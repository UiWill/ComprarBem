(()=>{"use strict";var a={452:(a,t,e)=>{e.d(t,{ND:()=>r});var o=e(9119);const i="https://ruagsbbczuwgfflgcaol.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1YWdzYmJjenV3Z2ZmbGdjYW9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ0Njg5MDQsImV4cCI6MjA2MDA0NDkwNH0.S2KD6-9DpBYAOsodjibI7LGa04CspZZ5OdRQagNjoK8",r=(0,o.UU)(i,s)},1291:(a,t,e)=>{var o=e(6848),i=function(){var a=this,t=a._self._c;return t("div",{attrs:{id:"app"}},[t("router-view"),t("AIChat")],1)},s=[],r=function(){var a=this,t=a._self._c;return t("div",{staticClass:"ai-chat",class:{"ai-chat--expanded":a.isExpanded}},[a.isExpanded?t("div",{staticClass:"ai-chat__window"},[t("div",{staticClass:"ai-chat__header"},[a._m(1),t("button",{staticClass:"ai-chat__close",on:{click:a.toggleChat}},[t("i",{staticClass:"fas fa-times"})])]),t("div",{ref:"messagesContainer",staticClass:"ai-chat__messages"},[a._l(a.messages,(function(e,o){return t("div",{key:o,class:["ai-chat__message",`ai-chat__message--${e.type}`]},["assistant"===e.type?t("div",{staticClass:"ai-chat__message-avatar"},[t("i",{staticClass:"fas fa-robot"}),t("i",{staticClass:"fas fa-bolt ai-chat__bolt-small"})]):a._e(),t("div",{staticClass:"ai-chat__message-content"},[a._v(a._s(e.text))])])})),a.isLoading?t("div",{staticClass:"ai-chat__message ai-chat__message--assistant"},[a._m(2),a._m(3)]):a._e()],2),t("div",{staticClass:"ai-chat__input"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.currentMessage,expression:"currentMessage"}],attrs:{placeholder:"Digite sua dúvida sobre licitações...",rows:"2"},domProps:{value:a.currentMessage},on:{keydown:function(t){return!t.type.indexOf("key")&&a._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),a.sendMessage.apply(null,arguments))},input:function(t){t.target.composing||(a.currentMessage=t.target.value)}}}),t("button",{staticClass:"ai-chat__send",attrs:{disabled:a.isLoading||!a.currentMessage.trim()},on:{click:a.sendMessage}},[t("i",{staticClass:"fas fa-paper-plane"})])])]):t("button",{staticClass:"ai-chat__button",attrs:{title:"QualiBot 2.0 - Seu Assistente de Licitações"},on:{click:a.toggleChat}},[a._m(0),a.hasInteracted?a._e():t("div",{staticClass:"ai-chat__notification"},[t("i",{staticClass:"fas fa-bolt"}),a._v(" Como posso ajudar? ")])])])},n=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"ai-chat__button-content"},[t("i",{staticClass:"fas fa-robot"}),t("span",{staticClass:"ai-chat__button-label"},[a._v("QualiBot 2.0")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"ai-chat__header-info"},[t("div",{staticClass:"ai-chat__logo"},[t("i",{staticClass:"fas fa-robot"}),t("i",{staticClass:"fas fa-bolt ai-chat__bolt"})]),t("div",[t("h3",[a._v("QualiBot 2.0")]),t("span",{staticClass:"ai-chat__status"},[t("span",{staticClass:"ai-chat__status-dot"}),a._v(" Online e Pronto ")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"ai-chat__message-avatar"},[t("i",{staticClass:"fas fa-robot"}),t("i",{staticClass:"fas fa-bolt ai-chat__bolt-small"})])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"ai-chat__typing"},[t("span"),t("span"),t("span")])}];const l="AIzaSyAf-Oe56q4Rao0OodEOtnEjtI_FpOmDg6I",c=!1,d=c?"https://cors-anywhere.herokuapp.com/":"https://seu-worker.seu-nome.workers.dev/",u="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent",m={async chat(a){try{const e=c?`${d}${u}?key=${l}`:d;console.log("Enviando requisição para:",e);const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Você é o QualiBot 2.0, um assistente especializado em licitações e compras públicas, com foco em ajudar os usuários de forma rápida e eficiente. Responda a seguinte pergunta de forma clara e objetiva, usando sua expertise em licitações: ${a}`}]}]})}),i=await o.text();let s;console.log("Resposta bruta:",i);try{s=JSON.parse(i)}catch(t){throw console.error("Erro ao fazer parse da resposta:",t),console.error("Resposta que causou erro:",i),new Error("Resposta inválida do servidor")}if(!o.ok)throw console.error("Erro detalhado da API:",s),new Error(s.error?.message||"Erro na comunicação com o servidor");if(!s.candidates||!s.candidates[0]?.content?.parts?.[0]?.text)throw console.error("Resposta sem o formato esperado:",s),new Error("Resposta inválida do servidor");return s.candidates[0].content.parts[0].text}catch(e){if(console.error("Erro ao chamar o serviço:",e),e.message.includes("Failed to fetch"))throw new Error("Não foi possível conectar ao servidor. Verifique sua conexão com a internet.");throw new Error("Não foi possível processar sua solicitação no momento. Por favor, tente novamente mais tarde.")}}},p={name:"AIChat",data(){return{isExpanded:!1,hasInteracted:!1,messages:[{type:"assistant",text:"Olá! Sou o QualiBot 2.0, seu assistente virtual especializado em licitações e compras públicas. Como posso ajudar hoje?"}],currentMessage:"",isLoading:!1}},methods:{toggleChat(){this.isExpanded=!this.isExpanded,this.hasInteracted=!0,this.isExpanded&&this.$nextTick((()=>{this.scrollToBottom()}))},async sendMessage(){if(!this.currentMessage.trim()||this.isLoading)return;const a=this.currentMessage.trim();this.messages.push({type:"user",text:a}),this.currentMessage="",this.isLoading=!0;try{const t=await m.chat(a);this.messages.push({type:"assistant",text:t})}catch(t){console.error("Erro no chat:",t),this.messages.push({type:"assistant",text:"Desculpe, estou enfrentando algumas dificuldades técnicas no momento. Nossa equipe já está trabalhando nisso. Por favor, tente novamente em alguns instantes ou, se preferir, entre em contato com o suporte através do menu principal."})}finally{this.isLoading=!1,this.$nextTick((()=>{this.scrollToBottom()}))}},scrollToBottom(){const a=this.$refs.messagesContainer;a.scrollTop=a.scrollHeight}}},v=p;var g=e(1656),_=(0,g.A)(v,r,n,!1,null,"4c6e95cc",null);const h=_.exports,f={name:"App",components:{AIChat:h}},C=f;var b=(0,g.A)(C,i,s,!1,null,null,null);const D=b.exports;var w=e(6178),E=function(){var a=this,t=a._self._c;return t("div",{staticClass:"home"},[t("Login")],1)},A=[],y=function(){var a=this,t=a._self._c;return t("div",{staticClass:"login-container"},[t("div",{staticClass:"login-card"},[t("h2",[a._v("Comprar Bem: Compras Inteligentes")]),t("p",[a._v("Saúde e Administração")]),t("div",{staticClass:"tabs"},[t("button",{class:{active:"login"===a.activeTab},on:{click:function(t){a.activeTab="login"}}},[a._v("Login")]),t("button",{class:{active:"register"===a.activeTab},on:{click:function(t){a.activeTab="register"}}},[a._v("Registrar")])]),"login"===a.activeTab?t("div",[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[a._v("E-mail")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.email,expression:"email"}],attrs:{id:"email",type:"email",placeholder:"Seu e-mail",required:""},domProps:{value:a.email},on:{input:function(t){t.target.composing||(a.email=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"password"}},[a._v("Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.password,expression:"password"}],attrs:{id:"password",type:"password",placeholder:"Sua senha",required:""},domProps:{value:a.password},on:{input:function(t){t.target.composing||(a.password=t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{disabled:a.loading},on:{click:a.login}},[a._v(" "+a._s(a.loading?"Entrando...":"Entrar")+" ")])]):a._e(),"register"===a.activeTab?t("div",[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registerEmail"}},[a._v("E-mail")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.registerEmail,expression:"registerEmail"}],attrs:{id:"registerEmail",type:"email",placeholder:"Seu e-mail",required:""},domProps:{value:a.registerEmail},on:{input:function(t){t.target.composing||(a.registerEmail=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registerPassword"}},[a._v("Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.registerPassword,expression:"registerPassword"}],attrs:{id:"registerPassword",type:"password",placeholder:"Sua senha",required:""},domProps:{value:a.registerPassword},on:{input:function(t){t.target.composing||(a.registerPassword=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"confirmPassword"}},[a._v("Confirmar Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.confirmPassword,expression:"confirmPassword"}],attrs:{id:"confirmPassword",type:"password",placeholder:"Confirme sua senha",required:""},domProps:{value:a.confirmPassword},on:{input:function(t){t.target.composing||(a.confirmPassword=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeInstitucional"}},[a._v("Nome da Instituição")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nomeInstitucional,expression:"nomeInstitucional"}],attrs:{id:"nomeInstitucional",type:"text",placeholder:"Nome da sua instituição",required:""},domProps:{value:a.nomeInstitucional},on:{input:function(t){t.target.composing||(a.nomeInstitucional=t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{type:"button"},on:{click:a.register}},[a._v(" "+a._s(a.loading?"Registrando...":"Registrar")+" ")]),t("button",{staticClass:"btn-test",staticStyle:{"margin-top":"10px"},on:{click:a.testeSimples}},[a._v(" Teste Simples ")]),a.validRegistration?a._e():t("div",{staticClass:"validation-info"},[t("p",[a._v("O formulário não está válido porque:")]),t("ul",[a.registerEmail?a._e():t("li",[a._v("Falta o e-mail")]),a.registerPassword?a._e():t("li",[a._v("Falta a senha")]),a.registerPassword&&a.registerPassword.length<6?t("li",[a._v("A senha precisa ter pelo menos 6 caracteres")]):a._e(),a.registerPassword!==a.confirmPassword?t("li",[a._v("As senhas não conferem")]):a._e(),a.nomeInstitucional?a._e():t("li",[a._v("Falta o nome da instituição")])])])]):a._e(),a.errorMsg?t("p",{staticClass:"error-message"},[a._v(a._s(a.errorMsg))]):a._e(),t("div",{staticClass:"rdm-access"},[t("hr",{staticStyle:{margin:"20px 0"}}),a._m(0),t("router-link",{staticClass:"btn-rdm",attrs:{to:"/rdm"}},[a._v(" 📝 Acessar Dashboard RDM ")]),t("p",{staticStyle:{"font-size":"12px",color:"#888","text-align":"center","margin-top":"10px"}},[a._v(" Para usuários cadastrados emitir Requisições de Materiais ")])],1),"register"===a.activeTab?t("div",{staticClass:"test-buttons"},[t("button",{staticClass:"btn-test",on:{click:a.testarSupabase}},[a._v("Testar Conexão Supabase")])]):a._e()])])},x=[function(){var a=this,t=a._self._c;return t("p",{staticStyle:{"text-align":"center",color:"#666","margin-bottom":"15px"}},[t("strong",[a._v("🏥 Sistema RDM Online")])])}],P=e(452),S=e(4963);const N={name:"Login",data(){return{activeTab:"login",email:"",password:"",registerEmail:"",registerPassword:"",confirmPassword:"",nomeInstitucional:"",loading:!1,errorMsg:""}},computed:{validRegistration(){return this.registerEmail&&this.registerPassword&&this.registerPassword===this.confirmPassword&&this.nomeInstitucional&&this.registerPassword.length>=6}},mounted(){console.log("Componente Login montado",{activeTab:this.activeTab})},watch:{activeTab(a){console.log("Aba ativa alterada para:",a)},registerEmail(a){console.log("E-mail de registro alterado:",a)},registerPassword(a){console.log("Senha de registro alterada:",a?"****":"")}},methods:{async testarSupabase(){console.log("Testando conexão com Supabase...");try{const{data:a,error:t}=await P.ND.from("tenants").select("*").limit(1);console.log("Resultado do teste tabela tenants:",{data:a,error:t}),t?alert(`Erro ao acessar tabela: ${t.message}`):alert(`Conexão OK! ${a?a.length:0} registros encontrados.`);const e=(0,S.A)();console.log("Teste UUID gerado:",e)}catch(a){console.error("Erro no teste:",a),alert(`Erro na conexão: ${a.message}`)}},async login(){try{this.loading=!0,this.errorMsg="";const{error:a}=await P.ND.auth.signInWithPassword({email:this.email,password:this.password});if(a)throw a;this.$router.push("/dashboard")}catch(a){this.errorMsg=a.message||"Erro ao fazer login"}finally{this.loading=!1}},async register(){if(console.log("Método register chamado",{email:this.registerEmail,password:"****",nomeInstitucional:this.nomeInstitucional}),!this.validRegistration)return console.log("Formulário inválido"),void(this.errorMsg="Verifique os campos do formulário");try{this.loading=!0,this.errorMsg="",console.log("Iniciando registro de usuário no Supabase...");const{data:t,error:e}=await P.ND.auth.signUp({email:this.registerEmail,password:this.registerPassword});if(console.log("Resposta do registro de usuário:",{authData:t,authError:e}),e&&!e.message.includes("already registered"))throw e;const o=t?.user?.id;console.log("ID da autenticação:",o);const i=(0,S.A)(),s=(0,S.A)();try{const{error:a}=await P.ND.from("usuarios").delete().eq("email",this.registerEmail);a&&console.warn("Aviso ao tentar remover usuário existente:",a)}catch(a){console.warn("Erro ao tentar remover usuário:",a)}console.log("Criando tenant...");const{data:r,error:n}=await P.ND.from("tenants").insert({id:i,nome:this.nomeInstitucional,descricao:`Tenant para ${this.registerEmail}`,ativo:!0}).select();if(n)throw new Error(`Erro ao criar tenant: ${n.message}`);console.log("Criando usuário...");const{data:l,error:c}=await P.ND.from("usuarios").insert({id:s,email:this.registerEmail,nome:this.nomeInstitucional,tenant_id:i,tipo:"admin",ativo:!0}).select();if(c)throw c.message.includes("duplicate key")?(this.errorMsg="Este email já está registrado. Por favor, contate o suporte.",new Error(`Email já existe na base de dados: ${c.message}`)):new Error(`Erro ao criar usuário: ${c.message}`);console.log("Atualizando tenant com user_id...");const{error:d}=await P.ND.from("tenants").update({user_id:o}).eq("id",i);d&&console.warn("Aviso: Não foi possível atualizar o tenant com user_id:",d),console.log("Registro concluído com sucesso!"),alert("Registro realizado com sucesso! Verifique seu e-mail para confirmar a conta."),this.activeTab="login",this.email=this.registerEmail}catch(t){console.error("Erro detalhado no registro:",t),this.errorMsg=this.errorMsg||t.message||"Erro ao fazer registro"}finally{this.loading=!1}},testeSimples(){console.log("Botão de teste simples clicado"),alert("Teste de evento de clique funcionando!")}}},R=N;var I=(0,g.A)(R,y,x,!1,null,"6d99fded",null);const M=I.exports,$={name:"Home",components:{Login:M}},T=$;var k=(0,g.A)(T,E,A,!1,null,null,null);const O=k.exports;var B=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("▼")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("DashboardCPM")],1)])},F=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])}],z=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard"},[t("h2",[a._v("Painel CPM")]),t("div",{staticClass:"tabs"},[t("div",{staticClass:"tab",class:{active:"dashboard"===a.activeTab},on:{click:function(t){a.activeTab="dashboard"}}},[a._v(" Dashboard ")]),t("div",{staticClass:"tab",class:{active:"editais"===a.activeTab},on:{click:function(t){a.activeTab="editais"}}},[a._v(" Editais de Pré-Qualificação ")]),t("div",{staticClass:"tab",class:{active:"pesquisa"===a.activeTab},on:{click:function(t){a.activeTab="pesquisa"}}},[a._v(" Pesquisa de Mercado ")]),t("div",{staticClass:"tab",class:{active:"despadronizadas"===a.activeTab},on:{click:function(t){a.activeTab="despadronizadas"}}},[a._v(" Marcas Despadronizadas ")]),t("div",{staticClass:"tab",class:{active:"certificados"===a.activeTab},on:{click:function(t){a.activeTab="certificados"}}},[a._v(" Emissão de Certificados (DCB) ")]),t("div",{staticClass:"tab",class:{active:"usuarios"===a.activeTab},on:{click:function(t){a.activeTab="usuarios"}}},[a._v(" Cadastro de Usuários ")]),t("div",{staticClass:"tab",class:{active:"reclamacoes"===a.activeTab},on:{click:function(t){a.activeTab="reclamacoes"}}},[a._v(" Avaliações de Usuários ")])]),"dashboard"===a.activeTab?t("div",[t("div",{staticClass:"stats-container"},[t("div",{staticClass:"stat-card status-pendente-card"},[t("h3",[a._v("Produtos em Avaliação")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.pendentes))])]),t("div",{staticClass:"stat-card status-aprovado-card"},[t("h3",[a._v("Produtos Aprovados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.aprovados))])]),t("div",{staticClass:"stat-card status-reprovado-card"},[t("h3",[a._v("Produtos Reprovados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.reprovados))])])]),t("div",{staticClass:"recent-products"},[t("div",{staticClass:"section-header"},[t("h3",[a._v("📋 Requerimentos Recentes")]),t("div",{staticClass:"pagination-controls"},[t("label",[a._v("Itens por página:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.itensPorPagina,expression:"itensPorPagina"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.itensPorPagina=t.target.multiple?e:e[0]},a.aplicarPaginacao]}},[t("option",{attrs:{value:"5"}},[a._v("5")]),t("option",{attrs:{value:"10"}},[a._v("10")]),t("option",{attrs:{value:"20"}},[a._v("20")]),t("option",{attrs:{value:"50"}},[a._v("50")])])])]),t("div",{staticClass:"filtros-inline"},[t("div",{staticClass:"filtro-inline"},[t("label",[a._v("🔤 Nome:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.nome,expression:"filtros.nome"}],attrs:{type:"text",placeholder:"Filtrar por nome..."},domProps:{value:a.filtros.nome},on:{input:[function(t){t.target.composing||a.$set(a.filtros,"nome",t.target.value)},a.aplicarFiltros]}})]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("🏷️ Marca:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.marca,expression:"filtros.marca"}],attrs:{type:"text",placeholder:"Filtrar por marca..."},domProps:{value:a.filtros.marca},on:{input:[function(t){t.target.composing||a.$set(a.filtros,"marca",t.target.value)},a.aplicarFiltros]}})]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("📊 Status:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtros.status,expression:"filtros.status"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtros,"status",t.target.multiple?e:e[0])},a.aplicarFiltros]}},[t("option",{attrs:{value:""}},[a._v("Todos")]),t("option",{attrs:{value:"pendente"}},[a._v("Em Avaliação")]),t("option",{attrs:{value:"aprovado"}},[a._v("Aprovado")]),t("option",{attrs:{value:"reprovado"}},[a._v("Reprovado")]),t("option",{attrs:{value:"em_analise"}},[a._v("Em Análise")])])]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("📅 Data:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.data,expression:"filtros.data"}],attrs:{type:"date"},domProps:{value:a.filtros.data},on:{change:a.aplicarFiltros,input:function(t){t.target.composing||a.$set(a.filtros,"data",t.target.value)}}})]),t("button",{staticClass:"btn-limpar-filtros",on:{click:a.limparFiltros}},[a._v(" 🗑️ Limpar ")])]),a.produtosPaginados.length>0?t("table",[a._m(0),t("tbody",a._l(a.produtosPaginados,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.marca))]),t("td",["aprovado"===e.status?t("span",{staticStyle:{"background-color":"#2ecc71",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")]):"pendente"===e.status?t("span",{staticStyle:{"background-color":"#f39c12",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")]):"reprovado"===e.status?t("span",{staticStyle:{"background-color":"#e74c3c",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")]):"em_analise"===e.status?t("span",{staticStyle:{"background-color":"#3498db",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")]):"diligencia"===e.status?t("span",{staticStyle:{"background-color":"#9b59b6",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")]):t("span",{staticStyle:{"background-color":"#6c757d",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")])]),t("td",[a._v(a._s(a.formatDate(e.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.verProduto(e.id)}}},[a._v("Visualizar")])])])})),0)]):a._e(),a.totalPaginas>1?t("div",{staticClass:"paginacao"},[t("div",{staticClass:"paginacao-info"},[a._v(" Página "+a._s(a.paginaAtual)+" de "+a._s(a.totalPaginas)+" ")]),t("div",{staticClass:"paginacao-botoes"},[t("button",{staticClass:"btn-paginacao",attrs:{disabled:1===a.paginaAtual},on:{click:function(t){return a.irParaPagina(a.paginaAtual-1)}}},[a._v(" ◀️ Anterior ")]),t("span",{staticClass:"numeros-pagina"},a._l(a.paginasVisiveis,(function(e){return t("button",{key:e,class:["btn-numero",{active:e===a.paginaAtual}],on:{click:function(t){return a.irParaPagina(e)}}},[a._v(" "+a._s(e)+" ")])})),0),t("button",{staticClass:"btn-paginacao",attrs:{disabled:a.paginaAtual===a.totalPaginas},on:{click:function(t){return a.irParaPagina(a.paginaAtual+1)}}},[a._v(" ▶️ Próxima ")])])]):0===a.produtos.length?t("p",[a._v("Nenhum requerimento cadastrado.")]):a.temFiltrosAplicados?t("p",[a._v("Nenhum produto encontrado com os filtros aplicados.")]):a._e()]),t("div",{staticClass:"diligencia-section"},[t("div",{staticClass:"section-header"},[t("h3",[a._v("🔍 Requerimentos com Diligências")]),t("div",{staticClass:"pagination-controls"},[t("label",[a._v("Itens por página:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.itensPorPaginaDiligencia,expression:"itensPorPaginaDiligencia"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.itensPorPaginaDiligencia=t.target.multiple?e:e[0]},a.aplicarPaginacaoDiligencia]}},[t("option",{attrs:{value:"5"}},[a._v("5")]),t("option",{attrs:{value:"10"}},[a._v("10")]),t("option",{attrs:{value:"20"}},[a._v("20")])])])]),t("div",{staticClass:"filtros-inline"},[t("div",{staticClass:"filtro-inline"},[t("label",[a._v("🔍 Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDiligencia.busca,expression:"filtrosDiligencia.busca"}],attrs:{type:"text",placeholder:"Nome, marca ou fabricante..."},domProps:{value:a.filtrosDiligencia.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtrosDiligencia,"busca",t.target.value)},a.aplicarFiltrosDiligencia]}})]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("🏷️ Marca:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDiligencia.marca,expression:"filtrosDiligencia.marca"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtrosDiligencia,"marca",t.target.multiple?e:e[0])},a.aplicarFiltrosDiligencia]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),a._l(a.marcasUnicas,(function(e){return t("option",{key:e,domProps:{value:e}},[a._v(" "+a._s(e)+" ")])}))],2)]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("📅 Data:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDiligencia.data,expression:"filtrosDiligencia.data"}],attrs:{type:"date"},domProps:{value:a.filtrosDiligencia.data},on:{change:a.aplicarFiltrosDiligencia,input:function(t){t.target.composing||a.$set(a.filtrosDiligencia,"data",t.target.value)}}})]),t("button",{staticClass:"btn-limpar-filtros",on:{click:a.limparFiltrosDiligencia}},[a._v(" 🗑️ Limpar ")])]),a.diligenciasPaginadas.length>0?t("table",[a._m(1),t("tbody",a._l(a.diligenciasPaginadas,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.marca))]),a._m(2,!0),t("td",[a._v(a._s(a.formatDate(e.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.verProduto(e.id)}}},[a._v("Visualizar")]),t("button",{staticClass:"btn-small btn-diligencia",on:{click:function(t){return a.visualizarDiligencias(e.id)}}},[a._v("Ver Diligências")])])])})),0)]):a._e(),a.totalPaginasDiligencia>1?t("div",{staticClass:"paginacao"},[t("div",{staticClass:"paginacao-info"},[a._v(" Página "+a._s(a.paginaAtualDiligencia)+" de "+a._s(a.totalPaginasDiligencia)+" ")]),t("div",{staticClass:"paginacao-botoes"},[t("button",{staticClass:"btn-paginacao",attrs:{disabled:1===a.paginaAtualDiligencia},on:{click:function(t){return a.irParaPaginaDiligencia(a.paginaAtualDiligencia-1)}}},[a._v(" ◀️ Anterior ")]),t("span",{staticClass:"numeros-pagina"},a._l(a.paginasVisiveisDiligencia,(function(e){return t("button",{key:e,class:["btn-numero",{active:e===a.paginaAtualDiligencia}],on:{click:function(t){return a.irParaPaginaDiligencia(e)}}},[a._v(" "+a._s(e)+" ")])})),0),t("button",{staticClass:"btn-paginacao",attrs:{disabled:a.paginaAtualDiligencia===a.totalPaginasDiligencia},on:{click:function(t){return a.irParaPaginaDiligencia(a.paginaAtualDiligencia+1)}}},[a._v(" ▶️ Próxima ")])])]):0===a.produtosComDiligencia.length?t("p",[a._v("Nenhum requerimento com diligência encontrado.")]):a.temFiltrosDiligenciaAplicados?t("p",[a._v("Nenhuma diligência encontrada com os filtros aplicados.")]):a._e()]),t("div",{staticClass:"impugnacoes-section"},[t("h3",[a._v("Impugnações ao Edital")]),a.impugnacoes.length>0?t("table",[a._m(3),t("tbody",a._l(a.impugnacoes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.impugnante))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[a._v(a._s(a.formatDate(e.data_impugnacao)))]),t("td",[a._v(a._s(a.formatDate(e.prazo_final)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getImpugnacaoStatusClass(e.status)},[a._v(" "+a._s(e.status)+" ")])]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.analisarImpugnacao(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("Não há impugnações apresentadas.")])])]):a._e(),"pesquisa"===a.activeTab?t("div",{staticClass:"pesquisa-mercado"},[a._m(4)]):a._e(),"editais"===a.activeTab?t("div",{staticClass:"editais"},[t("div",{staticClass:"editais-container"},[t("div",{staticClass:"editais-stats"},[t("div",{staticClass:"stat-card editais-ativos"},[t("h4",[a._v("📋 Publicados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.editaisAtivos.length))]),t("small",[a._v("Recebendo documentação")])]),t("div",{staticClass:"stat-card editais-rascunho"},[t("h4",[a._v("✏️ Em Elaboração")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.editaisRascunho.length))]),t("small",[a._v("Aguardando publicação")])]),t("div",{staticClass:"stat-card editais-finalizados"},[t("h4",[a._v("✅ Finalizados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.editaisFinalizados.length))]),t("small",[a._v("Processos concluídos")])])]),t("div",{staticClass:"editais-actions"},[t("div",{staticClass:"actions-left"},[t("button",{staticClass:"btn-primary",on:{click:a.abrirModalNovoEdital}},[a._v(" ➕ Novo Edital ")]),t("button",{staticClass:"btn-secondary",attrs:{disabled:a.loadingEditais},on:{click:a.carregarEditais}},[a._v(" 🔄 Atualizar ")])]),t("div",{staticClass:"actions-right"},[t("div",{staticClass:"filtro-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroEditais.busca,expression:"filtroEditais.busca"}],attrs:{type:"text",placeholder:"🔍 Buscar edital..."},domProps:{value:a.filtroEditais.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtroEditais,"busca",t.target.value)},a.aplicarFiltrosEditais]}})]),t("div",{staticClass:"filtro-group"},[t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtroEditais.status,expression:"filtroEditais.status"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtroEditais,"status",t.target.multiple?e:e[0])},a.aplicarFiltrosEditais]}},[t("option",{attrs:{value:""}},[a._v("Todos os Status")]),t("option",{attrs:{value:"RASCUNHO"}},[a._v("📝 Em Elaboração")]),t("option",{attrs:{value:"PUBLICADO"}},[a._v("📋 Publicado")]),t("option",{attrs:{value:"CANCELADO"}},[a._v("❌ Cancelado")])])])])]),a.loadingEditais?t("div",{staticClass:"loading-state"},[t("div",{staticClass:"loading-spinner"}),t("p",[a._v("Carregando editais...")])]):a.editaisFiltrados.length>0?t("div",{staticClass:"editais-grid"},a._l(a.editaisFiltrados,(function(e){return t("div",{key:e.id,staticClass:"edital-card",class:{"status-ativo":"PUBLICADO"===e.status,"status-rascunho":"RASCUNHO"===e.status,"status-cancelado":"CANCELADO"===e.status}},[t("div",{staticClass:"edital-header"},[t("div",{staticClass:"edital-numero"},[a._v(a._s(e.numero))]),t("div",{staticClass:"edital-status"},["PUBLICADO"===e.status?t("span",{staticClass:"badge status-publicado"},[a._v("📋 Publicado")]):"RASCUNHO"===e.status?t("span",{staticClass:"badge status-rascunho"},[a._v("✏️ Em Elaboração")]):"CANCELADO"===e.status?t("span",{staticClass:"badge status-cancelado"},[a._v("❌ Cancelado")]):a._e()])]),t("div",{staticClass:"edital-content"},[t("h4",[a._v(a._s(e.descricao))]),t("div",{staticClass:"edital-info"},["PUBLICADO"===e.status?[t("p",[t("strong",[a._v("📅 Publicação:")]),a._v(" "+a._s(a.formatDate(e.data_publicacao)))]),e.data_limite_impugnacao?t("p",[t("strong",[a._v("⏰ Prazo Impugnação:")]),a._v(" "+a._s(a.formatDate(e.data_limite_impugnacao))+" ")]):a._e()]:a._e()],2)]),t("div",{staticClass:"edital-actions"},[t("button",{staticClass:"btn-secondary btn-small",on:{click:function(t){return a.visualizarEdital(e)}}},[a._v(" 👁️ Visualizar ")]),"RASCUNHO"===e.status?t("button",{staticClass:"btn-primary btn-small",on:{click:function(t){return a.editarEdital(e)}}},[a._v(" ✏️ Editar ")]):a._e(),t("div",{staticClass:"dropdown"},[t("button",{staticClass:"btn-secondary btn-small dropdown-toggle"},[a._v("⋮")]),t("div",{staticClass:"dropdown-menu"},[e.url_documento?t("a",{on:{click:function(t){return a.baixarDocumento(e)}}},[a._v("📥 Baixar PDF")]):a._e(),t("a",{on:{click:function(t){return a.duplicarEdital(e)}}},[a._v("📋 Duplicar")]),"RASCUNHO"===e.status?t("a",{staticClass:"text-danger",on:{click:function(t){return a.cancelarEdital(e)}}},[a._v("❌ Cancelar")]):a._e()])])])])})),0):t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("📋")]),t("h3",[a._v("Nenhum edital encontrado")]),a.filtroEditais.busca||a.filtroEditais.status?t("p",[a._v(" Nenhum edital corresponde aos filtros aplicados. ")]):t("p",[a._v(' Ainda não há editais cadastrados. Clique em "Novo Edital" para começar. ')]),t("button",{staticClass:"btn-primary",on:{click:a.abrirModalNovoEdital}},[a._v(" ➕ Criar Primeiro Edital ")])])]),a.modalNovoEdital?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalNovoEdital}},[t("div",{staticClass:"modal-content large",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.modoEdicaoEdital?"✏️ Editar Edital":"➕ Novo Edital de Pré-Qualificação"))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalNovoEdital}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarEdital.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"numero"}},[a._v("Número do Edital*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.editalAtual.numero,expression:"editalAtual.numero"}],attrs:{id:"numero",type:"text",placeholder:"Ex: 001/2024",required:""},domProps:{value:a.editalAtual.numero},on:{input:function(t){t.target.composing||a.$set(a.editalAtual,"numero",t.target.value)}}}),t("small",[a._v("Formato sugerido: 001/2024, 002/2024...")])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"status"}},[a._v("Status*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.editalAtual.status,expression:"editalAtual.status"}],attrs:{id:"status",required:""},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.editalAtual,"status",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:"RASCUNHO"}},[a._v("✏️ Em Elaboração")]),t("option",{attrs:{value:"PUBLICADO"}},[a._v("📋 Publicado")])])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descrição/Objeto*")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.editalAtual.descricao,expression:"editalAtual.descricao"}],attrs:{id:"descricao",rows:"3",placeholder:"Ex: Pré-qualificação técnica de medicamentos básicos para unidades de saúde",required:""},domProps:{value:a.editalAtual.descricao},on:{input:function(t){t.target.composing||a.$set(a.editalAtual,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"conteudo"}},[a._v("Conteúdo Detalhado")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.editalAtual.conteudo,expression:"editalAtual.conteudo"}],attrs:{id:"conteudo",rows:"6",placeholder:"Detalhes técnicos, especificações, critérios de avaliação..."},domProps:{value:a.editalAtual.conteudo},on:{input:function(t){t.target.composing||a.$set(a.editalAtual,"conteudo",t.target.value)}}})]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"data_publicacao"}},[a._v("Data de Publicação")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.editalAtual.data_publicacao,expression:"editalAtual.data_publicacao"}],attrs:{id:"data_publicacao",type:"datetime-local"},domProps:{value:a.editalAtual.data_publicacao},on:{input:function(t){t.target.composing||a.$set(a.editalAtual,"data_publicacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"data_limite_impugnacao"}},[a._v("Prazo para Impugnações")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.editalAtual.data_limite_impugnacao,expression:"editalAtual.data_limite_impugnacao"}],attrs:{id:"data_limite_impugnacao",type:"datetime-local",min:a.editalAtual.data_publicacao},domProps:{value:a.editalAtual.data_limite_impugnacao},on:{change:a.validarDataLimite,input:function(t){t.target.composing||a.$set(a.editalAtual,"data_limite_impugnacao",t.target.value)}}}),a.editalAtual.data_publicacao?t("small",{staticClass:"form-text text-muted"},[a._v(" ⚠️ Deve ser posterior à data de publicação ("+a._s(a.formatDate(a.editalAtual.data_publicacao))+") ")]):a._e()])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"arquivo"}},[a._v("Upload do Edital (PDF)")]),t("input",{attrs:{id:"arquivo",type:"file",accept:".pdf"},on:{change:a.handleFileUpload}}),t("small",[a._v("Arquivo PDF com o edital completo (máximo 10MB)")])]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharModalNovoEdital}},[a._v(" Cancelar ")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.salvandoEdital}},[a._v(" "+a._s(a.salvandoEdital?"Salvando...":a.modoEdicaoEdital?"Atualizar":"Criar Edital")+" ")])])])])])]):a._e(),a.modalVisualizarEdital?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalVisualizarEdital}},[t("div",{staticClass:"modal-content large",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("👁️ "+a._s(a.editalSelecionado.numero)+" - "+a._s(a.editalSelecionado.descricao))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalVisualizarEdital}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"edital-detalhes"},[t("div",{staticClass:"info-section"},[t("h4",[a._v("📋 Informações Gerais")]),t("div",{staticClass:"info-grid"},[t("div",[t("strong",[a._v("Número:")]),a._v(" "+a._s(a.editalSelecionado.numero))]),t("div",[t("strong",[a._v("Status:")]),t("span",{class:"badge status-"+a.editalSelecionado.status.toLowerCase()},[a._v(" "+a._s(a.editalSelecionado.status)+" ")])]),"PUBLICADO"===a.editalSelecionado.status?[t("div",[t("strong",[a._v("Data Publicação:")]),a._v(" "+a._s(a.formatDate(a.editalSelecionado.data_publicacao)))]),a.editalSelecionado.data_limite_impugnacao?t("div",[t("strong",[a._v("Prazo Impugnação:")]),a._v(" "+a._s(a.formatDate(a.editalSelecionado.data_limite_impugnacao))+" ")]):a._e()]:a._e()],2)]),a.editalSelecionado.conteudo?t("div",{staticClass:"info-section"},[t("h4",[a._v("📄 Conteúdo")]),t("div",{staticClass:"conteudo-texto"},[a._v(a._s(a.editalSelecionado.conteudo))])]):a._e(),t("div",{staticClass:"info-section"},[t("h4",[a._v("📊 Estatísticas")]),t("div",{staticClass:"stats-grid"},[t("div",{staticClass:"mini-stat"}),t("div",{staticClass:"mini-stat"},[t("span",{staticClass:"mini-stat-value"},[a._v(a._s(a.editalSelecionado.produtos_submetidos||0))]),t("span",{staticClass:"mini-stat-label"},[a._v("Produtos Submetidos")])]),t("div",{staticClass:"mini-stat"},[t("span",{staticClass:"mini-stat-value"},[a._v(a._s(a.editalSelecionado.impugnacoes_count||0))]),t("span",{staticClass:"mini-stat-label"},[a._v("Impugnações")])])])])]),t("div",{staticClass:"modal-actions"},[a.editalSelecionado.url_documento?t("button",{staticClass:"btn-primary",on:{click:function(t){return a.abrirDocumento(a.editalSelecionado.url_documento)}}},[a._v(" 📄 Abrir PDF ")]):a._e(),a.editalSelecionado.url_documento?t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.baixarDocumento(a.editalSelecionado)}}},[a._v(" 📥 Baixar PDF ")]):a._e(),"RASCUNHO"===a.editalSelecionado.status?t("button",{staticClass:"btn-secondary",on:{click:a.editarEditalSelecionado}},[a._v(" ✏️ Editar ")]):a._e(),t("button",{staticClass:"btn-secondary",on:{click:a.fecharModalVisualizarEdital}},[a._v(" Fechar ")])])])])]):a._e()]):a._e(),"despadronizadas"===a.activeTab?t("div",{staticClass:"marcas-despadronizadas"},[a._m(5)]):a._e(),"certificados"===a.activeTab?t("div",{staticClass:"certificados-dcb"},[t("div",{staticClass:"dcb-container"},[t("div",{staticClass:"dcb-stats"},[t("div",{staticClass:"stat-card dcb-pendentes"},[t("h4",[a._v("🟡 Prontos para DCB")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.produtosProntosDCB.length))]),t("small",[a._v("Produtos aprovados sem DCB")])]),t("div",{staticClass:"stat-card dcb-emitidos"},[t("h4",[a._v("✅ DCBs Emitidas")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.dcbsEmitidos.length))]),t("small",[a._v("Certificados válidos")])]),t("div",{staticClass:"stat-card dcb-vencendo"},[t("h4",[a._v("⚠️ DCBs Vencendo")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.dcbsVencendo.length))]),t("small",[a._v("Próximos 30 dias")])]),t("div",{staticClass:"stat-card dcb-vencidos"},[t("h4",[a._v("🔴 DCBs Vencidas")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.dcbsVencidos.length))]),t("small",[a._v("Precisam renovação")])])]),t("div",{staticClass:"dcb-tabs"},[t("div",{staticClass:"dcb-tab",class:{active:"emitir"===a.activeTabDCB},on:{click:function(t){a.activeTabDCB="emitir"}}},[a._v(" 📝 Emitir DCB ")]),t("div",{staticClass:"dcb-tab",class:{active:"historico"===a.activeTabDCB},on:{click:function(t){a.activeTabDCB="historico"}}},[a._v(" 📋 Histórico DCBs ")]),t("div",{staticClass:"dcb-tab",class:{active:"vencimentos"===a.activeTabDCB},on:{click:function(t){a.activeTabDCB="vencimentos"}}},[a._v(" ⏰ Controle Vencimentos ")])]),"emitir"===a.activeTabDCB?t("div",{staticClass:"dcb-content"},[a._m(6),t("div",{staticClass:"filtros-dcb"},[t("div",{staticClass:"filtro-group"},[t("label",[a._v("🔍 Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDCB.busca,expression:"filtrosDCB.busca"}],attrs:{type:"text",placeholder:"Nome, marca ou fabricante..."},domProps:{value:a.filtrosDCB.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtrosDCB,"busca",t.target.value)},a.aplicarFiltrosDCB]}})]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("📂 Categoria:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDCB.categoria,expression:"filtrosDCB.categoria"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtrosDCB,"categoria",t.target.multiple?e:e[0])},a.aplicarFiltrosDCB]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),t("option",{attrs:{value:"medicamentos"}},[a._v("Medicamentos")]),t("option",{attrs:{value:"materiais_medicos"}},[a._v("Materiais Médicos")]),t("option",{attrs:{value:"equipamentos"}},[a._v("Equipamentos")]),t("option",{attrs:{value:"administrativo"}},[a._v("Administrativo")])])]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("📅 Data Aprovação:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDCB.dataAprovacao,expression:"filtrosDCB.dataAprovacao"}],attrs:{type:"date"},domProps:{value:a.filtrosDCB.dataAprovacao},on:{change:a.aplicarFiltrosDCB,input:function(t){t.target.composing||a.$set(a.filtrosDCB,"dataAprovacao",t.target.value)}}})]),t("button",{staticClass:"btn-limpar",on:{click:a.limparFiltrosDCB}},[a._v("🗑️ Limpar")])]),a.produtosProntosDCBFiltrados.length>0?t("div",{staticClass:"produtos-dcb-lista"},a._l(a.produtosProntosDCBFiltrados,(function(e){return t("div",{key:e.id,staticClass:"produto-dcb-card"},[t("div",{staticClass:"produto-info"},[t("div",{staticClass:"produto-header"},[t("h4",[a._v(a._s(e.nome))]),t("span",{staticClass:"status-badge status-aprovado"},[a._v("✅ Aprovado")])]),t("div",{staticClass:"produto-details"},[t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(e.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(e.modelo||"N/A"))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(e.fabricante))]),t("p",[t("strong",[a._v("Data Aprovação:")]),a._v(" "+a._s(a.formatDate(e.data_aprovacao||e.aprovado_em||e.criado_em)))])])]),t("div",{staticClass:"produto-actions"},[t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.visualizarProdutoDetalhes(e)}}},[a._v(" 👁️ Detalhes ")]),t("button",{staticClass:"btn-primary",attrs:{disabled:a.emitindoDCB===e.id},on:{click:function(t){return a.emitirDCB(e)}}},[a.emitindoDCB===e.id?t("span",[a._v("⏳ Emitindo...")]):t("span",[a._v("📜 Emitir DCB")])])])])})),0):0===a.produtosProntosDCB.length?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("📝")]),t("h3",[a._v("Nenhum produto pronto para DCB")]),t("p",[a._v("Todos os produtos aprovados já possuem DCB emitido ou não há produtos aprovados.")])]):t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("🔍")]),t("h3",[a._v("Nenhum produto encontrado")]),t("p",[a._v("Nenhum produto corresponde aos filtros aplicados.")])])]):a._e(),"historico"===a.activeTabDCB?t("div",{staticClass:"dcb-content"},[a._m(7),t("div",{staticClass:"filtros-dcb"},[t("div",{staticClass:"filtro-group"},[t("label",[a._v("🔢 Número DCB:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosHistorico.numeroDCB,expression:"filtrosHistorico.numeroDCB"}],attrs:{type:"text",placeholder:"Ex: 001/2024"},domProps:{value:a.filtrosHistorico.numeroDCB},on:{input:[function(t){t.target.composing||a.$set(a.filtrosHistorico,"numeroDCB",t.target.value)},a.aplicarFiltrosHistorico]}})]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("📊 Status:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtrosHistorico.status,expression:"filtrosHistorico.status"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtrosHistorico,"status",t.target.multiple?e:e[0])},a.aplicarFiltrosHistorico]}},[t("option",{attrs:{value:""}},[a._v("Todos")]),t("option",{attrs:{value:"ativo"}},[a._v("Ativo")]),t("option",{attrs:{value:"vencido"}},[a._v("Vencido")]),t("option",{attrs:{value:"revogado"}},[a._v("Revogado")])])]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("📅 Período:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosHistorico.dataInicio,expression:"filtrosHistorico.dataInicio"}],attrs:{type:"date"},domProps:{value:a.filtrosHistorico.dataInicio},on:{change:a.aplicarFiltrosHistorico,input:function(t){t.target.composing||a.$set(a.filtrosHistorico,"dataInicio",t.target.value)}}}),t("span",[a._v("até")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosHistorico.dataFim,expression:"filtrosHistorico.dataFim"}],attrs:{type:"date"},domProps:{value:a.filtrosHistorico.dataFim},on:{change:a.aplicarFiltrosHistorico,input:function(t){t.target.composing||a.$set(a.filtrosHistorico,"dataFim",t.target.value)}}})])]),a.dcbsHistoricoFiltrados.length>0?t("div",{staticClass:"dcb-historico-tabela"},[t("table",[a._m(8),t("tbody",a._l(a.dcbsHistoricoFiltrados,(function(e){return t("tr",{key:e.id},[t("td",{staticClass:"dcb-numero"},[a._v(a._s(e.numero_dcb))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[a._v(a._s(e.produto_marca))]),t("td",[a._v(a._s(a.formatDate(e.data_emissao)))]),t("td",[a._v(a._s(a.formatDate(e.data_validade)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusDCBClass(e.status)},[a._v(" "+a._s(a.formatStatusDCB(e.status))+" ")])]),t("td",[t("div",{staticClass:"acoes-dcb"},[t("button",{staticClass:"btn-small",on:{click:function(t){return a.visualizarDCB(e)}}},[a._v(" 👁️ Ver ")]),t("button",{staticClass:"btn-small",on:{click:function(t){return a.downloadDCB(e)}}},[a._v(" 📥 PDF ")]),"ativo"===e.status?t("button",{staticClass:"btn-small btn-danger",on:{click:function(t){return a.revogarDCB(e)}}},[a._v(" 🚫 Revogar ")]):a._e()])])])})),0)])]):t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("📋")]),t("h3",[a._v("Nenhum DCB encontrado")]),t("p",[a._v("Nenhum certificado corresponde aos filtros aplicados.")])])]):a._e(),"vencimentos"===a.activeTabDCB?t("div",{staticClass:"dcb-content"},[a._m(9),t("div",{staticClass:"alertas-vencimento"},[a.dcbsVencendo.length>0?t("div",{staticClass:"alerta-warning"},[t("div",{staticClass:"alerta-icon"},[a._v("⚠️")]),t("div",{staticClass:"alerta-content"},[t("h4",[a._v(a._s(a.dcbsVencendo.length)+" DCB(s) vencendo nos próximos 30 dias")]),t("p",[a._v("É recomendado iniciar o processo de renovação.")])])]):a._e(),a.dcbsVencidos.length>0?t("div",{staticClass:"alerta-danger"},[t("div",{staticClass:"alerta-icon"},[a._v("🔴")]),t("div",{staticClass:"alerta-content"},[t("h4",[a._v(a._s(a.dcbsVencidos.length)+" DCB(s) vencido(s)")]),t("p",[a._v("Produtos não podem ser utilizados em licitações até renovação.")])])]):a._e()]),a.dcbsVencendo.length>0?t("div",{staticClass:"dcb-vencimento-section"},[t("h4",[a._v("⚠️ DCBs Vencendo (Próximos 30 dias)")]),t("div",{staticClass:"dcb-vencimento-lista"},a._l(a.dcbsVencendo,(function(e){return t("div",{key:e.id,staticClass:"dcb-vencimento-card warning"},[t("div",{staticClass:"dcb-info"},[t("h5",[a._v(a._s(e.numero_dcb)+" - "+a._s(e.produto_nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(e.produto_marca))]),t("p",[t("strong",[a._v("Vence em:")]),a._v(" "+a._s(a.formatDate(e.data_validade)))]),t("p",[t("strong",[a._v("Dias restantes:")]),a._v(" "+a._s(a.calcularDiasRestantes(e.data_validade)))])]),t("div",{staticClass:"dcb-actions"},[t("button",{staticClass:"btn-warning",on:{click:function(t){return a.iniciarRenovacao(e)}}},[a._v(" 🔄 Renovar ")]),t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.visualizarDCB(e)}}},[a._v(" 👁️ Ver DCB ")])])])})),0)]):a._e(),a.dcbsVencidos.length>0?t("div",{staticClass:"dcb-vencimento-section"},[t("h4",[a._v("🔴 DCBs Vencidos")]),t("div",{staticClass:"dcb-vencimento-lista"},a._l(a.dcbsVencidos,(function(e){return t("div",{key:e.id,staticClass:"dcb-vencimento-card danger"},[t("div",{staticClass:"dcb-info"},[t("h5",[a._v(a._s(e.numero_dcb)+" - "+a._s(e.produto_nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(e.produto_marca))]),t("p",[t("strong",[a._v("Venceu em:")]),a._v(" "+a._s(a.formatDate(e.data_validade)))]),t("p",[t("strong",[a._v("Vencido há:")]),a._v(" "+a._s(a.calcularDiasVencidos(e.data_validade))+" dias")])]),t("div",{staticClass:"dcb-actions"},[t("button",{staticClass:"btn-danger",on:{click:function(t){return a.renovarDCBVencido(e)}}},[a._v(" 🔄 Renovar Urgente ")]),t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.visualizarDCB(e)}}},[a._v(" 👁️ Ver DCB ")])])])})),0)]):a._e(),0===a.dcbsVencendo.length&&0===a.dcbsVencidos.length?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("✅")]),t("h3",[a._v("Todos os DCBs estão em dia!")]),t("p",[a._v("Não há certificados vencidos ou próximos ao vencimento.")])]):a._e()]):a._e()]),a.modalProdutoDetalhes?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalDetalhes}},[t("div",{staticClass:"modal-content produto-detalhes-modal",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("📋 Detalhes do Produto")]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalDetalhes}},[a._v("✕")])]),a.produtoSelecionado?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"produto-detalhes-grid"},[t("div",{staticClass:"detalhes-section"},[t("h4",[a._v("📦 Informações Básicas")]),t("p",[t("strong",[a._v("Nome:")]),a._v(" "+a._s(a.produtoSelecionado.nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoSelecionado.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoSelecionado.modelo||"N/A"))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoSelecionado.fabricante))]),t("p",[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produtoSelecionado.cnpj_fabricante||a.produtoSelecionado.cnpj||"Não informado"))])]),t("div",{staticClass:"detalhes-section"},[t("h4",[a._v("✅ Status da Aprovação")]),t("p",[t("strong",[a._v("Status:")]),t("span",{staticClass:"status-badge status-aprovado"},[a._v(a._s(a.formatarStatus(a.produtoSelecionado.status)))])]),t("p",[t("strong",[a._v("Data Aprovação:")]),a._v(" "+a._s(a.formatDate(a.produtoSelecionado.data_aprovacao||a.produtoSelecionado.aprovado_em||a.produtoSelecionado.criado_em)))]),t("p",[t("strong",[a._v("Aprovado por:")]),a._v(" "+a._s(a.produtoSelecionado.aprovado_por_nome||"Sistema"))])])]),a.produtoSelecionado.especificacoes_tecnicas?t("div",{staticClass:"detalhes-section"},[t("h4",[a._v("🔧 Especificações Técnicas")]),t("pre",[a._v(a._s(a.formatarEspecificacoes(a.produtoSelecionado.especificacoes_tecnicas)))])]):a._e(),a.produtoSelecionado.observacoes_internas?t("div",{staticClass:"detalhes-section"},[t("h4",[a._v("📝 Observações")]),t("p",[a._v(a._s(a.produtoSelecionado.observacoes_internas))])]):a._e()]):a._e(),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn-secondary",on:{click:a.fecharModalDetalhes}},[a._v("Fechar")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return a.emitirDCB(a.produtoSelecionado)}}},[a._v(" 📜 Emitir DCB ")])])])]):a._e(),a.modalVisualizarDCB?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalDCB}},[t("div",{staticClass:"modal-content dcb-visualizar-modal",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("📜 Visualizar DCB")]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalDCB}},[a._v("✕")])]),a.dcbSelecionado?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"dcb-preview"},[t("div",{staticClass:"dcb-header"},[t("h2",[a._v("DECLARAÇÃO DE CONFORMIDADE DE BEM")]),t("h3",[a._v("DCB Nº "+a._s(a.dcbSelecionado.numero_dcb))])]),t("div",{staticClass:"dcb-content-preview"},[t("div",{staticClass:"dcb-section"},[t("h4",[a._v("PRODUTO CERTIFICADO")]),t("p",[t("strong",[a._v("Nome:")]),a._v(" "+a._s(a.dcbSelecionado.produto_nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.dcbSelecionado.produto_marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.dcbSelecionado.produto_modelo||"N/A"))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.dcbSelecionado.produto_fabricante))])]),t("div",{staticClass:"dcb-section"},[t("h4",[a._v("DADOS DO CERTIFICADO")]),t("p",[t("strong",[a._v("Data de Emissão:")]),a._v(" "+a._s(a.formatDate(a.dcbSelecionado.data_emissao)))]),t("p",[t("strong",[a._v("Validade:")]),a._v(" "+a._s(a.formatDate(a.dcbSelecionado.data_validade)))]),t("p",[t("strong",[a._v("Status:")]),t("span",{staticClass:"status-badge",class:a.getStatusDCBClass(a.dcbSelecionado.status)},[a._v(" "+a._s(a.formatStatusDCB(a.dcbSelecionado.status))+" ")])])])])])]):a._e(),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn-secondary",on:{click:a.fecharModalDCB}},[a._v("Fechar")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return a.downloadDCB(a.dcbSelecionado)}}},[a._v(" 📥 Download PDF ")])])])]):a._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:a.modalParticipantes,expression:"modalParticipantes"}],staticClass:"modal-participantes-overlay"},[t("div",{staticClass:"modal-participantes-content"},[t("div",{staticClass:"modal-participantes-header"},[t("h3",[a._v("👥 Participantes - "+a._s(a.editalSelecionado.numero))]),t("button",{staticClass:"btn-close-participantes",on:{click:a.fecharModalParticipantes}},[a._v("×")])]),t("div",{staticClass:"modal-participantes-body"},[t("div",{staticClass:"participantes-header"},[t("div",{staticClass:"filtros-participantes"},[t("div",{staticClass:"filtro-group"},[t("label",[a._v("🔍 Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroParticipantes.busca,expression:"filtroParticipantes.busca"}],attrs:{type:"text",placeholder:"Nome, CNPJ, representante..."},domProps:{value:a.filtroParticipantes.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtroParticipantes,"busca",t.target.value)},a.aplicarFiltrosParticipantes]}})]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("📊 Status:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtroParticipantes.status,expression:"filtroParticipantes.status"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtroParticipantes,"status",t.target.multiple?e:e[0])},a.aplicarFiltrosParticipantes]}},[t("option",{attrs:{value:""}},[a._v("Todos")]),t("option",{attrs:{value:"INTERESSADO"}},[a._v("Interessado")]),t("option",{attrs:{value:"DOCUMENTACAO_ENVIADA"}},[a._v("Documentação Enviada")]),t("option",{attrs:{value:"EM_AVALIACAO"}},[a._v("Em Avaliação")]),t("option",{attrs:{value:"APROVADO"}},[a._v("Aprovado")]),t("option",{attrs:{value:"REPROVADO"}},[a._v("Reprovado")]),t("option",{attrs:{value:"DESISTENTE"}},[a._v("Desistente")])])])]),t("button",{staticClass:"btn-primary",on:{click:a.abrirModalNovoParticipante}},[a._v(" ➕ Adicionar Participante ")])]),a.loadingParticipantes?t("div",{staticClass:"loading-state"},[t("div",{staticClass:"spinner"}),t("p",[a._v("Carregando participantes...")])]):a.participantesFiltrados.length>0?t("div",{staticClass:"participantes-lista"},a._l(a.participantesFiltrados,(function(e){return t("div",{key:e.id,staticClass:"participante-card"},[t("div",{staticClass:"participante-info"},[t("div",{staticClass:"participante-header"},[t("h4",[a._v(a._s(e.razao_social))]),t("span",{staticClass:"status-badge",class:a.getStatusClass(e.status)},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")])]),t("div",{staticClass:"participante-details"},[t("p",[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.formatarCNPJ(e.cnpj)))]),t("p",[t("strong",[a._v("Representante:")]),a._v(" "+a._s(e.representante_legal))]),t("p",[t("strong",[a._v("Email:")]),a._v(" "+a._s(e.email))]),e.telefone?t("p",[t("strong",[a._v("Telefone:")]),a._v(" "+a._s(e.telefone))]):a._e(),t("p",[t("strong",[a._v("Data Participação:")]),a._v(" "+a._s(a.formatDate(e.data_participacao)))]),e.data_envio_documentacao?t("p",[t("strong",[a._v("Documentação Enviada:")]),a._v(" "+a._s(a.formatDate(e.data_envio_documentacao))+" ")]):a._e(),e.observacoes?t("p",[t("strong",[a._v("Observações:")]),a._v(" "+a._s(e.observacoes)+" ")]):a._e()])]),t("div",{staticClass:"participante-actions"},[t("button",{staticClass:"btn-secondary btn-small",on:{click:function(t){return a.editarParticipante(e)}}},[a._v(" ✏️ Editar ")]),t("button",{staticClass:"btn-danger btn-small",on:{click:function(t){return a.removerParticipante(e)}}},[a._v(" 🗑️ Remover ")])])])})),0):t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("👥")]),t("h3",[a._v("Nenhum participante encontrado")]),a.filtroParticipantes.busca||a.filtroParticipantes.status?t("p",[a._v(" Nenhum participante corresponde aos filtros aplicados. ")]):t("p",[a._v(' Ainda não há participantes neste edital. Clique em "Adicionar Participante" para começar. ')])])]),t("div",{staticClass:"modal-participantes-footer"},[t("button",{staticClass:"btn-secondary",on:{click:a.fecharModalParticipantes}},[a._v("Fechar")])])])]),a.modalNovoParticipante?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalNovoParticipante}},[t("div",{staticClass:"modal-content large",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.participanteAtual.id?"✏️ Editar Participante":"➕ Novo Participante"))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalNovoParticipante}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarParticipante.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"razao_social"}},[a._v("Razão Social*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.razao_social,expression:"participanteAtual.razao_social"}],attrs:{id:"razao_social",type:"text",placeholder:"Nome da empresa",required:""},domProps:{value:a.participanteAtual.razao_social},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"razao_social",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cnpj"}},[a._v("CNPJ*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.cnpj,expression:"participanteAtual.cnpj"}],attrs:{id:"cnpj",type:"text",placeholder:"00.000.000/0000-00",required:""},domProps:{value:a.participanteAtual.cnpj},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"cnpj",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"representante_legal"}},[a._v("Representante Legal*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.representante_legal,expression:"participanteAtual.representante_legal"}],attrs:{id:"representante_legal",type:"text",placeholder:"Nome do representante",required:""},domProps:{value:a.participanteAtual.representante_legal},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"representante_legal",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[a._v("Email*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.email,expression:"participanteAtual.email"}],attrs:{id:"email",type:"email",placeholder:"contato@empresa.com",required:""},domProps:{value:a.participanteAtual.email},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"email",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"telefone"}},[a._v("Telefone")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.telefone,expression:"participanteAtual.telefone"}],attrs:{id:"telefone",type:"text",placeholder:"(11) 99999-9999"},domProps:{value:a.participanteAtual.telefone},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"telefone",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"status"}},[a._v("Status")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.status,expression:"participanteAtual.status"}],attrs:{id:"status"},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.participanteAtual,"status",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:"INTERESSADO"}},[a._v("Interessado")]),t("option",{attrs:{value:"DOCUMENTACAO_ENVIADA"}},[a._v("Documentação Enviada")]),t("option",{attrs:{value:"EM_AVALIACAO"}},[a._v("Em Avaliação")]),t("option",{attrs:{value:"APROVADO"}},[a._v("Aprovado")]),t("option",{attrs:{value:"REPROVADO"}},[a._v("Reprovado")]),t("option",{attrs:{value:"DESISTENTE"}},[a._v("Desistente")])])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"endereco"}},[a._v("Endereço")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.endereco,expression:"participanteAtual.endereco"}],attrs:{id:"endereco",type:"text",placeholder:"Endereço completo da empresa"},domProps:{value:a.participanteAtual.endereco},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"endereco",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"observacoes"}},[a._v("Observações")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.observacoes,expression:"participanteAtual.observacoes"}],attrs:{id:"observacoes",rows:"3",placeholder:"Observações sobre a participação..."},domProps:{value:a.participanteAtual.observacoes},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"observacoes",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharModalNovoParticipante}},[a._v(" Cancelar ")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit"}},[a._v(" "+a._s(a.participanteAtual.id?"Atualizar":"Adicionar")+" Participante ")])])])])])]):a._e()]):a._e(),"usuarios"===a.activeTab?t("div",{staticClass:"usuarios-section"},[a._m(10),t("div",{staticClass:"section-actions"},[t("button",{staticClass:"btn-primary",on:{click:a.abrirModalNovoUsuario}},[a._v(" ➕ Cadastrar Novo Usuário ")])]),t("div",{staticClass:"usuarios-container"},[t("div",{staticClass:"filtros-usuarios"},[t("div",{staticClass:"filtro-group"},[t("label",[a._v("🔍 Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroUsuarios.busca,expression:"filtroUsuarios.busca"}],attrs:{type:"text",placeholder:"Nome, unidade, coordenador..."},domProps:{value:a.filtroUsuarios.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtroUsuarios,"busca",t.target.value)},a.aplicarFiltrosUsuarios]}})]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("🏢 Unidade:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtroUsuarios.unidade,expression:"filtroUsuarios.unidade"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtroUsuarios,"unidade",t.target.multiple?e:e[0])},a.aplicarFiltrosUsuarios]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),a._l(a.unidadesUnicas,(function(e){return t("option",{key:e,domProps:{value:e}},[a._v(" "+a._s(e)+" ")])}))],2)])]),a.usuariosFiltrados.length>0?t("div",{staticClass:"usuarios-grid"},a._l(a.usuariosFiltrados,(function(e){return t("div",{key:e.id,staticClass:"usuario-card"},[t("div",{staticClass:"usuario-header"},[t("h4",[a._v(a._s(e.nome_usuario))]),t("div",{staticClass:"status-badges"},[t("span",{staticClass:"status-badge status-ativo"},[a._v("Ativo")]),e.user_id?t("span",{class:["status-convite",e.convite_aceito?"aceito":e.convite_enviado?"enviado":"pendente"]},[a._v(" "+a._s(e.convite_aceito?"🟢 Conectado":e.convite_enviado?"📧 Convite Enviado":"⏳ Convite Pendente")+" ")]):a._e()])]),t("div",{staticClass:"usuario-details"},[t("p",[t("strong",[a._v("Unidade/Setor:")]),a._v(" "+a._s(e.unidade_setor))]),t("p",[t("strong",[a._v("Coordenador:")]),a._v(" "+a._s(e.nome_coordenador))]),t("p",[t("strong",[a._v("Telefone:")]),a._v(" "+a._s(e.telefone))]),t("p",[t("strong",[a._v("Email:")]),a._v(" "+a._s(e.email))]),t("p",[t("strong",[a._v("Materiais:")]),a._v(" "+a._s(e.materiais?.length||0)+" cadastrados")]),t("p",[t("strong",[a._v("Próximo RDM:")]),t("span",{staticClass:"data-rdm"},[a._v(a._s(a.calcularProximoRDM(e)))])])]),t("div",{staticClass:"usuario-actions"},[t("button",{staticClass:"btn-secondary btn-small",on:{click:function(t){return a.editarUsuario(e)}}},[a._v(" ✏️ Editar ")]),t("button",{staticClass:"btn-info btn-small",on:{click:function(t){return a.verMateriaisUsuario(e)}}},[a._v(" 📦 Materiais ")]),e.user_id&&!e.convite_aceito?t("button",{staticClass:"btn-reenviar btn-small",on:{click:function(t){return a.reenviarConvite(e)}}},[a._v(" 📧 Reenviar Convite ")]):a._e(),t("button",{staticClass:"btn-danger btn-small",on:{click:function(t){return a.removerUsuario(e)}}},[a._v(" 🗑️ Remover ")])])])})),0):t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("👥")]),t("h3",[a._v("Nenhum usuário cadastrado")]),t("p",[a._v('Clique em "Cadastrar Novo Usuário" para começar.')])])]),a.modalNovoUsuario?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalNovoUsuario}},[t("div",{staticClass:"modal-content large",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.usuarioAtual.id?"✏️ Editar Usuário":"👥 Novo Usuário"))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalNovoUsuario}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarUsuario.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome_usuario"}},[a._v("Nome do Usuário/Unidade*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.nome_usuario,expression:"usuarioAtual.nome_usuario"}],attrs:{id:"nome_usuario",type:"text",placeholder:"Ex: Departamento de Compras, João Silva",required:""},domProps:{value:a.usuarioAtual.nome_usuario},on:{input:function(t){t.target.composing||a.$set(a.usuarioAtual,"nome_usuario",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"unidade_setor"}},[a._v("Unidade/Setor*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.unidade_setor,expression:"usuarioAtual.unidade_setor"}],attrs:{id:"unidade_setor",type:"text",placeholder:"Ex: Secretaria da Saúde",required:""},domProps:{value:a.usuarioAtual.unidade_setor},on:{input:function(t){t.target.composing||a.$set(a.usuarioAtual,"unidade_setor",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome_coordenador"}},[a._v("Nome do Coordenador*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.nome_coordenador,expression:"usuarioAtual.nome_coordenador"}],attrs:{id:"nome_coordenador",type:"text",placeholder:"Nome completo do responsável",required:""},domProps:{value:a.usuarioAtual.nome_coordenador},on:{input:function(t){t.target.composing||a.$set(a.usuarioAtual,"nome_coordenador",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"telefone_usuario"}},[a._v("Telefone*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.telefone,expression:"usuarioAtual.telefone"}],attrs:{id:"telefone_usuario",type:"tel",placeholder:"(00) 00000-0000",required:""},domProps:{value:a.usuarioAtual.telefone},on:{input:function(t){t.target.composing||a.$set(a.usuarioAtual,"telefone",t.target.value)}}})])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email_usuario"}},[a._v("Email*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.email,expression:"usuarioAtual.email"}],attrs:{id:"email_usuario",type:"email",placeholder:"email@exemplo.com",required:""},domProps:{value:a.usuarioAtual.email},on:{input:function(t){t.target.composing||a.$set(a.usuarioAtual,"email",t.target.value)}}})]),t("div",{staticClass:"login-system-section"},[t("h4",[a._v("🔐 Sistema de Login")]),t("div",{staticClass:"form-group checkbox-group"},[t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.criar_login,expression:"usuarioAtual.criar_login"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(a.usuarioAtual.criar_login)?a._i(a.usuarioAtual.criar_login,null)>-1:a.usuarioAtual.criar_login},on:{change:[function(t){var e=a.usuarioAtual.criar_login,o=t.target,i=!!o.checked;if(Array.isArray(e)){var s=null,r=a._i(e,s);o.checked?r<0&&a.$set(a.usuarioAtual,"criar_login",e.concat([s])):r>-1&&a.$set(a.usuarioAtual,"criar_login",e.slice(0,r).concat(e.slice(r+1)))}else a.$set(a.usuarioAtual,"criar_login",i)},a.toggleLoginSystem]}}),t("span",{staticClass:"checkmark"},[a._v("✓")]),a._v(" Permitir login no sistema (Dashboard RDM Online) ")]),t("p",{staticClass:"help-text"},[a._v(" Ao marcar esta opção, o usuário receberá um email com senha de acesso e instruções para usar o sistema RDM. ")])]),a.usuarioAtual.criar_login?t("div",{staticClass:"convite-info"},[t("div",{staticClass:"info-card"},[t("h5",[a._v("📧 Convite Automático")]),t("p",[a._v("Será enviado automaticamente um email para "),t("strong",[a._v(a._s(a.usuarioAtual.email))]),a._v(" com:")]),a._m(11)])]):a._e()]),t("div",{staticClass:"materiais-section"},[t("h4",[a._v("📦 Materiais sob Responsabilidade")]),t("div",{staticClass:"materiais-lista"},[a._l(a.usuarioAtual.materiais,(function(e,o){return t("div",{key:o,staticClass:"material-item"},[t("div",{staticClass:"material-fields-novo"},[t("div",{staticClass:"material-select"},[t("label",[a._v("📦 Material/Produto:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.produto_id,expression:"material.produto_id"}],attrs:{disabled:a.loadingProdutos,required:""},on:{change:[function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(e,"produto_id",t.target.multiple?o:o[0])},function(t){return a.selecionarProduto(o,t)}]}},[a.loadingProdutos?t("option",{attrs:{value:""}},[a._v("⏳ Carregando produtos...")]):0===a.produtosDisponiveis.length?t("option",{attrs:{value:""}},[a._v("Nenhum produto encontrado")]):t("option",{attrs:{value:""}},[a._v("Selecione um produto...")]),a._l(a.produtosDisponiveis,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" - "+a._s(e.marca||"S/Marca")+" ("+a._s(e.codigo_material||e.modelo||"S/Código")+") ")])})),t("option",{attrs:{value:"NOVO"}},[a._v("➕ Cadastrar Novo Material")])],2)]),"NOVO"===e.produto_id?t("div",{staticClass:"novo-material"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.nome,expression:"material.nome"}],attrs:{type:"text",placeholder:"Nome do novo material",required:""},domProps:{value:e.nome},on:{input:function(t){t.target.composing||a.$set(e,"nome",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.codigo,expression:"material.codigo"}],attrs:{type:"text",placeholder:"Código do material",required:""},domProps:{value:e.codigo},on:{input:function(t){t.target.composing||a.$set(e,"codigo",t.target.value)}}})]):a._e(),t("div",{staticClass:"material-periodo"},[t("label",[a._v("📅 Periodicidade RDM:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.periodicidade_rdm,expression:"material.periodicidade_rdm"}],attrs:{required:""},on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(e,"periodicidade_rdm",t.target.multiple?o:o[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecionar...")]),t("option",{attrs:{value:"mensal"}},[a._v("Mensal")]),t("option",{attrs:{value:"bimestral"}},[a._v("Bimestral")]),t("option",{attrs:{value:"trimestral"}},[a._v("Trimestral")]),t("option",{attrs:{value:"semestral"}},[a._v("Semestral")]),t("option",{attrs:{value:"anual"}},[a._v("Anual")])])]),t("button",{staticClass:"btn-danger btn-small",attrs:{type:"button",title:"Remover material"},on:{click:function(t){return a.removerMaterial(o)}}},[a._v(" 🗑️ ")])])])})),t("div",{staticClass:"material-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button",disabled:a.loadingProdutos},on:{click:a.adicionarMaterial}},[a.loadingProdutos?t("span",[a._v("⏳")]):t("span",[a._v("➕")]),a._v(" Adicionar Material ")]),t("button",{staticClass:"btn-info btn-small",attrs:{type:"button",disabled:a.loadingProdutos},on:{click:a.carregarProdutos}},[a.loadingProdutos?t("span",[a._v("⏳")]):t("span",[a._v("🔄")]),a._v(" Atualizar Lista ")])]),a.loadingProdutos?a._e():t("div",{staticClass:"debug-info"},[t("small",[a._v(" 📊 Debug: "+a._s(a.produtosDisponiveis.length)+" produtos disponíveis "),a.currentTenantId?t("span",[a._v("(Tenant: "+a._s(a.currentTenantId.substring(0,8))+"...)")]):a._e(),t("br"),a._v(" 📋 Materiais do usuário: "+a._s(a.usuarioAtual.materiais?.length||0)+" "),a.usuarioAtual.materiais?.length>0?t("span",[a._v(" ("+a._s(a.usuarioAtual.materiais.map((a=>a.nome||"Sem nome")).join(", "))+") ")]):a._e()])])],2)]),t("div",{staticClass:"modal-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharModalNovoUsuario}},[a._v(" Cancelar ")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit"}},[a._v(" "+a._s(a.usuarioAtual.id?"Atualizar":"Cadastrar")+" Usuário ")])])])])])]):a._e()]):a._e(),"reclamacoes"===a.activeTab?t("div",{staticClass:"avaliacoes-section"},[a._m(12),t("div",{staticClass:"section-actions"},[t("small",{staticStyle:{color:"#666"}},[a._v(" 📊 Total: "+a._s(a.avaliacoes.length)+" | Filtradas: "+a._s(a.avaliacoesFiltradas.length)+" ")])]),t("div",{staticClass:"filtros-avaliacoes"},[t("div",{staticClass:"filtro-group"},[t("label",[a._v("🔍 Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroAvaliacoes.busca,expression:"filtroAvaliacoes.busca"}],attrs:{type:"text",placeholder:"Material, usuário, comentário..."},domProps:{value:a.filtroAvaliacoes.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtroAvaliacoes,"busca",t.target.value)},a.aplicarFiltrosAvaliacoes]}})]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("⭐ Avaliação:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtroAvaliacoes.rating,expression:"filtroAvaliacoes.rating"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtroAvaliacoes,"rating",t.target.multiple?e:e[0])},a.aplicarFiltrosAvaliacoes]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),t("option",{attrs:{value:"5"}},[a._v("⭐⭐⭐⭐⭐ (5 estrelas)")]),t("option",{attrs:{value:"4"}},[a._v("⭐⭐⭐⭐ (4 estrelas)")]),t("option",{attrs:{value:"3"}},[a._v("⭐⭐⭐ (3 estrelas)")]),t("option",{attrs:{value:"2"}},[a._v("⭐⭐ (2 estrelas)")]),t("option",{attrs:{value:"1"}},[a._v("⭐ (1 estrela)")])])]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("👤 Usuário:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroAvaliacoes.usuario,expression:"filtroAvaliacoes.usuario"}],attrs:{type:"text",placeholder:"Nome do usuário..."},domProps:{value:a.filtroAvaliacoes.usuario},on:{input:[function(t){t.target.composing||a.$set(a.filtroAvaliacoes,"usuario",t.target.value)},a.aplicarFiltrosAvaliacoes]}})])]),a.avaliacoesFiltradas.length>0?t("div",{staticClass:"avaliacoes-lista"},a._l(a.avaliacoesFiltradas,(function(e){return t("div",{key:e.id,staticClass:"avaliacao-card"},[t("div",{staticClass:"avaliacao-header"},[t("h4",[a._v(a._s(e.usuario_rdm?.nome_usuario||"Usuário não encontrado"))]),t("div",{staticClass:"rating-display"},[a._l(5,(function(o){return t("span",{key:o,staticClass:"star",class:{active:e.rating>=o}},[a._v("⭐")])})),t("span",{staticClass:"rating-text"},[a._v(a._s(e.rating)+"/5")])],2)]),t("div",{staticClass:"avaliacao-content"},[t("div",{staticClass:"avaliacao-info"},[t("p",[t("strong",[a._v("Unidade/Setor:")]),a._v(" "+a._s(e.usuario_rdm?.unidade_setor||"N/A"))]),t("p",[t("strong",[a._v("Material:")]),a._v(" "+a._s(e.material_nome)+" ("+a._s(e.material_codigo)+")")]),t("p",[t("strong",[a._v("Data:")]),a._v(" "+a._s(a.formatDate(e.criado_em)))]),t("p",[t("strong",[a._v("Contato:")]),a._v(" "+a._s(e.usuario_rdm?.email||"N/A")+" | "+a._s(e.usuario_rdm?.telefone||"N/A"))])]),t("div",{staticClass:"avaliacao-detalhes"},[e.comentario?t("div",{staticClass:"comentario-texto"},[t("h5",[a._v("💬 Comentário:")]),t("p",[a._v(a._s(e.comentario))])]):a._e(),e.comentario?a._e():t("div",{staticClass:"sem-comentario"},[a._m(13,!0)])])])])})),0):a._e(),0===a.avaliacoesFiltradas.length?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("⭐")]),t("h3",[a._v("Nenhuma avaliação encontrada")]),t("p",[a._v("Quando houver avaliações de materiais, elas aparecerão aqui.")])]):a._e()]):a._e()])},q=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Ações")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Ações")])])])},function(){var a=this,t=a._self._c;return t("td",[t("span",{staticClass:"status-badge status-diligencia"},[a._v(" Diligência ")])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Impugnante")]),t("th",[a._v("Produto")]),t("th",[a._v("Data da Impugnação")]),t("th",[a._v("Prazo Final")]),t("th",[a._v("Status")]),t("th",[a._v("Documentação")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Pesquisa de Mercado")]),t("p",[a._v("Este módulo permitirá registrar as pesquisas realizadas para conhecer e/ou avaliar as especificações técnicas e funcionalidades de produtos novos ou já existentes no mercado fornecedor, bem como os seus preços estimados, para fins de instrução dos processos destinados à padronização de marcas e modelos.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Registro de especificações técnicas de produtos e cotações de fornecedores")]),t("li",[a._v("Comparativo técnico de produtos, seus preços e condições gerais")]),t("li",[a._v("Análise de variação de preços")]),t("li",[a._v("Geração de relatórios para instrução de processos de compras")]),t("li",[a._v("Integração com bancos de preços públicos")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Marcas Despadronizadas")]),t("p",[a._v("Este módulo permitirá gerenciar marcas e modelos que foram despadronizados ou que não atendem mais aos requisitos de padronização.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Registro de marcas e modelos despadronizados")]),t("li",[a._v("Motivos e justificativas para despadronização")]),t("li",[a._v("Histórico de despadronizações")]),t("li",[a._v("Restrições de uso para modelos despadronizados")]),t("li",[a._v("Notificação aos setores sobre despadronizações")]),t("li",[a._v("Relatórios de impacto por despadronização")]),t("li",[a._v("Registro de comunicações aos órgãos de controle")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-header"},[t("h3",[a._v("📝 Produtos Prontos para Certificação DCB")]),t("p",[a._v("Produtos aprovados pela CPM que ainda não possuem DCB emitido.")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-header"},[t("h3",[a._v("📋 Histórico de DCBs Emitidas")]),t("p",[a._v("Todos os certificados DCB emitidos pelo sistema.")])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Número DCB")]),t("th",[a._v("Produto")]),t("th",[a._v("Marca")]),t("th",[a._v("Data Emissão")]),t("th",[a._v("Validade")]),t("th",[a._v("Status")]),t("th",[a._v("Ações")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-header"},[t("h3",[a._v("⏰ Controle de Vencimentos DCB")]),t("p",[a._v("Monitoramento de DCBs próximos ao vencimento ou já vencidos.")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-header"},[t("h2",[a._v("👥 Cadastro de Usuários")]),t("p",[a._v("Gestão de usuários autorizados a emitir RDMs no sistema")])])},function(){var a=this,t=a._self._c;return t("ul",[t("li",[a._v("Senha de acesso definitiva")]),t("li",[a._v("Link direto para o sistema")]),t("li",[a._v("Instruções de uso do Dashboard RDM")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-header"},[t("h2",[a._v("⭐ Avaliações de Usuários")]),t("p",[a._v("Visualização das avaliações e feedbacks dos usuários sobre materiais")])])},function(){var a=this,t=a._self._c;return t("p",[t("em",[a._v("Nenhum comentário adicional fornecido.")])])}],L=e(365);const U={name:"DashboardCPM",data(){return{activeTab:"dashboard",produtos:[],produtosComDiligencia:[],pendentes:0,aprovados:0,reprovados:0,currentTenantId:null,loading:!1,editais:[],editaisFiltrados:[],loadingEditais:!1,modalNovoEdital:!1,modalVisualizarEdital:!1,modalParticipantes:!1,modalNovoParticipante:!1,modoEdicaoEdital:!1,salvandoEdital:!1,editalAtual:{id:null,numero:"",descricao:"",conteudo:"",status:"RASCUNHO",data_publicacao:"",data_limite_impugnacao:"",url_documento:"",nome_arquivo:""},editalSelecionado:{},filtroEditais:{busca:"",status:""},participantes:[],participantesFiltrados:[],loadingParticipantes:!1,participanteAtual:{id:null,razao_social:"",cnpj:"",representante_legal:"",email:"",telefone:"",endereco:"",status:"INTERESSADO",observacoes:"",produtos_submetidos:[]},filtroParticipantes:{busca:"",status:""},impugnacoes:[],certificados:[],activeTabDCB:"emitir",produtosProntosDCB:[],produtosProntosDCBFiltrados:[],dcbsEmitidos:[],dcbsHistoricoFiltrados:[],dcbsVencendo:[],dcbsVencidos:[],emitindoDCB:null,modalProdutoDetalhes:!1,modalVisualizarDCB:!1,produtoSelecionado:null,dcbSelecionado:null,filtrosDCB:{busca:"",categoria:"",dataAprovacao:""},filtrosHistorico:{numeroDCB:"",status:"",dataInicio:"",dataFim:""},itensPorPagina:5,paginaAtual:1,totalPaginas:1,paginasVisiveis:[],filtros:{nome:"",marca:"",status:"",data:""},produtosPaginados:[],produtosFiltrados:[],itensPorPaginaDiligencia:5,paginaAtualDiligencia:1,totalPaginasDiligencia:1,paginasVisiveisDiligencia:[],filtrosDiligencia:{busca:"",marca:"",data:""},diligenciasFiltradas:[],diligenciasPaginadas:[],usuarios:[],usuariosFiltrados:[],modalNovoUsuario:!1,usuarioAtual:{id:null,nome_usuario:"",unidade_setor:"",nome_coordenador:"",telefone:"",email:"",materiais:[],criar_login:!1,user_id:null,senha_temporaria:null,convite_enviado:!1,convite_aceito:!1},filtroUsuarios:{busca:"",unidade:""},statusConvites:{},notificacoes:[],produtosDisponiveis:[],loadingProdutos:!1,avaliacoes:[],avaliacoesFiltradas:[],filtroAvaliacoes:{busca:"",rating:"",usuario:""}}},created(){this.obterTenantId().then((()=>{this.carregarDados()}))},async mounted(){await this.carregarDados(),this.inicializarFiltros(),await this.carregarProdutos(),"lembretes"===this.activeTab&&(await this.carregarEstatisticasLembretes(),await this.carregarRdmsPendentes())},watch:{activeTab(a){"lembretes"===a?this.$nextTick((()=>{this.carregarEstatisticasLembretes&&this.carregarEstatisticasLembretes(),this.carregarRdmsPendentes&&this.carregarRdmsPendentes()})):"reclamacoes"===a&&this.$nextTick((()=>{this.carregarAvaliacoes()}))}},computed:{marcasUnicas(){const a=[...new Set(this.produtosComDiligencia.map((a=>a.marca)))];return a.filter((a=>a)).sort()},temFiltrosAplicados(){return this.filtros.nome||this.filtros.marca||this.filtros.status||this.filtros.data},temFiltrosDiligenciaAplicados(){return this.filtrosDiligencia.busca||this.filtrosDiligencia.marca||this.filtrosDiligencia.data},editaisAtivos(){return this.editais.filter((a=>"PUBLICADO"===a.status))},editaisRascunho(){return this.editais.filter((a=>"RASCUNHO"===a.status))},editaisFinalizados(){return this.editais.filter((a=>"CANCELADO"===a.status))},totalParticipantes(){return this.editais.reduce(((a,t)=>a+(t.participantes_count||0)),0)},unidadesUnicas(){const a=[...new Set(this.usuarios.map((a=>a.unidade_setor)))];return a.filter((a=>a)).sort()}},methods:{async obterTenantId(){try{const{data:a}=await P.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return this.currentTenantId=t.user_metadata.tenant_id,void console.log("Tenant ID obtido dos metadados:",this.currentTenantId);const{data:e,error:o}=await P.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id?(this.currentTenantId=e.tenant_id,console.log("Tenant ID obtido da tabela usuarios:",this.currentTenantId)):console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarDados(){try{if(this.loading=!0,!this.currentTenantId&&(console.error("Tenant ID não disponível. Tentando recarregar..."),await this.obterTenantId(),!this.currentTenantId))return void console.error("Não foi possível obter o tenant_id, impossível carregar dados");console.log("Carregando produtos para tenant_id:",this.currentTenantId);const{data:a,error:t}=await P.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1});if(t)throw t;const e=a||[];this.produtos=e.filter((a=>["pendente","aprovado","reprovado","em_analise"].includes(a.status))),console.log(`${this.produtos.length} requerimentos recentes carregados (sem diligências)`),this.produtosComDiligencia=e.filter((a=>"diligencia"===a.status)),console.log(`${this.produtosComDiligencia.length} produtos com diligência carregados`),await this.carregarImpugnacoes(),await this.carregarDadosDCB(),await this.carregarEditais(),await this.carregarUsuarios(),await this.carregarAvaliacoes();const o=await Promise.all([this.contarPorStatus("pendente"),this.contarPorStatus("aprovado"),this.contarPorStatus("reprovado")]);this.pendentes=o[0],this.aprovados=o[1],this.reprovados=o[2]}catch(a){console.error("Erro ao carregar dados:",a)}finally{this.loading=!1,this.$nextTick((()=>{this.inicializarFiltros()}))}},async contarPorStatus(a){if(!this.currentTenantId)return 0;const{count:t,error:e}=await P.ND.from("produtos").select("id",{count:"exact"}).eq("status",a).eq("tenant_id",this.currentTenantId);return e?(console.error(`Erro ao contar produtos ${a}:`,e),0):t||0},formatDate(a){if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")},formatarStatus(a){return"pendente"===a?"em avaliação":a},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},verProduto(a){this.$router.push(`/analise/${a}`)},async visualizarEdital(a){console.log(`Visualizando edital com ID: ${a}`)},getImpugnacaoStatusClass(a){switch(a){case"EM ANÁLISE":return"status-pendente";case"DEFERIDA":return"status-aprovado";case"INDEFERIDA":return"status-reprovado";default:return""}},async analisarImpugnacao(a){try{const{data:t,error:e}=await P.ND.from("impugnacoes").select("\n            *,\n            editais (\n              numero,\n              descricao\n            )\n          ").eq("id",a).single();if(e)throw e;const{value:o}=await this.$swal({title:"Análise de Impugnação",html:`\n            <div style="text-align: left;">\n              <h4>Impugnação de: ${t.impugnante}</h4>\n              <p><strong>Edital:</strong> ${t.editais?.numero} - ${t.editais?.descricao}</p>\n              <p><strong>Data:</strong> ${this.formatDate(t.data_impugnacao)}</p>\n              <p><strong>Prazo Final:</strong> ${this.formatDate(t.prazo_final)}</p>\n              <p><strong>Motivo:</strong> ${t.motivo}</p>\n              <p><strong>Status Atual:</strong> ${t.status}</p>\n            </div>\n            <hr>\n            <label for="decisao"><strong>Decisão:</strong></label>\n            <select id="decisao" class="swal2-input">\n              <option value="">Selecione uma decisão</option>\n              <option value="DEFERIDA">DEFERIDA (Procedente)</option>\n              <option value="INDEFERIDA">INDEFERIDA (Improcedente)</option>\n              <option value="PARCIALMENTE_DEFERIDA">PARCIALMENTE DEFERIDA</option>\n            </select>\n            <label for="justificativa"><strong>Justificativa da Decisão:</strong></label>\n            <textarea id="justificativa" class="swal2-textarea" placeholder="Fundamente a decisão tomada..."></textarea>\n          `,focusConfirm:!1,preConfirm:()=>{const a=document.getElementById("decisao").value,t=document.getElementById("justificativa").value;return a?!t||t.trim().length<10?(this.$swal.showValidationMessage("A justificativa deve ter pelo menos 10 caracteres"),!1):{decisao:a,justificativa:t}:(this.$swal.showValidationMessage("Selecione uma decisão"),!1)}});o&&await this.salvarDecisaoImpugnacao(a,o.decisao,o.justificativa)}catch(t){console.error("Erro ao analisar impugnação:",t),this.$swal({title:"Erro",text:"Erro ao carregar dados da impugnação",icon:"error"})}},async carregarImpugnacoes(){try{const{data:a,error:t}=await P.ND.from("impugnacoes").select("\n            *,\n            editais (\n              numero,\n              descricao\n            )\n          ").eq("tenant_id",this.currentTenantId).order("data_impugnacao",{ascending:!1}).limit(10);if(t)throw t;this.impugnacoes=a?.map((a=>({...a,produto_nome:`Edital ${a.editais?.numero||"N/A"}`})))||[],console.log(`${this.impugnacoes.length} impugnações carregadas`)}catch(a){console.error("Erro ao carregar impugnações:",a),this.impugnacoes=[]}},async salvarDecisaoImpugnacao(a,t,e){try{const{error:o}=await P.ND.from("impugnacoes").update({status:t,justificativa_decisao:e,data_decisao:(new Date).toISOString(),analisado_por:"CPM"}).eq("id",a);if(o)throw o;this.$swal({title:"Sucesso!",text:"Decisão da impugnação salva com sucesso",icon:"success"}),await this.carregarImpugnacoes()}catch(o){console.error("Erro ao salvar decisão:",o),this.$swal({title:"Erro",text:"Erro ao salvar decisão da impugnação",icon:"error"})}},async solicitarDiligencia(a){try{const{value:t}=await this.$swal({title:"Solicitar Diligência",html:'\n             <label for="tipo_diligencia"><strong>Tipo de Diligência:</strong></label>\n             <select id="tipo_diligencia" class="swal2-input">\n               <option value="">Selecione o tipo</option>\n               <option value="DOCUMENTACAO_FALTANTE">Documentação Faltante</option>\n               <option value="AMOSTRA_INADEQUADA">Amostra Inadequada</option>\n               <option value="ESPECIFICACAO_INCOMPLETA">Especificação Incompleta</option>\n               <option value="CERTIFICACAO_PENDENTE">Certificação Pendente</option>\n               <option value="ESCLARECIMENTO_TECNICO">Esclarecimento Técnico</option>\n             </select>\n             <label for="descricao_diligencia"><strong>Descrição da Diligência:</strong></label>\n             <textarea id="descricao_diligencia" class="swal2-textarea" placeholder="Descreva detalhadamente o que precisa ser providenciado..."></textarea>\n             <label for="prazo_dias"><strong>Prazo (dias úteis):</strong></label>\n             <input type="number" id="prazo_dias" class="swal2-input" value="5" min="1" max="30">\n           ',focusConfirm:!1,preConfirm:()=>{const a=document.getElementById("tipo_diligencia").value,t=document.getElementById("descricao_diligencia").value,e=parseInt(document.getElementById("prazo_dias").value);return a?!t||t.trim().length<10?(this.$swal.showValidationMessage("A descrição deve ter pelo menos 10 caracteres"),!1):!e||e<1||e>30?(this.$swal.showValidationMessage("O prazo deve ser entre 1 e 30 dias"),!1):{tipo:a,descricao:t,prazo:e}:(this.$swal.showValidationMessage("Selecione o tipo de diligência"),!1)}});t&&await this.salvarDiligencia(a,t)}catch(t){console.error("Erro ao solicitar diligência:",t)}},async salvarDiligencia(a,t){try{const e=this.calcularDataUtil(new Date,t.prazo),{error:o}=await P.ND.from("diligencias").insert({produto_id:a,tenant_id:this.currentTenantId,tipo:t.tipo,descricao:t.descricao,prazo_dias:t.prazo,data_limite:e.toISOString(),status:"PENDENTE",solicitado_por:"CPM"});if(o)throw o;const{error:i}=await P.ND.from("produtos").update({status:"diligencia"}).eq("id",a);if(i)throw i;this.$swal({title:"Sucesso!",text:"Diligência solicitada com sucesso",icon:"success"}),await this.carregarDados()}catch(e){console.error("Erro ao salvar diligência:",e),this.$swal({title:"Erro",text:"Erro ao solicitar diligência",icon:"error"})}},async visualizarDiligencias(a){try{const{data:t,error:e}=await P.ND.from("diligencias").select("*").eq("produto_id",a).order("criado_em",{ascending:!1});if(e)throw e;let o='<div style="text-align: left;">';t&&t.length>0?(o+="<h4>Diligências do Produto:</h4>",t.forEach(((a,t)=>{const e="PENDENTE"===a.status?"color: #f39c12":"color: #27ae60";o+=`\n               <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px;">\n                 <strong>Diligência ${t+1}</strong><br>\n                 <strong>Tipo:</strong> ${a.tipo.replace(/_/g," ")}<br>\n                 <strong>Status:</strong> <span style="${e}">${a.status}</span><br>\n                 <strong>Descrição:</strong> ${a.descricao}<br>\n                 <strong>Prazo:</strong> ${this.formatDate(a.data_limite)}<br>\n                 <strong>Solicitado em:</strong> ${this.formatDate(a.criado_em)}\n               </div>\n             `}))):o+="<p>Nenhuma diligência encontrada para este produto.</p>",o+="</div>",this.$swal({title:"Diligências",html:o,width:"600px"})}catch(t){console.error("Erro ao carregar diligências:",t),this.$swal({title:"Erro",text:"Erro ao carregar diligências do produto",icon:"error"})}},calcularDataUtil(a,t){const e=new Date(a);let o=0;while(o<t)e.setDate(e.getDate()+1),0!==e.getDay()&&6!==e.getDay()&&o++;return e},inicializarFiltros(){this.produtosFiltrados=[...this.produtos],this.diligenciasFiltradas=[...this.produtosComDiligencia],this.aplicarFiltros(),this.aplicarFiltrosDiligencia()},aplicarFiltros(){this.produtosFiltrados=this.produtos.filter((a=>{const t=a.nome.toLowerCase().includes(this.filtros.nome.toLowerCase()),e=a.marca.toLowerCase().includes(this.filtros.marca.toLowerCase()),o=""===this.filtros.status||a.status===this.filtros.status;let i=!0;if(this.filtros.data){const t=new Date(a.criado_em).toDateString(),e=new Date(this.filtros.data).toDateString();i=t===e}return t&&e&&o&&i})),this.calcularPaginacao()},calcularPaginacao(){this.totalPaginas=Math.ceil(this.produtosFiltrados.length/this.itensPorPagina),this.paginaAtual>this.totalPaginas&&(this.paginaAtual=Math.max(1,this.totalPaginas)),this.paginasVisiveis=[];const a=5;if(this.totalPaginas<=a)for(let o=1;o<=this.totalPaginas;o++)this.paginasVisiveis.push(o);else{const t=Math.max(1,this.paginaAtual-2),e=Math.min(this.totalPaginas,t+a-1);for(let a=t;a<=e;a++)this.paginasVisiveis.push(a)}const t=(this.paginaAtual-1)*this.itensPorPagina,e=t+this.itensPorPagina;this.produtosPaginados=this.produtosFiltrados.slice(t,e)},aplicarPaginacao(){this.paginaAtual=1,this.calcularPaginacao()},irParaPagina(a){this.paginaAtual=a,this.calcularPaginacao()},limparFiltros(){this.filtros={nome:"",marca:"",status:"",data:""},this.paginaAtual=1,this.aplicarFiltros()},aplicarFiltrosDiligencia(){this.diligenciasFiltradas=this.produtosComDiligencia.filter((a=>{const t=!this.filtrosDiligencia.busca||a.nome.toLowerCase().includes(this.filtrosDiligencia.busca.toLowerCase())||a.marca.toLowerCase().includes(this.filtrosDiligencia.busca.toLowerCase())||a.fabricante&&a.fabricante.toLowerCase().includes(this.filtrosDiligencia.busca.toLowerCase()),e=!this.filtrosDiligencia.marca||a.marca===this.filtrosDiligencia.marca;let o=!0;if(this.filtrosDiligencia.data){const t=new Date(a.criado_em).toDateString(),e=new Date(this.filtrosDiligencia.data).toDateString();o=t===e}return t&&e&&o})),this.calcularPaginacaoDiligencia()},calcularPaginacaoDiligencia(){this.totalPaginasDiligencia=Math.ceil(this.diligenciasFiltradas.length/this.itensPorPaginaDiligencia),this.paginaAtualDiligencia>this.totalPaginasDiligencia&&(this.paginaAtualDiligencia=Math.max(1,this.totalPaginasDiligencia)),this.paginasVisiveisDiligencia=[];const a=5;if(this.totalPaginasDiligencia<=a)for(let o=1;o<=this.totalPaginasDiligencia;o++)this.paginasVisiveisDiligencia.push(o);else{const t=Math.max(1,this.paginaAtualDiligencia-2),e=Math.min(this.totalPaginasDiligencia,t+a-1);for(let a=t;a<=e;a++)this.paginasVisiveisDiligencia.push(a)}const t=(this.paginaAtualDiligencia-1)*this.itensPorPaginaDiligencia,e=t+this.itensPorPaginaDiligencia;this.diligenciasPaginadas=this.diligenciasFiltradas.slice(t,e)},aplicarPaginacaoDiligencia(){this.paginaAtualDiligencia=1,this.calcularPaginacaoDiligencia()},irParaPaginaDiligencia(a){this.paginaAtualDiligencia=a,this.calcularPaginacaoDiligencia()},limparFiltrosDiligencia(){this.filtrosDiligencia={busca:"",marca:"",data:""},this.paginaAtualDiligencia=1,this.aplicarFiltrosDiligencia()},formatarStatus(a){const t={pendente:"Em Avaliação",aprovado:"Aprovado",reprovado:"Reprovado",diligencia:"Diligência",em_analise:"Em Análise"};return t[a]||a},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";case"diligencia":return"status-diligencia";case"em_analise":return"status-em_analise";default:return`status-${a}`}},formatDate(a){if(!a)return"Não informado";try{const t=new Date(a);return isNaN(t.getTime())?"Data inválida":t.toLocaleDateString("pt-BR")}catch(t){return"Data inválida"}},async carregarDadosDCB(){try{if(!this.currentTenantId)return;console.log("Carregando dados DCB para tenant:",this.currentTenantId);const{data:a,error:t}=await P.ND.from("produtos").select("\n              *,\n              categorias(nome)\n            ").eq("tenant_id",this.currentTenantId).eq("status","aprovado").is("numero_dcb",null).order("data_aprovacao",{ascending:!1});if(t)throw t;this.produtosProntosDCB=a||[],this.produtosProntosDCBFiltrados=[...this.produtosProntosDCB];const{data:e,error:o}=await P.ND.from("dcb_certificados").select("\n              *,\n              produtos(nome, marca, modelo, fabricante)\n            ").eq("tenant_id",this.currentTenantId).order("data_emissao",{ascending:!1});if(o)throw o;const i=e||[];this.dcbsEmitidos=i.map((a=>({...a,produto_nome:a.produtos?.nome||"N/A",produto_marca:a.produtos?.marca||"N/A",produto_modelo:a.produtos?.modelo||"N/A",produto_fabricante:a.produtos?.fabricante||"N/A"}))),this.dcbsHistoricoFiltrados=[...this.dcbsEmitidos],this.calcularVencimentos(),console.log(`DCB dados carregados: ${this.produtosProntosDCB.length} prontos, ${this.dcbsEmitidos.length} emitidos`)}catch(a){console.error("Erro ao carregar dados DCB:",a),this.$swal.fire("Erro","Erro ao carregar dados DCB","error")}},calcularVencimentos(){const a=new Date,t=new Date;t.setDate(a.getDate()+30),this.dcbsVencendo=this.dcbsEmitidos.filter((e=>{if("ativo"!==e.status)return!1;const o=new Date(e.data_validade);return o>a&&o<=t})),this.dcbsVencidos=this.dcbsEmitidos.filter((t=>{if("ativo"!==t.status)return!1;const e=new Date(t.data_validade);return e<=a}))},aplicarFiltrosDCB(){let a=[...this.produtosProntosDCB];if(this.filtrosDCB.busca){const t=this.filtrosDCB.busca.toLowerCase();a=a.filter((a=>a.nome.toLowerCase().includes(t)||a.marca.toLowerCase().includes(t)||a.fabricante.toLowerCase().includes(t)))}if(this.filtrosDCB.categoria&&(a=a.filter((a=>a.categorias?.nome?.toLowerCase()===this.filtrosDCB.categoria))),this.filtrosDCB.dataAprovacao){const t=new Date(this.filtrosDCB.dataAprovacao);a=a.filter((a=>{if(!a.data_aprovacao)return!1;const e=new Date(a.data_aprovacao);return e.toDateString()===t.toDateString()}))}this.produtosProntosDCBFiltrados=a},limparFiltrosDCB(){this.filtrosDCB={busca:"",categoria:"",dataAprovacao:""},this.aplicarFiltrosDCB()},aplicarFiltrosHistorico(){let a=[...this.dcbsEmitidos];if(this.filtrosHistorico.numeroDCB){const t=this.filtrosHistorico.numeroDCB.toLowerCase();a=a.filter((a=>a.numero_dcb.toLowerCase().includes(t)))}if(this.filtrosHistorico.status&&(a=a.filter((a=>a.status===this.filtrosHistorico.status))),this.filtrosHistorico.dataInicio){const t=new Date(this.filtrosHistorico.dataInicio);a=a.filter((a=>{const e=new Date(a.data_emissao);return e>=t}))}if(this.filtrosHistorico.dataFim){const t=new Date(this.filtrosHistorico.dataFim);a=a.filter((a=>{const e=new Date(a.data_emissao);return e<=t}))}this.dcbsHistoricoFiltrados=a},async emitirDCB(a){try{this.emitindoDCB=a.id,console.log("Emitindo DCB para produto:",a.nome);const t=await this.gerarNumeroDCB(),e=new Date,o=new Date;o.setFullYear(o.getFullYear()+1);const i=o.toISOString().split("T")[0],{data:s,error:r}=await P.ND.from("dcb_certificados").insert({tenant_id:this.currentTenantId,produto_id:a.id,numero_dcb:t,data_emissao:e.toISOString(),data_validade:i,status:"ativo"}).select().single();if(r)throw r;const{error:n}=await P.ND.from("produtos").update({numero_dcb:t,validade_dcb:i}).eq("id",a.id);if(n)throw n;await this.registrarHistoricoDCB(a.id,"dcb_emitido",`DCB ${t} emitido`),await this.carregarDadosDCB(),await this.gerarPDFDCBAutomatico(s,a),this.$swal.fire({icon:"success",title:"🎉 DCB Emitido com Sucesso!",html:`\n              <div style="text-align: left; padding: 10px;">\n                <p><strong>📜 DCB:</strong> ${t}</p>\n                <p><strong>📦 Produto:</strong> ${a.nome}</p>\n                <p><strong>🏭 Marca:</strong> ${a.marca}</p>\n                <p><strong>📅 Validade:</strong> ${this.formatDate(i)}</p>\n                <hr style="margin: 15px 0;">\n                <p style="color: #28a745; font-weight: bold;">\n                  ✅ PDF oficial gerado automaticamente<br>\n                  📥 Use o botão "PDF" para baixar\n                </p>\n              </div>\n            `,showConfirmButton:!0,confirmButtonText:"📥 Baixar PDF Agora",showCancelButton:!0,cancelButtonText:"Fechar",confirmButtonColor:"#dc3545"}).then((a=>{a.isConfirmed&&this.downloadDCB(s)})),console.log("DCB emitido com sucesso:",t)}catch(t){console.error("Erro ao emitir DCB:",t),this.$swal.fire("Erro","Erro ao emitir DCB: "+t.message,"error")}finally{this.emitindoDCB=null}},async gerarNumeroDCB(){try{const{data:a,error:t}=await P.ND.from("dcb_certificados").select("numero_dcb").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1}).limit(1);if(t)throw t;const e=(new Date).getFullYear();if(!a||0===a.length)return`001/${e}`;const o=a[0].numero_dcb,[i,s]=o.split("/");if(parseInt(s)===e){const a=parseInt(i)+1;return`${a.toString().padStart(3,"0")}/${e}`}return`001/${e}`}catch(a){throw console.error("Erro ao gerar número DCB:",a),a}},async registrarHistoricoDCB(a,t,e){try{const{data:o}=await P.ND.auth.getSession(),i=o?.session?.user;await P.ND.from("workflow_historico").insert({tenant_id:this.currentTenantId,produto_id:a,usuario_id:i?.id,acao:t,observacoes:e})}catch(o){console.error("Erro ao registrar histórico:",o)}},visualizarProdutoDetalhes(a){this.produtoSelecionado=a,this.modalProdutoDetalhes=!0},fecharModalDetalhes(){this.modalProdutoDetalhes=!1,this.produtoSelecionado=null},visualizarDCB(a){this.dcbSelecionado=a,this.modalVisualizarDCB=!0},fecharModalDCB(){this.modalVisualizarDCB=!1,this.dcbSelecionado=null},async downloadDCB(a){try{console.log("Iniciando download DCB:",a.numero_dcb),this.$swal.fire({title:"Gerando PDF...",text:"Aguarde enquanto geramos seu DCB",allowOutsideClick:!1,didOpen:()=>{this.$swal.showLoading()}}),await this.gerarPDFDCB(a),this.$swal.close()}catch(t){console.error("Erro ao fazer download:",t),this.$swal.fire("Erro","Erro ao gerar PDF do DCB: "+t.message,"error")}},async gerarPDFDCB(a){try{const o=(await Promise.resolve().then(e.bind(e,1749))).default,i=(await e.e(420).then(e.t.bind(e,8420,19))).default,{data:s,error:r}=await P.ND.from("produtos").select("*").eq("id",a.produto_id).single();if(r)throw r;const n=new o("portrait","mm","a4"),l=n.internal.pageSize.getWidth(),c=n.internal.pageSize.getHeight(),d=20;let u=d;n.setFontSize(16),n.setFont("helvetica","bold"),n.text("REPÚBLICA FEDERATIVA DO BRASIL",l/2,u,{align:"center"}),u+=8,n.setFontSize(14),n.text("MINISTÉRIO DA SAÚDE",l/2,u,{align:"center"}),u+=6,n.setFontSize(12),n.setFont("helvetica","normal"),n.text("Comissão de Padronização de Materiais - CPM",l/2,u,{align:"center"}),u+=15,n.setDrawColor(0,0,0),n.setLineWidth(.5),n.line(d,u,l-d,u),u+=15,n.setFontSize(18),n.setFont("helvetica","bold"),n.text("DECLARAÇÃO DE CONFORMIDADE DE BEM",l/2,u,{align:"center"}),u+=8,n.setFontSize(16),n.setTextColor(0,100,200),n.text(`DCB Nº ${a.numero_dcb}`,l/2,u,{align:"center"}),n.setTextColor(0,0,0),u+=20,n.setFontSize(14),n.setFont("helvetica","bold"),n.text("PRODUTO CERTIFICADO",d,u),u+=10,n.setFontSize(11),n.setFont("helvetica","normal");const m=50;n.setDrawColor(200,200,200),n.setFillColor(250,250,250),n.rect(d,u,l-2*d,m,"FD"),u+=10,n.setFont("helvetica","bold"),n.text("Nome do Produto:",d+5,u),n.setFont("helvetica","normal"),n.text(s.nome||"N/A",d+45,u),u+=7,n.setFont("helvetica","bold"),n.text("Marca:",d+5,u),n.setFont("helvetica","normal"),n.text(s.marca||"N/A",d+20,u),u+=7,n.setFont("helvetica","bold"),n.text("Modelo:",d+5,u),n.setFont("helvetica","normal"),n.text(s.modelo||"N/A",d+22,u),u+=7,n.setFont("helvetica","bold"),n.text("Fabricante:",d+5,u),n.setFont("helvetica","normal"),n.text(s.fabricante||"N/A",d+30,u),u+=7,n.setFont("helvetica","bold"),n.text("CNPJ:",d+5,u),n.setFont("helvetica","normal"),n.text(s.cnpj_fabricante||s.cnpj||"N/A",d+20,u),u+=25,n.setFontSize(14),n.setFont("helvetica","bold"),n.text("DADOS DO CERTIFICADO",d,u),u+=10,n.setFontSize(11),n.setFont("helvetica","normal"),n.setDrawColor(200,200,200),n.setFillColor(250,250,250),n.rect(d,u,l-2*d,40,"FD"),u+=10,n.setFont("helvetica","bold"),n.text("Data de Emissão:",d+5,u),n.setFont("helvetica","normal"),n.text(this.formatDate(a.data_emissao),d+40,u),u+=8,n.setFont("helvetica","bold"),n.text("Data de Validade:",d+5,u),n.setFont("helvetica","normal"),n.text(this.formatDate(a.data_validade),d+40,u),u+=8,n.setFont("helvetica","bold"),n.text("Status:",d+5,u),n.setFont("helvetica","normal"),n.setTextColor(0,150,0),n.text(this.formatStatusDCB(a.status),d+20,u),n.setTextColor(0,0,0),u+=25,n.setFontSize(12),n.setFont("helvetica","bold"),n.text("DECLARAÇÃO",d,u),u+=10,n.setFontSize(10),n.setFont("helvetica","normal");const p=`Declaramos que o produto acima identificado foi submetido a análise técnica pela Comissão de Padronização de Materiais (CPM) deste órgão, tendo sido APROVADO para utilização em processos licitatórios, conforme previsto na Lei Federal nº 14.133/2021 (Lei de Licitações e Contratos).\n\nO presente Documento de Comprovação de Bem (DCB) atesta que o produto atende aos requisitos técnicos mínimos exigidos e está apto para fornecimento no âmbito da Administração Pública.\n\nEsta declaração possui validade até ${this.formatDate(a.data_validade)}, podendo ser renovada mediante nova análise técnica.`,v=n.splitTextToSize(p,l-2*d),g=4*v.length+80;u+g>c-30&&(n.addPage(),u=d),n.text(v,d,u),u+=4*v.length+25;try{const t=window.location.origin,e=t.includes("github.io"),o=e?`${t}/ComprarBem/#/validar-dcb/${a.numero_dcb}`:`${t}/validar-dcb/${a.numero_dcb}`,s=await i.toDataURL(o,{width:80,margin:1,color:{dark:"#000000",light:"#FFFFFF"}}),r=Math.max(u,c-120);n.addImage(s,"PNG",l-d-30,r,25,25),n.setFontSize(8),n.text("Validar DCB:",l-d-30,r+30),n.text(a.numero_dcb,l-d-30,r+33)}catch(t){console.warn("Erro ao gerar QR Code:",t)}u=c-90,n.setFontSize(10),n.setFont("helvetica","normal");const _=new Date;n.text(`Brasília, ${_.getDate().toString().padStart(2,"0")} de ${_.toLocaleDateString("pt-BR",{month:"long"})} de ${_.getFullYear()}`,d,u),u+=20,u=Math.max(u,c-85),n.setDrawColor(0,0,0),n.setLineWidth(.5),n.line(d,u,l/2-10,u),u+=8,n.setFontSize(9),n.setTextColor(0,0,0),n.text("Presidente da Comissão de Padronização de Materiais",d,u),u+=4,n.text("CPM - Ministério da Saúde",d,u),n.setFontSize(8),n.setTextColor(100,100,100);const h=`Este documento foi gerado eletronicamente pelo Sistema ComprarBem em ${_.toLocaleString("pt-BR")}`;n.text(h,l/2,c-10,{align:"center"});const f=`DCB_${a.numero_dcb.replace("/","_")}_${s.nome.replace(/[^a-zA-Z0-9]/g,"_")}.pdf`;n.save(f),console.log("PDF gerado com sucesso:",f),await this.salvarURLPDFNoBanco(a.id,f)}catch(o){throw console.error("Erro ao gerar PDF:",o),o}},async salvarURLPDFNoBanco(a,t){try{const{error:e}=await P.ND.from("dcb_certificados").update({arquivo_pdf_url:t}).eq("id",a);e&&console.warn("Erro ao salvar URL do PDF:",e)}catch(e){console.warn("Erro ao atualizar banco com PDF:",e)}},async gerarPDFDCBAutomatico(a,t){try{console.log("Gerando PDF automaticamente para DCB:",a.numero_dcb);const e={...a,produto_id:t.id};await this.gerarPDFDCB(e)}catch(e){console.warn("Erro ao gerar PDF automaticamente:",e)}},async revogarDCB(a){try{const t=await this.$swal.fire({title:"Revogar DCB?",text:`Tem certeza que deseja revogar o DCB ${a.numero_dcb}?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sim, revogar",cancelButtonText:"Cancelar",input:"textarea",inputPlaceholder:"Digite o motivo da revogação...",inputValidator:a=>{if(!a)return"Você precisa inserir um motivo!"}});if(t.isConfirmed){const e=t.value,{error:o}=await P.ND.from("dcb_certificados").update({status:"revogado",revogado_em:(new Date).toISOString(),motivo_revogacao:e}).eq("id",a.id);if(o)throw o;await this.carregarDadosDCB(),this.$swal.fire("Sucesso!","DCB revogado com sucesso.","success")}}catch(t){console.error("Erro ao revogar DCB:",t),this.$swal.fire("Erro","Erro ao revogar DCB","error")}},async iniciarRenovacao(a){this.$swal.fire({icon:"info",title:"Renovação de DCB",text:`Processo de renovação do DCB ${a.numero_dcb} será implementado em breve.`,timer:2e3})},async renovarDCBVencido(a){this.$swal.fire({icon:"info",title:"Renovação Urgente",text:`Renovação urgente do DCB ${a.numero_dcb} será implementada em breve.`,timer:2e3})},getStatusDCBClass(a){switch(a){case"ativo":return"status-ativo";case"vencido":return"status-vencido";case"revogado":return"status-revogado";default:return"status-indefinido"}},formatStatusDCB(a){switch(a){case"ativo":return"Ativo";case"vencido":return"Vencido";case"revogado":return"Revogado";default:return a}},calcularDiasRestantes(a){const t=new Date,e=new Date(a),o=e-t,i=Math.ceil(o/864e5);return Math.max(0,i)},calcularDiasVencidos(a){const t=new Date,e=new Date(a),o=t-e,i=Math.ceil(o/864e5);return Math.max(0,i)},formatarEspecificacoes(a){return"string"===typeof a?a:"object"===typeof a?JSON.stringify(a,null,2):"N/A"},async carregarEditais(){try{if(this.loadingEditais=!0,!this.currentTenantId)return void console.error("Tenant ID não disponível para carregar editais");const{data:a,error:t}=await P.ND.from("editais").select("\n              *,\n              participantes_count:participantes_editais(count)\n            ").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1});if(t)throw t;this.editais=(a||[]).map((a=>({...a,participantes_count:a.participantes_count?.[0]?.count||0}))),this.aplicarFiltrosEditais(),console.log(`${this.editais.length} editais carregados`),console.log("Editais com participantes:",this.editais.map((a=>({numero:a.numero,participantes:a.participantes_count}))))}catch(a){console.error("Erro ao carregar editais:",a),this.$swal.fire("Erro","Erro ao carregar editais","error")}finally{this.loadingEditais=!1}},aplicarFiltrosEditais(){let a=[...this.editais];if(this.filtroEditais.busca){const t=this.filtroEditais.busca.toLowerCase();a=a.filter((a=>a.numero.toLowerCase().includes(t)||a.descricao.toLowerCase().includes(t)))}this.filtroEditais.status&&(a=a.filter((a=>a.status===this.filtroEditais.status))),this.editaisFiltrados=a},abrirModalNovoEdital(){this.modoEdicaoEdital=!1,this.editalAtual={id:null,numero:"",descricao:"",conteudo:"",status:"RASCUNHO",data_publicacao:"",data_limite_impugnacao:"",url_documento:""},this.modalNovoEdital=!0},fecharModalNovoEdital(){this.modalNovoEdital=!1,this.modoEdicaoEdital=!1,this.editalAtual={id:null,numero:"",descricao:"",conteudo:"",status:"RASCUNHO",data_publicacao:"",data_limite_impugnacao:"",url_documento:"",nome_arquivo:""}},validarDatas(){if(!this.editalAtual.data_publicacao)return this.$swal.fire("Erro","Data de publicação é obrigatória","error"),!1;if(!this.editalAtual.data_limite_impugnacao)return this.$swal.fire("Erro","Prazo para impugnações é obrigatório","error"),!1;const a=new Date(this.editalAtual.data_publicacao),t=new Date(this.editalAtual.data_limite_impugnacao);if(t<=a)return this.$swal.fire({icon:"error",title:"Erro de Data",html:`\n              <p><strong>O prazo para impugnações deve ser posterior à data de publicação!</strong></p>\n              <br>\n              <p><strong>Data de Publicação:</strong> ${this.formatDate(a)}</p>\n              <p><strong>Prazo para Impugnações:</strong> ${this.formatDate(t)}</p>\n              <br>\n              <p>Por favor, ajuste as datas e tente novamente.</p>\n            `,confirmButtonText:"Entendi"}),!1;const e=new Date(a);if(e.setFullYear(e.getFullYear()+1),t>e){const a=this.$swal.fire({icon:"warning",title:"Prazo muito distante",text:"O prazo para impugnações está mais de 1 ano após a publicação. Tem certeza?",showCancelButton:!0,confirmButtonText:"Sim, continuar",cancelButtonText:"Cancelar"});if(!a.isConfirmed)return!1}return!0},validarDataLimite(){if(!this.editalAtual.data_publicacao||!this.editalAtual.data_limite_impugnacao)return;const a=new Date(this.editalAtual.data_publicacao),t=new Date(this.editalAtual.data_limite_impugnacao);t<=a&&(this.$swal.fire({icon:"warning",title:"Atenção!",text:"O prazo para impugnações deve ser posterior à data de publicação.",timer:3e3,toast:!0,position:"top-end",showConfirmButton:!1}),this.editalAtual.data_limite_impugnacao="")},async salvarEdital(){try{if(this.salvandoEdital=!0,!this.currentTenantId)throw new Error("Tenant ID não disponível");if(!this.validarDatas())return;const a={tenant_id:this.currentTenantId,numero:this.editalAtual.numero,descricao:this.editalAtual.descricao,conteudo:this.editalAtual.conteudo,status:this.editalAtual.status,data_publicacao:this.editalAtual.data_publicacao||(new Date).toISOString(),data_limite_impugnacao:this.editalAtual.data_limite_impugnacao,url_documento:this.editalAtual.url_documento,nome_arquivo:this.editalAtual.nome_arquivo};let t;if(this.modoEdicaoEdital){const{data:e,error:o}=await P.ND.from("editais").update(a).eq("id",this.editalAtual.id).select().single();t={data:e,error:o}}else{const{data:e,error:o}=await P.ND.from("editais").insert(a).select().single();t={data:e,error:o}}if(t.error)throw t.error;await this.carregarEditais(),this.fecharModalNovoEdital(),this.$swal.fire({icon:"success",title:this.modoEdicaoEdital?"Edital Atualizado!":"Edital Criado!",text:`Edital ${this.editalAtual.numero} ${this.modoEdicaoEdital?"atualizado":"criado"} com sucesso.`,timer:2e3})}catch(a){console.error("Erro ao salvar edital:",a),this.$swal.fire("Erro","Erro ao salvar edital: "+a.message,"error")}finally{this.salvandoEdital=!1}},visualizarEdital(a){this.editalSelecionado={...a},this.modalVisualizarEdital=!0},fecharModalVisualizarEdital(){this.modalVisualizarEdital=!1,this.editalSelecionado={}},editarEdital(a){this.modoEdicaoEdital=!0,this.editalAtual={id:a.id,numero:a.numero,descricao:a.descricao,conteudo:a.conteudo||"",status:a.status,data_publicacao:a.data_publicacao?new Date(a.data_publicacao).toISOString().slice(0,16):"",data_limite_impugnacao:a.data_limite_impugnacao?new Date(a.data_limite_impugnacao).toISOString().slice(0,16):"",url_documento:a.url_documento||"",nome_arquivo:a.nome_arquivo||""},this.modalNovoEdital=!0},editarEditalSelecionado(){this.fecharModalVisualizarEdital(),this.editarEdital(this.editalSelecionado)},async duplicarEdital(a){try{const t=await this.$swal.fire({title:"Duplicar Edital",text:"Digite o número do novo edital:",input:"text",inputValue:"",inputPlaceholder:"Ex: 002/2024",showCancelButton:!0,confirmButtonText:"Duplicar",cancelButtonText:"Cancelar",inputValidator:a=>{if(!a)return"Você precisa inserir um número!"}});if(t.isConfirmed){const e=t.value,o={tenant_id:this.currentTenantId,numero:e,descricao:a.descricao+" (Cópia)",conteudo:a.conteudo,status:"RASCUNHO",data_publicacao:(new Date).toISOString(),data_limite_impugnacao:a.data_limite_impugnacao},{error:i}=await P.ND.from("editais").insert(o);if(i)throw i;await this.carregarEditais(),this.$swal.fire("Sucesso!",`Edital ${e} criado com sucesso.`,"success")}}catch(t){console.error("Erro ao duplicar edital:",t),this.$swal.fire("Erro","Erro ao duplicar edital","error")}},async cancelarEdital(a){try{const t=await this.$swal.fire({title:"Cancelar Edital",text:`Tem certeza que deseja cancelar o edital ${a.numero}?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sim, cancelar",cancelButtonText:"Não",confirmButtonColor:"#d33"});if(t.isConfirmed){const{error:t}=await P.ND.from("editais").update({status:"CANCELADO"}).eq("id",a.id);if(t)throw t;await this.carregarEditais(),this.$swal.fire("Cancelado!",`Edital ${a.numero} foi cancelado.`,"success")}}catch(t){console.error("Erro ao cancelar edital:",t),this.$swal.fire("Erro","Erro ao cancelar edital","error")}},gerenciarParticipantes(a){console.log("Abrindo modal de participantes para:",a.numero),this.criarModalParticipantes(a)},async criarModalParticipantes(a){const{data:t,error:o}=await P.ND.from("participantes_editais").select("*").eq("tenant_id",this.currentTenantId).eq("edital_id",a.id).order("data_participacao",{ascending:!1});if(o)return console.error("Erro ao carregar participantes:",o),void this.$swal.fire("Erro","Erro ao carregar participantes","error");console.log("Participantes carregados:",t);const i=`\n          <div id="modal-participantes-custom" style="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100vw;\n            height: 100vh;\n            background: rgba(0,0,0,0.8);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 999999;\n          ">\n            <div style="\n              background: white;\n              border-radius: 12px;\n              width: 90%;\n              max-width: 1000px;\n              max-height: 80vh;\n              overflow-y: auto;\n              box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n            ">\n              <div style="\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 20px 25px;\n                border-bottom: 1px solid #eee;\n                background: #f8f9fa;\n                border-radius: 12px 12px 0 0;\n              ">\n                <h3 style="margin: 0; color: #2c3e50;">👥 Participantes - ${a.numero}</h3>\n                <button onclick="document.getElementById('modal-participantes-custom').remove()" style="\n                  background: none;\n                  border: none;\n                  font-size: 24px;\n                  cursor: pointer;\n                  color: #6c757d;\n                  width: 30px;\n                  height: 30px;\n                  border-radius: 50%;\n                ">&times;</button>\n              </div>\n              \n              <div style="padding: 25px;">\n                <div style="margin-bottom: 20px;">\n                  <h4>📊 Total de Participantes: ${t.length}</h4>\n                </div>\n                \n                ${t.length>0?`\n                  <div style="display: grid; gap: 15px;">\n                    ${t.map((a=>`\n                      <div style="\n                        border: 1px solid #ddd;\n                        border-radius: 8px;\n                        padding: 20px;\n                        background: #f9f9f9;\n                      ">\n                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">\n                          <h4 style="margin: 0; color: #2c3e50;">${a.razao_social}</h4>\n                          <span style="\n                            padding: 4px 12px;\n                            border-radius: 20px;\n                            font-size: 12px;\n                            font-weight: 600;\n                            background: ${this.getStatusColor(a.status)};\n                            color: white;\n                          ">${this.getStatusText(a.status)}</span>\n                        </div>\n                        \n                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin-bottom: 15px;">\n                          <p style="margin: 5px 0;"><strong>CNPJ:</strong> ${this.formatarCNPJSimples(a.cnpj)}</p>\n                          <p style="margin: 5px 0;"><strong>Representante:</strong> ${a.representante_legal}</p>\n                          <p style="margin: 5px 0;"><strong>Email:</strong> ${a.email}</p>\n                          <p style="margin: 5px 0;"><strong>Telefone:</strong> ${a.telefone||"N/A"}</p>\n                          <p style="margin: 5px 0;"><strong>Data Inscrição:</strong> ${this.formatDateSimples(a.data_participacao)}</p>\n                          ${a.data_envio_documentacao?`<p style="margin: 5px 0;"><strong>Data Documentação:</strong> ${this.formatDateSimples(a.data_envio_documentacao)}</p>`:""}\n                        </div>\n                        \n                        ${a.endereco?`\n                          <div style="margin-bottom: 15px;">\n                            <p style="margin: 5px 0;"><strong>📍 Endereço:</strong> ${a.endereco}</p>\n                          </div>\n                        `:""}\n                        \n                        ${a.observacoes?`\n                          <div style="\n                            margin-bottom: 15px;\n                            padding: 12px;\n                            background: #fff3cd;\n                            border: 1px solid #ffeaa7;\n                            border-radius: 6px;\n                          ">\n                            <p style="margin: 0; font-weight: 600; color: #856404;">💬 Observações da Empresa:</p>\n                            <p style="margin: 8px 0 0 0; color: #856404;">${a.observacoes}</p>\n                          </div>\n                        `:""}\n                        \n                        ${a.produtos_submetidos&&a.produtos_submetidos.length>0?`\n                          <div style="\n                            margin-bottom: 15px;\n                            padding: 12px;\n                            background: #d1ecf1;\n                            border: 1px solid #bee5eb;\n                            border-radius: 6px;\n                          ">\n                            <p style="margin: 0; font-weight: 600; color: #0c5460;">📦 Produtos Submetidos:</p>\n                            <ul style="margin: 8px 0 0 20px; color: #0c5460;">\n                              ${a.produtos_submetidos.map((a=>`<li>${a.nome||a}</li>`)).join("")}\n                            </ul>\n                          </div>\n                        `:""}\n                        \n                        <div style="margin-top: 15px;">\n                          <div style="display: flex; gap: 10px; margin-bottom: 10px;">\n                            <button onclick="window.alterarStatusParticipante('${a.id}', 'APROVADO')" style="\n                              padding: 8px 16px;\n                              background: #28a745;\n                              color: white;\n                              border: none;\n                              border-radius: 6px;\n                              cursor: pointer;\n                              font-size: 14px;\n                            ">✅ Aprovar</button>\n                            \n                            <button onclick="window.alterarStatusParticipante('${a.id}', 'REPROVADO')" style="\n                              padding: 8px 16px;\n                              background: #dc3545;\n                              color: white;\n                              border: none;\n                              border-radius: 6px;\n                              cursor: pointer;\n                              font-size: 14px;\n                            ">❌ Reprovar</button>\n                            \n                            <button onclick="window.alterarStatusParticipante('${a.id}', 'EM_AVALIACAO')" style="\n                              padding: 8px 16px;\n                              background: #ffc107;\n                              color: #212529;\n                              border: none;\n                              border-radius: 6px;\n                              cursor: pointer;\n                              font-size: 14px;\n                            ">🔄 Em Avaliação</button>\n                            \n                            <button onclick="window.adicionarObservacaoInterna('${a.id}')" style="\n                              padding: 8px 16px;\n                              background: #6f42c1;\n                              color: white;\n                              border: none;\n                              border-radius: 6px;\n                              cursor: pointer;\n                              font-size: 14px;\n                            ">📝 Adicionar Observação</button>\n                          </div>\n                          \n                          ${a.observacoes_internas?`\n                            <div style="\n                              padding: 12px;\n                              background: #e9ecef;\n                              border: 1px solid #ced4da;\n                              border-radius: 6px;\n                              margin-top: 10px;\n                            ">\n                              <p style="margin: 0; font-weight: 600; color: #495057;">🔒 Observações Internas da CPM:</p>\n                              <p style="margin: 8px 0 0 0; color: #495057; font-style: italic;">${a.observacoes_internas}</p>\n                            </div>\n                          `:""}\n                        </div>\n                      </div>\n                    `)).join("")}\n                  </div>\n                `:'\n                  <div style="text-align: center; padding: 40px; color: #6c757d;">\n                    <div style="font-size: 48px; margin-bottom: 20px;">👥</div>\n                    <h3>Nenhum participante encontrado</h3>\n                    <p>Ainda não há empresas inscritas neste edital.</p>\n                  </div>\n                '}\n              </div>\n              \n              <div style="\n                padding: 20px 25px;\n                border-top: 1px solid #eee;\n                display: flex;\n                justify-content: flex-end;\n              ">\n                <button onclick="document.getElementById('modal-participantes-custom').remove()" style="\n                  padding: 10px 20px;\n                  background: #6c757d;\n                  color: white;\n                  border: none;\n                  border-radius: 6px;\n                  cursor: pointer;\n                ">Fechar</button>\n              </div>\n            </div>\n          </div>\n        `;document.body.insertAdjacentHTML("beforeend",i),window.alterarStatusParticipante=async(t,i)=>{try{const{data:o,error:r}=await P.ND.from("participantes_editais").select("*").eq("id",t).single();if(r)throw r;const{error:n}=await P.ND.from("participantes_editais").update({status:i}).eq("id",t);if(n)throw n;let l=null;if("APROVADO"===i||"REPROVADO"===i)try{const{enviarEmailParticipanteStatus:t}=await Promise.resolve().then(e.bind(e,3405));if("REPROVADO"===i){document.getElementById("modal-participantes-custom").remove(),await new Promise((a=>setTimeout(a,100)));const a=await this.$swal.fire({title:"❌ Motivo da Reprovação",text:"Informe o motivo da reprovação (será enviado por email):",input:"textarea",inputPlaceholder:"Ex: Documentação incompleta, dados inconsistentes, etc.",showCancelButton:!0,confirmButtonText:"Enviar Email",cancelButtonText:"Pular Email",inputValidator:a=>{if(!a)return"Por favor, informe o motivo da reprovação!"},heightAuto:!1,backdrop:!0,allowOutsideClick:!1});a.isConfirmed?l=a.value:(console.log("📧 Usuário cancelou envio de email de reprovação"),l=null)}if("APROVADO"===i||"REPROVADO"===i&&l){const e="APROVADO"===i?"aprovado":"rejeitado";console.log(`📧 Enviando email de ${e} para:`,o.email),await t(o,a,e,l),console.log(`✅ Email de ${e} enviado com sucesso!`)}else"REPROVADO"!==i||l||console.log("📧 Email de reprovação não enviado (usuário cancelou)")}catch(s){console.warn(`⚠️ Erro ao enviar email de ${i.toLowerCase()}:`,s)}const c=document.getElementById("modal-participantes-custom");c&&c.remove();let d=`Status alterado para ${this.getStatusText(i)}`;if("APROVADO"===i)d+="\n📧 Email de aprovação enviado automaticamente!";else if("REPROVADO"===i){const a=null!==l;d+=a?"\n📧 Email de reprovação enviado automaticamente!":"\n📧 Email de reprovação não foi enviado"}this.$swal.fire({icon:"success",title:"Sucesso!",text:d,timer:"APROVADO"===i||"REPROVADO"===i?4e3:2e3}),await this.carregarEditais(),setTimeout((()=>{this.criarModalParticipantes(a)}),500)}catch(o){console.error("Erro ao alterar status:",o);const e=document.getElementById("modal-participantes-custom");e&&e.remove(),this.$swal.fire({icon:"error",title:"Erro",text:"Erro ao alterar status do participante"}),setTimeout((()=>{this.criarModalParticipantes(a)}),2e3)}},window.adicionarObservacaoInterna=async t=>{try{document.getElementById("modal-participantes-custom").remove(),await new Promise((a=>setTimeout(a,100)));const e=await this.$swal.fire({title:"Observação Interna da CPM",text:"Esta observação será visível apenas para a equipe da CPM",input:"textarea",inputPlaceholder:"Digite suas observações sobre a análise deste participante...",showCancelButton:!0,confirmButtonText:"Salvar",cancelButtonText:"Cancelar",inputValidator:a=>{if(!a)return"Você precisa inserir uma observação!"}});if(e.isConfirmed){const o=e.value,{error:i}=await P.ND.from("participantes_editais").update({observacoes_internas:o}).eq("id",t);if(i)throw i;this.$swal.fire({icon:"success",title:"Sucesso!",text:"Observação interna adicionada com sucesso"}),setTimeout((()=>{this.criarModalParticipantes(a)}),500)}}catch(o){console.error("Erro ao adicionar observação:",o),this.$swal.fire({icon:"error",title:"Erro",text:"Erro ao adicionar observação interna"}),setTimeout((()=>{this.criarModalParticipantes(a)}),2e3)}}},getStatusColor(a){const t={INTERESSADO:"#17a2b8",DOCUMENTACAO_ENVIADA:"#ffc107",EM_AVALIACAO:"#fd7e14",APROVADO:"#28a745",REPROVADO:"#dc3545",DESISTENTE:"#6c757d"};return t[a]||"#6c757d"},getStatusText(a){const t={INTERESSADO:"Interessado",DOCUMENTACAO_ENVIADA:"Documentação Enviada",EM_AVALIACAO:"Em Avaliação",APROVADO:"Aprovado",REPROVADO:"Reprovado",DESISTENTE:"Desistente"};return t[a]||a},formatarCNPJSimples(a){return a?a.includes(".")?a:a.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/,"$1.$2.$3/$4-$5"):""},formatDateSimples(a){return a?new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"},abrirDocumento(a){a&&"uploads/documento-exemplo.pdf"!==a?window.open(a,"_blank"):this.$swal.fire("Aviso","Documento não disponível","warning")},async baixarDocumento(a){if(a.url_documento&&"uploads/documento-exemplo.pdf"!==a.url_documento)try{this.$swal.fire({title:"Preparando download...",text:"Aguarde um momento",allowOutsideClick:!1,didOpen:()=>{this.$swal.showLoading()}});const t=document.createElement("a");t.href=a.url_documento,t.download=a.nome_arquivo||`edital_${a.numero}.pdf`,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),this.$swal.close()}catch(t){console.error("Erro no download:",t),this.$swal.fire({icon:"error",title:"Erro no download",text:"Não foi possível baixar o arquivo. Tente novamente."})}else this.$swal.fire("Aviso","Documento não disponível para download","warning")},async handleFileUpload(a){const t=a.target.files[0];if(t){if("application/pdf"!==t.type)return this.$swal.fire("Erro","Apenas arquivos PDF são permitidos","error"),void(a.target.value="");if(t.size>10485760)return this.$swal.fire("Erro","Arquivo muito grande. Máximo 10MB","error"),void(a.target.value="");try{this.$swal.fire({title:"Fazendo upload...",text:"Aguarde enquanto o arquivo é enviado",allowOutsideClick:!1,didOpen:()=>{this.$swal.showLoading()}});const a=Date.now(),e=localStorage.getItem("tenant_id")||"default",o=`edital_${a}_${t.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,i=`${e}/editais/${o}`,{data:s,error:r}=await P.ND.storage.from("editais").upload(i,t,{cacheControl:"3600",upsert:!1});if(r)throw console.error("Erro no upload:",r),r;const{data:n}=P.ND.storage.from("editais").getPublicUrl(i);if(!n?.publicUrl)throw new Error("Não foi possível obter URL do arquivo");this.editalAtual.url_documento=n.publicUrl,this.editalAtual.nome_arquivo=t.name,this.$swal.fire({icon:"success",title:"Upload realizado!",text:"Arquivo PDF enviado com sucesso",timer:2e3})}catch(e){if(console.error("Erro no upload:",e),e.message?.includes("Bucket not found")||404===e.statusCode)try{return await this.criarBucketEditais(),void await this.handleFileUpload(a)}catch(o){console.error("Erro ao criar bucket:",o)}this.$swal.fire({icon:"error",title:"Erro no upload",text:"Não foi possível enviar o arquivo. Tente novamente.",footer:e.message||"Erro desconhecido"}),a.target.value=""}}},async criarBucketEditais(){try{const{data:a,error:t}=await P.ND.storage.createBucket("editais",{public:!0,fileSizeLimit:10485760,allowedMimeTypes:["application/pdf"]});if(t&&!t.message.includes("already exists"))throw t;console.log("Bucket editais criado/verificado com sucesso")}catch(a){throw console.error("Erro ao criar bucket editais:",a),a}},async carregarParticipantes(a){try{console.log("Carregando participantes para edital ID:",a),console.log("Tenant ID:",this.currentTenantId),this.loadingParticipantes=!0;const{data:t,error:e}=await P.ND.from("participantes_editais").select("*").eq("tenant_id",this.currentTenantId).eq("edital_id",a).order("data_participacao",{ascending:!1});if(e)throw e;console.log("Participantes carregados:",t),this.participantes=t||[],this.aplicarFiltrosParticipantes()}catch(t){console.error("Erro ao carregar participantes:",t),this.$swal.fire("Erro","Erro ao carregar participantes: "+t.message,"error")}finally{this.loadingParticipantes=!1}},aplicarFiltrosParticipantes(){let a=[...this.participantes];if(this.filtroParticipantes.busca){const t=this.filtroParticipantes.busca.toLowerCase();a=a.filter((a=>a.razao_social.toLowerCase().includes(t)||a.cnpj.includes(t)||a.representante_legal.toLowerCase().includes(t)||a.email.toLowerCase().includes(t)))}this.filtroParticipantes.status&&(a=a.filter((a=>a.status===this.filtroParticipantes.status))),this.participantesFiltrados=a},formatarCNPJ(a){return a?a.includes(".")?a:a.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/,"$1.$2.$3/$4-$5"):""},formatarStatus(a){const t={INTERESSADO:"Interessado",DOCUMENTACAO_ENVIADA:"Documentação Enviada",EM_AVALIACAO:"Em Avaliação",APROVADO:"Aprovado",REPROVADO:"Reprovado",DESISTENTE:"Desistente"};return t[a]||a},getStatusClass(a){const t={INTERESSADO:"status-interessado",DOCUMENTACAO_ENVIADA:"status-documentacao",EM_AVALIACAO:"status-avaliacao",APROVADO:"status-aprovado",REPROVADO:"status-reprovado",DESISTENTE:"status-desistente"};return t[a]||"status-default"},abrirModalNovoParticipante(){this.participanteAtual={id:null,razao_social:"",cnpj:"",representante_legal:"",email:"",telefone:"",endereco:"",status:"INTERESSADO",observacoes:"",produtos_submetidos:[]},this.modalNovoParticipante=!0},fecharModalParticipantes(){this.modalParticipantes=!1,this.editalSelecionado={},this.participantes=[],this.participantesFiltrados=[],this.filtroParticipantes={busca:"",status:""}},fecharModalNovoParticipante(){this.modalNovoParticipante=!1,this.participanteAtual={id:null,razao_social:"",cnpj:"",representante_legal:"",email:"",telefone:"",endereco:"",status:"INTERESSADO",observacoes:"",produtos_submetidos:[]}},async salvarParticipante(){try{if(!this.participanteAtual.razao_social||!this.participanteAtual.cnpj||!this.participanteAtual.representante_legal||!this.participanteAtual.email)return void this.$swal.fire("Erro","Preencha todos os campos obrigatórios","error");const a={tenant_id:this.currentTenantId,edital_id:this.editalSelecionado.id,razao_social:this.participanteAtual.razao_social,cnpj:this.participanteAtual.cnpj,representante_legal:this.participanteAtual.representante_legal,email:this.participanteAtual.email,telefone:this.participanteAtual.telefone,endereco:this.participanteAtual.endereco,status:this.participanteAtual.status,observacoes:this.participanteAtual.observacoes,produtos_submetidos:this.participanteAtual.produtos_submetidos};let t;if(this.participanteAtual.id){const{data:e,error:o}=await P.ND.from("participantes_editais").update(a).eq("id",this.participanteAtual.id).select().single();t={data:e,error:o}}else{const{data:e,error:o}=await P.ND.from("participantes_editais").insert(a).select().single();t={data:e,error:o}}if(t.error)throw t.error;await this.carregarParticipantes(this.editalSelecionado.id),this.fecharModalNovoParticipante(),this.$swal.fire({icon:"success",title:"Participante salvo!",text:`${this.participanteAtual.razao_social} foi ${this.participanteAtual.id?"atualizado":"adicionado"} com sucesso.`,timer:2e3})}catch(a){console.error("Erro ao salvar participante:",a),this.$swal.fire("Erro","Erro ao salvar participante: "+a.message,"error")}},editarParticipante(a){this.participanteAtual={...a},this.modalNovoParticipante=!0},async removerParticipante(a){try{const t=await this.$swal.fire({title:"Remover Participante",text:`Tem certeza que deseja remover ${a.razao_social}?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sim, remover",cancelButtonText:"Cancelar",confirmButtonColor:"#d33"});if(t.isConfirmed){const{error:t}=await P.ND.from("participantes_editais").delete().eq("id",a.id);if(t)throw t;await this.carregarParticipantes(this.editalSelecionado.id),await this.carregarEditais(),this.$swal.fire("Removido!","Participante removido com sucesso.","success")}}catch(t){console.error("Erro ao remover participante:",t),this.$swal.fire("Erro","Erro ao remover participante: "+t.message,"error")}},async carregarUsuarios(){try{const{data:a,error:t}=await P.ND.from("usuarios_rdm").select("*").eq("tenant_id",this.currentTenantId).order("nome_usuario",{ascending:!0});if(t)throw t;this.usuarios=a||[],this.aplicarFiltrosUsuarios()}catch(a){console.error("Erro ao carregar usuários:",a)}},aplicarFiltrosUsuarios(){let a=[...this.usuarios];if(this.filtroUsuarios.busca){const t=this.filtroUsuarios.busca.toLowerCase();a=a.filter((a=>a.nome_usuario?.toLowerCase().includes(t)||a.unidade_setor?.toLowerCase().includes(t)||a.nome_coordenador?.toLowerCase().includes(t)||a.email?.toLowerCase().includes(t)))}this.filtroUsuarios.unidade&&(a=a.filter((a=>a.unidade_setor===this.filtroUsuarios.unidade))),this.usuariosFiltrados=a},async abrirModalNovoUsuario(){console.log("➕ Abrindo modal de novo usuário..."),await this.carregarProdutos(),this.usuarioAtual={nome_usuario:"",unidade_setor:"",nome_coordenador:"",telefone:"",email:"",materiais:[{produto_id:"",nome:"",codigo:"",periodicidade_rdm:""}],criar_login:!1},console.log("✅ Modal novo usuário preparado"),console.log("📦 Produtos disponíveis:",this.produtosDisponiveis.length),this.modalNovoUsuario=!0},fecharModalNovoUsuario(){this.modalNovoUsuario=!1,this.usuarioAtual={nome_usuario:"",unidade_setor:"",nome_coordenador:"",telefone:"",email:"",materiais:[],criar_login:!1}},adicionarMaterial(){this.usuarioAtual.materiais.push({produto_id:"",nome:"",codigo:"",periodicidade_rdm:""})},removerMaterial(a){this.usuarioAtual.materiais.splice(a,1)},async salvarUsuario(){console.log("🚀 INICIANDO salvarUsuario..."),console.log("📊 Estado inicial:",{usuarioAtual:this.usuarioAtual,temCriarLogin:this.usuarioAtual?.criar_login,temId:!!this.usuarioAtual?.id});try{let e=null,o=null;if(console.log("✅ Variáveis inicializadas com sucesso"),console.log("🔍 Verificando necessidade de criar login..."),this.usuarioAtual.criar_login&&!this.usuarioAtual.id){console.log("🔐 Criando login automático para:",this.usuarioAtual.email),console.log("🎯 Gerando senha temporária..."),e=this.gerarSenhaTemporaria(),console.log("✅ Senha temporária gerada:",e?"SIM":"NÃO");try{console.log("🔐 SIMULAÇÃO - Criando usuário:",{email:this.usuarioAtual.email,senha:e,tipo:"rdm"});const a=crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){const t=16*Math.random()|0,e="x"==a?t:3&t|8;return e.toString(16)})),t={user:{id:a}},i=null;if(i)throw console.error("Erro ao criar usuário no Supabase Auth:",i),new Error("Não foi possível criar o login. Verifique se o email já está cadastrado.");o=t.user.id,console.log("✅ Usuário criado no Supabase Auth:",o)}catch(a){console.error("Erro na criação do login:",a),alert("Erro ao criar login do usuário. Usuário será cadastrado sem acesso ao sistema.")}}console.log("📝 Preparando dados do usuário..."),console.log("🔑 Dados de entrada:",{currentTenantId:this.currentTenantId,usuarioSupabaseId:o,senhaTemporaria:e?"EXISTE":"NULL"});const i={...this.usuarioAtual,tenant_id:this.currentTenantId,user_id:o,senha_temporaria:e,convite_enviado:!1,convite_aceito:!1,ativo:!0,criado_em:(new Date).toISOString(),atualizado_em:(new Date).toISOString()};if(console.log("✅ Dados do usuário preparados com sucesso"),delete i.criar_login,this.usuarioAtual.id||(delete i.id,console.log("🆔 Campo ID removido para permitir geração automática de UUID")),console.log("📝 Dados preparados para inserção:",{temId:!!i.id,tenant_id:i.tenant_id,nome_usuario:i.nome_usuario,email:i.email,materiais:i.materiais?.length||0}),console.log("🔍 DIAGNÓSTICO TENANT_ID:",{currentTenantId:this.currentTenantId,userDataTenantId:i.tenant_id,tenantIdType:typeof i.tenant_id,tenantIdLength:i.tenant_id?.length,isValidUUID:/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i.tenant_id)}),this.usuarioAtual.id){const a={...i};this.usuarioAtual.criar_login||(delete a.user_id,delete a.senha_temporaria,delete a.convite_enviado,delete a.convite_aceito,console.log("🔐 Campos de login preservados (não serão sobrescritos)"));const{error:t}=await P.ND.from("usuarios_rdm").update(a).eq("id",this.usuarioAtual.id).eq("tenant_id",this.currentTenantId);if(t)throw t;console.log("✅ Usuário atualizado com sucesso")}else{const{data:a,error:t}=await P.ND.from("usuarios_rdm").insert([i]).select();if(t)throw t;i.id=a[0].id,console.log("✅ Usuário criado com sucesso:",i.id)}console.log("📧 Verificando envio de email...");let s=null;if(o&&e){console.log("📧 Condições atendidas, enviando email..."),console.log("📧 Dados para envio:",{usuarioSupabaseId:o?"EXISTE":"NULL",senhaTemporaria:e?"EXISTE":"NULL",email:i.email});try{s=await this.enviarEmailConvite(i,e),console.log("📧 Resultado do email:",s)}catch(t){console.error("❌ ERRO ESPECÍFICO NO EMAIL:",t),s={success:!1,message:t.message}}}else console.log("⏩ Pulando envio de email (condições não atendidas)");this.fecharModalNovoUsuario(),await this.carregarUsuarios(),o?s&&s.success?alert(`🎉 USUÁRIO CADASTRADO COM SUCESSO!\n\n✅ Usuário: ${this.usuarioAtual.nome_usuario}\n✅ Login criado no sistema\n✅ Email enviado para: ${this.usuarioAtual.email}\n\n📧 O usuário receberá:\n• Link de acesso: ${window.location.origin.includes("localhost")?window.location.origin+"/rdm":window.location.origin+"/ComprarBem/#/rdm"}\n• Senha temporária para primeiro acesso\n• Instruções completas de uso\n\nO usuário já pode fazer login no sistema!`):alert(`⚠️ USUÁRIO CADASTRADO (Email com problema)\n\n✅ Usuário: ${this.usuarioAtual.nome_usuario}\n✅ Login criado no sistema\n⚠️ Email NÃO foi enviado automaticamente\n\n🔧 AÇÃO NECESSÁRIA:\nEnvie manualmente os dados de acesso:\n📧 Email: ${this.usuarioAtual.email}\n🔑 Senha: ${e}\n🔗 Link: ${window.location.origin.includes("localhost")?window.location.origin+"/rdm":window.location.origin+"/ComprarBem/#/rdm"}\n\nO sistema funciona normalmente, apenas o email automático falhou.`):alert("✅ Usuário cadastrado com sucesso!"),this.programarAlertasRDM(i)}catch(e){console.error("❌ ERRO PRINCIPAL em salvarUsuario:",e),console.error("📊 INFORMAÇÕES DO ERRO PRINCIPAL:",{tipo:typeof e,nome:e?.name,mensagem:e?.message,stack:e?.stack});let a="Erro desconhecido. Tente novamente.";try{e&&e.message?a=e.message:e&&"function"===typeof e.toString&&(a=e.toString())}catch(o){console.error("Erro ao extrair mensagem:",o)}alert(`❌ Erro ao salvar usuário: ${a}`)}},async editarUsuario(a){console.log("🔧 Editando usuário:",a.nome_usuario),console.log("📋 Materiais do usuário:",a.materiais),await this.carregarProdutos(),this.usuarioAtual={...a},this.usuarioAtual.materiais&&Array.isArray(this.usuarioAtual.materiais)||(console.log("⚠️ Materiais não encontrados, inicializando array vazio"),this.usuarioAtual.materiais=[]),this.usuarioAtual.materiais=this.usuarioAtual.materiais.map(((a,t)=>{console.log(`📦 Processando material ${t+1}:`,a);const e={produto_id:a.produto_id||"",nome:a.nome||"",codigo:a.codigo||"",periodicidade_rdm:a.periodicidade_rdm||"mensal",marca:a.marca||"",categoria:a.categoria||"",...a};return console.log(`✅ Material ${t+1} processado:`,e),e})),console.log("✅ Usuário preparado para edição:",this.usuarioAtual),console.log("📦 Produtos disponíveis:",this.produtosDisponiveis.length),this.modalNovoUsuario=!0},async removerUsuario(a){if(confirm(`Tem certeza que deseja remover o usuário "${a.nome_usuario}"?`))try{const{error:t}=await P.ND.from("usuarios_rdm").delete().eq("id",a.id).eq("tenant_id",this.currentTenantId);if(t)throw t;await this.carregarUsuarios()}catch(t){console.error("Erro ao remover usuário:",t),alert("Erro ao remover usuário. Tente novamente.")}},verMateriaisUsuario(a){alert(`Materiais de ${a.nome_usuario}:\n\n${a.materiais?.map((a=>`• ${a.nome} (${a.codigo}) - RDM ${a.periodicidade_rdm}`)).join("\n")||"Nenhum material cadastrado"}`)},calcularProximoRDM(a){if(!a.materiais||0===a.materiais.length)return"N/A";const t=new Date,e=new Date(t.getFullYear(),t.getMonth()+1,1);return e.toLocaleDateString("pt-BR")},programarAlertasRDM(a){console.log("Alertas RDM programados para:",a.nome_usuario)},async testarEmailJS(){if(confirm("🧪 Testar configuração do EmailJS?\n\nIsso enviará um email de teste para comprarbemteste@gmail.com"))try{if(console.log("🧪 Iniciando teste do EmailJS..."),"undefined"===typeof L.Ay||!L.Ay)throw new Error("❌ EmailJS não está carregado");if("function"!==typeof L.Ay.init||"function"!==typeof L.Ay.send)throw new Error("❌ Métodos EmailJS não estão disponíveis");const t={serviceId:"service_7sv1naw",templateId:"template_nyiw2ua",publicKey:"DqGKMNJ87ch3qVxGv"};console.log("🧪 Configuração:",t);try{console.log("🧪 Inicializando EmailJS para teste..."),L.Ay.init(t.publicKey),console.log("✅ EmailJS inicializado com sucesso para teste")}catch(a){throw console.error("❌ Erro crítico na inicialização:",a),new Error("Falha na inicialização do EmailJS para teste: "+a.message)}const e={numero_edital:"TESTE-EMAILJS",email_empresa:"comprarbemteste@gmail.com",message:`\n🧪 TESTE DE CONFIGURAÇÃO EMAILJS\n\nEste é um email de teste para verificar se o EmailJS está funcionando corretamente.\n\n=== INFORMAÇÕES DO TESTE ===\nData do teste: ${(new Date).toLocaleString("pt-BR")}\nSistema: ${window.location.origin}\nTemplate: template_nyiw2ua\nService: service_7sv1naw\n\n=== RESULTADO ===\nSe você recebeu este email, a configuração está funcionando perfeitamente!\n\n=== PRÓXIMO PASSO ===\nAgora você pode cadastrar usuários RDM com confiança que os emails serão enviados.\n\n---\nSistema Comprar Bem - Compras Públicas Inteligentes\nTeste automático de configuração EmailJS\n          `,name:"Teste do Sistema",email:"comprarbemteste@gmail.com",subject:"🧪 Teste de Configuração EmailJS - Sistema Comprar Bem",status_participante:"aprovado",motivo_rejeicao:""};console.log("🧪 Enviando email de teste..."),console.log("🧪 Parâmetros:",e);const o=await L.Ay.send(t.serviceId,t.templateId,e,t.publicKey);if(console.log("✅ Teste bem-sucedido:",o),!o||200!==o.status)throw new Error(`Status de resposta inesperado: ${o?.status}`);alert("✅ TESTE REALIZADO COM SUCESSO!\n\n📧 Email de teste enviado para comprarbemteste@gmail.com\n\n✅ EmailJS está configurado corretamente")}catch(t){console.error("❌ Falha no teste:",t),alert(`❌ FALHA NO TESTE DO EMAILJS\n\nErro: ${t.message}\n\nPossíveis causas:\n• Configuração incorreta do EmailJS\n• Problemas de conectividade\n• Service ID ou Template ID inválidos\n• Public Key incorreta\n\nVerifique:\n1. Configuração no EmailJS Dashboard\n2. Conexão com a internet\n3. Console do navegador para mais detalhes`)}},async carregarAvaliacoes(){try{console.log("🔍 [AVALIAÇÕES CPM] === DEBUG COMPLETO ==="),console.log("🔍 [AVALIAÇÕES CPM] Tenant ID atual:",this.currentTenantId),console.log("🔍 [AVALIAÇÕES CPM] TESTE 1: TODAS as avaliações (sem filtro)");const{data:a,error:t}=await P.ND.from("material_feedbacks").select("*").order("criado_em",{ascending:!1});console.log("📊 [AVALIAÇÕES CPM] TESTE 1 - Total geral:",a?.length||0),a&&a.length>0&&(console.log("📊 [AVALIAÇÕES CPM] TESTE 1 - Primeira avaliação:",a[0]),console.log("📊 [AVALIAÇÕES CPM] TESTE 1 - Tenant IDs encontrados:",[...new Set(a.map((a=>a.tenant_id)))])),console.log("🔍 [AVALIAÇÕES CPM] TESTE 2: Com filtro de tenant");const{data:e,error:o}=await P.ND.from("material_feedbacks").select("*").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1});if(console.log("📊 [AVALIAÇÕES CPM] TESTE 2 - Com tenant:",e?.length||0),o)return console.error("❌ [AVALIAÇÕES CPM] Erro ao carregar avaliações básicas:",o),this.avaliacoes=[],void this.aplicarFiltrosAvaliacoes();if(!e||0===e.length)return console.log("📭 [AVALIAÇÕES CPM] Nenhuma avaliação encontrada para este tenant"),console.log("🔍 [AVALIAÇÕES CPM] Vamos usar TODAS as avaliações temporariamente para debug..."),a&&a.length>0?(this.avaliacoes=await this.enriquecerAvaliacoesComUsuarios(a),console.log("🔄 [AVALIAÇÕES CPM] Usando TODAS as avaliações (sem filtro de tenant)")):this.avaliacoes=[],void this.aplicarFiltrosAvaliacoes();console.log("🔍 [AVALIAÇÕES CPM] TESTE 3: JOIN com usuários");const{data:i,error:s}=await P.ND.from("material_feedbacks").select("\n            *,\n            usuario_rdm:usuarios_rdm(nome_usuario, unidade_setor, email, telefone)\n          ").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1});s?(console.error("⚠️ [AVALIAÇÕES CPM] Erro no JOIN, usando dados básicos:",s),this.avaliacoes=await this.enriquecerAvaliacoesComUsuarios(e)):(console.log("✅ [AVALIAÇÕES CPM] JOIN executado com sucesso:",i?.length||0),this.avaliacoes=i||[]),this.aplicarFiltrosAvaliacoes(),console.log("🎯 [AVALIAÇÕES CPM] === FIM DEBUG - RESULTADO FINAL ==="),console.log("🎯 [AVALIAÇÕES CPM] Avaliações carregadas:",this.avaliacoes.length)}catch(a){console.error("❌ [AVALIAÇÕES CPM] Erro geral ao carregar avaliações:",a),this.avaliacoes=[],this.aplicarFiltrosAvaliacoes()}},async enriquecerAvaliacoesComUsuarios(a){try{const t=[];for(const e of a)if(e.usuario_rdm_id){const{data:a,error:o}=await P.ND.from("usuarios_rdm").select("nome_usuario, unidade_setor, email, telefone").eq("id",e.usuario_rdm_id).eq("tenant_id",this.currentTenantId).single();t.push({...e,usuario_rdm:a||null})}else t.push({...e,usuario_rdm:null});return t}catch(t){return console.error("❌ [AVALIAÇÕES CPM] Erro ao enriquecer com usuários:",t),a.map((a=>({...a,usuario_rdm:null})))}},aplicarFiltrosAvaliacoes(){let a=[...this.avaliacoes];if(this.filtroAvaliacoes.busca){const t=this.filtroAvaliacoes.busca.toLowerCase();a=a.filter((a=>a.material_nome?.toLowerCase().includes(t)||a.material_codigo?.toLowerCase().includes(t)||a.usuario_rdm?.nome_usuario?.toLowerCase().includes(t)||a.usuario_rdm?.unidade_setor?.toLowerCase().includes(t)||a.comentario?.toLowerCase().includes(t)))}this.filtroAvaliacoes.rating&&(a=a.filter((a=>a.rating==this.filtroAvaliacoes.rating))),this.filtroAvaliacoes.usuario&&(a=a.filter((a=>a.usuario_rdm?.nome_usuario?.toLowerCase().includes(this.filtroAvaliacoes.usuario.toLowerCase())))),this.avaliacoesFiltradas=a},toggleLoginSystem(){this.usuarioAtual.criar_login||(this.usuarioAtual.senha_temporaria=null,this.usuarioAtual.user_id=null)},gerarSenhaTemporaria(){const a=(new Date).getFullYear(),t=Math.floor(1e4*Math.random()).toString().padStart(4,"0");return`CB${a}${t}`},async enviarEmailConvite(a,t){try{if(console.log("📧 Enviando email REAL de convite para:",a.email),"undefined"===typeof L.Ay||!L.Ay)throw new Error("EmailJS não está carregado. Verifique a importação.");if("function"!==typeof L.Ay.init||"function"!==typeof L.Ay.send)throw new Error("Métodos EmailJS não estão disponíveis. Verifique a versão.");const o={serviceId:"service_7sv1naw",templateId:"template_nyiw2ua",publicKey:"DqGKMNJ87ch3qVxGv"};console.log("📧 EmailJS disponível:",typeof L.Ay),console.log("📧 Configuração:",o);const i={numero_edital:"RDM-CONVITE",email_empresa:a.email,message:`\n🔐 BEM-VINDO AO SISTEMA COMPRAR BEM\n\nOlá ${a.nome_usuario}!\n\nVocê foi cadastrado(a) para acessar o Sistema Comprar Bem - Dashboard RDM Online.\n\n=== SEUS DADOS DE ACESSO ===\nEmail: ${a.email}\nSenha de Acesso: ${t}\nUnidade/Setor: ${a.unidade_setor}\nCoordenador: ${a.nome_coordenador}\n\n=== COMO ACESSAR ===\n1. Acesse: ${window.location.origin.includes("localhost")?window.location.origin+"/rdm":window.location.origin+"/ComprarBem/#/rdm"}\n2. Faça login com seu email e senha\n3. Comece a emitir suas RDMs online!\n\n=== FUNCIONALIDADES DISPONÍVEIS ===\n✅ Emissão de RDMs online\n✅ Histórico de solicitações\n✅ Acompanhamento de status\n✅ Notificações automáticas\n\n=== IMPORTANTE ===\n🔑 Use sempre a mesma senha para acessar o sistema\n📝 Guarde seus dados de acesso em local seguro\n📞 Em caso de dúvidas, entre em contato conosco\n\n=== SUPORTE ===\nEmail: comprarbemteste@gmail.com\nSistema: ${window.location.origin}\n\nData do cadastro: ${(new Date).toLocaleDateString("pt-BR")}\n\n---\nSistema Comprar Bem - Compras Públicas Inteligentes\nEste é um email automático. Não responda diretamente.\n          `,name:a.nome_usuario,email:"comprarbemteste@gmail.com",subject:"🔐 Bem-vindo ao Sistema Comprar Bem - Acesso RDM Online",status_participante:"aprovado",motivo_rejeicao:""};console.log("📧 Enviando email REAL via EmailJS..."),console.log("📧 Para:",a.email),console.log("📧 Config EmailJS:",o),console.log("📧 Parâmetros do email:",i);try{console.log("📧 Inicializando EmailJS com public key..."),L.Ay.init(o.publicKey),console.log("✅ EmailJS inicializado com sucesso")}catch(e){throw console.error("❌ Erro na inicialização do EmailJS:",e),new Error("Falha na inicialização do EmailJS: "+e.message)}console.log("📧 Chamando emailjs.send...");const s=await L.Ay.send(o.serviceId,o.templateId,i,o.publicKey);if(console.log("🎉 EMAIL REAL ENVIADO COM SUCESSO!",s),!s||200!==s.status)throw new Error(`Falha no envio do email. Status: ${s?.status||"desconhecido"}`);return await P.ND.from("usuarios_rdm").update({convite_enviado:!0,data_convite:(new Date).toISOString()}).eq("id",a.id).eq("tenant_id",this.currentTenantId),console.log("✅ Status do convite atualizado no banco"),await this.criarNotificacao(this.currentTenantId,this.currentTenantId,"SISTEMA","Convite RDM Enviado",`✅ Email de convite enviado com SUCESSO!\n          \n📧 Destinatário: ${a.nome_usuario} (${a.email})\n🔑 Senha de acesso: ${t}\n🔗 Link de acesso: ${window.location.origin.includes("localhost")?window.location.origin+"/rdm":window.location.origin+"/ComprarBem/#/rdm"}\n📅 Data: ${(new Date).toLocaleString("pt-BR")}\n\nO usuário pode fazer login imediatamente no sistema RDM.`,null),console.log("🎉 PROCESSO COMPLETO - Email enviado e notificação criada!"),{success:!0,message:"Email enviado com sucesso!"}}catch(o){console.error("❌ ERRO DETALHADO ao enviar email de convite:",o),console.error("📊 INFORMAÇÕES DO ERRO:",{tipo:typeof o,nome:o?.name||"SemNome",mensagem:o?.message||"SemMensagem",stack:o?.stack||"SemStack",usuario:a?.email||"SemEmail",emailjsDisponivel:typeof L.Ay,errorString:o?.toString()||"NãoConvertível"});let t="Erro desconhecido";try{let a="Erro sem descrição";o&&"object"===typeof o?"string"===typeof o.message?a=o.message:"function"===typeof o.toString&&(a=o.toString()):"string"===typeof o&&(a=o),console.log("🔍 Mensagem de erro extraída:",a),t="string"===typeof a&&a.length>0?-1!==a.indexOf("emailjs")?"EmailJS não está carregado ou configurado corretamente":-1!==a.indexOf("network")||-1!==a.indexOf("fetch")?"Erro de conectividade. Verifique sua conexão com a internet":-1!==a.indexOf("service")||-1!==a.indexOf("template")?"Configuração inválida do EmailJS (service/template ID)":-1!==a.indexOf("422")?"Parâmetros incorretos do template EmailJS (erro 422)":-1!==a.indexOf("includes")?"Erro interno do JavaScript (propriedade undefined)":a:"Erro sem mensagem válida"}catch(i){console.error("❌ Erro na análise do erro:",i),t="Erro complexo não analisável"}return{success:!1,message:t}}},async criarNotificacao(a,t,e,o,i,s=null){try{const{error:r}=await P.ND.from("notificacoes").insert([{tenant_id:a,usuario_destino:t,tipo:e,titulo:o,mensagem:i,link_acao:s,criado_em:(new Date).toISOString()}]);if(r)throw r}catch(r){console.error("Erro ao criar notificação:",r)}},async verificarStatusConvites(){try{const{data:a,error:t}=await P.ND.from("usuarios_rdm").select("id, nome_usuario, email, convite_enviado, convite_aceito, data_convite").eq("tenant_id",this.currentTenantId).eq("ativo",!0).not("user_id","is",null);if(t)throw t;this.statusConvites=a.reduce(((a,t)=>(a[t.id]={enviado:t.convite_enviado,aceito:t.convite_aceito,dataConvite:t.data_convite},a)),{})}catch(a){console.error("Erro ao verificar status dos convites:",a)}},async reenviarConvite(a){if(confirm(`Reenviar convite de acesso para ${a.nome_usuario}?`))try{const t=this.gerarSenhaTemporaria();await P.ND.from("usuarios_rdm").update({senha_temporaria:t,convite_enviado:!1}).eq("id",a.id).eq("tenant_id",this.currentTenantId),a.user_id&&console.log("🔐 SIMULAÇÃO - Atualizando senha para:",a.email,t),await this.enviarEmailConvite({...a,senha_temporaria:t},t),alert("✅ Convite reenviado com sucesso!"),await this.carregarUsuarios()}catch(t){console.error("Erro ao reenviar convite:",t),alert("❌ Erro ao reenviar convite. Tente novamente.")}},async carregarProdutos(){try{this.loadingProdutos=!0,console.log("📦 Carregando produtos disponíveis..."),console.log("🔑 Tenant ID atual:",this.currentTenantId);const{data:a,error:t}=await P.ND.from("produtos").select("id, nome, marca, modelo, codigo_material, categoria_id, status, tenant_id").order("nome");console.log("📊 Todos os produtos encontrados:",a?.length||0),console.log("📋 Primeiros 3 produtos:",a?.slice(0,3)),a?.length>0&&console.log("🔍 Estrutura do primeiro produto:",{id:a[0].id,nome:a[0].nome,marca:a[0].marca,modelo:a[0].modelo,codigo_material:a[0].codigo_material,categoria_id:a[0].categoria_id,status:a[0].status,tenant_id:a[0].tenant_id});const{data:e,error:o}=await P.ND.from("produtos").select("id, nome, marca, modelo, codigo_material, categoria_id, status, tenant_id").eq("tenant_id",this.currentTenantId).order("nome");if(console.log("🎯 Produtos do tenant atual:",e?.length||0),console.log("📋 Status dos produtos:",e?.map((a=>a.status))),o)throw console.error("❌ Erro na query:",o),o;let i=e?.filter((a=>"aprovado"===a.status))||[];0===i.length&&(console.log('⚠️ Nenhum produto "aprovado" encontrado, carregando todos os produtos do tenant...'),i=e||[]),this.produtosDisponiveis=i,console.log(`✅ ${this.produtosDisponiveis.length} produtos carregados para seleção`),console.log("📦 Produtos disponíveis:",this.produtosDisponiveis.map((a=>`${a.nome} (${a.status})`)))}catch(a){console.error("❌ Erro ao carregar produtos:",a),this.produtosDisponiveis=[],alert(`❌ Erro ao carregar produtos:\n${a.message}\n\nVerifique o console para mais detalhes.`)}finally{this.loadingProdutos=!1}},selecionarProduto(a,t){const e=t.target.value,o=this.usuarioAtual.materiais[a];if(console.log("🔍 Selecionando produto:",e,"para material index:",a),"NOVO"===e)o.produto_id="NOVO",o.nome="",o.codigo="",console.log("📝 Modo novo material ativado");else if(e){const a=this.produtosDisponiveis.find((a=>a.id===e));console.log("🔍 Produto encontrado:",a),a&&(o.produto_id=e,o.nome=a.nome,o.codigo=a.codigo_material||a.modelo||"",o.marca=a.marca||"",o.categoria=a.categoria_id||"",console.log("✅ Dados do produto aplicados:",{nome:o.nome,codigo:o.codigo,marca:o.marca,categoria_id:o.categoria}))}else o.produto_id="",o.nome="",o.codigo="",console.log("🗑️ Seleção limpa");console.log("📋 Material atualizado:",o)}},formatarData(a){if(!a)return"";const t=new Date(a);return t.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}},V=U;var j=(0,g.A)(V,z,q,!1,null,"0d7b857a",null);const J=j.exports,H={name:"Dashboard",components:{DashboardCPM:J},data(){return{showDropdown:!1,usuarioNome:"Usuário",usuarioEmail:"",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},async created(){await this.carregarDadosUsuario(),this.carregarConfiguracoes()},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await P.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usuário:",a)}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},closeDropdown(){this.showDropdown=!1},abrirConfiguracoes(){this.closeDropdown(),this.mostrarConfigEmail()},abrirConfiguracoesEmail(){this.closeDropdown(),this.mostrarConfigEmail()},async mostrarConfigEmail(){const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},async logout(){try{await P.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()}}},G=H;var K=(0,g.A)(G,B,F,!1,null,"49a774eb",null);const Y=K.exports;var Q=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cadastro-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("▼")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("CadastroProduto")],1)])},X=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])}],Z=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cadastro-produto"},[t("h2",[a._v("Cadastro de Produto")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarProduto.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome do Produto*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.nome,expression:"produto.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.produto.nome},on:{input:function(t){t.target.composing||a.$set(a.produto,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"grupo"}},[a._v("Grupo*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produto.grupo_id,expression:"produto.grupo_id"}],attrs:{id:"grupo",required:""},on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.produto,"grupo_id",t.target.multiple?e:e[0])},a.onGrupoChange]}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.grupos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" ")])}))],2)])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"classe"}},[a._v("Classe*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produto.classe_id,expression:"produto.classe_id"}],attrs:{id:"classe",required:"",disabled:!a.produto.grupo_id||0===a.classes.length},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.produto,"classe_id",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.filteredClasses,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" ")])}))],2),a.produto.grupo_id&&0===a.filteredClasses.length?t("div",{staticClass:"info-text"},[a._v(" Não há classes disponíveis para este grupo. Por favor, cadastre uma classe primeiro. ")]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"marca"}},[a._v("Marca*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.marca,expression:"produto.marca"}],attrs:{id:"marca",type:"text",required:""},domProps:{value:a.produto.marca},on:{input:function(t){t.target.composing||a.$set(a.produto,"marca",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"modelo"}},[a._v("Modelo*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.modelo,expression:"produto.modelo"}],attrs:{id:"modelo",type:"text",required:""},domProps:{value:a.produto.modelo},on:{input:function(t){t.target.composing||a.$set(a.produto,"modelo",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"fabricante"}},[a._v("Fabricante*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.fabricante,expression:"produto.fabricante"}],attrs:{id:"fabricante",type:"text",required:""},domProps:{value:a.produto.fabricante},on:{input:function(t){t.target.composing||a.$set(a.produto,"fabricante",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cnpj"}},[a._v("CNPJ do Requerente*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.cnpjFormatado,expression:"cnpjFormatado"}],class:{"input-error":a.cnpjInvalido,"input-success":a.cnpjValidado&&!a.cnpjInvalido},attrs:{id:"cnpj",type:"text",required:"",maxlength:"18",placeholder:"00.000.000/0000-00"},domProps:{value:a.cnpjFormatado},on:{input:[function(t){t.target.composing||(a.cnpjFormatado=t.target.value)},a.formatarCNPJ]}}),a.cnpjMensagem?t("div",{class:["mensagem",{"error-text":a.cnpjInvalido,"success-text":!a.cnpjInvalido}]},[a._v(" "+a._s(a.cnpjMensagem)+" ")]):a._e(),a.dadosEmpresa?t("div",{staticClass:"dados-empresa"},[t("p",[t("strong",[a._v("Razão Social:")]),a._v(" "+a._s(a.dadosEmpresa.razaoSocial))]),a.dadosEmpresa.nomeFantasia?t("p",[t("strong",[a._v("Nome Fantasia:")]),a._v(" "+a._s(a.dadosEmpresa.nomeFantasia))]):a._e(),t("p",[t("strong",[a._v("Situação:")]),a._v(" "+a._s(a.dadosEmpresa.situacao))])]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email_fornecedor"}},[a._v("E-mail do Requerente*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.email_fornecedor,expression:"produto.email_fornecedor"}],attrs:{id:"email_fornecedor",type:"email",required:"",placeholder:"contato@empresa.com"},domProps:{value:a.produto.email_fornecedor},on:{input:function(t){t.target.composing||a.$set(a.produto,"email_fornecedor",t.target.value)}}}),t("small",{staticClass:"info-text"},[a._v("Email para comunicações sobre diligências")])])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"origem"}},[a._v("Origem")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.origem,expression:"produto.origem"}],attrs:{id:"origem",type:"text",placeholder:"Nacional ou Importado"},domProps:{value:a.produto.origem},on:{input:function(t){t.target.composing||a.$set(a.produto,"origem",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registro_anvisa"}},[a._v("Registro na Anvisa/MS")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.registro_anvisa,expression:"produto.registro_anvisa"}],attrs:{id:"registro_anvisa",type:"text",placeholder:"Número do registro"},domProps:{value:a.produto.registro_anvisa},on:{input:function(t){t.target.composing||a.$set(a.produto,"registro_anvisa",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cbpf"}},[a._v("CBPF")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.cbpf,expression:"produto.cbpf"}],attrs:{id:"cbpf",type:"text",placeholder:"Certificado de Boas Práticas de Fabricação"},domProps:{value:a.produto.cbpf},on:{input:function(t){t.target.composing||a.$set(a.produto,"cbpf",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"codigo_material"}},[a._v("Código do Material")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.codigo_material,expression:"produto.codigo_material"}],attrs:{id:"codigo_material",type:"text",placeholder:"Código interno do material"},domProps:{value:a.produto.codigo_material},on:{input:function(t){t.target.composing||a.$set(a.produto,"codigo_material",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"norma_abnt"}},[a._v("Norma ABNT")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.norma_abnt,expression:"produto.norma_abnt"}],attrs:{id:"norma_abnt",type:"text",placeholder:"Número da norma ABNT"},domProps:{value:a.produto.norma_abnt},on:{input:function(t){t.target.composing||a.$set(a.produto,"norma_abnt",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"norma_regulamentadora"}},[a._v("Norma Regulamentadora")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.norma_regulamentadora,expression:"produto.norma_regulamentadora"}],attrs:{id:"norma_regulamentadora",type:"text",placeholder:"Número da norma regulamentadora"},domProps:{value:a.produto.norma_regulamentadora},on:{input:function(t){t.target.composing||a.$set(a.produto,"norma_regulamentadora",t.target.value)}}})])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Especificação Detalhada")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.produto.descricao,expression:"produto.descricao"}],attrs:{id:"descricao",rows:"4"},domProps:{value:a.produto.descricao},on:{input:function(t){t.target.composing||a.$set(a.produto,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Documentação do Produto (apenas PDF)")]),t("div",{staticClass:"file-upload"},[t("input",{attrs:{type:"file",multiple:"",accept:".pdf"},on:{change:a.onFileSelect}})]),t("small",{staticClass:"info-text"},[a._v("Apenas arquivos PDF são aceitos (máx. 10MB por arquivo)")]),a.selectedFiles.length>0?t("div",{staticClass:"selected-files"},[t("p",[a._v("Arquivos selecionados:")]),t("ul",a._l(a.selectedFiles,(function(e,o){return t("li",{key:o,class:{"arquivo-invalido":!a.validarArquivoPDF(e)}},[a._v(" "+a._s(e.name)+" "),a.validarArquivoPDF(e)?a._e():t("span",{staticClass:"error-text"},[a._v("(Formato inválido - apenas PDF permitido)")])])})),0)]):a._e(),a.arquivosInvalidos.length>0?t("div",{staticClass:"error-text"},[t("p",[a._v("Os seguintes arquivos não serão enviados (apenas PDF permitido):")]),t("ul",a._l(a.arquivosInvalidos,(function(e,o){return t("li",{key:o},[a._v(" "+a._s(e.name)+" ")])})),0)]):a._e()]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.loading}},[a._v(" "+a._s(a.loading?"Salvando...":"Salvar")+" ")])])])])},W=[];const aa="https://publica.cnpj.ws/cnpj";async function ta(a){try{const t=a.replace(/[^\d]/g,"");if(14!==t.length)return{valido:!1,mensagem:"CNPJ deve ter 14 dígitos"};const e=await fetch(`${aa}/${t}`);if(!e.ok){if(404===e.status)return{valido:!1,mensagem:"CNPJ não encontrado na base de dados"};throw new Error("Erro ao consultar CNPJ")}const o=await e.json();return{valido:!0,mensagem:"CNPJ válido",dados:{razaoSocial:o.razao_social,nomeFantasia:o.estabelecimento?.nome_fantasia||"",situacao:o.estabelecimento?.situacao_cadastral||""}}}catch(t){return console.error("Erro ao validar CNPJ:",t),{valido:!1,mensagem:"Erro ao validar CNPJ. Tente novamente mais tarde."}}}const ea={name:"CadastroProduto",data(){return{produto:{nome:"",grupo_id:"",classe_id:"",marca:"",modelo:"",fabricante:"",cnpj:"",email_fornecedor:"",origem:"",registro_anvisa:"",cbpf:"",codigo_material:"",norma_abnt:"",norma_regulamentadora:"",descricao:""},cnpjFormatado:"",cnpjInvalido:!1,cnpjMensagem:"",cnpjValidado:!1,dadosEmpresa:null,loading:!1,grupos:[],classes:[],selectedFiles:[],arquivosInvalidos:[],currentTenantId:null}},computed:{filteredClasses(){return this.produto.grupo_id?this.classes.filter((a=>a.grupo_id===this.produto.grupo_id)):[]}},async created(){this.carregarGrupos(),await this.obterTenantId()},methods:{async obterTenantId(){try{const{data:a}=await P.ND.auth.getSession(),t=a?.session?.user;if(!t)throw new Error("Usuário não autenticado");if(t?.user_metadata?.tenant_id)return console.log("Obteve tenant_id dos metadados:",t.user_metadata.tenant_id),void(this.currentTenantId=t.user_metadata.tenant_id);const{data:e,error:o}=await P.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(console.log("Busca de tenant_id na tabela usuarios:",{userData:e,userError:o}),e&&e.tenant_id){console.log("Obteve tenant_id da tabela usuarios:",e.tenant_id),this.currentTenantId=e.tenant_id;const{error:a}=await P.ND.auth.updateUser({data:{tenant_id:e.tenant_id}});return void(a?console.error("Erro ao atualizar metadados do usuário:",a):console.log("Metadados do usuário atualizados com sucesso"))}const i=(0,S.A)();console.log("Gerando novo tenant_id:",i);const{error:s}=await P.ND.from("usuarios").insert({id:(0,S.A)(),email:t.email,tenant_id:i,ativo:!0});s&&console.error("Erro ao inserir novo tenant_id na tabela usuarios:",s);const{error:r}=await P.ND.auth.updateUser({data:{tenant_id:i}});r?console.error("Erro ao atualizar metadados do usuário:",r):console.log("Metadados do usuário atualizados com novo tenant_id"),this.currentTenantId=i}catch(a){console.error("Erro ao obter tenant_id:",a),alert("Erro ao obter identificação do tenant. Por favor, faça login novamente."),this.$router.push("/")}},async carregarGrupos(){try{const{data:a,error:t}=await P.ND.from("grupos").select("*").order("nome");if(t)throw t;a&&a.length>0?this.grupos=a:this.grupos=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}catch(a){console.error("Erro ao carregar grupos:",a),this.grupos=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}},onGrupoChange(){this.carregarClasses()},async carregarClasses(){try{const{data:a,error:t}=await P.ND.from("classes").select("*").eq("grupo_id",this.produto.grupo_id).order("nome");if(t)throw t;a&&a.length>0?this.classes=a:this.classes=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}catch(a){console.error("Erro ao carregar classes:",a),this.classes=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}},async formatarCNPJ(a){let t=a.target.value.replace(/\D/g,"");t.length<=14&&(t=t.replace(/^(\d{2})(\d)/,"$1.$2"),t=t.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3"),t=t.replace(/\.(\d{3})(\d)/,".$1/$2"),t=t.replace(/(\d{4})(\d)/,"$1-$2"),this.cnpjFormatado=t,this.produto.cnpj=t,this.cnpjValidado&&(this.cnpjValidado=!1,this.cnpjInvalido=!1,this.cnpjMensagem="",this.dadosEmpresa=null),14===t.replace(/\D/g,"").length&&await this.validarCNPJOnline())},async validarCNPJOnline(){try{const a=await ta(this.cnpjFormatado);this.cnpjValidado=!0,this.cnpjInvalido=!a.valido,this.cnpjMensagem=a.mensagem,a.valido?this.dadosEmpresa=a.dados:this.dadosEmpresa=null}catch(a){console.error("Erro ao validar CNPJ:",a),this.cnpjInvalido=!0,this.cnpjMensagem="Erro ao validar CNPJ. Tente novamente mais tarde."}},onFileSelect(a){const t=Array.from(a.target.files);this.arquivosInvalidos=[],this.selectedFiles=t.filter((a=>{const t=this.validarArquivoPDF(a);return t||this.arquivosInvalidos.push(a),t}))},validarArquivoPDF(a){const t=a.name.split(".").pop().toLowerCase(),e=a.type.toLowerCase();return"pdf"===t&&"application/pdf"===e},sanitizarNomeArquivo(a){let t=a.normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(t=t.replace(/[^a-zA-Z0-9_.]/g,"_"),t.length>100){const a=t.split(".").pop();t=t.substring(0,90)+"."+a}return t},async salvarProduto(){if(this.validarFormulario())try{if(this.loading=!0,this.currentTenantId||await this.obterTenantId(),console.log("Salvando produto com tenant_id:",this.currentTenantId),!this.validarCNPJ())return this.$swal({icon:"error",title:"CNPJ Inválido",text:"Por favor, informe um CNPJ válido no formato 00.000.000/0000-00"}),void(this.loading=!1);const a={nome:this.produto.nome,descricao:this.produto.descricao,grupo_id:this.produto.grupo_id,classe_id:this.produto.classe_id,marca:this.produto.marca,modelo:this.produto.modelo,fabricante:this.produto.fabricante,cnpj:this.produto.cnpj,email_fornecedor:this.produto.email_fornecedor,origem:this.produto.origem,registro_anvisa:this.produto.registro_anvisa,cbpf:this.produto.cbpf,norma_abnt:this.produto.norma_abnt,norma_regulamentadora:this.produto.norma_regulamentadora,codigo_material:this.produto.codigo_material,status:"pendente",tenant_id:this.currentTenantId};console.log("Objeto produto a ser inserido:",a);const{data:t,error:e}=await P.ND.from("produtos").insert(a).select().single();if(e)throw console.error("Erro detalhado ao salvar produto:",e),new Error(`Erro ao salvar produto: ${e.message}`);console.log("Produto inserido com sucesso:",t);const o=this.selectedFiles.filter((a=>this.validarArquivoPDF(a)));if(o.length>0){const a=t.id;for(const t of o){const e=t.name,o=this.sanitizarNomeArquivo(t.name),i=`${Date.now()}-${o}`;console.log(`Upload de arquivo: Original "${e}" -> Sanitizado "${o}"`);const{data:s,error:r}=await P.ND.storage.from("documentos").upload(i,t);if(r){console.error("Erro ao fazer upload do arquivo:",r);continue}const{data:n}=P.ND.storage.from("documentos").getPublicUrl(i),l=n?.publicUrl||"",c={tenant_id:this.currentTenantId,produto_id:a,nome:e,tipo:t.type,arquivo_url:l},{error:d}=await P.ND.from("documentos").insert(c);d&&console.error("Erro ao registrar documento:",d)}}this.arquivosInvalidos.length>0?this.$swal({icon:"warning",title:"Produto salvo com ressalvas",text:`O produto foi salvo, mas ${this.arquivosInvalidos.length} arquivo(s) não foi(ram) enviado(s) por não serem PDFs válidos.`}):this.$swal({icon:"success",title:"Produto salvo com sucesso!",text:"O produto foi cadastrado e está aguardando aprovação."}),this.limparFormulario()}catch(a){console.error("Erro no processo de salvamento:",a),this.$swal({icon:"error",title:"Erro ao salvar produto",text:a.message||"Ocorreu um erro ao tentar salvar o produto."})}finally{this.loading=!1}},limparFormulario(){this.produto={nome:"",grupo_id:"",classe_id:"",marca:"",modelo:"",fabricante:"",cnpj:"",origem:"",registro_anvisa:"",cbpf:"",norma_abnt:"",norma_regulamentadora:"",codigo_material:"",descricao:"",status:"pendente"},this.cnpjFormatado="",this.cnpjInvalido=!1,this.selectedFiles=[],this.arquivosInvalidos=[]},validarFormulario(){return this.produto.nome&&""!==this.produto.nome.trim()?this.produto.grupo_id?this.produto.classe_id?this.produto.descricao&&""!==this.produto.descricao.trim()?this.validarCNPJ()?(this.arquivosInvalidos.length>0&&this.$swal({icon:"error",title:"Arquivos inválidos",text:"Alguns arquivos selecionados não são PDFs válidos e não serão enviados."}),!0):(this.$swal({icon:"error",title:"Erro de validação",text:"O CNPJ informado é inválido"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"A descrição do produto é obrigatória"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"Selecione uma classe para o produto"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"Selecione um grupo para o produto"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"O nome do produto é obrigatório"}),!1)},convertToUUID(a){if(!a)return null;const t=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(t.test(a))return console.log("categoria_id já é um UUID válido:",a),a;const e=parseInt(a,10);if(isNaN(e))return console.warn("categoria_id não é um número nem UUID válido:",a),(0,S.A)();const o=`00000000-0000-0000-0000-${e.toString().padStart(12,"0")}`;return console.log(`Converteu categoria_id ${a} para UUID: ${o}`),o}}},oa=ea;var ia=(0,g.A)(oa,Z,W,!1,null,"68eb370a",null);const sa=ia.exports,ra={name:"Cadastro",components:{CadastroProduto:sa},data(){return{showDropdown:!1,modalEmailAberto:!1,usuarioNome:"comprarBemTeste",usuarioEmail:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},async created(){await this.carregarDadosUsuario(),this.carregarConfiguracoes()},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await P.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usuário:",a)}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},closeDropdown(){this.showDropdown=!1},abrirConfiguracoes(){this.closeDropdown(),this.mostrarConfigEmail()},abrirConfiguracoesEmail(){this.closeDropdown(),this.mostrarConfigEmail()},async mostrarConfigEmail(){const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},async logout(){try{await P.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()}}},na=ra;var la=(0,g.A)(na,Q,X,!1,null,"7cb6a01b",null);const ca=la.exports;var da=function(){var a=this,t=a._self._c;return t("div",{staticClass:"analise-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("▼")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("AnaliseProduto",{attrs:{id:a.produtoId}})],1)])},ua=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])}],ma=function(){var a=this,t=a._self._c;return t("div",{staticClass:"analise-container"},[a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando...")])]):a.produto?t("div",{staticClass:"produto-analise"},[t("h2",[a._v("Análise de Produto")]),t("div",{staticClass:"produto-info"},[t("div",{staticClass:"produto-header"},[t("h3",[a._v(a._s(a.produto.nome))]),t("div",{staticClass:"produto-actions"},["pendente"===a.produto.status?t("button",{staticClass:"btn-diligencia",on:{click:function(t){return a.solicitarDiligencia(a.produto.id)}}},[a._v(" 🔍 Solicitar Diligência ")]):a._e(),"diligencia"===a.produto.status?t("button",{staticClass:"btn-ver-diligencias",on:{click:function(t){return a.visualizarDiligencias(a.produto.id)}}},[a._v(" 📋 Ver Diligências ")]):a._e()])]),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item"},[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produto.marca)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produto.modelo)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produto.fabricante)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produto.cnpj)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Origem:")]),a._v(" "+a._s(a.produto.origem||"Não informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Registro na Anvisa/MS:")]),a._v(" "+a._s(a.produto.registro_anvisa||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CBPF:")]),a._v(" "+a._s(a.produto.cbpf||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Código do Material:")]),a._v(" "+a._s(a.produto.codigo_material||"Não informado")+" ")]),t("div",{staticClass:"info-item full-width"},[t("strong",[a._v("Descrição:")]),a._v(" "+a._s(a.produto.descricao||"Não informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Status Atual:")]),t("span",{staticClass:"status-pill",class:a.getStatusClass(a.produto.status)},[a._v(" "+a._s(a.produto.status)+" ")])]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Data de Cadastro:")]),a._v(" "+a._s(a.formatDate(a.produto.criado_em))+" ")])])]),a.documentos.length>0?t("div",{staticClass:"documentos-section"},[t("h3",[a._v("Documentos")]),t("div",{staticClass:"documentos-list"},a._l(a.documentos,(function(e){return t("div",{key:e.id,staticClass:"documento-item"},[t("div",{staticClass:"doc-icon"},[a._v("📄")]),t("div",{staticClass:"doc-info"},[t("p",{staticClass:"doc-name"},[a._v(a._s(e.nome))]),t("p",{staticClass:"doc-type"},[a._v(a._s(e.tipo))])]),t("a",{staticClass:"doc-action",attrs:{href:e.arquivo_url,target:"_blank"}},[a._v("Visualizar")])])})),0)]):a._e(),t("div",{staticClass:"analise-form"},[t("h3",[a._v("Parecer Técnico")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarAnalise.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"parecer"}},[a._v("Observações / Parecer")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.analise.parecer,expression:"analise.parecer"}],attrs:{id:"parecer",rows:"4",required:""},domProps:{value:a.analise.parecer},on:{input:function(t){t.target.composing||a.$set(a.analise,"parecer",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Decisão")]),t("div",{staticClass:"radio-group"},[t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.analise.status,expression:"analise.status"}],attrs:{type:"radio",value:"aprovado",required:""},domProps:{checked:a._q(a.analise.status,"aprovado")},on:{change:function(t){return a.$set(a.analise,"status","aprovado")}}}),a._v(" Aprovar ")]),t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.analise.status,expression:"analise.status"}],attrs:{type:"radio",value:"reprovado",required:""},domProps:{checked:a._q(a.analise.status,"reprovado")},on:{change:function(t){return a.$set(a.analise,"status","reprovado")}}}),a._v(" Reprovar ")])])]),"reprovado"===a.analise.status?t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"motivacao"}},[a._v("Motivação da Reprovação")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.analise.motivacao,expression:"analise.motivacao"}],attrs:{id:"motivacao",rows:"6",placeholder:"Descreva detalhadamente os motivos que levaram à reprovação deste produto",required:""},domProps:{value:a.analise.motivacao},on:{input:function(t){t.target.composing||a.$set(a.analise,"motivacao",t.target.value)}}}),t("small",{staticClass:"helper-text"},[a._v("Este campo será exibido ao fornecedor para justificar a reprovação do produto")])]):a._e(),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.submitting}},[a._v(" "+a._s(a.submitting?"Salvando...":"Salvar Análise")+" ")]),t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.voltar}},[a._v(" Voltar ")])])])]),a.analisesAnteriores.length>0?t("div",{staticClass:"analises-anteriores"},[t("h3",[a._v("Análises Anteriores")]),a._l(a.analisesAnteriores,(function(e){return t("div",{key:e.id,staticClass:"analise-historico"},[t("div",{staticClass:"analise-header"},[t("span",{staticClass:"status-pill",class:a.getStatusClass(e.status)},[a._v(a._s(e.status))]),t("span",{staticClass:"analise-data"},[a._v(a._s(a.formatDate(e.criado_em)))])]),t("div",{staticClass:"analise-conteudo"},[t("p",[a._v(a._s(e.parecer))]),"reprovado"===e.status&&e.motivacao?t("div",{staticClass:"motivacao-reprovacao"},[t("h4",[a._v("Motivação da Reprovação:")]),t("p",[a._v(a._s(e.motivacao))])]):a._e()])])}))],2):a._e()]):t("div",{staticClass:"not-found"},[t("p",[a._v("Produto não encontrado ou você não tem permissão para visualizá-lo.")]),t("button",{staticClass:"btn-secondary",on:{click:a.voltar}},[a._v("Voltar")])])])},pa=[],va=e(3405);const ga={name:"AnaliseProduto",props:{id:{type:String,required:!0}},data(){return{produto:null,documentos:[],analisesAnteriores:[],analise:{parecer:"",status:"",motivacao:""},loading:!0,submitting:!1}},created(){this.carregarDados()},methods:{async carregarDados(){try{this.loading=!0;const{data:a,error:t}=await P.ND.from("produtos").select("*").eq("id",this.id).single();if(t)throw t;this.produto=a;const{data:e,error:o}=await P.ND.from("documentos").select("*").eq("produto_id",this.id);if(o)throw o;this.documentos=e||[];const{data:i,error:s}=await P.ND.from("analises").select("*").eq("produto_id",this.id).order("criado_em",{ascending:!1});if(s)throw s;this.analisesAnteriores=i||[]}catch(a){console.error("Erro ao carregar dados:",a),alert("Erro ao carregar dados do produto. Por favor, tente novamente.")}finally{this.loading=!1}},async salvarAnalise(){try{if(this.submitting=!0,"reprovado"===this.analise.status&&!this.analise.motivacao)return this.$swal({icon:"error",title:"Campo obrigatório",text:"É necessário preencher a motivação da reprovação"}),void(this.submitting=!1);const{data:a}=await P.ND.auth.getSession(),t=a?.session?.user;let e;if(t){console.log("Usuário autenticado:",t.email);const{data:a,error:o}=await P.ND.from("usuarios").select("id").eq("email",t.email).maybeSingle();if(o&&console.error("Erro ao buscar ID do usuário:",o),a?.id)console.log("ID do usuário encontrado na tabela usuarios:",a.id),e=a.id;else{console.warn("Usuário não encontrado na tabela, gerando UUID"),e=this.gerarUUID();const{error:a}=await P.ND.from("usuarios").insert({id:e,email:t.email,nome:t.email.split("@")[0],tenant_id:this.produto.tenant_id,tipo:"avaliador",ativo:!0});a&&console.error("Erro ao criar usuário automaticamente:",a)}}else console.warn("Nenhum usuário autenticado, gerando UUID"),e=this.gerarUUID();console.log("Salvando análise com avaliador_id:",e);const o={produto_id:this.id,tenant_id:this.produto.tenant_id,avaliador_id:e,parecer:this.analise.parecer,status:this.analise.status};"reprovado"===this.analise.status&&(o.motivacao=this.analise.motivacao);const{error:i}=await P.ND.from("analises").insert(o);if(i)throw console.error("Erro detalhado ao salvar análise:",i),new Error(`Erro ao salvar análise: ${i.message}`);const{error:s}=await P.ND.from("produtos").update({status:this.analise.status}).eq("id",this.id);if(s)throw s;this.$swal({icon:"success",title:"Análise salva com sucesso!",showConfirmButton:!1,timer:1500}),await this.carregarDados(),this.analise={parecer:"",status:"",motivacao:""}}catch(a){console.error("Erro ao salvar análise:",a);let t="Erro ao salvar análise.";a.message&&a.message.includes("uuid")?t="Erro no formato de identificação. Este problema foi corrigido, tente novamente.":a.message&&(t=a.message),this.$swal({icon:"error",title:"Erro ao processar análise",text:t})}finally{this.submitting=!1}},formatDate(a){if(!a)return"";const t=new Date(a);return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},voltar(){this.$router.push("/dashboard")},gerarUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){const t=16*Math.random()|0,e="x"==a?t:3&t|8;return e.toString(16)}))},async solicitarDiligencia(a){try{const{value:t}=await this.$swal({title:"🔍 Solicitar Diligência",html:'\n            <div style="text-align: left; padding: 10px;">\n              <div style="margin-bottom: 20px;">\n                <label for="tipo_diligencia" style="display: block; font-weight: bold; margin-bottom: 8px; color: #2c3e50;">\n                  📋 Tipo de Diligência:\n                </label>\n                <select id="tipo_diligencia" class="swal2-input" style="width: 100%; font-size: 14px;">\n                  <option value="">Selecione o tipo</option>\n                  <option value="DOCUMENTACAO_FALTANTE">📄 Documentação Faltante</option>\n                  <option value="AMOSTRA_INADEQUADA">🔬 Amostra Inadequada</option>\n                  <option value="ESPECIFICACAO_INCOMPLETA">📝 Especificação Incompleta</option>\n                  <option value="CERTIFICACAO_PENDENTE">✅ Certificação Pendente</option>\n                  <option value="ESCLARECIMENTO_TECNICO">🔧 Esclarecimento Técnico</option>\n                  <option value="OUTRO">✏️ Outro (especificar)</option>\n                </select>\n                <div id="tipo_outro_container" style="display: none; margin-top: 10px;">\n                  <input \n                    type="text" \n                    id="tipo_outro_texto" \n                    class="swal2-input" \n                    placeholder="Digite o tipo de diligência..."\n                    style="width: 100%; font-size: 14px;"\n                  >\n                </div>\n              </div>\n              \n              <div style="margin-bottom: 20px;">\n                <label for="descricao_diligencia" style="display: block; font-weight: bold; margin-bottom: 8px; color: #2c3e50;">\n                  ✍️ Descrição Detalhada:\n                </label>\n                <textarea \n                  id="descricao_diligencia" \n                  class="swal2-textarea" \n                  placeholder="Descreva detalhadamente o que precisa ser providenciado pelo fornecedor..."\n                  style="width: 100%; min-height: 120px; font-size: 14px; line-height: 1.5;"\n                ></textarea>\n              </div>\n              \n              <div style="margin-bottom: 20px; padding: 15px; background: #e8f4fd; border-left: 4px solid #3498db; border-radius: 4px;">\n                <div style="display: flex; align-items: center; margin-bottom: 8px;">\n                  <span style="font-size: 18px; margin-right: 8px;">⏰</span>\n                  <strong style="color: #2c3e50;">Prazo para Resposta:</strong>\n                </div>\n                <p style="margin: 0; color: #34495e; font-size: 14px;">\n                  <strong>30 dias úteis</strong> (padrão do sistema)\n                </p>\n                <small style="color: #6c757d; font-size: 12px; margin-top: 5px; display: block;">\n                  📅 A data limite será calculada automaticamente excluindo fins de semana\n                </small>\n              </div>\n            </div>\n          ',width:"600px",focusConfirm:!1,showCancelButton:!0,confirmButtonText:"📤 Enviar Diligência",cancelButtonText:"❌ Cancelar",confirmButtonColor:"#f39c12",cancelButtonColor:"#6c757d",didOpen:()=>{const a=document.getElementById("tipo_diligencia"),t=document.getElementById("tipo_outro_container");a.addEventListener("change",(function(){"OUTRO"===this.value?(t.style.display="block",setTimeout((()=>{document.getElementById("tipo_outro_texto").focus()}),100)):t.style.display="none"}))},preConfirm:()=>{const a=document.getElementById("tipo_diligencia").value,t=document.getElementById("tipo_outro_texto").value,e=document.getElementById("descricao_diligencia").value,o=30;let i=a;if("OUTRO"===a){if(!t||t.trim().length<3)return this.$swal.showValidationMessage("⚠️ Por favor, especifique o tipo de diligência (mínimo 3 caracteres)"),!1;i=t.trim()}return a?!e||e.trim().length<20?(this.$swal.showValidationMessage("⚠️ A descrição deve ter pelo menos 20 caracteres"),!1):{tipo:i,descricao:e,prazo:o}:(this.$swal.showValidationMessage("⚠️ Por favor, selecione o tipo de diligência"),!1)}});t&&await this.salvarDiligencia(a,t)}catch(t){console.error("Erro ao solicitar diligência:",t)}},async salvarDiligencia(a,t){try{if(!this.produto.email_fornecedor)return void this.$swal({title:"⚠️ Email do Fornecedor Necessário",text:"Para enviar a diligência, é necessário que o produto tenha o email do fornecedor cadastrado. Deseja continuar sem enviar email?",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar sem Email",cancelButtonText:"Cancelar",confirmButtonColor:"#f39c12"}).then((async e=>{e.isConfirmed&&await this.processarDiligencia(a,t,!1)}));await this.processarDiligencia(a,t,!0)}catch(e){console.error("Erro ao salvar diligência:",e),this.$swal({title:"❌ Erro",text:"Erro ao solicitar diligência",icon:"error"})}},async processarDiligencia(a,t,e=!0){try{const i=this.calcularDataUtil(new Date,t.prazo),{data:s,error:r}=await P.ND.from("diligencias").insert({produto_id:a,tenant_id:this.produto.tenant_id,tipo:t.tipo,descricao:t.descricao,prazo_dias:t.prazo,data_limite:i.toISOString(),status:"PENDENTE",solicitado_por:"CPM"}).select().single();if(r)throw r;const{error:n}=await P.ND.from("produtos").update({status:"diligencia"}).eq("id",a);if(n)throw n;let l=!1;if(e&&this.produto.email_fornecedor)try{const a=await(0,va.lY)({destinatario:this.produto.email_fornecedor,produto:this.produto,diligencia:{...s,data_limite:i}});l=a.success,a.success||console.error("Erro no envio do email:",a.message)}catch(o){console.error("Erro ao enviar email:",o)}const c=e&&l?" O fornecedor foi notificado por email.":e&&!l?" ⚠️ A diligência foi salva, mas houve erro no envio do email.":" (Sem notificação por email)";this.$swal({title:"✅ Sucesso!",text:`Diligência solicitada com sucesso.${c}`,icon:l||!e?"success":"warning",confirmButtonColor:"#28a745"}),await this.carregarDados()}catch(i){console.error("Erro ao processar diligência:",i),this.$swal({title:"❌ Erro",text:"Erro ao processar diligência",icon:"error"})}},async visualizarDiligencias(a){try{const{data:t,error:e}=await P.ND.from("diligencias").select("*").eq("produto_id",a).order("criado_em",{ascending:!1});if(e)throw e;let o='<div style="text-align: left; padding: 10px;">';t&&t.length>0?(o+='<h4 style="color: #2c3e50; margin-bottom: 20px;">📋 Histórico de Diligências:</h4>',t.forEach(((a,t)=>{const e="PENDENTE"===a.status?"#f39c12":"ATENDIDA"===a.status?"#28a745":"#dc3545",i="PENDENTE"===a.status?"⏳":"ATENDIDA"===a.status?"✅":"❌";o+=`\n              <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin: 15px 0; background: ${"PENDENTE"===a.status?"#fff3cd":"ATENDIDA"===a.status?"#d4edda":"#f8d7da"};">\n                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">\n                  <strong style="color: #2c3e50;">Diligência #${t+1}</strong>\n                  <span style="color: ${e}; font-weight: bold;">\n                    ${i} ${a.status}\n                  </span>\n                </div>\n                \n                <div style="margin-bottom: 8px;">\n                  <strong style="color: #495057;">Tipo:</strong> \n                  <span style="color: #6c757d;">${a.tipo.replace(/_/g," ")}</span>\n                </div>\n                \n                <div style="margin-bottom: 8px;">\n                  <strong style="color: #495057;">Descrição:</strong>\n                  <div style="background: white; padding: 10px; border-radius: 4px; margin-top: 5px; border-left: 4px solid ${e};">\n                    ${a.descricao}\n                  </div>\n                </div>\n                \n                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; font-size: 12px; color: #6c757d;">\n                  <div>📅 <strong>Prazo:</strong> ${this.formatDate(a.data_limite)}</div>\n                  <div>🕐 <strong>Solicitado:</strong> ${this.formatDate(a.criado_em)}</div>\n                </div>\n              </div>\n            `}))):o+='\n            <div style="text-align: center; padding: 40px; color: #6c757d;">\n              <div style="font-size: 48px; margin-bottom: 15px;">📭</div>\n              <p>Nenhuma diligência encontrada para este produto.</p>\n            </div>\n          ',o+="</div>",this.$swal({title:"📋 Diligências do Produto",html:o,width:"700px",confirmButtonColor:"#007bff"})}catch(t){console.error("Erro ao carregar diligências:",t),this.$swal({title:"❌ Erro",text:"Erro ao carregar diligências do produto",icon:"error"})}},calcularDataUtil(a,t){const e=new Date(a);let o=0;while(o<t)e.setDate(e.getDate()+1),0!==e.getDay()&&6!==e.getDay()&&o++;return e}}},_a=ga;var ha=(0,g.A)(_a,ma,pa,!1,null,"1eb6b586",null);const fa=ha.exports,Ca={name:"Analise",components:{AnaliseProduto:fa},data(){return{showDropdown:!1,usuarioNome:"Usuário",usuarioEmail:""}},computed:{produtoId(){return this.$route.params.id}},async created(){await this.carregarDadosUsuario()},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await P.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usuário:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},closeDropdown(){this.showDropdown=!1},abrirConfiguracoes(){this.closeDropdown(),this.$swal({title:"⚙️ Configurações",text:"Configure o email no Dashboard principal para salvar as configurações globais.",icon:"info"})},abrirConfiguracoesEmail(){this.closeDropdown(),this.$swal({title:"📧 Configurar Email",text:"Acesse o Dashboard principal para configurar o email do sistema.",icon:"info"})},async logout(){try{await P.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()}}},ba=Ca;var Da=(0,g.A)(ba,da,ua,!1,null,"5d87272e",null);const wa=Da.exports;var Ea=function(){var a=this,t=a._self._c;return t("div",{staticClass:"catalogo-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.dropdownOpen},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("▼")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.nomeUsuario))]),t("small",[a._v(a._s(a.emailUsuario))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.dropdownOpen?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("CatalogoEletronico")],1),a.modalEmailAberto?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalEmail}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[a._m(2),t("button",{staticClass:"btn-close",on:{click:a.fecharModalEmail}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeOrganizacao"}},[a._v("Nome da Organização")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeOrganizacao,expression:"configEmail.nomeOrganizacao"}],attrs:{id:"nomeOrganizacao",type:"text",placeholder:"Ex: Prefeitura Municipal de..."},domProps:{value:a.configEmail.nomeOrganizacao},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeOrganizacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"emailRemetente"}},[a._v("Email Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.emailRemetente,expression:"configEmail.emailRemetente"}],attrs:{id:"emailRemetente",type:"email",placeholder:"Ex: licitacoes@prefeitura.gov.br"},domProps:{value:a.configEmail.emailRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"emailRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeRemetente"}},[a._v("Nome do Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeRemetente,expression:"configEmail.nomeRemetente"}],attrs:{id:"nomeRemetente",type:"text",placeholder:"Ex: CPM - Comissão de Padronização de Materiais"},domProps:{value:a.configEmail.nomeRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"assinatura"}},[a._v("Assinatura do Email")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.assinatura,expression:"configEmail.assinatura"}],attrs:{id:"assinatura",rows:"4",placeholder:"Ex: Atenciosamente,&#10;Comissão de Padronização de Materiais&#10;Prefeitura Municipal&#10;Telefone: (xx) xxxx-xxxx"},domProps:{value:a.configEmail.assinatura},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"assinatura",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:a.fecharModalEmail}},[a._v("Cancelar")]),t("button",{staticClass:"btn btn-primary",on:{click:a.salvarConfiguracaoEmail}},[t("i",{staticClass:"fas fa-save"}),a._v(" Salvar ")])])])]):a._e()])},Aa=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])},function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-envelope"}),a._v(" Configurar Email da Organização")])}],ya=function(){var a=this,t=a._self._c;return t("div",{staticClass:"catalogo-container"},[t("h2",[a._v("Catálogo Eletrônico de Bens Padronizados")]),t("div",{staticClass:"search-filters"},[t("div",{staticClass:"search-box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.searchTerm,expression:"searchTerm"}],attrs:{type:"text",placeholder:"Buscar produto..."},domProps:{value:a.searchTerm},on:{input:[function(t){t.target.composing||(a.searchTerm=t.target.value)},a.filtrarProdutos]}})]),t("div",{staticClass:"filters"},[t("div",{staticClass:"categoria-filter"},[a._m(0),t("div",{staticClass:"dropdown"},[t("button",{staticClass:"dropdown-toggle",attrs:{type:"button"},on:{click:a.toggleCategoriaDropdown}},[a._v(" "+a._s(a.categoriaAtual)+" ")]),t("div",{staticClass:"dropdown-menu",class:{show:a.showCategoriaDropdown}},[a.carregandoCategorias?t("div",{staticClass:"dropdown-item loading"},[t("div",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status"}}),t("span",[a._v("Carregando...")])]):[t("a",{staticClass:"dropdown-item",on:{click:function(t){return a.selecionarCategoria(null)}}},[a._v("Todos os grupos")]),0===a.categorias.length?t("div",{staticClass:"dropdown-item empty"},[a._v(" Nenhum grupo disponível ")]):a._l(a.categorias,(function(e){return t("a",{key:e.id,staticClass:"dropdown-item",class:{active:e.id===a.filtroCategoria},on:{click:function(t){return a.selecionarCategoria(e)}}},[a._v(" "+a._s(e.nome)+" ")])}))]],2)])])])]),a.produtosFiltrados.length>0?t("div",{staticClass:"produtos-grid"},a._l(a.produtosFiltrados,(function(e){return t("div",{key:e.id,staticClass:"produto-card",on:{click:function(t){return a.verDetalhesProduto(e.id)}}},[t("div",{staticClass:"produto-info"},[t("h3",[a._v(a._s(e.nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(e.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(e.modelo))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(e.fabricante))])])])})),0):t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhum produto encontrado.")])]),a.produtoSelecionado?t("div",{staticClass:"produto-modal",on:{click:function(t){return t.target!==t.currentTarget?null:a.fecharModal.apply(null,arguments)}}},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.produtoSelecionado.nome))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModal}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"produto-detalhes"},[t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoSelecionado.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoSelecionado.modelo))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoSelecionado.fabricante))]),t("p",[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produtoSelecionado.cnpj))]),t("p",[t("strong",[a._v("Código Material:")]),a._v(" "+a._s(a.produtoSelecionado.codigo_material))]),a.produtoSelecionado.descricao?t("p",[t("strong",[a._v("Descrição:")]),a._v(" "+a._s(a.produtoSelecionado.descricao))]):a._e(),t("div",{staticClass:"avaliacoes-section"},[t("div",{staticClass:"avaliacoes-header",class:{active:a.showAvaliacoes},on:{click:a.toggleAvaliacoes}},[t("h4",[a._v("Avaliações de Desempenho (RDM)")]),t("div",{staticClass:"avaliacao-summary"},[a.avaliacaoMedia>0?t("div",{staticClass:"stars-container"},[t("div",{staticClass:"stars"},a._l(5,(function(e){return t("span",{key:e,staticClass:"star",class:{filled:a.avaliacaoMedia>=e,half:a.avaliacaoMedia>=e-.5&&a.avaliacaoMedia<e}},[a._v("★")])})),0),t("span",{staticClass:"rating-number"},[a._v(a._s(a.avaliacaoMedia))]),t("span",{staticClass:"rating-count"},[a._v("("+a._s(a.avaliacoes.length)+" avaliações)")])]):t("div",{staticClass:"no-ratings"},[a._v(" Sem avaliações ainda ")]),t("span",{staticClass:"toggle-icon"},[a._v(a._s(a.showAvaliacoes?"▲":"▼"))])])]),a.showAvaliacoes?t("div",{staticClass:"avaliacoes-content"},[0===a.avaliacoes.length?t("div",{staticClass:"no-avaliacoes"},[a._v(" Este produto ainda não possui avaliações de desempenho. ")]):t("div",{staticClass:"avaliacoes-list"},a._l(a.avaliacoes,(function(e,o){return t("div",{key:o,staticClass:"avaliacao-item"},[t("div",{staticClass:"avaliacao-header"},[t("span",{staticClass:"avaliacao-tipo",class:e.tipo.toLowerCase()},[a._v(" "+a._s(e.tipo)+" ")]),t("div",{staticClass:"avaliacao-stars"},a._l(5,(function(o){return t("span",{key:o,staticClass:"star",class:{filled:e.avaliacao>=o}},[a._v("★")])})),0)]),e.comentario?t("div",{staticClass:"avaliacao-comentario"},[a._v(" "+a._s(e.comentario)+" ")]):a._e(),t("div",{staticClass:"avaliacao-footer"},[t("span",{staticClass:"avaliador"},[a._v(a._s(e.avaliador))]),t("span",{staticClass:"avaliacao-data"},[a._v(a._s(a.formatarData(e.data)))])])])})),0)]):a._e()]),t("div",{staticClass:"reclamacoes-section mt-4"},[t("div",{staticClass:"section-header",on:{click:a.toggleReclamacoes}},[t("div",{staticClass:"d-flex justify-content-between align-items-center"},[t("h5",{staticClass:"mb-0"},[a._v("Reclamações e Sugestões")]),t("div",{staticClass:"d-flex align-items-center"},[a.reclamacoes.length>0?t("span",{staticClass:"badge badge-info me-2"},[a._v(a._s(a.reclamacoes.length)+" registros")]):a._e(),t("span",{staticClass:"toggle-icon"},[a._v(a._s(a.showReclamacoes?"▲":"▼"))])])])]),a.showReclamacoes?t("div",{staticClass:"reclamacoes-content"},[0===a.reclamacoes.length?t("div",{staticClass:"text-center text-muted py-3"},[a._v(" Nenhuma reclamação registrada ")]):t("div",{staticClass:"reclamacoes-list"},a._l(a.reclamacoesSorted,(function(e){return t("div",{key:e.id,staticClass:"reclamacao-item"},[t("div",{staticClass:"reclamacao-header"},[t("div",{staticClass:"d-flex align-items-center"},[t("span",{staticClass:"badge",class:a.getStatusBadgeClass(e.status)},[a._v(a._s(e.status))]),t("span",{staticClass:"reclamante-nome"},[a._v(a._s(e.nome_reclamante))]),t("span",{staticClass:"reclamante-setor"},[a._v(a._s(e.unidade_setor))])]),t("span",{staticClass:"reclamacao-data"},[a._v(a._s(a.formatDate(e.data_reclamacao)))])]),t("div",{staticClass:"reclamacao-content"},[t("div",{staticClass:"problema-box"},[t("h6",{staticClass:"box-title"},[a._v("Problema Reportado:")]),t("p",{staticClass:"box-text"},[a._v(a._s(e.registro_reclamacao))])]),e.sugestoes?t("div",{staticClass:"sugestao-box"},[t("h6",{staticClass:"box-title"},[a._v("Sugestões de Melhoria:")]),t("p",{staticClass:"box-text"},[a._v(a._s(e.sugestoes))])]):a._e(),e.providencias_cpm?t("div",{staticClass:"providencias-box"},[t("h6",{staticClass:"box-title"},[a._v("Providências Tomadas:")]),t("p",{staticClass:"box-text"},[a._v(a._s(e.providencias_cpm))])]):a._e()])])})),0)]):a._e()]),a.documentos.length>0?t("div",{staticClass:"documentos"},[t("h4",[a._v("Documentos")]),t("ul",a._l(a.documentos,(function(e){return t("li",{key:e.id},[t("a",{attrs:{href:e.arquivo_url,target:"_blank"}},[a._v(a._s(e.nome))])])})),0)]):a._e()])])])]):a._e()])},xa=[function(){var a=this,t=a._self._c;return t("label",[t("strong",[a._v("Grupo:")])])}];const Pa={name:"CatalogoEletronico",data(){return{produtos:[],produtosFiltrados:[],categorias:[],searchTerm:"",filtroCategoria:"",categoriaAtual:"Todos os grupos",showCategoriaDropdown:!1,showAvaliacoes:!1,showReclamacoes:!1,produtoSelecionado:null,documentos:[],avaliacoes:[],avaliacaoMedia:0,carregandoCategorias:!0,categoriaSelecionada:null,currentTenantId:null,loading:!1,reclamacoes:(0,o.KR)([])}},created(){this.obterTenantId().then((()=>{this.carregarDados()})),document.addEventListener("click",this.closeDropdownOnClickOutside)},mounted(){this.carregarCategoriasDireto(),this.showCategoriaDropdown=!1},beforeUnmount(){document.removeEventListener("click",this.closeDropdownOnClickOutside)},methods:{async obterTenantId(){try{const{data:a}=await P.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return this.currentTenantId=t.user_metadata.tenant_id,void console.log("Tenant ID obtido dos metadados:",this.currentTenantId);const{data:e,error:o}=await P.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id?(this.currentTenantId=e.tenant_id,console.log("Tenant ID obtido da tabela usuarios:",this.currentTenantId)):console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarDados(){console.log("Iniciando carregamento de dados"),this.carregandoCategorias=!0,this.loading=!0;try{if(!this.currentTenantId&&(console.error("Tenant ID não disponível. Tentando recarregar..."),await this.obterTenantId(),!this.currentTenantId))return console.error("Não foi possível obter o tenant_id, impossível carregar dados"),void this.$swal({icon:"error",title:"Erro ao carregar dados",text:"Não foi possível identificar sua conta. Por favor, faça login novamente."});console.log("Buscando categorias do Supabase...");const{data:a,error:t}=await P.ND.from("categorias").select("*");t?console.error("Erro ao carregar categorias:",t):(this.categorias=a||[],console.log(`${this.categorias.length} categorias carregadas`)),console.log("Buscando produtos padronizados do Supabase...");let e=P.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).eq("status","aprovado");const{data:o,error:i}=await e;i?(console.error("Erro ao carregar produtos:",i),this.produtos=[]):(this.produtos=o||[],console.log(`${this.produtos.length} produtos padronizados carregados`)),this.filtrarProdutos()}catch(a){console.error("Erro no carregamento de dados:",a),this.$swal({icon:"error",title:"Erro ao carregar dados",text:"Ocorreu um erro ao carregar os dados. Tente novamente."})}finally{this.carregandoCategorias=!1,this.loading=!1}},async carregarCategoriasDireto(){try{console.log("Tentando carregar categorias diretamente...");const{data:a,error:t}=await P.ND.from("categorias").select("*");if(t)return void console.error("Erro ao carregar categorias direto:",t);console.log("Resposta direta de categorias:",a),a&&a.length>0&&0===this.categorias.length&&(console.log("Atualizando categorias com dados diretos"),this.categorias=a)}catch(a){console.error("Exceção ao carregar categorias direto:",a)}},filtrarProdutos(){console.log("Filtrando produtos por:",this.filtroCategoria,"e texto:",this.searchTerm),this.produtosFiltrados=this.produtos.filter((a=>{const t=!this.filtroCategoria||a.categoria_id===this.filtroCategoria,e=!this.searchTerm||a.nome.toLowerCase().includes(this.searchTerm.toLowerCase())||a.descricao&&a.descricao.toLowerCase().includes(this.searchTerm.toLowerCase());return t&&e})),console.log("Produtos filtrados:",this.produtosFiltrados.length)},async verDetalhesProduto(a){try{if(!this.currentTenantId)return void console.error("Não foi possível identificar o tenant_id");const{data:t,error:e}=await P.ND.from("produtos").select("*").eq("id",a).eq("tenant_id",this.currentTenantId).single();if(e)throw console.error("Erro ao carregar produto:",e),e;if(!t)return console.error("Produto não encontrado ou não pertence ao tenant atual"),void this.$swal({icon:"error",title:"Produto não encontrado",text:"O produto solicitado não existe ou você não tem permissão para visualizá-lo."});this.produtoSelecionado=t;const{data:o,error:i}=await P.ND.from("documentos").select("*").eq("produto_id",a).eq("tenant_id",this.currentTenantId);if(i)throw i;this.documentos=o||[];const[s,r,n]=await Promise.all([P.ND.from("rdm_avaliacoes").select("*").eq("produto_id",a),P.ND.from("material_feedbacks").select("*").eq("produto_id",a),P.ND.from("rdm_feedbacks").select("*").eq("rdm_id",a)]);s.error&&console.error("Erro ao carregar avaliações RDM:",s.error),r.error&&console.error("Erro ao carregar feedbacks:",r.error),n.error&&console.error("Erro ao carregar feedbacks RDM:",n.error);const l=s.data||[],c=r.data||[],d=n.data||[];if(this.avaliacoes=[...l.map((a=>({id:a.id,avaliacao:a.rating||0,comentario:a.comentario,data:a.criado_em,tipo:"RDM",avaliador:"Avaliação Técnica"}))),...c.map((a=>({id:a.id,avaliacao:a.rating||0,comentario:a.comentario,data:a.criado_em,tipo:"Feedback",avaliador:"Feedback de Usuário"}))),...d.map((a=>({id:a.id,avaliacao:a.rating||0,comentario:a.comentario,data:a.criado_em,tipo:"RDM",avaliador:"Avaliação do Órgão"})))],this.avaliacoes.sort(((a,t)=>new Date(t.data)-new Date(a.data))),this.avaliacoes.length>0){const a=this.avaliacoes.reduce(((a,t)=>a+t.avaliacao),0);this.avaliacaoMedia=parseFloat((a/this.avaliacoes.length).toFixed(1))}else this.avaliacaoMedia=0;await this.carregarReclamacoes()}catch(t){console.error("Erro ao carregar detalhes do produto:",t),this.$swal({icon:"error",title:"Erro ao carregar detalhes",text:"Não foi possível carregar os detalhes do produto. Tente novamente."})}},fecharModal(){this.produtoSelecionado=null,this.documentos=[],this.avaliacoes=[],this.avaliacaoMedia=0,this.showAvaliacoes=!1},closeDropdownOnClickOutside(a){const t=this.$el.querySelector(".dropdown");t&&!t.contains(a.target)&&(this.showCategoriaDropdown=!1)},selecionarCategoria(a){console.log("Categoria selecionada:",a),this.categoriaSelecionada=a,this.categoriaAtual=a?a.nome:"Todos os grupos",this.filtroCategoria=a?a.id:"",this.showCategoriaDropdown=!1,this.filtrarProdutos()},toggleCategoriaDropdown(){this.showCategoriaDropdown=!this.showCategoriaDropdown},toggleAvaliacoes(){this.showAvaliacoes=!this.showAvaliacoes},toggleReclamacoes(){this.showReclamacoes=!this.showReclamacoes},formatarData(a){if(!a)return"Data não disponível";try{const t=new Date(a);return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Erro ao formatar data:",t),"Data inválida"}},async carregarReclamacoes(){try{if(!this.produtoSelecionado?.codigo_material)return void console.log("Código do material não encontrado no produto");console.log("Buscando reclamações para o código de material:",this.produtoSelecionado.codigo_material);const{data:a,error:t}=await P.ND.from("reclamacoes_usuarios").select("*").eq("codigo_material",this.produtoSelecionado.codigo_material).order("data_reclamacao",{ascending:!1});if(t)throw console.error("Erro ao carregar reclamações:",t),t;console.log(`Reclamações encontradas: ${a?.length||0}`,a),this.reclamacoes=a||[]}catch(a){console.error("Erro ao carregar reclamações:",a),this.reclamacoes=[]}},formatDate(a){return a?new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""},getStatusBadgeClass(a){const t={ABERTA:"badge-warning",EM_ANALISE:"badge-info",RESOLVIDA:"badge-success",REJEITADA:"badge-danger"};return t[a]||"badge-secondary"},getTipoAvaliacao(a){return"RDM"===a.tipo?"RDM":"FEEDBACK"===a.tipo?"Feedback":"Avaliação"},getDocumentName(a){if(!a)return"";const t=a.split("/");return t[t.length-1]}},computed:{avaliacoesSorted(){return[...this.avaliacoes].sort(((a,t)=>{const e=new Date(a.data),o=new Date(t.data);return o-e}))},reclamacoesSorted(){return[...this.reclamacoes].sort(((a,t)=>new Date(t.data_reclamacao)-new Date(a.data_reclamacao)))},averageRating(){if(!this.avaliacoes.length)return 0;const a=this.avaliacoes.reduce(((a,t)=>a+(t.avaliacao||0)),0);return(a/this.avaliacoes.length).toFixed(1)}}},Sa=Pa;var Na=(0,g.A)(Sa,ya,xa,!1,null,"771300dd",null);const Ra=Na.exports,Ia={name:"Catalogo",components:{CatalogoEletronico:Ra},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},mounted(){this.carregarConfiguracoes(),document.addEventListener("click",this.fecharDropdownFora)},beforeUnmount(){document.removeEventListener("click",this.fecharDropdownFora)},methods:{async logout(){try{await P.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},fecharDropdownFora(a){this.$el.querySelector(".profile-dropdown").contains(a.target)||(this.dropdownOpen=!1)},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}},closeDropdown(){this.dropdownOpen=!1}}},Ma=Ia;var $a=(0,g.A)(Ma,Ea,Aa,!1,null,"5f8dc8aa",null);const Ta=$a.exports;var ka=function(){var a=this,t=a._self._c;return t("div",{staticClass:"feedback-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-btn",on:{click:a.toggleDropdown}},[t("div",{staticClass:"profile-avatar"},[a._v(" 👤 ")]),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("▼")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" ⚙️ Configuração ")]),t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" 📧 Configurar Email ")]),t("hr",{staticClass:"dropdown-divider"}),t("a",{staticClass:"dropdown-item logout",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.logout.apply(null,arguments)}}},[a._v(" 🚪 Sair ")])]):a._e()])])]),t("main",{staticClass:"main-content"},[t("FormularioRDM")],1),a.modalEmailAberto?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalEmail}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[a._m(1),t("button",{staticClass:"btn-close",on:{click:a.fecharModalEmail}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeOrganizacao"}},[a._v("Nome da Organização")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeOrganizacao,expression:"configEmail.nomeOrganizacao"}],attrs:{id:"nomeOrganizacao",type:"text",placeholder:"Ex: Prefeitura Municipal de..."},domProps:{value:a.configEmail.nomeOrganizacao},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeOrganizacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"emailRemetente"}},[a._v("Email Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.emailRemetente,expression:"configEmail.emailRemetente"}],attrs:{id:"emailRemetente",type:"email",placeholder:"Ex: licitacoes@prefeitura.gov.br"},domProps:{value:a.configEmail.emailRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"emailRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeRemetente"}},[a._v("Nome do Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeRemetente,expression:"configEmail.nomeRemetente"}],attrs:{id:"nomeRemetente",type:"text",placeholder:"Ex: CPM - Comissão de Padronização de Materiais"},domProps:{value:a.configEmail.nomeRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"assinatura"}},[a._v("Assinatura do Email")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.assinatura,expression:"configEmail.assinatura"}],attrs:{id:"assinatura",rows:"4",placeholder:"Ex: Atenciosamente,&#10;Comissão de Padronização de Materiais&#10;Prefeitura Municipal&#10;Telefone: (xx) xxxx-xxxx"},domProps:{value:a.configEmail.assinatura},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"assinatura",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:a.fecharModalEmail}},[a._v("Cancelar")]),t("button",{staticClass:"btn btn-primary",on:{click:a.salvarConfiguracaoEmail}},[t("i",{staticClass:"fas fa-save"}),a._v(" Salvar ")])])])]):a._e()])},Oa=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-envelope"}),a._v(" Configurar Email da Organização")])}],Ba=function(){var a=this,t=a._self._c;return t("div",{staticClass:"rdm-container"},[t("h2",[a._v("Relatório de Desempenho de Material (RDM)")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.enviarFeedback.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"produto"}},[a._v("Produto*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.feedback.rdm_id,expression:"feedback.rdm_id"}],attrs:{id:"produto",required:""},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.feedback,"rdm_id",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione o produto...")]),a._l(a.produtos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" - "+a._s(e.codigo||"Sem código")+" ")])}))],2)]),t("div",{staticClass:"form-group"},[t("label",[a._v("Avaliação*")]),t("div",{staticClass:"avaliacao"},a._l(5,(function(e){return t("div",{key:e,staticClass:"estrela",class:{ativa:a.feedback.rating>=e},on:{click:function(t){a.feedback.rating=e}}},[a._v(" ★ ")])})),0)]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"comentario"}},[a._v("Comentário")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.feedback.comentario,expression:"feedback.comentario"}],attrs:{id:"comentario",rows:"4",placeholder:"Ex: Equipamento apresentou falha após 3 meses de uso..."},domProps:{value:a.feedback.comentario},on:{input:function(t){t.target.composing||a.$set(a.feedback,"comentario",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.loading}},[a._v(" "+a._s(a.loading?"Salvando...":"Salvar")+" ")])])])])},Fa=[];const za={name:"FormularioRDM",data(){return{feedback:{rdm_id:"",rating:0,comentario:"",material_nome:"",material_codigo:""},produtos:[],loading:!1,currentUser:null,currentTenantId:null,error:null}},created(){this.carregarProdutos(),this.obterUsuarioAtual()},methods:{async obterUsuarioAtual(){try{const{data:{session:a},error:t}=await P.ND.auth.getSession();if(t)throw t;if(!a?.user)throw new Error("Usuário não está autenticado");{this.currentUser=a.user;const{data:t,error:e}=await P.ND.from("usuarios").select("tenant_id").eq("email",a.user.email).single();if(e&&"PGRST116"!==e.code)throw e;this.currentTenantId=t?.tenant_id||a.user.user_metadata?.tenant_id||(0,S.A)()}}catch(a){console.error("Erro ao obter dados do usuário:",a),this.$swal({icon:"error",title:"Erro de Autenticação",text:"Por favor, faça login novamente para enviar um feedback."})}},async carregarProdutos(){try{if(this.currentTenantId||await this.obterUsuarioAtual(),!this.currentTenantId)throw new Error("Não foi possível identificar o tenant_id");const{data:a,error:t}=await P.ND.from("produtos").select("*").eq("status","aprovado").eq("tenant_id",this.currentTenantId).order("nome");if(t)throw t;this.produtos=a||[]}catch(a){console.error("Erro ao carregar produtos:",a),this.$swal({icon:"error",title:"Erro ao carregar produtos",text:"Não foi possível carregar a lista de produtos. Por favor, recarregue a página."})}},async enviarFeedback(){if(0!==this.feedback.rating)if(this.feedback.rdm_id)try{if(this.loading=!0,this.error=null,!this.currentUser?.email)throw new Error("Usuário não está autenticado");const{data:a,error:t}=await P.ND.from("usuarios").select("id, tenant_id").eq("email",this.currentUser.email).single();if(t&&"PGRST116"!==t.code)throw t;const e=this.produtos.find((a=>a.id===this.feedback.rdm_id));if(!e)throw new Error("Produto não encontrado");const o={id:(0,S.A)(),tenant_id:this.currentTenantId,rdm_id:this.feedback.rdm_id,usuario_rdm_id:a.id,rating:this.feedback.rating,comentario:this.feedback.comentario||null,material_nome:e.nome,material_codigo:e.codigo||"N/A",criado_em:(new Date).toISOString()},{error:i}=await P.ND.from("rdm_feedbacks").insert(o);if(i)throw i;this.$swal({icon:"success",title:"Feedback enviado!",text:"Seu feedback foi enviado com sucesso."}),this.limparFormulario()}catch(a){console.error("Erro ao enviar feedback:",a);let t="Por favor, tente novamente.";"Usuário não está autenticado"===a.message?t="Por favor, faça login para enviar um feedback.":"23505"===a.code&&(t="Você já enviou um feedback para este produto."),this.$swal({icon:"error",title:"Erro ao enviar feedback",text:t}),this.error=a}finally{this.loading=!1}else this.$swal({icon:"warning",title:"Produto necessário",text:"Por favor, selecione um produto para avaliar."});else this.$swal({icon:"warning",title:"Avaliação necessária",text:"Por favor, selecione uma avaliação de 1 a 5 estrelas."})},limparFormulario(){this.feedback={rdm_id:"",rating:0,comentario:"",material_nome:"",material_codigo:""},this.error=null}}},qa=za;var La=(0,g.A)(qa,Ba,Fa,!1,null,"2811c5e7",null);const Ua=La.exports,Va={name:"Feedback",components:{FormularioRDM:Ua},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},mounted(){this.carregarConfiguracoes()},methods:{async logout(){try{await P.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}}}},ja=Va;var Ja=(0,g.A)(ja,ka,Oa,!1,null,"098da73d",null);const Ha=Ja.exports;var Ga=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dcb-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-btn",on:{click:a.toggleDropdown}},[t("div",{staticClass:"profile-avatar"},[a._v(" 👤 ")]),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("▼")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" ⚙️ Configuração ")]),t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" 📧 Configurar Email ")]),t("hr",{staticClass:"dropdown-divider"}),t("a",{staticClass:"dropdown-item logout",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.logout.apply(null,arguments)}}},[a._v(" 🚪 Sair ")])]):a._e()])])]),t("main",{staticClass:"main-content"},[t("FormularioDCB")],1)])},Ka=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])}],Ya=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dcb-container"},[t("h2",[a._v("Declaração de Conformidade de Bem (DCB)")]),t("div",{staticClass:"search-container"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"produto"}},[a._v("Selecione o produto")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produtoSelecionado,expression:"produtoSelecionado"}],attrs:{id:"produto"},on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.produtoSelecionado=t.target.multiple?e:e[0]},a.carregarDetalhes]}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.produtos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" - "+a._s(e.marca)+" - "+a._s(e.modelo)+" ")])}))],2)])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando informações...")])]):a.produtoDetalhes?t("div",{staticClass:"produto-detalhes"},[t("div",{staticClass:"dcb-section"},[t("h3",[a._v("PRODUTO CERTIFICADO")]),t("div",{staticClass:"primeiro-quadro"},[a._m(0),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item full-width"},[t("strong",[a._v("1.1. Nome do Produto:")]),a._v(" "+a._s(a.produtoDetalhes.nome||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoDetalhes.marca||"Não informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoDetalhes.modelo||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoDetalhes.fabricante||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CNPJ do Fabricante:")]),a._v(" "+a._s(a.produtoDetalhes.cnpj||"Não informado")+" ")])])])]),t("div",{staticClass:"dcb-section"},[t("h3",[a._v("DADOS DA CERTIFICAÇÃO")]),t("div",{staticClass:"primeiro-quadro"},[a._m(1),t("div",{staticClass:"status-info"},[a._m(2),t("div",{staticClass:"info-item",staticStyle:{"margin-left":"40px"}},[t("strong",[a._v("Status:")]),t("span",{staticClass:"status-badge",class:a.getStatusDCBClass()},[a._v(" "+a._s(a.getStatusDCB())+" ")])]),t("div",{staticClass:"info-item",staticStyle:{"margin-left":"40px"}},[t("strong",[a._v("1.1.1. Origem:")]),a._v(" Edital de Pré-Qualificação de Bens nº "+a._s(a.produtoDetalhes.numero_edital||"XXX/YYYY")+" ")])]),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item"},[t("strong",[a._v("Data de Emissão:")]),a._v(" "+a._s(a.formatarData(a.produtoDetalhes.data_emissao))+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Data de Validade:")]),a._v(" "+a._s(a.formatarData(a.produtoDetalhes.data_validade))+" ")])])])]),a.documentos.length>0?t("div",{staticClass:"documentos"},[t("h3",[a._v("Documentos Anexos")]),t("ul",{staticClass:"documentos-lista"},a._l(a.documentos,(function(e){return t("li",{key:e.id,staticClass:"documento-item"},[t("span",{staticClass:"doc-icon"},[a._v("📄")]),t("span",{staticClass:"doc-nome"},[a._v(a._s(e.nome))]),t("a",{staticClass:"btn-download",attrs:{href:e.arquivo_url,target:"_blank"}},[a._v("Visualizar")])])})),0)]):a._e(),t("div",{staticClass:"dcb-actions"},[t("div",{staticClass:"button-group"},[t("button",{staticClass:"btn-primary",attrs:{disabled:!a.produtoAprovado},on:{click:a.visualizarDCB}},[a._v(" 👁️ Visualizar DCB ")]),t("button",{staticClass:"btn-secondary",attrs:{disabled:!a.produtoAprovado},on:{click:a.baixarDCB}},[a._v(" 📥 Baixar DCB (PDF) ")])]),a.produtoAprovado?a._e():t("p",{staticClass:"aviso"},[a._v(" ⚠️ Somente produtos aprovados possuem Declaração de Conformidade disponível. ")])])]):a._e()])},Qa=[function(){var a=this,t=a._self._c;return t("p",[t("strong",[a._v("1. Primeiro quadro")])])},function(){var a=this,t=a._self._c;return t("p",[t("strong",[a._v("1. Primeiro quadro")])])},function(){var a=this,t=a._self._c;return t("p",{staticStyle:{"margin-left":"20px"}},[t("strong",[a._v("1.1.")]),a._v(' Incluir abaixo de "Status":')])}],Xa=e(1749);const Za={name:"FormularioDCB",data(){return{produtoSelecionado:"",produtoDetalhes:null,documentos:[],produtos:[],loading:!1,currentTenantId:null}},computed:{produtoAprovado(){return this.produtoDetalhes&&"aprovado"===this.produtoDetalhes.status}},created(){this.obterTenantId().then((()=>{this.carregarProdutos()}))},methods:{async obterTenantId(){try{const{data:a}=await P.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return void(this.currentTenantId=t.user_metadata.tenant_id);const{data:e,error:o}=await P.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id&&(this.currentTenantId=e.tenant_id)}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarProdutos(){try{if(!this.currentTenantId)return void console.error("Tenant ID não disponível");const{data:a,error:t}=await P.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).eq("status","aprovado").order("nome");if(t)throw t;this.produtos=a||[]}catch(a){console.error("Erro ao carregar produtos:",a),this.$swal({icon:"error",title:"Erro",text:"Não foi possível carregar os produtos."})}},async carregarDetalhes(){if(!this.produtoSelecionado)return this.produtoDetalhes=null,void(this.documentos=[]);try{this.loading=!0;const{data:a,error:t}=await P.ND.from("produtos").select("*").eq("id",this.produtoSelecionado).single();if(t)throw t;if(console.log("Produto carregado:",a),a.data_emissao||(a.data_emissao=(new Date).toISOString().split("T")[0]),!a.data_validade){const t=new Date;t.setFullYear(t.getFullYear()+1),a.data_validade=t.toISOString().split("T")[0]}a.numero_edital||(a.numero_edital=`001/${(new Date).getFullYear()}`),this.produtoDetalhes=a,console.log("Detalhes do produto definidos:",this.produtoDetalhes);const{data:e,error:o}=await P.ND.from("documentos").select("*").eq("produto_id",this.produtoSelecionado);if(o)throw o;this.documentos=e||[]}catch(a){console.error("Erro ao carregar detalhes do produto:",a),this.$swal({icon:"error",title:"Erro",text:"Não foi possível carregar os detalhes do produto."})}finally{this.loading=!1}},getStatusDCB(){if(!this.produtoDetalhes||!this.produtoDetalhes.data_validade)return"VENCIDA";const a=new Date,t=new Date(this.produtoDetalhes.data_validade);return t>a?"EM VIGOR":"VENCIDA"},getStatusDCBClass(){const a=this.getStatusDCB();return{"status-em-vigor":"EM VIGOR"===a,"status-vencida":"VENCIDA"===a}},formatarData(a){if(!a)return"Não informada";try{const t=new Date(a);return t.toLocaleDateString("pt-BR")}catch(t){return"Data inválida"}},visualizarDCB(){if(!this.produtoDetalhes||!this.produtoAprovado)return void this.$swal({icon:"error",title:"Não disponível",text:"Apenas produtos aprovados possuem Declaração de Conformidade disponível."});const a=this.criarConteudoDCB();this.$swal({title:"Declaração de Conformidade de Bem",html:a,width:"800px",showConfirmButton:!0,confirmButtonText:"Fechar",showCancelButton:!0,cancelButtonText:"📥 Baixar PDF",cancelButtonColor:"#3498db"}).then((a=>{a.isDismissed&&"cancel"===a.dismiss&&this.baixarDCB()}))},baixarDCB(){if(this.produtoDetalhes&&this.produtoAprovado)try{const a=new Xa.jsPDF("p","mm","a4"),t=this.produtoDetalhes,e=(new Date).getFullYear();a.setFont("helvetica"),a.setFontSize(9),a.text("(Logo do órgão ou entidade)",20,15),a.text("(Nome do órgão ou entidade)",130,15),a.text("Comissão de Padronização de Materiais - CPM",115,22),a.setFontSize(14),a.setFont("helvetica","bold");const o="DECLARAÇÃO DE CONFORMIDADE DE BEM",i=a.getTextWidth(o);a.text(o,(210-i)/2,35),a.setFontSize(12);const s=`DCB Nº ${t.id}/${e}`,r=a.getTextWidth(s);a.text(s,(210-r)/2,42),a.line(20,47,190,47);let n=55;a.setFontSize(11),a.setFont("helvetica","bold"),a.text("PRODUTO CERTIFICADO",20,n),n+=6,a.setFont("helvetica","normal"),a.setFontSize(9),a.text("1. Primeiro quadro",20,n),n+=5,a.text(`1.1. Nome: ${t.nome||"Não informado"}`,25,n),n+=4,a.text(`Marca: ${t.marca||"Não informada"}`,25,n),n+=4,a.text(`Modelo: ${t.modelo||"Não informado"}`,25,n),n+=4,a.text(`Fabricante: ${t.fabricante||"Não informado"}`,25,n),n+=4,a.text(`CNPJ do Fabricante: ${t.cnpj||"Não informado"}`,25,n),n+=10,a.setFont("helvetica","bold"),a.setFontSize(11),a.text("DADOS DA CERTIFICAÇÃO",20,n),n+=6,a.setFont("helvetica","normal"),a.setFontSize(9),a.text("1. Primeiro quadro",20,n),n+=5,a.text('1.1. Incluir abaixo de "Status":',25,n),n+=4,a.text(`Status: ${this.getStatusDCB()}`,30,n),n+=4,a.text(`1.1.1. Origem: Edital de Pré-Qualificação de Bens nº ${t.numero_edital||"XXX/YYYY"}`,30,n),n+=10,a.setFont("helvetica","bold"),a.setFontSize(11),a.text("DECLARAÇÃO",20,n),n+=6,a.setFont("helvetica","normal"),a.setFontSize(8);const l=["A Comissão de Padronização de Materiais – CPM do(a) _______ (nome do órgão/entidade)","_______, constituída por meio do(a) __________ [informar o tipo de instrumento","(resolução/portaria), número e ano de expedição], DECLARA que:","","1º) o produto especificado nesta DCB foi submetido à demonstração funcional e análise","técnica, devidamente monitoradas e documentadas por esta CPM em processo administrativo","próprio, com estrita observância às formalidades legais e regulamentares, tendo sido","considerado apto e, portanto, APROVADO para o uso e a finalidade a que se destina, uma","vez que atendeu aos requisitos técnicos exigidos pelo Edital de Pré-Qualificação de Bens","em referência, sendo a sua marca comercial e modelo lançados no Catálogo Eletrônico de","Bens Padronizados deste(a) órgão/entidade, para fins de aquisições futuras e eventuais,","conforme previsto na Lei Federal nº 14.133/2021 (Lei de Licitações e Contratos);","","2º) expirada a sua vigência, esta DCB somente poderá ser renovada mediante a realização","de nova demonstração do produto nela especificado, para fins de reanálise técnica e","funcional monitoradas e documentadas pela CPM."];l.forEach((t=>{a.text(t,20,n),n+=""===t?2:4})),n+=8,a.text("Local e data ___________",20,n),n+=12,a.text("(assinatura digital)",20,n),n+=5,a.setFont("helvetica","bold"),a.text("Comissão de Padronização de Materiais",20,n),n+=4,a.text("Presidente da CPM",20,n);const c=`DCB_${t.nome}_${t.id}_${e}.pdf`;a.save(c),this.$swal({icon:"success",title:"PDF Gerado!",text:`DCB baixada como: ${c}`,timer:3e3,showConfirmButton:!1})}catch(a){console.error("Erro ao gerar PDF:",a),this.$swal({icon:"error",title:"Erro ao gerar PDF",text:"Ocorreu um erro ao gerar o arquivo PDF."})}else this.$swal({icon:"error",title:"Não disponível",text:"Apenas produtos aprovados possuem Declaração de Conformidade disponível."})},criarConteudoDCB(){const a=this.produtoDetalhes,t=((new Date).toLocaleDateString("pt-BR"),(new Date).getFullYear());return`\n        <div style="text-align: left; font-family: Arial, sans-serif; line-height: 1.6; padding: 20px;">\n          <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #2c3e50; padding-bottom: 20px;">\n            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">\n              <div style="text-align: left;">\n                <strong>(Logo do órgão<br>ou entidade)</strong>\n              </div>\n              <div style="text-align: right;">\n                <strong>(Nome do órgão ou entidade)<br>\n                Comissão de Padronização de Materiais - CPM</strong>\n              </div>\n            </div>\n            <h2 style="margin: 20px 0 10px 0; font-size: 18px; font-weight: bold;">DECLARAÇÃO DE CONFORMIDADE DE BEM</h2>\n            <h3 style="margin: 5px 0; font-size: 16px;">DCB Nº ${a.id}/${t}</h3>\n          </div>\n          \n          <div style="margin-bottom: 25px;">\n            <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 16px; font-weight: bold;">PRODUTO CERTIFICADO</h4>\n            <p style="margin: 8px 0;"><strong>1. Primeiro quadro</strong></p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>1.1. Nome:</strong> ${a.nome||"Não informado"}</p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>Marca:</strong> ${a.marca||"Não informada"}</p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>Modelo:</strong> ${a.modelo||"Não informado"}</p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>Fabricante:</strong> ${a.fabricante||"Não informado"}</p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>CNPJ do Fabricante:</strong> ${a.cnpj||"Não informado"}</p>\n          </div>\n          \n          <div style="margin-bottom: 25px;">\n            <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 16px; font-weight: bold;">DADOS DA CERTIFICAÇÃO</h4>\n            <p style="margin: 8px 0;"><strong>1. Primeiro quadro</strong></p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>1.1.</strong> Incluir abaixo de "Status":</p>\n            <p style="margin: 8px 0; margin-left: 40px;"><strong>Status:</strong> ${this.getStatusDCB()}</p>\n            <p style="margin: 8px 0; margin-left: 40px;"><strong>1.1.1. Origem:</strong> Edital de Pré-Qualificação de Bens nº ${a.numero_edital||"XXX/YYYY"}</p>\n          </div>\n          \n          <div style="margin-bottom: 25px;">\n            <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 16px; font-weight: bold;">DECLARAÇÃO</h4>\n            <p style="margin: 10px 0; text-align: justify;">\n              A Comissão de Padronização de Materiais – CPM do(a) <strong>_______ (nome do órgão/entidade) _______</strong>, constituída por meio do(a) <strong>__________ [informar o tipo de instrumento (resolução/portaria), número e ano de expedição]</strong>, <strong>DECLARA</strong> que:\n            </p>\n            \n            <p style="margin: 15px 0; text-align: justify;">\n              <strong>1º)</strong> o produto especificado nesta DCB foi submetido à demonstração funcional e análise técnica, devidamente monitoradas e documentadas por esta CPM em processo administrativo próprio, com estrita observância às formalidades legais e regulamentares, tendo sido considerado apto e, portanto, <strong>APROVADO</strong> para o uso e a finalidade a que se destina, uma vez que atendeu aos requisitos técnicos exigidos pelo Edital de Pré-Qualificação de Bens em referência, sendo a sua marca comercial e modelo lançados no <strong>Catálogo Eletrônico de Bens Padronizados</strong> deste(a) órgão/entidade, para fins de aquisições futuras e eventuais, conforme previsto na Lei Federal nº 14.133/2021 (Lei de Licitações e Contratos);\n            </p>\n            \n            <p style="margin: 15px 0; text-align: justify;">\n              <strong>2º)</strong> expirada a sua vigência, esta DCB somente poderá ser renovada mediante a realização de nova demonstração do produto nela especificado, para fins de reanálise técnica e funcional monitoradas e documentadas pela CPM.\n            </p>\n          </div>\n          \n          <div style="margin-top: 50px; text-align: center;">\n            <p style="margin: 20px 0;">Local e data ___________</p>\n            <br><br>\n            <p style="margin: 10px 0;">(assinatura digital)</p>\n            <p style="margin: 5px 0; font-weight: bold;">Comissão de Padronização de Materiais</p>\n            <p style="margin: 5px 0; font-weight: bold;">Presidente da CPM</p>\n          </div>\n        </div>\n      `}}},Wa=Za;var at=(0,g.A)(Wa,Ya,Qa,!1,null,"95e4a772",null);const tt=at.exports,et={name:"DCB",components:{FormularioDCB:tt},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},mounted(){this.carregarConfiguracoes(),document.addEventListener("click",this.fecharDropdownFora)},beforeUnmount(){document.removeEventListener("click",this.fecharDropdownFora)},methods:{async logout(){try{await P.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},fecharDropdownFora(a){this.$el.querySelector(".profile-dropdown").contains(a.target)||(this.dropdownOpen=!1)},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}}}},ot=et;var it=(0,g.A)(ot,Ga,Ka,!1,null,"bb85b182",null);const st=it.exports;var rt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"ccl-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("▼")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("DashboardCCL")],1)])},nt=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])}],lt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard"},[t("h2",[a._v("Painel Comissão de Contratação ou Licitação")]),t("div",{staticClass:"tabs"},[t("div",{staticClass:"tab",class:{active:"dashboard"===a.activeTab},on:{click:function(t){a.activeTab="dashboard"}}},[a._v(" Dashboard ")]),t("div",{staticClass:"tab",class:{active:"atas"===a.activeTab},on:{click:function(t){a.activeTab="atas"}}},[a._v(" Atas de Julgamento ")]),t("div",{staticClass:"tab",class:{active:"homologacoes"===a.activeTab},on:{click:function(t){a.activeTab="homologacoes"}}},[a._v(" Homologações ")])]),"dashboard"===a.activeTab?t("div",[t("div",{staticClass:"stats-container"},[t("div",{staticClass:"stat-card status-pendente-card"},[t("h3",[a._v("Processos em Julgamento")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.pendentes))])]),t("div",{staticClass:"stat-card status-aprovado-card"},[t("h3",[a._v("Homologações")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.aprovados))])]),t("div",{staticClass:"stat-card status-diligencia-card"},[t("h3",[a._v("Processos com Diligências")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.diligencias))])])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Processos Pendentes de Julgamento")]),a.produtosPendentes.length>0?t("table",[a._m(0),t("tbody",a._l(a.produtosPendentes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.marca))]),t("td",[a._v(a._s(a.getCategoriaName(e.categoria_id)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(e.status)},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")])]),t("td",[a._v(a._s(a.formatDate(e.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.publicarDecisao(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("Não há processos pendentes de julgamento.")])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Atas de Julgamento")]),a.atasRecentes.length>0?t("table",[a._m(1),t("tbody",a._l(a.atasRecentes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.numero))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(e.decisao)},[a._v(" "+a._s(a.formatarStatus(e.decisao))+" ")])]),t("td",[a._v(a._s(a.formatDate(e.data_publicacao)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.visualizarAta(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("Não há atas de julgamento.")])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Recursos Apresentados")]),a.recursos.length>0?t("table",[a._m(2),t("tbody",a._l(a.recursos,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.recorrente))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[a._v(a._s(a.formatDate(e.data_recurso)))]),t("td",[a._v(a._s(a.formatDate(e.prazo_final)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getRecursoStatusClass(e.status)},[a._v(" "+a._s(e.status)+" ")])]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.julgarRecurso(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("Não há recursos apresentados.")])])]):a._e(),"atas"===a.activeTab?t("div",{staticClass:"atas-julgamento"},[a._m(3)]):a._e(),"homologacoes"===a.activeTab?t("div",{staticClass:"homologacoes"},[a._m(4)]):a._e()])},ct=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Categoria")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Documentação")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Número da Ata")]),t("th",[a._v("Produto")]),t("th",[a._v("Decisão")]),t("th",[a._v("Data de Publicação")]),t("th",[a._v("Documentação")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Recorrente")]),t("th",[a._v("Produto")]),t("th",[a._v("Data do Recurso")]),t("th",[a._v("Prazo Final")]),t("th",[a._v("Status")]),t("th",[a._v("Documentação")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Atas de Julgamento")]),t("p",[a._v("Este módulo permitirá o gerenciamento completo das atas de julgamento emitidas pela Comissão de Contratação ou Licitação.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Cadastro e edição de atas de julgamento")]),t("li",[a._v("Publicação automática no Diário Oficial")]),t("li",[a._v("Comunicação com fornecedores interessados")]),t("li",[a._v("Histórico de alterações e versões")]),t("li",[a._v("Geração de relatórios consolidados")]),t("li",[a._v("Integração com sistema de processo eletrônico")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Homologações")]),t("p",[a._v("Este módulo permitirá o acesso a todos os arquivos em PDF de atos de homologação assinados digitalmente pela autoridade competente do órgão ou entidade.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Acesso aos documentos de homologação de padronizações de marcas e modelos")]),t("li",[a._v("Acesso aos documentos de despadronizações")]),t("li",[a._v("Registro de decisões da autoridade competente")]),t("li",[a._v("Notificação automática de homologações e indeferimentos")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])}];const dt={name:"DashboardCCL",data(){return{activeTab:"dashboard",produtosPendentes:[],atasRecentes:[],pendentes:0,aprovados:0,diligencias:0,categorias:[],currentTenantId:null,loading:!1,recursos:[]}},created(){this.obterTenantId().then((()=>{this.carregarDados(),this.carregarCategorias()}))},methods:{async obterTenantId(){try{const{data:a}=await P.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return void(this.currentTenantId=t.user_metadata.tenant_id);const{data:e,error:o}=await P.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id?this.currentTenantId=e.tenant_id:console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarCategorias(){try{const{data:a,error:t}=await P.ND.from("categorias").select("*");if(t)throw t;this.categorias=a||[]}catch(a){console.error("Erro ao carregar categorias:",a)}},getCategoriaName(a){const t=this.categorias.find((t=>t.id===a));return t?t.nome:"Categoria não encontrada"},async carregarDados(){try{if(this.loading=!0,!this.currentTenantId)return void console.error("Tenant ID não disponível");const{data:a,error:t}=await P.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).in("status",["aprovado","reprovado"]).order("criado_em",{ascending:!1}).limit(10);if(t)throw t;this.produtosPendentes=a||[],this.atasRecentes=[{id:"1",numero:"ATA-001/2023",produto_nome:"Monitor de Sinais Vitais",decisao:"aprovado",data_publicacao:"2023-05-15"},{id:"2",numero:"ATA-002/2023",produto_nome:"Desfibrilador",decisao:"diligencia",data_publicacao:"2023-05-20"},{id:"3",numero:"ATA-003/2023",produto_nome:"Autoclave Hospitalar",decisao:"aprovado",data_publicacao:"2023-06-01"}],this.recursos=[{id:"1",recorrente:"Hospital Médico LTDA",produto_nome:"Desfibrilador",data_recurso:"2023-05-22",status:"EM ANÁLISE",prazo_final:"2023-06-06"},{id:"2",recorrente:"Equipamentos Hospitalares S.A.",produto_nome:"Bomba de Infusão",data_recurso:"2023-06-05",status:"DEFERIDO",prazo_final:"2023-06-20"},{id:"3",recorrente:"Medical Suprimentos Médicos",produto_nome:"Ventilador Pulmonar",data_recurso:"2023-06-10",status:"INDEFERIDO",prazo_final:"2023-06-25"}];const e=await Promise.all([this.contarPorStatus("pendente"),this.contarPorStatus("aprovado"),this.contarPorStatus("diligencia")]);this.pendentes=e[0],this.aprovados=e[1],this.diligencias=e[2];const o=this.atasRecentes.filter((a=>"diligencia"===a.decisao)).length;o>0&&(this.diligencias=o);const i=this.atasRecentes.filter((a=>"aprovado"===a.decisao)).length;i>0&&0===this.aprovados&&(this.aprovados=i)}catch(a){console.error("Erro ao carregar dados:",a)}finally{this.loading=!1}},async contarPorStatus(a){if(!this.currentTenantId)return 0;const{count:t,error:e}=await P.ND.from("produtos").select("id",{count:"exact"}).eq("status",a).eq("tenant_id",this.currentTenantId);return e?(console.error(`Erro ao contar produtos ${a}:`,e),0):t||0},formatDate(a){if(!a)return"";if(a.includes("T")){const t=new Date(a);return t.toLocaleDateString("pt-BR")}const t=a.split("-");return 3===t.length?`${t[2]}/${t[1]}/${t[0]}`:a},formatarStatus(a){switch(a){case"pendente":return"Em avaliação";case"aprovado":return"Em Diligência";case"reprovado":return"Em Análise";case"diligencia":return"Em diligência";default:return a}},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";case"diligencia":return"status-diligencia";default:return""}},publicarDecisao(a){this.$swal({title:"Ação Simulada",text:"Em uma implementação completa, abriria um formulário para registrar a decisão da comissão e publicar no Diário Oficial.",icon:"info"})},visualizarAta(a){this.$swal({title:"Ação Simulada",text:"Em uma implementação completa, exibiria o documento da ata de julgamento e permitiria fazer download.",icon:"info"})},getRecursoStatusClass(a){switch(a){case"EM ANÁLISE":return"status-pendente";case"DEFERIDO":return"status-aprovado";case"INDEFERIDO":return"status-reprovado";default:return""}},julgarRecurso(a){this.$swal({title:"Ação Simulada",text:"Em uma implementação completa, abriria um formulário para julgar o recurso e permitiria acesso ao documento PDF assinado digitalmente.",icon:"info"})}}},ut=dt;var mt=(0,g.A)(ut,lt,ct,!1,null,"307ff78f",null);const pt=mt.exports,vt={name:"CCL",components:{DashboardCCL:pt},data(){return{dropdownOpen:!1,modalEmailAberto:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",configEmail:{nomeOrganizacao:"",emailRemetente:"",nomeRemetente:"",assinatura:""},showDropdown:!1,usuarioNome:"comprarBemTeste",usuarioEmail:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},async created(){await this.carregarDadosUsuario(),this.carregarConfiguracoes()},mounted(){},beforeUnmount(){},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await P.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usuário:",a)}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},abrirConfiguracoesEmail(){this.closeDropdown(),this.mostrarConfigEmail()},async logout(){try{await P.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()},abrirConfiguracoes(){this.closeDropdown(),this.mostrarConfigEmail()},async mostrarConfigEmail(){const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},closeDropdown(){this.showDropdown=!1}}},gt=vt;var _t=(0,g.A)(gt,rt,nt,!1,null,"3bed4c5e",null);const ht=_t.exports;var ft=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classificacao-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.dropdownOpen},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("▼")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.nomeUsuario))]),t("small",[a._v(a._s(a.emailUsuario))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.dropdownOpen?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("Classificacao")],1),a.modalEmailAberto?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalEmail}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[a._m(2),t("button",{staticClass:"btn-close",on:{click:a.fecharModalEmail}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeOrganizacao"}},[a._v("Nome da Organização")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeOrganizacao,expression:"configEmail.nomeOrganizacao"}],attrs:{id:"nomeOrganizacao",type:"text",placeholder:"Ex: Prefeitura Municipal de..."},domProps:{value:a.configEmail.nomeOrganizacao},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeOrganizacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"emailRemetente"}},[a._v("Email Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.emailRemetente,expression:"configEmail.emailRemetente"}],attrs:{id:"emailRemetente",type:"email",placeholder:"Ex: licitacoes@prefeitura.gov.br"},domProps:{value:a.configEmail.emailRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"emailRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeRemetente"}},[a._v("Nome do Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeRemetente,expression:"configEmail.nomeRemetente"}],attrs:{id:"nomeRemetente",type:"text",placeholder:"Ex: CPM - Comissão de Padronização de Materiais"},domProps:{value:a.configEmail.nomeRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"assinatura"}},[a._v("Assinatura do Email")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.assinatura,expression:"configEmail.assinatura"}],attrs:{id:"assinatura",rows:"4",placeholder:"Ex: Atenciosamente,&#10;Comissão de Padronização de Materiais&#10;Prefeitura Municipal&#10;Telefone: (xx) xxxx-xxxx"},domProps:{value:a.configEmail.assinatura},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"assinatura",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:a.fecharModalEmail}},[a._v("Cancelar")]),t("button",{staticClass:"btn btn-primary",on:{click:a.salvarConfiguracaoEmail}},[t("i",{staticClass:"fas fa-save"}),a._v(" Salvar ")])])])]):a._e()])},Ct=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])},function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-envelope"}),a._v(" Configurar Email da Organização")])}],bt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classificacao-container"},[t("h2",[a._v("Classificação de Produtos")]),t("div",{staticClass:"tabs"},[t("button",{class:["tab-button",{active:"grupos"===a.activeTab}],on:{click:function(t){a.activeTab="grupos"}}},[a._v(" Grupos ")]),t("button",{class:["tab-button",{active:"classes"===a.activeTab}],on:{click:function(t){a.activeTab="classes"}}},[a._v(" Classes ")])]),t("div",{staticClass:"tab-content"},["grupos"===a.activeTab?t("GruposList"):a._e(),"classes"===a.activeTab?t("ClassesList"):a._e()],1)])},Dt=[],wt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"grupos-list"},[t("div",{staticClass:"header"},[t("h3",[a._v("Gerenciamento de Grupos")]),t("button",{staticClass:"btn-add",on:{click:function(t){a.mostrarFormulario=!0}}},[a._v(" Adicionar Grupo ")])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando grupos...")])]):0===a.grupos.length?t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhum grupo cadastrado.")])]):t("div",{staticClass:"grupos-table"},[t("table",[a._m(0),t("tbody",a._l(a.grupos,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.descricao||"-"))]),t("td",[a._v(a._s(a.formatarData(e.created_at)))]),t("td",{staticClass:"actions"},[t("button",{staticClass:"btn-edit",on:{click:function(t){return a.editarGrupo(e)}}},[a._v("Editar")]),t("button",{staticClass:"btn-delete",on:{click:function(t){return a.confirmarExclusao(e)}}},[a._v("Excluir")])])])})),0)])]),a.mostrarFormulario?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.modoEdicao?"Editar":"Adicionar")+" Grupo")]),t("button",{staticClass:"btn-close",on:{click:a.fecharFormulario}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarGrupo.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome do Grupo*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.grupoAtual.nome,expression:"grupoAtual.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.grupoAtual.nome},on:{input:function(t){t.target.composing||a.$set(a.grupoAtual,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descrição")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.grupoAtual.descricao,expression:"grupoAtual.descricao"}],attrs:{id:"descricao",rows:"3"},domProps:{value:a.grupoAtual.descricao},on:{input:function(t){t.target.composing||a.$set(a.grupoAtual,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharFormulario}},[a._v("Cancelar")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.salvando}},[a._v(" "+a._s(a.salvando?"Salvando...":"Salvar")+" ")])])])])])]):a._e()])},Et=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Descrição")]),t("th",[a._v("Data de Criação")]),t("th",[a._v("Ações")])])])}];const At={name:"GruposList",setup(){const a=(0,o.KR)([]),t=(0,o.KR)(!0),e=(0,o.KR)(!1),i=(0,o.KR)(!1),s=(0,o.KR)(!1),r=(0,o.Kh)({id:null,nome:"",descricao:""});(0,o.sV)((async()=>{await n()}));const n=async()=>{try{t.value=!0;const{data:e,error:o}=await P.ND.from("grupos").select("*").order("nome");if(o)throw o;a.value=e||[]}catch(e){console.error("Erro ao carregar grupos:",e),alert("Erro ao carregar grupos. Por favor, tente novamente.")}finally{t.value=!1}},l=a=>{if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")},c=a=>{s.value=!0,r.id=a.id,r.nome=a.nome,r.descricao=a.descricao||"",i.value=!0},d=()=>{i.value=!1,s.value=!1,r.id=null,r.nome="",r.descricao=""},u=async()=>{try{if(e.value=!0,s.value){const{error:a}=await P.ND.from("grupos").update({nome:r.nome,descricao:r.descricao}).eq("id",r.id);if(a)throw a;alert("Grupo atualizado com sucesso!")}else{const{error:a}=await P.ND.from("grupos").insert({nome:r.nome,descricao:r.descricao});if(a)throw a;alert("Grupo adicionado com sucesso!")}await n(),d()}catch(a){console.error("Erro ao salvar grupo:",a),alert(`Erro ao ${s.value?"atualizar":"adicionar"} grupo: ${a.message}`)}finally{e.value=!1}},m=a=>{confirm(`Deseja realmente excluir o grupo "${a.nome}"?`)&&p(a.id)},p=async a=>{try{t.value=!0;const{data:e,error:o}=await P.ND.from("classes").select("id").eq("grupo_id",a);if(o)throw o;if(e&&e.length>0)return void alert(`Não é possível excluir este grupo porque existem ${e.length} classes associadas a ele.`);const{data:i,error:s}=await P.ND.from("produtos").select("id").eq("grupo_id",a);if(s)throw s;if(i&&i.length>0)return void alert(`Não é possível excluir este grupo porque existem ${i.length} produtos associados a ele.`);const{error:r}=await P.ND.from("grupos").delete().eq("id",a);if(r)throw r;alert("Grupo excluído com sucesso!"),await n()}catch(e){console.error("Erro ao excluir grupo:",e),alert(`Erro ao excluir grupo: ${e.message}`)}finally{t.value=!1}};return{grupos:a,loading:t,salvando:e,mostrarFormulario:i,modoEdicao:s,grupoAtual:r,carregarGrupos:n,formatarData:l,editarGrupo:c,fecharFormulario:d,salvarGrupo:u,confirmarExclusao:m}}},yt=At;var xt=(0,g.A)(yt,wt,Et,!1,null,"3509bc35",null);const Pt=xt.exports;var St=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classes-list"},[t("div",{staticClass:"header"},[t("h3",[a._v("Gerenciamento de Classes")]),t("button",{staticClass:"btn-add",on:{click:function(t){a.mostrarFormulario=!0}}},[a._v(" Adicionar Classe ")])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando classes...")])]):0===a.classes.length?t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhuma classe cadastrada.")])]):t("div",{staticClass:"classes-table"},[t("table",[a._m(0),t("tbody",a._l(a.classes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(a.getNomeGrupo(e.grupo_id)))]),t("td",[a._v(a._s(e.descricao||"-"))]),t("td",[a._v(a._s(a.formatarData(e.created_at)))]),t("td",{staticClass:"actions"},[t("button",{staticClass:"btn-edit",on:{click:function(t){return a.editarClasse(e)}}},[a._v("Editar")]),t("button",{staticClass:"btn-delete",on:{click:function(t){return a.confirmarExclusao(e)}}},[a._v("Excluir")])])])})),0)])]),a.mostrarFormulario?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.modoEdicao?"Editar":"Adicionar")+" Classe")]),t("button",{staticClass:"btn-close",on:{click:a.fecharFormulario}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarClasse.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"grupo"}},[a._v("Grupo*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.grupo_id,expression:"classeAtual.grupo_id"}],attrs:{id:"grupo",required:""},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.classeAtual,"grupo_id",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.grupos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" ")])}))],2),0===a.grupos.length?t("div",{staticClass:"error-text"},[t("p",[a._v("É necessário cadastrar pelo menos um grupo antes de adicionar classes.")])]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome da Classe*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.nome,expression:"classeAtual.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.classeAtual.nome},on:{input:function(t){t.target.composing||a.$set(a.classeAtual,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descrição")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.descricao,expression:"classeAtual.descricao"}],attrs:{id:"descricao",rows:"3"},domProps:{value:a.classeAtual.descricao},on:{input:function(t){t.target.composing||a.$set(a.classeAtual,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharFormulario}},[a._v("Cancelar")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.salvando||0===a.grupos.length}},[a._v(" "+a._s(a.salvando?"Salvando...":"Salvar")+" ")])])])])])]):a._e()])},Nt=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Grupo")]),t("th",[a._v("Descrição")]),t("th",[a._v("Data de Criação")]),t("th",[a._v("Ações")])])])}];const Rt={name:"ClassesList",setup(){const a=(0,o.KR)([]),t=(0,o.KR)([]),e=(0,o.KR)(!0),i=(0,o.KR)(!1),s=(0,o.KR)(!1),r=(0,o.KR)(!1),n=(0,o.Kh)({id:null,grupo_id:"",nome:"",descricao:""});(0,o.sV)((async()=>{await Promise.all([l(),c()])}));const l=async()=>{try{const{data:a,error:e}=await P.ND.from("grupos").select("*").order("nome");if(e)throw e;t.value=a||[]}catch(a){console.error("Erro ao carregar grupos:",a),alert("Erro ao carregar grupos. Por favor, tente novamente.")}},c=async()=>{try{e.value=!0;const{data:t,error:o}=await P.ND.from("classes").select("*").order("nome");if(o)throw o;a.value=t||[]}catch(t){console.error("Erro ao carregar classes:",t),alert("Erro ao carregar classes. Por favor, tente novamente.")}finally{e.value=!1}},d=a=>{const e=t.value.find((t=>t.id===a));return e?e.nome:"Grupo não encontrado"},u=a=>{if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")},m=a=>{r.value=!0,n.id=a.id,n.grupo_id=a.grupo_id,n.nome=a.nome,n.descricao=a.descricao||"",s.value=!0},p=()=>{s.value=!1,r.value=!1,n.id=null,n.grupo_id="",n.nome="",n.descricao=""},v=async()=>{try{if(i.value=!0,r.value){const{error:a}=await P.ND.from("classes").update({grupo_id:n.grupo_id,nome:n.nome,descricao:n.descricao}).eq("id",n.id);if(a)throw a;alert("Classe atualizada com sucesso!")}else{const{error:a}=await P.ND.from("classes").insert({grupo_id:n.grupo_id,nome:n.nome,descricao:n.descricao});if(a)throw a;alert("Classe adicionada com sucesso!")}await c(),p()}catch(a){console.error("Erro ao salvar classe:",a),alert(`Erro ao ${r.value?"atualizar":"adicionar"} classe: ${a.message}`)}finally{i.value=!1}},g=a=>{confirm(`Deseja realmente excluir a classe "${a.nome}"?`)&&_(a.id)},_=async a=>{try{e.value=!0;const{data:t,error:o}=await P.ND.from("produtos").select("id").eq("classe_id",a);if(o)throw o;if(t&&t.length>0)return void alert(`Não é possível excluir esta classe porque existem ${t.length} produtos associados a ela.`);const{error:i}=await P.ND.from("classes").delete().eq("id",a);if(i)throw i;alert("Classe excluída com sucesso!"),await c()}catch(t){console.error("Erro ao excluir classe:",t),alert(`Erro ao excluir classe: ${t.message}`)}finally{e.value=!1}};return{classes:a,grupos:t,loading:e,salvando:i,mostrarFormulario:s,modoEdicao:r,classeAtual:n,carregarClasses:c,carregarGrupos:l,getNomeGrupo:d,formatarData:u,editarClasse:m,fecharFormulario:p,salvarClasse:v,confirmarExclusao:g}}},It=Rt;var Mt=(0,g.A)(It,St,Nt,!1,null,"7574422a",null);const $t=Mt.exports,Tt={name:"Classificacao",components:{GruposList:Pt,ClassesList:$t},setup(){const a=(0,o.KR)("grupos");return{activeTab:a}}},kt=Tt;var Ot=(0,g.A)(kt,bt,Dt,!1,null,"35477b05",null);const Bt=Ot.exports,Ft={name:"ClassificacaoView",components:{Classificacao:Bt},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},mounted(){this.carregarConfiguracoes(),document.addEventListener("click",this.fecharDropdownFora)},beforeUnmount(){document.removeEventListener("click",this.fecharDropdownFora)},methods:{async logout(){try{await P.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},fecharDropdownFora(a){this.$el.querySelector(".profile-dropdown").contains(a.target)||(this.dropdownOpen=!1)},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}},closeDropdown(){this.dropdownOpen=!1}}},zt=Ft;var qt=(0,g.A)(zt,ft,Ct,!1,null,"7461ecae",null);const Lt=qt.exports;var Ut=function(){var a=this,t=a._self._c;return t("div",{staticClass:"login-rdm-container"},[a._m(0),t("main",{staticClass:"login-main"},[t("div",{staticClass:"container"},[t("div",{staticClass:"login-card"},[a._m(1),t("form",{staticClass:"login-form",on:{submit:function(t){return t.preventDefault(),a.fazerLogin.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[a._v("📧 Email:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.loginData.email,expression:"loginData.email"}],attrs:{type:"email",id:"email",placeholder:"Digite seu email",required:"",disabled:a.carregando},domProps:{value:a.loginData.email},on:{input:function(t){t.target.composing||a.$set(a.loginData,"email",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"senha"}},[a._v("🔒 Senha:")]),t("div",{staticClass:"password-input"},["checkbox"===(a.mostrarSenha?"text":"password")?t("input",{directives:[{name:"model",rawName:"v-model",value:a.loginData.senha,expression:"loginData.senha"}],attrs:{id:"senha",placeholder:"Digite sua senha",required:"",disabled:a.carregando,type:"checkbox"},domProps:{checked:Array.isArray(a.loginData.senha)?a._i(a.loginData.senha,null)>-1:a.loginData.senha},on:{change:function(t){var e=a.loginData.senha,o=t.target,i=!!o.checked;if(Array.isArray(e)){var s=null,r=a._i(e,s);o.checked?r<0&&a.$set(a.loginData,"senha",e.concat([s])):r>-1&&a.$set(a.loginData,"senha",e.slice(0,r).concat(e.slice(r+1)))}else a.$set(a.loginData,"senha",i)}}}):"radio"===(a.mostrarSenha?"text":"password")?t("input",{directives:[{name:"model",rawName:"v-model",value:a.loginData.senha,expression:"loginData.senha"}],attrs:{id:"senha",placeholder:"Digite sua senha",required:"",disabled:a.carregando,type:"radio"},domProps:{checked:a._q(a.loginData.senha,null)},on:{change:function(t){return a.$set(a.loginData,"senha",null)}}}):t("input",{directives:[{name:"model",rawName:"v-model",value:a.loginData.senha,expression:"loginData.senha"}],attrs:{id:"senha",placeholder:"Digite sua senha",required:"",disabled:a.carregando,type:a.mostrarSenha?"text":"password"},domProps:{value:a.loginData.senha},on:{input:function(t){t.target.composing||a.$set(a.loginData,"senha",t.target.value)}}}),t("button",{staticClass:"toggle-password",attrs:{type:"button",disabled:a.carregando},on:{click:function(t){a.mostrarSenha=!a.mostrarSenha}}},[a._v(" "+a._s(a.mostrarSenha?"🙈":"👁️")+" ")])]),a.primeiroAcesso?t("small",{staticClass:"password-hint"},[a._v(" 💡 Use a senha temporária enviada por email ")]):a._e()]),a.mensagem?t("div",{staticClass:"alert",class:a.tipoMensagem},[a._v(" "+a._s(a.mensagem)+" ")]):a._e(),t("button",{staticClass:"btn-login",attrs:{type:"submit",disabled:a.carregando||!a.loginData.email||!a.loginData.senha}},[a.carregando?t("span",[a._v("⏳ Entrando...")]):t("span",[a._v("🚀 Entrar no Sistema")])])]),t("div",{staticClass:"login-footer"},[t("div",{staticClass:"links"},[t("a",{attrs:{href:"#"},on:{click:function(t){t.preventDefault(),a.mostrarModalAjuda=!0}}},[a._v("❓ Esqueci minha senha")]),t("a",{attrs:{href:"#"},on:{click:function(t){t.preventDefault(),a.mostrarModalContato=!0}}},[a._v("📞 Suporte")])]),a._m(2)])]),a._m(3)])]),a.mostrarModalAjuda?t("div",{staticClass:"modal-overlay",on:{click:function(t){a.mostrarModalAjuda=!1}}},[t("div",{staticClass:"modal",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("❓ Esqueci minha senha")]),t("button",{staticClass:"btn-close",on:{click:function(t){a.mostrarModalAjuda=!1}}},[a._v("✕")])]),a._m(4)])]):a._e(),a.mostrarModalContato?t("div",{staticClass:"modal-overlay",on:{click:function(t){a.mostrarModalContato=!1}}},[t("div",{staticClass:"modal",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("📞 Suporte Técnico")]),t("button",{staticClass:"btn-close",on:{click:function(t){a.mostrarModalContato=!1}}},[a._v("✕")])]),a._m(5)])]):a._e()])},Vt=[function(){var a=this,t=a._self._c;return t("header",{staticClass:"login-header"},[t("div",{staticClass:"container"},[t("div",{staticClass:"logo-section"},[t("h1",[a._v("🏥 Sistema Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Dashboard RDM Online")])])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"card-header"},[t("h2",[a._v("🔐 Acesso RDM")]),t("p",[a._v("Faça login para emitir suas Requisições de Materiais")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info"},[t("small",[a._v("🔒 Acesso seguro e criptografado")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-cards"},[t("div",{staticClass:"info-card"},[t("h3",[a._v("📝 O que você pode fazer")]),t("ul",[t("li",[a._v("✅ Emitir RDMs online")]),t("li",[a._v("📊 Acompanhar status das solicitações")]),t("li",[a._v("📋 Consultar histórico")]),t("li",[a._v("🔔 Receber notificações automáticas")])])]),t("div",{staticClass:"info-card"},[t("h3",[a._v("⚡ Primeiro Acesso?")]),t("ol",[t("li",[a._v("Use o email e senha enviados por email")]),t("li",[a._v("Altere sua senha no primeiro login")]),t("li",[a._v("Configure suas preferências")]),t("li",[a._v("Comece a usar o sistema!")])])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"modal-body"},[t("p",[a._v("Entre em contato com o CPM para redefinir sua senha:")]),t("div",{staticClass:"contact-info"},[t("p",[a._v("📧 "),t("strong",[a._v("Email:")]),a._v(" comprarbemteste@gmail.com")]),t("p",[a._v("📞 "),t("strong",[a._v("Telefone:")]),a._v(" (61) 3315-2425")])]),t("p",[t("small",[a._v("💡 Informe seu nome completo e unidade/setor")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"modal-body"},[t("div",{staticClass:"contact-info"},[t("h4",[a._v("💬 Canais de Atendimento:")]),t("p",[a._v("📧 "),t("strong",[a._v("Email:")]),a._v(" comprarbemteste@gmail.com")]),t("p",[a._v("📞 "),t("strong",[a._v("Telefone:")]),a._v(" (61) 3315-2425")]),t("p",[a._v("🕐 "),t("strong",[a._v("Horário:")]),a._v(" Segunda a Sexta, 8h às 17h")])]),t("div",{staticClass:"faq"},[t("h4",[a._v("❓ Problemas Comuns:")]),t("ul",[t("li",[t("strong",[a._v("Não recebi o email:")]),a._v(" Verifique spam/lixeira")]),t("li",[t("strong",[a._v("Senha não funciona:")]),a._v(" Certifique-se de usar a senha temporária")]),t("li",[t("strong",[a._v("Conta bloqueada:")]),a._v(" Contate o CPM")])])])])}];const jt={name:"LoginRDM",data(){return{loginData:{email:"",senha:""},carregando:!1,mostrarSenha:!1,mensagem:"",tipoMensagem:"",primeiroAcesso:!1,mostrarModalAjuda:!1,mostrarModalContato:!1}},async mounted(){await this.verificarSessaoExistente()},methods:{async verificarSessaoExistente(){try{const{data:a}=await P.ND.auth.getSession();if(a?.session?.user){const{data:t,error:e}=await P.ND.from("usuarios_rdm").select("*").eq("email",a.session.user.email).single();!e&&t&&(console.log("Usuário RDM já logado, redirecionando..."),this.$router.push("/dashboard-rdm"))}}catch(a){console.log("Nenhuma sessão ativa encontrada")}},async fazerLogin(){if(!this.carregando){this.carregando=!0,this.mensagem="";try{console.log("🔐 Tentativa de login RDM:",this.loginData.email);const{data:a,error:t}=await P.ND.from("usuarios_rdm").select("*").eq("email",this.loginData.email).eq("ativo",!0).single();if(t||!a)throw new Error("Email não encontrado ou usuário inativo. Verifique seus dados ou contate o CPM.");if(console.log("✅ Usuário RDM encontrado:",a.nome_usuario),a.senha_temporaria!==this.loginData.senha)throw new Error("Senha incorreta. Verifique sua senha cadastrada.");console.log("✅ Login realizado com sucesso - senha validada"),localStorage.setItem("usuarioRDM",JSON.stringify({id:a.id,user_id:a.user_id,nome_usuario:a.nome_usuario,email:a.email,unidade_setor:a.unidade_setor,nome_coordenador:a.nome_coordenador,materiais:a.materiais,tenant_id:a.tenant_id})),await P.ND.from("usuarios_rdm").update({atualizado_em:(new Date).toISOString(),convite_aceito:!0}).eq("id",a.id),this.mensagem=`🎉 Bem-vindo(a), ${a.nome_usuario}!`,this.tipoMensagem="success",console.log("✅ Login RDM realizado com sucesso!"),setTimeout((()=>{this.$router.push("/dashboard-rdm")}),1500)}catch(a){console.error("❌ Erro no login RDM:",a),this.mensagem=a.message,this.tipoMensagem="error"}finally{this.carregando=!1}}}}},Jt=jt;var Ht=(0,g.A)(Jt,Ut,Vt,!1,null,"3d6c719e",null);const Gt=Ht.exports;var Kt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard-rdm"},[t("header",{staticClass:"dashboard-header"},[t("div",{staticClass:"container"},[t("div",{staticClass:"header-content"},[a._m(0),t("div",{staticClass:"user-section"},[t("div",{staticClass:"user-info"},[t("span",{staticClass:"user-name"},[a._v("👤 "+a._s(a.usuarioAtual.nome_usuario))]),t("span",{staticClass:"user-sector"},[a._v("🏢 "+a._s(a.usuarioAtual.unidade_setor))])]),t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("🚪 Sair")])])])])]),t("nav",{staticClass:"nav-tabs"},[t("div",{staticClass:"container"},[t("div",{staticClass:"tabs"},[t("button",{staticClass:"tab-btn",class:{active:"avaliacao"===a.activeTab},on:{click:function(t){a.activeTab="avaliacao"}}},[a._v(" ⭐ Avaliação de Materiais ")]),t("button",{staticClass:"tab-btn",class:{active:"historico"===a.activeTab},on:{click:function(t){a.activeTab="historico"}}},[a._v(" 📋 Histórico ")]),t("button",{staticClass:"tab-btn",class:{active:"materiais"===a.activeTab},on:{click:function(t){a.activeTab="materiais"}}},[a._v(" 📦 Meus Materiais ")]),t("button",{staticClass:"tab-btn",class:{active:"perfil"===a.activeTab},on:{click:function(t){a.activeTab="perfil"}}},[a._v(" ⚙️ Perfil ")])])])]),t("main",{staticClass:"main-content"},[t("div",{staticClass:"container"},["avaliacao"===a.activeTab?t("div",{staticClass:"tab-content"},[a._m(1),t("div",{staticClass:"reclamacao-form-card"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.enviarReclamacao.apply(null,arguments)}}},[t("div",{staticClass:"form-section"},[t("h3",[a._v("👤 Dados do Reclamante")]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",[a._v("Nome do Reclamante:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.nome_reclamante,expression:"novaReclamacao.nome_reclamante"}],attrs:{type:"text",required:""},domProps:{value:a.novaReclamacao.nome_reclamante},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"nome_reclamante",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Telefone:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.telefone,expression:"novaReclamacao.telefone"}],attrs:{type:"tel",placeholder:"(00) 00000-0000",required:""},domProps:{value:a.novaReclamacao.telefone},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"telefone",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",[a._v("Email:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.email,expression:"novaReclamacao.email"}],attrs:{type:"email",required:""},domProps:{value:a.novaReclamacao.email},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"email",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Unidade/Setor:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.unidade_setor,expression:"novaReclamacao.unidade_setor"}],attrs:{type:"text",required:""},domProps:{value:a.novaReclamacao.unidade_setor},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"unidade_setor",t.target.value)}}})])])]),t("div",{staticClass:"form-section"},[t("h3",[a._v("📦 Dados do Material")]),t("div",{staticClass:"form-group"},[t("label",[a._v("Selecionar Material:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.materialSelecionadoReclamacao,expression:"materialSelecionadoReclamacao"}],attrs:{required:""},on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.materialSelecionadoReclamacao=t.target.multiple?e:e[0]},a.preencherDadosMaterial]}},[t("option",{attrs:{value:""}},[a._v("Selecione um material sob sua responsabilidade")]),a._l(a.usuarioAtual.materiais,(function(e){return t("option",{key:e.produto_id,domProps:{value:e}},[a._v(" "+a._s(e.nome)+" - "+a._s(e.codigo)+" ")])}))],2),0===a.usuarioAtual.materiais?.length?t("small",{staticClass:"error-text"},[a._v(" ⚠️ Você não possui materiais cadastrados. Entre em contato com a CPM. ")]):a._e()]),a.materialSelecionadoReclamacao?t("div",{staticClass:"material-info-reclamacao"},[t("h4",[a._v("📋 Dados do Material Selecionado:")]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",[a._v("Nome do Material:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.nome_material,expression:"novaReclamacao.nome_material"}],staticClass:"readonly-input",attrs:{type:"text",readonly:""},domProps:{value:a.novaReclamacao.nome_material},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"nome_material",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Código do Material:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.codigo_material,expression:"novaReclamacao.codigo_material"}],staticClass:"readonly-input",attrs:{type:"text",readonly:""},domProps:{value:a.novaReclamacao.codigo_material},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"codigo_material",t.target.value)}}})])]),t("div",{staticClass:"form-group"},[t("label",[a._v("Marca e Modelo:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.marca_modelo,expression:"novaReclamacao.marca_modelo"}],attrs:{type:"text",placeholder:"Informe a marca e modelo específicos (se necessário)"},domProps:{value:a.novaReclamacao.marca_modelo},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"marca_modelo",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("⭐ Avaliação da Qualidade (obrigatório):")]),t("div",{staticClass:"star-rating"},a._l(5,(function(e){return t("span",{key:e,staticClass:"star",class:{active:(a.novaReclamacao.rating||0)>=e},attrs:{title:`${e} estrela${e>1?"s":""}`},on:{click:function(t){a.novaReclamacao.rating=e}}},[a._v(" ⭐ ")])})),0),a.novaReclamacao.rating?t("small",{staticClass:"rating-info"},[a._v(" Avaliação: "+a._s(a.novaReclamacao.rating)+"/5 estrelas ")]):t("small",{staticClass:"error-text"},[a._v(" ⚠️ Por favor, dê uma avaliação de 1 a 5 estrelas ")])])]):a._e()]),t("div",{staticClass:"form-section"},[t("h3",[a._v("💬 Comentários e Observações")]),t("div",{staticClass:"form-group"},[t("label",[a._v("Observações sobre o Material:")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.comentario,expression:"novaReclamacao.comentario"}],attrs:{rows:"3",placeholder:"Como está sendo a experiência com este material? Qualidade, durabilidade, eficácia..."},domProps:{value:a.novaReclamacao.comentario},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"comentario",t.target.value)}}})])]),t("div",{staticClass:"form-section"},[t("h3",[a._v("🚨 Problemas e Reclamações (opcional)")]),t("div",{staticClass:"form-group"},[t("label",[a._v("Descrição de Problemas:")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.registro_reclamacao,expression:"novaReclamacao.registro_reclamacao"}],attrs:{rows:"4",placeholder:"Se houver problemas, defeitos ou situações negativas, descreva detalhadamente aqui... (opcional)"},domProps:{value:a.novaReclamacao.registro_reclamacao},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"registro_reclamacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Sugestões de Melhoria:")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.sugestoes,expression:"novaReclamacao.sugestoes"}],attrs:{rows:"3",placeholder:"Sugestões para melhorias ou soluções... (opcional)"},domProps:{value:a.novaReclamacao.sugestoes},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"sugestoes",t.target.value)}}})])]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.limparAvaliacao}},[a._v(" 🗑️ Limpar ")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.enviandoReclamacao||!a.novaReclamacao.rating}},[a.enviandoReclamacao?t("span",[a._v("⏳ Enviando...")]):t("span",[a._v("⭐ Enviar Avaliação")])])])])])]):a._e(),"historico"===a.activeTab?t("div",{staticClass:"tab-content"},[a._m(2),t("div",{staticClass:"historico-container"},[t("div",{staticClass:"filters-card"},[t("div",{staticClass:"filters-row"},[t("div",{staticClass:"filter-group"},[t("label",[a._v("🔍 Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.busca,expression:"filtros.busca"}],attrs:{type:"text",placeholder:"Material, código..."},domProps:{value:a.filtros.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtros,"busca",t.target.value)},a.aplicarFiltros]}})]),t("div",{staticClass:"filter-group"},[t("label",[a._v("⭐ Avaliação:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtros.rating,expression:"filtros.rating"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtros,"rating",t.target.multiple?e:e[0])},a.aplicarFiltros]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),t("option",{attrs:{value:"5"}},[a._v("⭐⭐⭐⭐⭐ (5 estrelas)")]),t("option",{attrs:{value:"4"}},[a._v("⭐⭐⭐⭐ (4 estrelas)")]),t("option",{attrs:{value:"3"}},[a._v("⭐⭐⭐ (3 estrelas)")]),t("option",{attrs:{value:"2"}},[a._v("⭐⭐ (2 estrelas)")]),t("option",{attrs:{value:"1"}},[a._v("⭐ (1 estrela)")])])]),t("div",{staticClass:"filter-group"},[t("label",[a._v("📅 Período:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtros.periodo,expression:"filtros.periodo"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtros,"periodo",t.target.multiple?e:e[0])},a.aplicarFiltros]}},[t("option",{attrs:{value:""}},[a._v("Todos")]),t("option",{attrs:{value:"hoje"}},[a._v("Hoje")]),t("option",{attrs:{value:"semana"}},[a._v("Esta Semana")]),t("option",{attrs:{value:"mes"}},[a._v("Este Mês")]),t("option",{attrs:{value:"trimestre"}},[a._v("Último Trimestre")])])])])]),t("div",{staticClass:"feedbacks-list"},[a.carregandoHistorico?t("div",{staticClass:"loading-card"},[a._v(" ⏳ Carregando histórico... ")]):0===a.historicoFeedbacks.length?t("div",{staticClass:"empty-state-card"},[t("div",{staticClass:"empty-icon"},[a._v("📭")]),t("h3",[a._v("Nenhuma avaliação encontrada")]),t("p",[a._v("Você ainda não enviou nenhuma avaliação de material.")]),t("button",{staticClass:"btn-primary",on:{click:function(t){a.activeTab="avaliacao"}}},[a._v(" ⭐ Fazer Primeira Avaliação ")])]):t("div",{staticClass:"feedbacks-grid"},a._l(a.historicoFeedbacks,(function(e){return t("div",{key:e.id,staticClass:"feedback-card-history"},[t("div",{staticClass:"feedback-header"},[t("h4",[a._v(a._s(e.material_nome))]),t("div",{staticClass:"rating-display"},a._l(5,(function(o){return t("span",{key:o,staticClass:"star",class:{active:e.rating>=o}},[a._v("⭐")])})),0)]),t("div",{staticClass:"feedback-content"},[t("p",{staticClass:"feedback-details"},[t("strong",[a._v("Código:")]),a._v(" "+a._s(e.material_codigo)),t("br"),t("strong",[a._v("Avaliação:")]),a._v(" "+a._s(e.rating)+"/5 estrelas ")]),e.comentario?t("p",{staticClass:"feedback-comentario"},[t("strong",[a._v("Comentário:")]),a._v(" "+a._s(e.comentario)+" ")]):a._e()]),t("div",{staticClass:"feedback-footer"},[t("span",{staticClass:"feedback-date"},[a._v("📅 "+a._s(a.formatDate(e.criado_em)))])])])})),0)])])]):a._e(),"materiais"===a.activeTab?t("div",{staticClass:"tab-content"},[a._m(3),t("div",{staticClass:"materiais-container"},[0===a.usuarioAtual.materiais?.length?t("div",{staticClass:"empty-state-card"},[t("div",{staticClass:"empty-icon"},[a._v("📦")]),t("h3",[a._v("Nenhum material cadastrado")]),t("p",[a._v("Você ainda não possui materiais sob sua responsabilidade.")]),t("p",[a._v("Entre em contato com a CPM para solicitar acesso aos materiais do seu setor.")])]):t("div",{staticClass:"materiais-grid"},a._l(a.usuarioAtual.materiais,(function(e){return t("div",{key:e.produto_id,staticClass:"material-card"},[t("div",{staticClass:"material-header"},[t("h4",[a._v(a._s(e.nome))]),t("span",{staticClass:"material-code"},[a._v(a._s(e.codigo))])]),t("div",{staticClass:"material-info"},[t("p",[t("strong",[a._v("Periodicidade de Avaliação:")]),a._v(" "+a._s(e.periodicidade_rdm))]),t("p",[t("strong",[a._v("Próxima Avaliação:")]),a._v(" "+a._s(a.calcularProximaAvaliacao(e)))])]),t("div",{staticClass:"material-actions"},[t("button",{staticClass:"btn-avaliar",on:{click:function(t){a.activeTab="avaliacao"}}},[a._v(" ⭐ Avaliar Material ")])])])})),0)])]):a._e(),"perfil"===a.activeTab?t("div",{staticClass:"tab-content"},[a._m(4),t("div",{staticClass:"perfil-container"},[t("div",{staticClass:"perfil-cards"},[t("div",{staticClass:"perfil-card"},[t("h3",[a._v("👤 Dados Pessoais")]),t("div",{staticClass:"perfil-info"},[t("p",[t("strong",[a._v("Nome:")]),a._v(" "+a._s(a.usuarioAtual.nome_usuario))]),t("p",[t("strong",[a._v("Email:")]),a._v(" "+a._s(a.usuarioAtual.email))]),t("p",[t("strong",[a._v("Unidade/Setor:")]),a._v(" "+a._s(a.usuarioAtual.unidade_setor))]),t("p",[t("strong",[a._v("Coordenador:")]),a._v(" "+a._s(a.usuarioAtual.nome_coordenador))])])]),t("div",{staticClass:"perfil-card"},[t("h3",[a._v("📊 Estatísticas")]),t("div",{staticClass:"stats-grid"},[t("div",{staticClass:"stat-item"},[t("span",{staticClass:"stat-number"},[a._v(a._s(a.totalFeedbacks))]),t("span",{staticClass:"stat-label"},[a._v("Avaliações Enviadas")])]),t("div",{staticClass:"stat-item"},[t("span",{staticClass:"stat-number"},[a._v(a._s(a.feedbacksRecentes))]),t("span",{staticClass:"stat-label"},[a._v("Últimos 30 dias")])]),t("div",{staticClass:"stat-item"},[t("span",{staticClass:"stat-number"},[a._v(a._s(a.usuarioAtual.materiais?.length||0))]),t("span",{staticClass:"stat-label"},[a._v("Materiais Sob Responsabilidade")])])])]),t("div",{staticClass:"perfil-card"},[t("h3",[a._v("🔒 Alterar Senha")]),t("form",{staticClass:"senha-form",on:{submit:function(t){return t.preventDefault(),a.alterarSenha.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",[a._v("Senha Atual:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.alteracaoSenha.senhaAtual,expression:"alteracaoSenha.senhaAtual"}],attrs:{type:"password",required:""},domProps:{value:a.alteracaoSenha.senhaAtual},on:{input:function(t){t.target.composing||a.$set(a.alteracaoSenha,"senhaAtual",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Nova Senha:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.alteracaoSenha.novaSenha,expression:"alteracaoSenha.novaSenha"}],attrs:{type:"password",required:""},domProps:{value:a.alteracaoSenha.novaSenha},on:{input:function(t){t.target.composing||a.$set(a.alteracaoSenha,"novaSenha",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Confirmar Nova Senha:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.alteracaoSenha.confirmaSenha,expression:"alteracaoSenha.confirmaSenha"}],attrs:{type:"password",required:""},domProps:{value:a.alteracaoSenha.confirmaSenha},on:{input:function(t){t.target.composing||a.$set(a.alteracaoSenha,"confirmaSenha",t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.alterandoSenha}},[a.alterandoSenha?t("span",[a._v("⏳ Alterando...")]):t("span",[a._v("🔒 Alterar Senha")])])])])])])]):a._e()])])])},Yt=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo-section"},[t("h1",[a._v("🏥 Sistema Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Dashboard RDM")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"page-header"},[t("h2",[a._v("⭐ Avaliação de Materiais")]),t("p",[a._v("Avalie a qualidade dos materiais e registre problemas ou sugestões")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"page-header"},[t("h2",[a._v("📋 Histórico de Avaliações")]),t("p",[a._v("Veja suas avaliações e feedbacks anteriores")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"page-header"},[t("h2",[a._v("📦 Meus Materiais")]),t("p",[a._v("Materiais sob sua responsabilidade para avaliação")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"page-header"},[t("h2",[a._v("⚙️ Meu Perfil")]),t("p",[a._v("Informações da sua conta e configurações")])])}];const Qt={name:"DashboardRDM",data(){return{activeTab:"avaliacao",usuarioAtual:{},novaReclamacao:{nome_reclamante:"",telefone:"",email:"",unidade_setor:"",nome_material:"",codigo_material:"",marca_modelo:"",rating:0,comentario:"",registro_reclamacao:"",sugestoes:""},materialSelecionadoReclamacao:null,enviandoReclamacao:!1,historicoFeedbacks:[],carregandoHistorico:!1,filtros:{busca:"",rating:"",periodo:""},alteracaoSenha:{senhaAtual:"",novaSenha:"",confirmaSenha:""},alterandoSenha:!1}},computed:{totalFeedbacks(){return this.historicoFeedbacks.length},feedbacksRecentes(){return this.historicoFeedbacks.filter((a=>{const t=new Date;return t.setMonth(t.getMonth()-1),new Date(a.criado_em)>=t})).length}},async mounted(){await this.carregarDadosUsuario(),await this.carregarHistoricoFeedbacks(),this.inicializarReclamacao()},watch:{activeTab(a){"historico"===a&&this.carregarHistoricoFeedbacks()}},methods:{async carregarDadosUsuario(){try{const a=localStorage.getItem("usuarioRDM");if(!a)throw new Error("Dados do usuário não encontrados");if(this.usuarioAtual=JSON.parse(a),!this.usuarioAtual.id||!this.usuarioAtual.tenant_id)throw new Error("Dados do usuário incompletos");console.log("✅ Dados do usuário carregados:",{nome:this.usuarioAtual.nome_usuario,id:this.usuarioAtual.id,tenant_id:this.usuarioAtual.tenant_id,materiais:this.usuarioAtual.materiais?.length||0})}catch(a){console.error("❌ Erro ao carregar dados do usuário:",a),alert("Erro ao carregar dados do usuário. Por favor, faça login novamente."),this.$router.push("/rdm")}},inicializarReclamacao(){this.novaReclamacao.nome_reclamante=this.usuarioAtual.nome_usuario||"",this.novaReclamacao.email=this.usuarioAtual.email||"",this.novaReclamacao.unidade_setor=this.usuarioAtual.unidade_setor||"",this.novaReclamacao.rating=0,this.novaReclamacao.comentario=""},async carregarHistoricoFeedbacks(){this.carregandoHistorico=!0;try{if(!this.usuarioAtual.id||!this.usuarioAtual.tenant_id)throw new Error("Dados do usuário incompletos");const{data:a,error:t}=await P.ND.from("material_feedbacks").select("*").eq("usuario_rdm_id",this.usuarioAtual.id).eq("tenant_id",this.usuarioAtual.tenant_id).order("criado_em",{ascending:!1});if(t)throw t;this.historicoFeedbacks=a||[],this.aplicarFiltros()}catch(a){console.error("❌ [HISTÓRICO] Erro:",a),this.historicoFeedbacks=[],alert("Erro ao carregar histórico: "+a.message)}finally{this.carregandoHistorico=!1}},aplicarFiltros(){if(!this.historicoFeedbacks)return;let a=[...this.historicoFeedbacks];if(this.filtros.busca){const t=this.filtros.busca.toLowerCase();a=a.filter((a=>a.material_nome?.toLowerCase().includes(t)||a.material_codigo?.toLowerCase().includes(t)))}if(this.filtros.rating&&(a=a.filter((a=>a.rating==this.filtros.rating))),this.filtros.periodo){const t=new Date;a=a.filter((a=>{const e=new Date(a.criado_em);switch(this.filtros.periodo){case"hoje":return e.toDateString()===t.toDateString();case"semana":const a=new Date(t.getTime()-6048e5);return e>=a;case"mes":return e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear();case"trimestre":const o=new Date(t.getTime()-7776e6);return e>=o;default:return!0}}))}},calcularProximaAvaliacao(a){const t=new Date,e=a.periodicidade_rdm||"MENSAL";switch(e.toUpperCase()){case"SEMANAL":t.setDate(t.getDate()+7);break;case"QUINZENAL":t.setDate(t.getDate()+15);break;case"MENSAL":t.setMonth(t.getMonth()+1);break;case"TRIMESTRAL":t.setMonth(t.getMonth()+3);break;case"SEMESTRAL":t.setMonth(t.getMonth()+6);break;case"ANUAL":t.setFullYear(t.getFullYear()+1);break;default:t.setMonth(t.getMonth()+1)}return t.toLocaleDateString("pt-BR")},async enviarReclamacao(){if(!this.enviandoReclamacao){this.enviandoReclamacao=!0;try{if(console.log("📤 [RECLAMAÇÃO] Enviando reclamação..."),!this.usuarioAtual.id||!this.usuarioAtual.tenant_id)throw new Error("Dados do usuário incompletos");if(!this.materialSelecionadoReclamacao)throw new Error("Nenhum material selecionado");const a={id:crypto.randomUUID(),tenant_id:this.usuarioAtual.tenant_id,usuario_rdm_id:this.usuarioAtual.id,produto_id:this.materialSelecionadoReclamacao.produto_id,material_nome:this.novaReclamacao.nome_material,material_codigo:this.novaReclamacao.codigo_material,rating:this.novaReclamacao.rating,comentario:this.novaReclamacao.comentario||"",criado_em:(new Date).toISOString()};console.log("💾 [AVALIAÇÃO] Dados preparados:",a);const{error:t}=await P.ND.from("material_feedbacks").insert([a]);if(t)throw console.error("❌ [AVALIAÇÃO] Erro ao salvar feedback:",t),new Error(t.message);if(console.log("✅ [AVALIAÇÃO] Feedback salvo com sucesso!"),this.novaReclamacao.registro_reclamacao?.trim()){const a={id:crypto.randomUUID(),tenant_id:this.usuarioAtual.tenant_id,usuario_rdm_id:this.usuarioAtual.id,nome_reclamante:this.novaReclamacao.nome_reclamante,telefone:this.novaReclamacao.telefone,email:this.novaReclamacao.email,unidade_setor:this.novaReclamacao.unidade_setor,nome_material:this.novaReclamacao.nome_material,codigo_material:this.novaReclamacao.codigo_material,marca_modelo:this.novaReclamacao.marca_modelo,registro_reclamacao:this.novaReclamacao.registro_reclamacao,sugestoes:this.novaReclamacao.sugestoes||"",status:"ABERTA",data_reclamacao:(new Date).toISOString()},{error:t}=await P.ND.from("reclamacoes_usuarios").insert([a]);if(t)throw console.error("❌ [RECLAMAÇÃO] Erro ao salvar reclamação:",t),new Error(t.message)}await this.carregarHistoricoFeedbacks(),alert("✅ Avaliação enviada com sucesso!"),this.limparAvaliacao()}catch(a){console.error("❌ [RECLAMAÇÃO] Erro ao enviar:",a),alert("Erro ao enviar: "+a.message)}finally{this.enviandoReclamacao=!1}}},preencherDadosMaterial(){this.materialSelecionadoReclamacao&&(this.novaReclamacao.nome_material=this.materialSelecionadoReclamacao.nome,this.novaReclamacao.codigo_material=this.materialSelecionadoReclamacao.codigo,this.novaReclamacao.marca_modelo="",console.log("📦 [RECLAMAÇÃO] Material selecionado:",this.materialSelecionadoReclamacao.nome))},limparAvaliacao(){this.novaReclamacao={nome_reclamante:this.usuarioAtual.nome_usuario||"",telefone:"",email:this.usuarioAtual.email||"",unidade_setor:this.usuarioAtual.unidade_setor||"",nome_material:"",codigo_material:"",marca_modelo:"",rating:0,comentario:"",registro_reclamacao:"",sugestoes:""},this.materialSelecionadoReclamacao=null},formatDate(a){return new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},async alterarSenha(){if(this.alteracaoSenha.novaSenha===this.alteracaoSenha.confirmaSenha){this.alterandoSenha=!0;try{alert("🎉 Senha alterada com sucesso!"),this.alteracaoSenha={senhaAtual:"",novaSenha:"",confirmaSenha:""}}catch(a){console.error("❌ Erro ao alterar senha:",a),alert("❌ Erro ao alterar senha: "+a.message)}finally{this.alterandoSenha=!1}}else alert("❌ As senhas não coincidem!")},async logout(){confirm("Tem certeza que deseja sair?")&&(localStorage.removeItem("usuarioRDM"),this.$router.push("/rdm"))}}},Xt=Qt;var Zt=(0,g.A)(Xt,Kt,Yt,!1,null,"c149abe6",null);const Wt=Zt.exports;o.Ay.use(w.Ay);const ae=[{path:"/",name:"Home",component:O,meta:{requiresAuth:!1}},{path:"/dashboard",name:"Dashboard",component:Y,meta:{requiresAuth:!0}},{path:"/ccl",name:"CCL",component:ht,meta:{requiresAuth:!0}},{path:"/cadastro",name:"Cadastro",component:ca,meta:{requiresAuth:!0}},{path:"/analise/:id",name:"Analise",component:wa,meta:{requiresAuth:!0}},{path:"/catalogo",name:"Catalogo",component:Ta,meta:{requiresAuth:!0}},{path:"/feedback",name:"Feedback",component:Ha,meta:{requiresAuth:!0}},{path:"/dcb",name:"DCB",component:st,meta:{requiresAuth:!0}},{path:"/classificacao",name:"Classificacao",component:Lt,meta:{requiresAuth:!0}},{path:"/produtos/:id",name:"DetalheProduto",component:()=>e.e(961).then(e.bind(e,9961)),props:!0,meta:{requiresAuth:!0}},{path:"/validar-dcb/:numero/:ano",name:"ValidarDCB",component:()=>e.e(796).then(e.bind(e,1796)),props:!0,meta:{requiresAuth:!1}},{path:"/rdm",name:"LoginRDM",component:Gt,meta:{requiresAuth:!1}},{path:"/dashboard-rdm",name:"DashboardRDM",component:Wt,meta:{requiresAuth:!1}}],te=new w.Ay({mode:"hash",base:"/ComprarBem/",routes:ae});te.beforeEach((async(a,t,e)=>{const o=a.matched.some((a=>a.meta.requiresAuth));if(o)try{const{data:a}=await P.ND.auth.getSession(),t=a?.session?.user;o&&!t?e("/"):e()}catch(i){console.error("Erro na verificação de autenticação:",i),o?e("/"):e()}else e()}));const ee=te;var oe=e(3518);o.Ay.use(oe.Ay);const ie=new oe.Ay.Store({state:{user:null,tenant:null,isLoading:!1},mutations:{SET_USER(a,t){a.user=t},SET_TENANT(a,t){a.tenant=t},SET_LOADING(a,t){a.isLoading=t}},actions:{async fetchUser({commit:a}){const{data:t}=await P.ND.auth.getSession(),e=t?.session?.user;if(a("SET_USER",e),e){const{data:t,error:o}=await P.ND.from("tenants").select("*").eq("id",e.user_metadata?.tenant_id).single();!o&&t&&a("SET_TENANT",t)}},setLoading({commit:a},t){a("SET_LOADING",t)}},getters:{isAuthenticated:a=>!!a.user,currentUser:a=>a.user,currentTenant:a=>a.tenant,isLoading:a=>a.isLoading}});var se=e(5329),re=e(5170),ne=e.n(re);o.Ay.config.productionTip=!1,o.Ay.use(se.A),o.Ay.use(ne()),new o.Ay({router:ee,store:ie,render:a=>a(D)}).$mount("#app")},3405:(a,t,e)=>{e.d(t,{enviarEmailParticipanteStatus:()=>n,lY:()=>l});var o=e(452),i=e(365);const s={from:{email:"cpm@suaorganizacao.com.br",name:"CPM - Comissão de Padronização de Materiais"},provider:{apiKey:{NODE_ENV:"production",BASE_URL:"/ComprarBem/"}.VUE_APP_EMAIL_API_KEY,apiUrl:"https://api.sendgrid.v3/mail/send"}},r={diligencia:{subject:"Diligência Solicitada - Produto em Análise",template:a=>`\n      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">\n        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center;">\n          <h1>📋 Diligência Solicitada</h1>\n          <p>Comissão de Padronização de Materiais</p>\n        </div>\n        \n        <div style="padding: 30px; background: #f8f9fa;">\n          <h2 style="color: #333;">Prezado(a) Fornecedor,</h2>\n          \n          <p>Foi solicitada uma <strong>diligência</strong> para o produto em análise:</p>\n          \n          <div style="background: white; padding: 20px; border-left: 4px solid #667eea; margin: 20px 0;">\n            <h3 style="color: #667eea; margin-top: 0;">📦 Dados do Produto:</h3>\n            <p><strong>Nome:</strong> ${a.produto.nome}</p>\n            <p><strong>Marca:</strong> ${a.produto.marca}</p>\n            <p><strong>Modelo:</strong> ${a.produto.modelo}</p>\n            <p><strong>Fabricante:</strong> ${a.produto.fabricante}</p>\n          </div>\n          \n          <div style="background: #fff3cd; padding: 20px; border-left: 4px solid #ffc107; margin: 20px 0;">\n            <h3 style="color: #856404; margin-top: 0;">⚠️ Tipo de Diligência:</h3>\n            <p><strong>${a.diligencia.tipo}</strong></p>\n            <p>${a.diligencia.descricao}</p>\n          </div>\n          \n          <div style="background: #f8d7da; padding: 20px; border-left: 4px solid #dc3545; margin: 20px 0;">\n            <h3 style="color: #721c24; margin-top: 0;">⏰ Prazo para Resposta:</h3>\n            <p><strong>${a.diligencia.prazo_dias} dias úteis</strong></p>\n            <p><strong>Data Limite:</strong> ${new Date(a.diligencia.data_limite).toLocaleDateString("pt-BR")}</p>\n          </div>\n          \n          <div style="background: #d4edda; padding: 20px; border-left: 4px solid #28a745; margin: 20px 0;">\n            <h3 style="color: #155724; margin-top: 0;">📝 Instruções:</h3>\n            <ul>\n              <li>Responda a esta diligência dentro do prazo estabelecido</li>\n              <li>Envie todos os documentos solicitados em formato PDF</li>\n              <li>Em caso de dúvidas, entre em contato conosco</li>\n              <li>O não atendimento da diligência pode resultar na reprovação do produto</li>\n            </ul>\n          </div>\n          \n          <div style="text-align: center; margin: 30px 0;">\n            <p style="color: #666;">Para responder esta diligência, entre em contato através do nosso sistema ou envie os documentos por email.</p>\n          </div>\n          \n          <hr style="border: none; border-top: 1px solid #ddd; margin: 30px 0;">\n          \n          <div style="color: #666; font-size: 12px;">\n            <p><strong>CPM - Comissão de Padronização de Materiais</strong></p>\n            <p>Este é um email automático. Não responda diretamente a este email.</p>\n            <p>Data de envio: ${(new Date).toLocaleDateString("pt-BR")} às ${(new Date).toLocaleTimeString("pt-BR")}</p>\n          </div>\n        </div>\n      </div>\n    `},participanteStatus:{subject:"{{titulo status}}",template:a=>`\nSUBJECT: ${"aprovado"===a.status?"✅ APROVADO":"❌ REJEITADO"} - Sua empresa foi ${"aprovado"===a.status?"aprovada":"rejeitada"} no Edital ${a.numero_edital}\n\nPrezado(a) ${a.representante_legal},\n\n${"aprovado"===a.status?"É com grande satisfação que informamos que sua empresa foi APROVADA para participar do processo de pré-qualificação!":"Informamos que sua empresa foi REJEITADA no processo de pré-qualificação."}\n\n=== DADOS DA EMPRESA ===\nRazão Social: ${a.razao_social}\nCNPJ: ${a.cnpj}\nRepresentante Legal: ${a.representante_legal}\nEmail: ${a.email_empresa}\nTelefone: ${a.telefone}\n\n=== DADOS DO EDITAL ===\nNúmero: ${a.numero_edital}\nDescrição: ${a.descricao_edital}\nData da Decisão: ${a.data_decisao}\nStatus: ${a.status.toUpperCase()}\n\n${"aprovado"===a.status?`=== PRÓXIMOS PASSOS ===\n1. Documentação Técnica: Envie os documentos técnicos dos produtos conforme especificado no edital\n2. Amostras (se aplicável): Providencie as amostras físicas quando solicitado\n3. Análise CPM: Aguarde a análise técnica da Comissão de Padronização de Materiais\n4. Emissão DCB: Após aprovação técnica, será emitido o DCB (Declaração de Conformidade de Bem)\n5. Catálogo Eletrônico: Produtos aprovados entrarão no catálogo para licitações\n\n=== INFORMAÇÕES IMPORTANTES ===\n- Esta aprovação é para participação no processo, não garante aprovação final dos produtos\n- Todos os produtos passarão por análise técnica rigorosa pela CPM\n- Documentação incompleta ou inadequada pode resultar em reprovação\n- Mantenha seus dados atualizados em nosso sistema\n- Acompanhe o status através do nosso portal\n\n=== PRAZOS ===\nEnvio de Documentação: ${a.prazo_documentacao}\nAnálise Técnica: Até 30 dias úteis após recebimento completo\nResultado Final: Será comunicado por email e sistema`:`=== MOTIVO DA REJEIÇÃO ===\n${a.motivo_rejeicao||"Documentação não atende aos requisitos do edital"}\n\n=== COMO PROCEDER ===\n- Revise a documentação enviada\n- Corrija os problemas identificados\n- Você pode se candidatar novamente em editais futuros\n- Em caso de dúvidas, entre em contato conosco`}\n\n=== CONTATO ===\nEmail: ${a.email_suporte}\nTelefone: ${a.telefone_suporte}\nHorário: Segunda a Sexta, 8h às 17h\n\n=== SISTEMA COMPRARBEM ===\nAcesse: ${a.link_sistema}\n\n${a.nome_organizacao}\nEmail: ${a.email_organizacao}\nTelefone: ${a.telefone_organizacao}\nEndereço: ${a.endereco_organizacao}\n\n---\nEste é um email automático. Não responda diretamente a este email.\nEmail enviado em ${a.data_envio} às ${a.hora_envio}\n    `}};async function n(a,t,e="aprovado",o=null){try{console.log(`📧 Iniciando envio de email de ${e} para participante...`,a.email);const s={representante_legal:a.representante_legal,razao_social:a.razao_social,cnpj:a.cnpj,email_empresa:a.email,telefone:a.telefone||"Não informado",status:e,motivo_rejeicao:o,numero_edital:t.numero||"N/A",descricao_edital:t.descricao||"Edital de Pré-Qualificação",data_decisao:(new Date).toLocaleDateString("pt-BR"),prazo_documentacao:"30 dias úteis a partir desta data",link_sistema:window.location.origin,email_suporte:"comprarbemteste@gmail.com",telefone_suporte:"(61) 3315-2425",nome_organizacao:"Ministério da Saúde",email_organizacao:"cpm@saude.gov.br",telefone_organizacao:"(61) 3315-2425",endereco_organizacao:"Brasília - DF",data_envio:(new Date).toLocaleDateString("pt-BR"),hora_envio:(new Date).toLocaleTimeString("pt-BR")},n=r.participanteStatus.template(s),l="aprovado"===e?`✅ APROVADO - Sua empresa foi aprovada no Edital ${s.numero_edital}`:`❌ REJEITADO - Sua empresa foi rejeitada no Edital ${s.numero_edital}`,d={serviceId:"service_7sv1naw",templateId:"template_nyiw2ua",publicKey:"DqGKMNJ87ch3qVxGv"},u={numero_edital:s.numero_edital,email_empresa:s.email_empresa,message:n,name:s.representante_legal,email:s.email_suporte,subject:l,status_participante:e,motivo_rejeicao:o||""};console.log(`📧 Enviando email de ${e} via EmailJS...`),console.log("📧 Para:",s.email_empresa),console.log("📧 Edital:",s.numero_edital),console.log("📧 Subject:",l),console.log("📧 Status:",e),console.log("📧 Motivo Rejeição:",o),console.log("📧 Parâmetros EmailJS:",u);const m=await i.Ay.send(d.serviceId,d.templateId,u,d.publicKey);return console.log(`🎉 EMAIL DE ${e.toUpperCase()} ENVIADO COM SUCESSO!`,m),await c({tipo:`participante_${e}`,destinatario:a.email,assunto:l,participante_id:a.id,edital_id:t.id,status:"enviado"}),{sucesso:!0,mensagem:`Email de ${e} enviado com sucesso!`,destinatario:a.email}}catch(s){throw console.error(`❌ Erro ao enviar email de ${e}:`,s),await c({tipo:`participante_${e}`,destinatario:a.email,assunto:`${"aprovado"===e?"✅ APROVADO":"❌ REJEITADO"} - Edital ${t.numero}`,participante_id:a.id,edital_id:t.id,status:"erro",erro:s.message}),new Error(`Falha ao enviar email de ${e}: `+s.message)}}async function l(a){try{console.log("📧 Iniciando envio de email de diligência...",a);try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);t.emailRemetente&&(s.from.email=t.emailRemetente),t.nomeRemetente&&(s.from.name=t.nomeRemetente)}}catch(t){console.error("Erro ao carregar configurações do usuário:",t)}if(!a.produto||!a.diligencia||!a.destinatario)throw new Error("Dados incompletos para envio do email");const l={personalizations:[{to:[{email:a.destinatario,name:a.produto.fabricante}]}],from:{email:s.from.email,name:s.from.name},subject:r.diligencia.subject,content:[{type:"text/html",value:r.diligencia.template(a)}]},{data:c,error:d}=await o.ND.from("emails_enviados").insert({tipo:"diligencia",destinatario:a.destinatario,assunto:r.diligencia.subject,produto_id:a.produto.id,diligencia_id:a.diligencia.id,status:"enviando",tentativas:1}).select().single();if(d&&console.error("❌ Erro ao registrar log de email:",d),"sendgrid"==={NODE_ENV:"production",BASE_URL:"/ComprarBem/"}.VUE_APP_EMAIL_PROVIDER&&{NODE_ENV:"production",BASE_URL:"/ComprarBem/"}.VUE_APP_SENDGRID_API_KEY){console.log("📧 Enviando email via EmailJS (usando SendGrid configurado)...");try{const t={to_email:a.destinatario,fabricante:a.produto.fabricante,produto_nome:a.produto.nome,produto_marca:a.produto.marca,produto_modelo:a.produto.modelo,cnpj:a.produto.cnpj||"Não informado",tipo_diligencia:a.diligencia.tipo,descricao_diligencia:a.diligencia.descricao,prazo_dias:"30",data_limite:new Date(a.diligencia.data_limite).toLocaleDateString("pt-BR"),data_envio:(new Date).toLocaleDateString("pt-BR")+" às "+(new Date).toLocaleTimeString("pt-BR"),nome_responsavel:"William Martins",cargo_responsavel:"Analista CPM",email_responsavel:"comprarbemteste@gmail.com"};console.log("📧 Enviando email via EmailJS..."),console.log("📧 Dados preparados:",t);const s={serviceId:"service_7sv1naw",templateId:"template_vbp986f",publicKey:"DqGKMNJ87ch3qVxGv"};try{console.log("📧 Enviando email REAL via EmailJS..."),console.log("📧 Configuração:",s),console.log("📧 Dados:",t);const a=await i.Ay.send(s.serviceId,s.templateId,t,s.publicKey);console.log("🎉 EMAIL ENVIADO COM SUCESSO!",a)}catch(e){throw console.error("❌ Erro no EmailJS:",e),e}return c&&await o.ND.from("emails_enviados").update({status:"enviado",data_envio:(new Date).toISOString(),corpo:t.message}).eq("id",c.id),console.log("✅ EMAIL PREPARADO COM SUCESSO!"),console.log("📧 Para:",t.to_email),console.log("📧 Assunto:",t.subject),{success:!0,message:"Email preparado com sucesso! (SendGrid configurado)",emailId:c?.id}}catch(n){return console.error("❌ Erro ao preparar email:",n),c&&await o.ND.from("emails_enviados").update({status:"desenvolvimento",data_envio:(new Date).toISOString(),erro_detalhes:"Erro na preparação do email"}).eq("id",c.id),{success:!0,message:"Diligência criada (modo desenvolvimento)",emailId:c?.id,development:!0}}}return console.log("🔄 Modo desenvolvimento - Simulando envio de email"),console.log("📧 Email Data:",l),await new Promise((a=>setTimeout(a,1e3))),c&&await o.ND.from("emails_enviados").update({status:"enviado",data_envio:(new Date).toISOString()}).eq("id",c.id),{success:!0,message:"Email enviado com sucesso (simulado)",emailId:c?.id}}catch(t){return console.error("❌ Erro ao enviar email de diligência:",t),{success:!1,message:t.message||"Erro interno no envio do email",error:t}}}async function c(a){try{const{error:t}=await o.ND.from("emails_enviados").insert({tipo:a.tipo,destinatario:a.destinatario,assunto:a.assunto,participante_id:a.participante_id||null,edital_id:a.edital_id||null,produto_id:a.produto_id||null,diligencia_id:a.diligencia_id||null,status:a.status,erro:a.erro||null,tentativas:1,criado_em:(new Date).toISOString()});t?console.warn("⚠️ Erro ao registrar email no banco:",t):console.log("✅ Email registrado no banco com sucesso")}catch(t){console.warn("⚠️ Falha ao registrar email no banco:",t)}}const d={serviceId:"service_7sv1naw",templateId:"template_nyiw2ua",publicKey:"DqGKMNJ87ch3qVxGv"};i.Ay.init(d.publicKey)}},t={};function e(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return a[o].call(s.exports,s,s.exports,e),s.exports}e.m=a,(()=>{var a=[];e.O=(t,o,i,s)=>{if(!o){var r=1/0;for(d=0;d<a.length;d++){for(var[o,i,s]=a[d],n=!0,l=0;l<o.length;l++)(!1&s||r>=s)&&Object.keys(e.O).every((a=>e.O[a](o[l])))?o.splice(l--,1):(n=!1,s<r&&(r=s));if(n){a.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=a.length;d>0&&a[d-1][2]>s;d--)a[d]=a[d-1];a[d]=[o,i,s]}})(),(()=>{e.n=a=>{var t=a&&a.__esModule?()=>a["default"]:()=>a;return e.d(t,{a:t}),t}})(),(()=>{var a,t=Object.getPrototypeOf?a=>Object.getPrototypeOf(a):a=>a.__proto__;e.t=function(o,i){if(1&i&&(o=this(o)),8&i)return o;if("object"===typeof o&&o){if(4&i&&o.__esModule)return o;if(16&i&&"function"===typeof o.then)return o}var s=Object.create(null);e.r(s);var r={};a=a||[null,t({}),t([]),t(t)];for(var n=2&i&&o;"object"==typeof n&&!~a.indexOf(n);n=t(n))Object.getOwnPropertyNames(n).forEach((a=>r[a]=()=>o[a]));return r["default"]=()=>o,e.d(s,r),s}})(),(()=>{e.d=(a,t)=>{for(var o in t)e.o(t,o)&&!e.o(a,o)&&Object.defineProperty(a,o,{enumerable:!0,get:t[o]})}})(),(()=>{e.f={},e.e=a=>Promise.all(Object.keys(e.f).reduce(((t,o)=>(e.f[o](a,t),t)),[]))})(),(()=>{e.u=a=>"js/"+a+"."+{125:"68e8c682",353:"7ac320c4",420:"79143310",796:"65b50ff6",828:"e23f50db",961:"15efbacc",967:"605526fb"}[a]+".js"})(),(()=>{e.miniCssF=a=>"css/"+a+"."+{796:"71a35ed3",961:"401b363e"}[a]+".css"})(),(()=>{e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"===typeof window)return window}}()})(),(()=>{e.o=(a,t)=>Object.prototype.hasOwnProperty.call(a,t)})(),(()=>{var a={},t="comprar-bem:";e.l=(o,i,s,r)=>{if(a[o])a[o].push(i);else{var n,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==o||u.getAttribute("data-webpack")==t+s){n=u;break}}n||(l=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,e.nc&&n.setAttribute("nonce",e.nc),n.setAttribute("data-webpack",t+s),n.src=o),a[o]=[i];var m=(t,e)=>{n.onerror=n.onload=null,clearTimeout(p);var i=a[o];if(delete a[o],n.parentNode&&n.parentNode.removeChild(n),i&&i.forEach((a=>a(e))),t)return t(e)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=m.bind(null,n.onerror),n.onload=m.bind(null,n.onload),l&&document.head.appendChild(n)}}})(),(()=>{e.r=a=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})}})(),(()=>{e.p="/ComprarBem/"})(),(()=>{if("undefined"!==typeof document){var a=(a,t,o,i,s)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",e.nc&&(r.nonce=e.nc);var n=e=>{if(r.onerror=r.onload=null,"load"===e.type)i();else{var o=e&&e.type,n=e&&e.target&&e.target.href||t,l=new Error("Loading CSS chunk "+a+" failed.\n("+o+": "+n+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=o,l.request=n,r.parentNode&&r.parentNode.removeChild(r),s(l)}};return r.onerror=r.onload=n,r.href=t,o?o.parentNode.insertBefore(r,o.nextSibling):document.head.appendChild(r),r},t=(a,t)=>{for(var e=document.getElementsByTagName("link"),o=0;o<e.length;o++){var i=e[o],s=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(s===a||s===t))return i}var r=document.getElementsByTagName("style");for(o=0;o<r.length;o++){i=r[o],s=i.getAttribute("data-href");if(s===a||s===t)return i}},o=o=>new Promise(((i,s)=>{var r=e.miniCssF(o),n=e.p+r;if(t(r,n))return i();a(o,n,null,i,s)})),i={524:0};e.f.miniCss=(a,t)=>{var e={796:1,961:1};i[a]?t.push(i[a]):0!==i[a]&&e[a]&&t.push(i[a]=o(a).then((()=>{i[a]=0}),(t=>{throw delete i[a],t})))}}})(),(()=>{var a={524:0};e.f.j=(t,o)=>{var i=e.o(a,t)?a[t]:void 0;if(0!==i)if(i)o.push(i[2]);else{var s=new Promise(((e,o)=>i=a[t]=[e,o]));o.push(i[2]=s);var r=e.p+e.u(t),n=new Error,l=o=>{if(e.o(a,t)&&(i=a[t],0!==i&&(a[t]=void 0),i)){var s=o&&("load"===o.type?"missing":o.type),r=o&&o.target&&o.target.src;n.message="Loading chunk "+t+" failed.\n("+s+": "+r+")",n.name="ChunkLoadError",n.type=s,n.request=r,i[1](n)}};e.l(r,l,"chunk-"+t,t)}},e.O.j=t=>0===a[t];var t=(t,o)=>{var i,s,[r,n,l]=o,c=0;if(r.some((t=>0!==a[t]))){for(i in n)e.o(n,i)&&(e.m[i]=n[i]);if(l)var d=l(e)}for(t&&t(o);c<r.length;c++)s=r[c],e.o(a,s)&&a[s]&&a[s][0](),a[s]=0;return e.O(d)},o=self["webpackChunkcomprar_bem"]=self["webpackChunkcomprar_bem"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=e.O(void 0,[504],(()=>e(1291)));o=e.O(o)})();
//# sourceMappingURL=app.516b1734.js.map