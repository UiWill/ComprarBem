"use strict";(self["webpackChunkcomprar_bem"]=self["webpackChunkcomprar_bem"]||[]).push([[7],{1007:(a,o,t)=>{t.r(o),t.d(o,{default:()=>d});var e=function(){var a=this,o=a._self._c;return o("div",{staticClass:"catalogo-publico"},["selecao"===a.etapaAtual?o("div",{staticClass:"selecao-orgao"},[o("div",{staticClass:"container"},[a._m(0),a.carregandoOrgaos?a._e():o("div",{staticClass:"orgaos-grid"},[0===a.orgaos.length?o("div",{staticClass:"no-orgaos"},[o("p",[a._v("Nenhum √≥rg√£o encontrado.")])]):a._l(a.orgaos,(function(t){return o("div",{key:t.tenant_id,staticClass:"orgao-card",on:{click:function(o){return a.selecionarOrgao(t)}}},[o("div",{staticClass:"orgao-info"},[o("h3",[a._v(a._s(t.nome_orgao||t.tenant_id))]),t.descricao?o("p",[a._v(a._s(t.descricao))]):a._e(),o("div",{staticClass:"orgao-stats"},[o("span",{staticClass:"stat"},[a._v(a._s(t.total_produtos||0)+" produtos")])])]),o("div",{staticClass:"orgao-arrow"},[a._v("‚Üí")])])}))],2),a.carregandoOrgaos?o("div",{staticClass:"loading-state"},[o("div",{staticClass:"spinner"}),o("p",[a._v("Carregando √≥rg√£os...")])]):a._e()])]):a._e(),"catalogo"===a.etapaAtual?o("div",{staticClass:"catalogo-orgao"},[o("div",{staticClass:"container"},[o("div",{staticClass:"breadcrumb"},[o("button",{staticClass:"btn-voltar",on:{click:a.voltarSelecao}},[a._v("‚Üê Voltar")]),o("span",{staticClass:"breadcrumb-text"},[a._v(a._s(a.orgaoSelecionado.nome_orgao||a.orgaoSelecionado.tenant_id))])]),o("div",{staticClass:"catalogo-header"},[o("h2",[a._v("Cat√°logo de "+a._s(a.orgaoSelecionado.nome_orgao||a.orgaoSelecionado.tenant_id))]),o("p",[a._v("Visualize os produtos padronizados e fa√ßa reclama√ß√µes")])]),o("div",{staticClass:"search-filters"},[o("div",{staticClass:"search-box"},[o("input",{directives:[{name:"model",rawName:"v-model",value:a.searchTerm,expression:"searchTerm"}],attrs:{type:"text",placeholder:"Buscar produto..."},domProps:{value:a.searchTerm},on:{input:[function(o){o.target.composing||(a.searchTerm=o.target.value)},a.filtrarProdutos]}})]),o("div",{staticClass:"filters"},[o("div",{staticClass:"categoria-filter"},[a._m(1),o("select",{directives:[{name:"model",rawName:"v-model",value:a.filtroCategoria,expression:"filtroCategoria"}],on:{change:[function(o){var t=Array.prototype.filter.call(o.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));a.filtroCategoria=o.target.multiple?t:t[0]},a.filtrarProdutos]}},[o("option",{attrs:{value:""}},[a._v("Todos os grupos")]),a._l(a.categorias,(function(t){return o("option",{key:t.id,domProps:{value:t.id}},[a._v(" "+a._s(t.nome)+" ")])}))],2)])])]),a.produtosFiltrados.length>0?o("div",{staticClass:"produtos-grid"},a._l(a.produtosFiltrados,(function(t){return o("div",{key:t.id,staticClass:"produto-card",on:{click:function(o){return a.verDetalhesProduto(t.id)}}},[o("div",{staticClass:"produto-info"},[o("h3",[a._v(a._s(t.nome))]),o("p",[o("strong",[a._v("Marca:")]),a._v(" "+a._s(t.marca))]),o("div",{staticClass:"status-marca"},[o("span",{staticClass:"status-badge",class:a.getStatusMarcaClass(t)},[a._v(a._s(a.getStatusMarca(t)))])]),o("p",[o("strong",[a._v("Modelo:")]),a._v(" "+a._s(t.modelo))]),o("p",[o("strong",[a._v("Fabricante:")]),a._v(" "+a._s(t.fabricante))])])])})),0):a.carregandoProdutos?a._e():o("div",{staticClass:"empty-state"},[o("p",[a._v("Nenhum produto encontrado.")])]),a.carregandoProdutos?o("div",{staticClass:"loading-state"},[o("div",{staticClass:"spinner"}),o("p",[a._v("Carregando produtos...")])]):a._e()])]):a._e(),a.produtoSelecionado?o("div",{staticClass:"produto-modal",on:{click:function(o){return o.target!==o.currentTarget?null:a.fecharModal.apply(null,arguments)}}},[o("div",{staticClass:"modal-content produto-detalhes-modal"},[o("div",{staticClass:"modal-header"},[o("h3",[a._v(a._s(a.produtoSelecionado.nome))]),o("button",{staticClass:"btn-close",on:{click:a.fecharModal}},[a._v("√ó")])]),o("div",{staticClass:"modal-body"},[o("div",{staticClass:"produto-detalhes"},[o("p",[o("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoSelecionado.marca))]),o("p",[o("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoSelecionado.modelo))]),o("p",[o("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoSelecionado.fabricante))]),o("p",[o("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produtoSelecionado.cnpj))]),o("p",[o("strong",[a._v("C√≥digo Material:")]),a._v(" "+a._s(a.produtoSelecionado.codigo_material))]),a.produtoSelecionado.descricao?o("p",[o("strong",[a._v("Descri√ß√£o:")]),a._v(" "+a._s(a.produtoSelecionado.descricao))]):a._e(),a.editalInfo?o("div",{staticClass:"edital-section"},[o("div",{staticClass:"edital-header",class:{active:a.showEdital},on:{click:a.toggleEdital}},[o("h4",[a._v("üìÑ Edital de Pr√©-qualifica√ß√£o")]),o("span",{staticClass:"toggle-icon"},[a._v(a._s(a.showEdital?"‚ñ≤":"‚ñº"))])]),a.showEdital?o("div",{staticClass:"edital-content"},[o("div",{staticClass:"edital-info"},[o("p",[o("strong",[a._v("N√∫mero:")]),a._v(" "+a._s(a.editalInfo.numero))]),o("p",[o("strong",[a._v("Descri√ß√£o:")]),a._v(" "+a._s(a.editalInfo.descricao))]),o("p",[o("strong",[a._v("Data de Publica√ß√£o:")]),a._v(" "+a._s(a.formatarData(a.editalInfo.data_publicacao)))]),a.editalInfo.data_limite_impugnacao?o("p",[o("strong",[a._v("Prazo para Impugna√ß√£o:")]),a._v(" "+a._s(a.formatarData(a.editalInfo.data_limite_impugnacao)))]):a._e(),o("p",[o("strong",[a._v("Status:")]),a._v(" "),o("span",{staticClass:"status-badge",class:a.getEditalStatusClass(a.editalInfo.status)},[a._v(a._s(a.getEditalStatusText(a.editalInfo.status)))])])]),a.editalInfo.pdf_convertido_url?o("div",{staticClass:"edital-actions"},[o("button",{staticClass:"btn-edital-download",on:{click:a.baixarEdital}},[a._v(" üì• Baixar Edital ")]),o("button",{staticClass:"btn-edital-view",on:{click:a.visualizarEdital}},[a._v(" üëÅÔ∏è Visualizar Edital ")])]):o("div",{staticClass:"no-documento"},[o("p",{staticClass:"text-muted"},[a._v("üìÑ Documento do edital n√£o est√° dispon√≠vel para download")]),o("p",{staticClass:"text-muted-small"},[a._v("Entre em contato com o √≥rg√£o para solicitar o documento")])])]):a._e()]):a._e(),a.avaliacoes.length>0?o("div",{staticClass:"avaliacoes-section"},[o("div",{staticClass:"avaliacoes-header",class:{active:a.showAvaliacoes},on:{click:a.toggleAvaliacoes}},[o("h4",[a._v("Avalia√ß√µes de Desempenho (RDM)")]),o("div",{staticClass:"avaliacao-summary"},[o("div",{staticClass:"stars-container"},[o("div",{staticClass:"stars"},a._l(5,(function(t){return o("span",{key:t,staticClass:"star",class:{filled:a.avaliacaoMedia>=t,half:a.avaliacaoMedia>=t-.5&&a.avaliacaoMedia<t}},[a._v("‚òÖ")])})),0),o("span",{staticClass:"rating-number"},[a._v(a._s(a.avaliacaoMedia))]),o("span",{staticClass:"rating-count"},[a._v("("+a._s(a.avaliacoes.length)+" avalia√ß√µes)")])]),o("span",{staticClass:"toggle-icon"},[a._v(a._s(a.showAvaliacoes?"‚ñ≤":"‚ñº"))])])]),a.showAvaliacoes?o("div",{staticClass:"avaliacoes-content"},[o("div",{staticClass:"avaliacoes-list"},a._l(a.avaliacoes,(function(t,e){return o("div",{key:e,staticClass:"avaliacao-item"},[o("div",{staticClass:"avaliacao-header-item"},[o("span",{staticClass:"avaliacao-tipo",class:t.tipo.toLowerCase()},[a._v(" "+a._s(t.tipo)+" ")]),o("div",{staticClass:"avaliacao-stars"},a._l(5,(function(e){return o("span",{key:e,staticClass:"star",class:{filled:t.avaliacao>=e}},[a._v("‚òÖ")])})),0)]),t.comentario?o("div",{staticClass:"avaliacao-comentario"},[a._v(" "+a._s(t.comentario)+" ")]):a._e(),o("div",{staticClass:"avaliacao-footer"},[o("span",{staticClass:"avaliador"},[a._v(a._s(t.avaliador))]),o("span",{staticClass:"avaliacao-data"},[a._v(a._s(a.formatarData(t.data)))])])])})),0)]):a._e()]):a._e(),o("div",{staticClass:"avaliacoes-usuarios-section"},[o("div",{staticClass:"section-header",on:{click:a.toggleAvaliacoesUsuarios}},[o("div",{staticClass:"section-title-row"},[o("h4",[a._v("Avalia√ß√µes de Usu√°rios")]),o("div",{staticClass:"section-info"},[a.reclamacoes.length>0?o("span",{staticClass:"count-badge"},[a._v(a._s(a.reclamacoes.length)+" avalia√ß√µes")]):a._e(),o("span",{staticClass:"toggle-icon"},[a._v(a._s(a.showAvaliacoesUsuarios?"‚ñ≤":"‚ñº"))])])])]),a.showAvaliacoesUsuarios?o("div",{staticClass:"avaliacoes-usuarios-content"},[0===a.reclamacoes.length?o("div",{staticClass:"no-content"},[a._v(" Nenhuma avalia√ß√£o registrada para este produto ")]):o("div",{staticClass:"avaliacoes-usuarios-list"},a._l(a.reclamacoesSorted,(function(t){return o("div",{key:t.id,staticClass:"avaliacao-usuario-item"},[o("div",{staticClass:"avaliacao-usuario-header"},[o("div",{staticClass:"avaliacao-usuario-info"},[o("span",{staticClass:"badge-status",class:a.getStatusBadgeClass(t.status)},[a._v(a._s(a.getStatusText(t.status)))]),o("span",{staticClass:"avaliador-nome"},[a._v(a._s(t.nome_reclamante))]),t.unidade_setor?o("span",{staticClass:"avaliador-setor"},[a._v(a._s(t.unidade_setor))]):a._e()]),o("span",{staticClass:"avaliacao-usuario-data"},[a._v(a._s(a.formatDate(t.data_reclamacao)))])]),o("div",{staticClass:"avaliacao-usuario-content"},[o("div",{staticClass:"comentario-box"},[o("h6",{staticClass:"box-title"},[a._v("Coment√°rio/Avalia√ß√£o:")]),o("p",{staticClass:"box-text"},[a._v(a._s(t.registro_reclamacao))])]),t.sugestoes?o("div",{staticClass:"sugestao-box"},[o("h6",{staticClass:"box-title"},[a._v("Sugest√µes de Melhoria:")]),o("p",{staticClass:"box-text"},[a._v(a._s(t.sugestoes))])]):a._e(),t.providencias_cpm?o("div",{staticClass:"resposta-box"},[o("h6",{staticClass:"box-title"},[a._v("Resposta da CPM:")]),o("p",{staticClass:"box-text"},[a._v(a._s(t.providencias_cpm))])]):a._e()])])})),0)]):a._e()]),o("div",{staticClass:"avaliacao-action"},[o("button",{staticClass:"btn-avaliacao",on:{click:a.abrirFormularioReclamacao}},[a._v(" üìù Avaliar este Produto ")])])])])])]):a._e(),a.mostrarFormReclamacao?o("div",{staticClass:"modal-overlay",on:{click:a.fecharFormularioReclamacao}},[o("div",{staticClass:"modal-content form-reclamacao-modal",on:{click:function(a){a.stopPropagation()}}},[o("div",{staticClass:"modal-header"},[o("h3",[a._v("Nova Avalia√ß√£o do Produto")]),o("button",{staticClass:"btn-close",on:{click:a.fecharFormularioReclamacao}},[a._v("√ó")])]),o("div",{staticClass:"modal-body"},[o("form",{on:{submit:function(o){return o.preventDefault(),a.salvarReclamacao.apply(null,arguments)}}},[o("div",{staticClass:"produto-info-display"},[o("h4",[a._v("Produto Selecionado:")]),o("p",[o("strong",[a._v(a._s(a.produtoSelecionado?.nome))]),a._v(" - "+a._s(a.produtoSelecionado?.marca)+" "+a._s(a.produtoSelecionado?.modelo))])]),o("div",{staticClass:"form-row"},[o("div",{staticClass:"form-group"},[o("label",{attrs:{for:"nomeReclamante"}},[a._v("Nome Completo *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.nome_reclamante,expression:"novaReclamacao.nome_reclamante"}],attrs:{id:"nomeReclamante",type:"text",required:"",placeholder:"Digite seu nome completo"},domProps:{value:a.novaReclamacao.nome_reclamante},on:{input:function(o){o.target.composing||a.$set(a.novaReclamacao,"nome_reclamante",o.target.value)}}})]),o("div",{staticClass:"form-group"},[o("label",{attrs:{for:"telefoneContato"}},[a._v("Telefone para Contato")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.telefone_contato,expression:"novaReclamacao.telefone_contato"}],attrs:{id:"telefoneContato",type:"tel",placeholder:"(00) 00000-0000"},domProps:{value:a.novaReclamacao.telefone_contato},on:{input:function(o){o.target.composing||a.$set(a.novaReclamacao,"telefone_contato",o.target.value)}}})])]),o("div",{staticClass:"form-row"},[o("div",{staticClass:"form-group"},[o("label",{attrs:{for:"emailContato"}},[a._v("E-mail para Contato *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.email_contato,expression:"novaReclamacao.email_contato"}],attrs:{id:"emailContato",type:"email",required:"",placeholder:"seu@email.com"},domProps:{value:a.novaReclamacao.email_contato},on:{input:function(o){o.target.composing||a.$set(a.novaReclamacao,"email_contato",o.target.value)}}})]),o("div",{staticClass:"form-group"},[o("label",{attrs:{for:"unidadeSetor"}},[a._v("Unidade Administrativa / Setor")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.unidade_setor,expression:"novaReclamacao.unidade_setor"}],attrs:{id:"unidadeSetor",type:"text",placeholder:"Departamento, Setor ou Unidade"},domProps:{value:a.novaReclamacao.unidade_setor},on:{input:function(o){o.target.composing||a.$set(a.novaReclamacao,"unidade_setor",o.target.value)}}})])]),o("div",{staticClass:"form-group"},[o("label",{attrs:{for:"registroReclamacao"}},[a._v("Sua Avalia√ß√£o do Produto *")]),o("textarea",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.registro_reclamacao,expression:"novaReclamacao.registro_reclamacao"}],attrs:{id:"registroReclamacao",rows:"4",required:"",placeholder:"Compartilhe sua experi√™ncia com este produto. Pode ser um elogio, cr√≠tica, problema encontrado ou qualquer feedback relevante..."},domProps:{value:a.novaReclamacao.registro_reclamacao},on:{input:function(o){o.target.composing||a.$set(a.novaReclamacao,"registro_reclamacao",o.target.value)}}})]),o("div",{staticClass:"form-group"},[o("label",{attrs:{for:"sugestoes"}},[a._v("Sugest√µes de Melhoria (Opcional)")]),o("textarea",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.sugestoes,expression:"novaReclamacao.sugestoes"}],attrs:{id:"sugestoes",rows:"3",placeholder:"Sugest√µes para melhoria do produto, processo ou qualquer recomenda√ß√£o..."},domProps:{value:a.novaReclamacao.sugestoes},on:{input:function(o){o.target.composing||a.$set(a.novaReclamacao,"sugestoes",o.target.value)}}})])])]),o("div",{staticClass:"modal-footer"},[o("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:a.fecharFormularioReclamacao}},[a._v(" Cancelar ")]),o("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:a.salvandoReclamacao},on:{click:a.salvarReclamacao}},[a.salvandoReclamacao?o("span",{staticClass:"spinner"}):a._e(),a._v(" "+a._s(a.salvandoReclamacao?"Enviando...":"Enviar Avalia√ß√£o")+" ")])])])]):a._e()])},s=[function(){var a=this,o=a._self._c;return o("div",{staticClass:"header-section"},[o("h1",[a._v("Cat√°logo Eletr√¥nico de Bens Padronizados")]),o("p",{staticClass:"subtitle"},[a._v("Selecione o √≥rg√£o para visualizar o cat√°logo e fazer reclama√ß√µes")])])},function(){var a=this,o=a._self._c;return o("label",[o("strong",[a._v("Grupo:")])])}],r=t(452);const i={name:"CatalogoPublico",data(){return{etapaAtual:"selecao",orgaos:[],orgaoSelecionado:null,carregandoOrgaos:!0,carregandoProdutos:!1,produtos:[],produtosFiltrados:[],categorias:[],searchTerm:"",filtroCategoria:"",produtoSelecionado:null,mostrarFormReclamacao:!1,salvandoReclamacao:!1,avaliacoes:[],avaliacaoMedia:0,reclamacoes:[],showAvaliacoes:!1,showAvaliacoesUsuarios:!1,produtosDespadronizados:[],editalInfo:null,showEdital:!1,novaReclamacao:{nome_reclamante:"",telefone_contato:"",email_contato:"",unidade_setor:"",nome_material:"",codigo_material:"",marca_modelo:"",registro_reclamacao:"",sugestoes:""}}},async created(){await this.carregarOrgaos()},methods:{async carregarOrgaos(){try{this.carregandoOrgaos=!0;let{data:o,error:t}=await r.ND.from("produtos").select("tenant_id").in("status",["aprovado","despadronizado","julgado_aprovado","julgado_reprovado"]);if(t&&(t.message.includes("RLS")||t.message.includes("permission")||t.message.includes("policy"))){console.log("Tentando buscar √≥rg√£os da tabela tenants devido a erro RLS:",t.message);const{data:o,error:e}=await r.ND.from("tenants").select("id, nome").eq("ativo",!0);if(e)return console.error("Erro ao carregar tenants:",e),void(this.orgaos=[{tenant_id:"demo-orgao-1",nome_orgao:"Secretaria de Sa√∫de - Demo",total_produtos:50},{tenant_id:"demo-orgao-2",nome_orgao:"Secretaria de Educa√ß√£o - Demo",total_produtos:30}]);this.orgaos=o.map((a=>({tenant_id:a.id,nome_orgao:a.nome||a.id,total_produtos:0})));for(let t of this.orgaos)try{const{data:a}=await r.ND.from("produtos").select("id",{count:"exact"}).eq("tenant_id",t.tenant_id).eq("status","aprovado");t.total_produtos=a?.length||0}catch(a){t.total_produtos=Math.floor(50*Math.random())+10}return}if(t)return void console.error("Erro ao carregar √≥rg√£os:",t);const e={};o.forEach((a=>{e[a.tenant_id]||(e[a.tenant_id]={tenant_id:a.tenant_id,nome_orgao:a.tenant_id,total_produtos:0}),e[a.tenant_id].total_produtos++})),this.orgaos=Object.values(e);for(let s of this.orgaos)try{const{data:a}=await r.ND.from("tenants").select("nome").eq("id",s.tenant_id).limit(1);if(a&&a.length>0)s.nome_orgao=a[0].nome||s.tenant_id;else{const{data:a}=await r.ND.from("usuarios").select("nome").eq("tenant_id",s.tenant_id).limit(1);a&&a.length>0&&(s.nome_orgao=a[0].nome||s.tenant_id)}}catch(a){console.log("N√£o foi poss√≠vel carregar nome do √≥rg√£o:",s.tenant_id)}}catch(o){console.error("Erro ao carregar √≥rg√£os:",o),this.orgaos=[{tenant_id:"demo-publico",nome_orgao:"√ìrg√£o P√∫blico Demo",total_produtos:25}]}finally{this.carregandoOrgaos=!1}},async selecionarOrgao(a){this.orgaoSelecionado=a,this.etapaAtual="catalogo",await this.carregarProdutosOrgao(a.tenant_id)},async carregarProdutosOrgao(a){try{this.carregandoProdutos=!0;const{data:o,error:t}=await r.ND.from("produtos").select("*").eq("tenant_id",a).in("status",["aprovado","despadronizado","julgado_aprovado","julgado_reprovado"]);t?(console.error("Erro ao carregar produtos:",t),t.message.includes("RLS")||t.message.includes("permission")||t.message.includes("policy")?(console.log("Usando dados demo devido a erro RLS:",t.message),this.produtos=[{id:"demo-1",nome:"Produto Demo 1",marca:"Marca Demo",modelo:"Modelo A",fabricante:"Fabricante Demo Ltda",codigo_material:"DEMO001",categoria_id:"cat-demo",validade_dcb:new Date(Date.now()+31536e6).toISOString(),status:"aprovado"},{id:"demo-2",nome:"Produto Demo 2",marca:"Marca Demo 2",modelo:"Modelo B",fabricante:"Fabricante Demo 2 Ltda",codigo_material:"DEMO002",categoria_id:"cat-demo",validade_dcb:new Date(Date.now()+15552e6).toISOString(),status:"aprovado"}]):this.produtos=[]):this.produtos=o||[],await this.carregarProdutosDespadronizados(a);const{data:e,error:s}=await r.ND.from("categorias").select("*");s?(console.error("Erro ao carregar categorias:",s),this.categorias=[{id:"cat-demo",nome:"Categoria Demo"},{id:"cat-demo-2",nome:"Outra Categoria Demo"}]):this.categorias=e||[],this.filtrarProdutos()}catch(o){console.error("Erro ao carregar dados do √≥rg√£o:",o),this.produtos=[{id:"fallback-1",nome:"Produto P√∫blico Demo",marca:"Marca P√∫blica",modelo:"Modelo Demo",fabricante:"Fabricante P√∫blico Ltda",codigo_material:"PUB001",categoria_id:"cat-pub",validade_dcb:new Date(Date.now()+2592e7).toISOString(),status:"aprovado"}],this.categorias=[{id:"cat-pub",nome:"Categoria P√∫blica"}],this.filtrarProdutos()}finally{this.carregandoProdutos=!1}},async carregarProdutosDespadronizados(a){try{console.log("Carregando produtos despadronizados para tenant:",a);const{data:o,error:t}=await r.ND.from("marcas_despadronizadas").select("produto_id").eq("tenant_id",a).eq("status_atual","ativa");t?(console.error("Erro ao carregar produtos despadronizados:",t),this.produtosDespadronizados=[]):(this.produtosDespadronizados=(o||[]).filter((a=>a.produto_id)).map((a=>a.produto_id)),console.log(`${this.produtosDespadronizados.length} produtos despadronizados encontrados:`,this.produtosDespadronizados))}catch(o){console.error("Erro ao carregar produtos despadronizados:",o),this.produtosDespadronizados=[]}},filtrarProdutos(){this.produtosFiltrados=this.produtos.filter((a=>{const o=!this.filtroCategoria||a.categoria_id===this.filtroCategoria,t=!this.searchTerm||a.nome.toLowerCase().includes(this.searchTerm.toLowerCase())||a.descricao&&a.descricao.toLowerCase().includes(this.searchTerm.toLowerCase());return o&&t}))},voltarSelecao(){this.etapaAtual="selecao",this.orgaoSelecionado=null,this.produtos=[],this.produtosFiltrados=[],this.categorias=[],this.searchTerm="",this.filtroCategoria=""},async verDetalhesProduto(a){const o=this.produtos.find((o=>o.id===a));o&&(this.produtoSelecionado=o,await Promise.all([this.carregarAvaliacoes(a),this.carregarReclamacoes(o),this.carregarEdital(o)]))},fecharModal(){this.produtoSelecionado=null,this.avaliacoes=[],this.avaliacaoMedia=0,this.reclamacoes=[],this.showAvaliacoes=!1,this.showAvaliacoesUsuarios=!1,this.editalInfo=null,this.showEdital=!1},async carregarAvaliacoes(a){try{this.avaliacoes=[],this.avaliacaoMedia=0}catch(o){console.error("Erro ao carregar avalia√ß√µes:",o),this.avaliacoes=[],this.avaliacaoMedia=0}},async carregarReclamacoes(a){try{if(!a?.codigo_material)return void(this.reclamacoes=[]);const{data:o,error:t}=await r.ND.from("reclamacoes_usuarios").select("*").eq("codigo_material",a.codigo_material).order("data_reclamacao",{ascending:!1});if(t)throw console.error("Erro ao carregar reclama√ß√µes:",t),t;this.reclamacoes=o||[]}catch(o){console.error("Erro ao carregar reclama√ß√µes:",o),this.reclamacoes=[]}},toggleAvaliacoes(){this.showAvaliacoes=!this.showAvaliacoes},toggleAvaliacoesUsuarios(){this.showAvaliacoesUsuarios=!this.showAvaliacoesUsuarios},abrirFormularioReclamacao(){this.mostrarFormReclamacao=!0,this.produtoSelecionado&&(this.novaReclamacao.nome_material=this.produtoSelecionado.nome,this.novaReclamacao.codigo_material=this.produtoSelecionado.codigo_material||"",this.novaReclamacao.marca_modelo=`${this.produtoSelecionado.marca} - ${this.produtoSelecionado.modelo}`)},fecharFormularioReclamacao(){this.mostrarFormReclamacao=!1,this.novaReclamacao={nome_reclamante:"",telefone_contato:"",email_contato:"",unidade_setor:"",nome_material:"",codigo_material:"",marca_modelo:"",registro_reclamacao:"",sugestoes:""}},async salvarReclamacao(){if(this.novaReclamacao.nome_reclamante&&this.novaReclamacao.email_contato&&this.novaReclamacao.registro_reclamacao){this.salvandoReclamacao=!0;try{const a={...this.novaReclamacao,data_reclamacao:(new Date).toISOString(),status:"ABERTA",orgao_id:this.orgaoSelecionado.tenant_id},{data:o,error:t}=await r.ND.from("reclamacoes_usuarios").insert([a]).select().single();if(t)throw console.error("Erro ao salvar reclama√ß√£o:",t),t;alert("Avalia√ß√£o enviada com sucesso! Obrigado pelo seu feedback."),this.fecharFormularioReclamacao(),this.fecharModal()}catch(a){console.error("Erro ao salvar reclama√ß√£o:",a),alert("Ocorreu um erro ao enviar sua avalia√ß√£o. Tente novamente.")}finally{this.salvandoReclamacao=!1}}else alert("Por favor, preencha os campos: Nome Completo, E-mail e Sua Avalia√ß√£o do Produto.")},getStatusMarca(a){if(this.produtosDespadronizados.includes(a.id))return"Despadronizado";if(!0===a.processo_cancelamento)return"Em Processo de Cancelamento";if(!a.validade_dcb)return"Aguardando DCB";const o=new Date,t=new Date(a.validade_dcb);return t<o?"Vencido":"Em Vigor"},getStatusMarcaClass(a){const o=this.getStatusMarca(a);switch(o){case"Em Vigor":return"status-em-vigor";case"Vencido":return"status-vencido";case"Despadronizado":return"status-despadronizado";case"Aguardando DCB":return"status-aguardando-dcb";case"Em Processo de Cancelamento":return"status-cancelamento";default:return"status-despadronizado"}},formatarData(a){if(!a)return"Data n√£o dispon√≠vel";try{const o=new Date(a);return o.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(o){return console.error("Erro ao formatar data:",o),"Data inv√°lida"}},formatDate(a){return a?new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""},getStatusBadgeClass(a){const o={ABERTA:"badge-warning",EM_ANALISE:"badge-info",RESOLVIDA:"badge-success",REJEITADA:"badge-danger"};return o[a]||"badge-secondary"},getStatusText(a){const o={ABERTA:"Aberta",EM_ANALISE:"Em An√°lise",RESOLVIDA:"Resolvida",REJEITADA:"Rejeitada"};return o[a]||a},async carregarEdital(a){try{if(console.log("=== DEBUG EDITAL ==="),console.log("Produto:",a),console.log("Produto.edital_id:",a.edital_id),console.log("Produto.edital_prequalificacao:",a.edital_prequalificacao),!a.edital_id)return console.log("N√£o tem edital_id, verificando edital_prequalificacao..."),void(a.edital_prequalificacao?(console.log("Usando edital_prequalificacao"),this.editalInfo={numero:"N/A",descricao:a.edital_prequalificacao,data_publicacao:null,data_limite_impugnacao:null,status:"PUBLICADO",pdf_convertido_url:null}):(console.log("Nenhuma informa√ß√£o de edital encontrada"),this.editalInfo=null));console.log("Buscando edital na tabela editais com ID:",a.edital_id);const{data:o,error:t}=await r.ND.from("editais").select("*").eq("id",a.edital_id).single();if(t)return console.error("Erro ao carregar edital:",t),void(a.edital_prequalificacao?(console.log("Erro na consulta, usando edital_prequalificacao como fallback"),this.editalInfo={numero:"N/A",descricao:a.edital_prequalificacao,data_publicacao:null,data_limite_impugnacao:null,status:"PUBLICADO",pdf_convertido_url:null}):this.editalInfo=null);console.log("Edital carregado com sucesso:",o),console.log("URL do documento:",o.pdf_convertido_url),this.editalInfo=o}catch(o){console.error("Erro ao carregar edital:",o),a.edital_prequalificacao?(console.log("Exce√ß√£o, usando edital_prequalificacao como fallback"),this.editalInfo={numero:"N/A",descricao:a.edital_prequalificacao,data_publicacao:null,data_limite_impugnacao:null,status:"PUBLICADO",url_documento:null}):this.editalInfo=null}},toggleEdital(){this.showEdital=!this.showEdital},baixarEdital(){if(this.editalInfo?.pdf_convertido_url){const a=document.createElement("a");a.href=this.editalInfo.pdf_convertido_url,a.download=`Edital_${this.editalInfo.numero.replace(/\//g,"_")}.pdf`,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}else alert("Documento do edital n√£o dispon√≠vel para download.")},visualizarEdital(){this.editalInfo?.pdf_convertido_url?window.open(this.editalInfo.pdf_convertido_url,"_blank"):alert("Documento do edital n√£o dispon√≠vel para visualiza√ß√£o.")},getEditalStatusClass(a){const o={RASCUNHO:"status-rascunho",PUBLICADO:"status-publicado",CANCELADO:"status-cancelado"};return o[a]||"status-default"},getEditalStatusText(a){const o={RASCUNHO:"Rascunho",PUBLICADO:"Publicado",CANCELADO:"Cancelado"};return o[a]||a}},computed:{reclamacoesSorted(){return[...this.reclamacoes].sort(((a,o)=>new Date(o.data_reclamacao)-new Date(a.data_reclamacao)))}}},l=i;var c=t(1656),n=(0,c.A)(l,e,s,!1,null,"654fed84",null);const d=n.exports}}]);
//# sourceMappingURL=7.0f9a787e.js.map