"use strict";(self["webpackChunkcomprar_bem"]=self["webpackChunkcomprar_bem"]||[]).push([[130],{4130:(t,n,e)=>{e.d(n,{convertWordToPdf:()=>i});class o{constructor(){this.docxConverter=null,this.pdfLib=null,this.mammoth=null,this.jsPDF=null,this.html2canvas=null}async convertWordToPdf(t,n="documento"){console.log("üéØ === CONVERS√ÉO WORD ‚Üí PDF PRESERVANDO 100% LAYOUT ==="),console.log("üìÑ Arquivo:",t);const e=[{name:"CloudConvert API",fn:()=>this.convertUsingCloudConvert(t,n)},{name:"Docx2PDF Premium",fn:()=>this.convertUsingDocx2Pdf(t,n)},{name:"LibreOffice API",fn:()=>this.convertUsingLibreOffice(t,n)},{name:"PDFLib Direct",fn:()=>this.convertUsingPDFLib(t,n)},{name:"Word Web API",fn:()=>this.convertUsingWordAPI(t,n)},{name:"Mammoth Optimized",fn:()=>this.convertUsingMammothOptimized(t,n)}];for(const a of e)try{console.log(`üîÑ Tentando m√©todo: ${a.name}`);const t=await a.fn();if(t&&t.blob)return console.log(`‚úÖ Sucesso com m√©todo: ${a.name}`),t}catch(o){console.warn(`‚ö†Ô∏è M√©todo ${a.name} falhou:`,o.message);continue}return console.log("üîÑ Usando fallback simples..."),await this.createFallbackPdf(n)}async convertUsingPDFLib(t,n){try{console.log("üìö Carregando PDF-lib...");const e=await Promise.resolve().then((function(){var t=new Error("Cannot find module 'pdf-lib'");throw t.code="MODULE_NOT_FOUND",t}));this.pdfLib=e;const o=await fetch(t),a=await o.arrayBuffer(),i=this.detectFileType(a);if("docx"===i)return await this.convertDocxDirectly(a,n);throw new Error("Arquivo n√£o √© DOCX v√°lido")}catch(e){throw new Error(`PDF-lib falhou: ${e.message}`)}}async convertUsingLibreOffice(t,n){try{console.log("üîÑ Tentando LibreOffice/OnlyOffice API...");const e=this.getLibreOfficeUrl();if(!e)throw new Error("LibreOffice API n√£o dispon√≠vel");const o=new FormData,a=await fetch(t),i=await a.blob();o.append("file",i,`${n}.docx`);const r=await fetch(`${e}/convert/pdf`,{method:"POST",body:o});if(!r.ok)throw new Error("Falha na convers√£o LibreOffice");const l=await r.blob();return{blob:l,fileName:`${n}_LibreOffice.pdf`}}catch(e){throw new Error(`LibreOffice falhou: ${e.message}`)}}async convertUsingCloudConvert(t,n){try{console.log("üîÑ Tentando CloudConvert API...");const e=this.getCloudConvertApiKey();if(!e)throw new Error("CloudConvert API Key n√£o configurada");console.log("üîë API Key length:",e.length),console.log("üîë API Key starts with:",e.substring(0,20)+"..."),console.log("üß™ Testando API key...");const o=await fetch("https://api.cloudconvert.com/v2/users/me",{headers:{Authorization:`Bearer ${e}`}});if(!o.ok){const t=await o.text();throw console.error("‚ùå API Key inv√°lida:",o.status,t),new Error(`API Key CloudConvert inv√°lida: ${o.status}`)}const a=await o.json();console.log("‚úÖ API Key v√°lida!"),console.log("üë§ Usu√°rio:",a.data?.email||"N/A"),console.log("üí≥ Plano:",a.data?.subscription?.plan||"Free"),console.log("üîÑ Convers√µes usadas este m√™s:",a.data?.subscription?.usage?.conversions||0),console.log("üìä Limite mensal:",a.data?.subscription?.limits?.conversions||25);const i=await fetch(t),r=await i.arrayBuffer(),l=new Blob([r]),s=await fetch("https://api.cloudconvert.com/v2/jobs",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({tasks:{"import-file":{operation:"import/upload"},"convert-file":{operation:"convert",input:"import-file",input_format:"docx",output_format:"pdf",options:{pdf_a:!1,page_range:"1-",margin_top:20,margin_bottom:20,margin_left:20,margin_right:20}},"export-file":{operation:"export/url",input:"convert-file"}}})});if(!s.ok){const t=await s.text();throw console.error("‚ùå CloudConvert job creation failed:",{status:s.status,statusText:s.statusText,error:t}),new Error(`Erro ao criar job CloudConvert: ${s.status} - ${t}`)}const m=await s.json(),d=m.data.tasks.find((t=>"import-file"===t.name)),p=d.result.form,c=new FormData;Object.keys(p.parameters).forEach((t=>{c.append(t,p.parameters[t])})),c.append("file",l,`${n}.docx`),await fetch(p.url,{method:"POST",body:c});let g=m.data;while("finished"!==g.status&&"error"!==g.status){await new Promise((t=>setTimeout(t,2e3)));const t=await fetch(`https://api.cloudconvert.com/v2/jobs/${m.data.id}`,{headers:{Authorization:`Bearer ${e}`}});g=(await t.json()).data}if("error"===g.status)throw new Error("Erro na convers√£o CloudConvert");const h=g.tasks.find((t=>"export-file"===t.name)),u=h.result.files[0].url,b=await fetch(u),f=await b.blob();return{blob:f,fileName:`${n}_CloudConvert.pdf`}}catch(e){throw new Error(`CloudConvert falhou: ${e.message}`)}}async convertUsingWordAPI(t,n){try{console.log("üîÑ Tentando Word Web API...");const n=this.getMicrosoftApiKey();if(!n)throw new Error("Microsoft API Key n√£o encontrada");const e=await fetch(t);await e.arrayBuffer();throw new Error("Word API n√£o implementada ainda")}catch(e){throw new Error(`Word API falhou: ${e.message}`)}}async convertUsingMammothOptimized(t,n){try{console.log("üîÑ Usando Mammoth otimizado..."),await this.loadLibraries();const e=await fetch(t),o=await e.arrayBuffer(),a={styleMap:["p[style-name='Normal'] => p.normal","p[style-name='Title'] => h1.title","p[style-name='Heading 1'] => h1.heading1","p[style-name='Heading 2'] => h2.heading2","p[style-name='Heading 3'] => h3.heading3","p[style-name='Subtitle'] => p.subtitle","p[style-name='Quote'] => blockquote.quote","p[style-name='List Paragraph'] => ul > li.list-item","r[style-name='Strong'] => strong.bold","r[style-name='Emphasis'] => em.italic","table => table.word-table","tr => tr.table-row","td => td.table-cell","th => th.table-header"],includeDefaultStyleMap:!0,includeEmbeddedStyleMap:!0,preserveEmptyParagraphs:!0,convertImage:this.mammoth.images.imgElement((function(t){return t.read("base64").then((function(n){return{src:"data:"+t.contentType+";base64,"+n,style:"max-width: 100%; height: auto;"}}))}))},i=await this.mammoth.convertToHtml({arrayBuffer:o},a);if(!i.value||i.value.length<50)throw new Error("Conte√∫do HTML extra√≠do insuficiente");const r=this.prepareHtmlForMaxFidelity(i.value),l=await this.renderHtmlToImageOptimized(r),s=await this.createPdfFromImageOptimized(l);return{blob:s,fileName:`${n}_Optimized.pdf`}}catch(e){throw new Error(`Mammoth otimizado falhou: ${e.message}`)}}async loadLibraries(){try{if(this.mammoth&&this.jsPDF&&this.html2canvas)return;console.log("üìö Carregando bibliotecas...");const[t,n,o]=await Promise.all([e.e(208).then(e.t.bind(e,1208,19)),Promise.resolve().then(e.bind(e,1749)),e.e(125).then(e.t.bind(e,2125,23))]);this.mammoth=t,this.jsPDF=n.jsPDF||n.default,this.html2canvas=o.default,console.log("‚úÖ Bibliotecas b√°sicas carregadas")}catch(t){throw new Error(`Erro ao carregar bibliotecas: ${t.message}`)}}detectFileType(t){const n=new Uint8Array(t.slice(0,4));return 80===n[0]&&75===n[1]?"docx":208===n[0]&&207===n[1]?"doc":"unknown"}async convertDocxDirectly(t,n){throw new Error("Convers√£o direta DOCX ainda n√£o implementada")}getLibreOfficeUrl(){return{NODE_ENV:"production",BASE_URL:"/ComprarBem/"}.LIBREOFFICE_API_URL||localStorage.getItem("libreoffice_api_url")||null}getMicrosoftApiKey(){return{NODE_ENV:"production",BASE_URL:"/ComprarBem/"}.MICROSOFT_API_KEY||localStorage.getItem("microsoft_api_key")||null}getCloudConvertApiKey(){const t="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiIxIiwianRpIjoiZDQ1ZjZiMzhkYzFkMzFiNmIyMDUzZDIyOTlkMzZjOGEzZjZhN2Q1MGM1NDk0ZjkyMTUxNmRiZjdlMjUwYzEwZDc0MzgzYzViYjBlZDNlMTMiLCJpYXQiOjE3NTI0MTYzMTguMTc4ODc3LCJuYmYiOjE3NTI0MTYzMTguMTc4ODc4LCJleHAiOjQ5MDgwODk5MTguMTc0NjI3LCJzdWIiOiI3MjQyMjkzOSIsInNjb3BlcyI6WyJ1c2VyLnJlYWQiLCJ1c2VyLndyaXRlIiwidGFzay5yZWFkIiwidGFzay53cml0ZSIsIndlYmhvb2sucmVhZCIsIndlYmhvb2sud3JpdGUiLCJwcmVzZXQucmVhZCIsInByZXNldC53cml0ZSJdfQ.rblTb7A65oxXQlsIzgz2Qa8xW-FzwvNNWFwV0zvh3qlHdW9Bg4reHADfAKh-yLzRSpEw-_sO_5HHi3SmNEweG_gc001PE_O9nuRl8pdQiE25GRerfc6H3ZnfBKlJIcMhhADEIlHyHdcz9CTWRPSQttMwjIXi2GVajgijrpY3kLyEbdMgZFRM_Yfej3TGyRM14Da-XzTx0ya0oXX1JmIVPihNgf87MwnvpdI6gItIp0fNYVhhCwH6KPzCIh21c4VP6WMWmMLpcpdtRTy1h24J0JOXBmESzX-Ju4wO61PLhgQmATdzdQsKBgTC51iwwJZZblgCIaEycJJz6OZ_KJqlE-dlvmqrUH0xJdXRf-G6OmJ5rauRKe5hR2eb7Di4ktNO8PSZ9ULf_1Ko7apsulZTiMbDc6Anbi_SFjACjtjcLzYMTWjGVGl8nGwQcOI5woZVgtkHKZe7yWFKgk-7EmdK7Kcj1OVEzwpoRqKUp9KcMAwi8Qaq9-1w-zcWsPnSjCKJM94-WMvbDajujNVKJbQa8EKgZTPdjX0yp6wljYXEBdpnOY57WUj9qUnZce2YWZ4G4_MqtNpHOBmobA8ldv8WqU8-dhEGXy3aGyPy28otuunUwQ8SSKAC9qf2k4-dKgCT6dt72Ssa1aauZmwUWvJm7Qk9jvXyE6on6nbced-qcoc";return{NODE_ENV:"production",BASE_URL:"/ComprarBem/"}.CLOUDCONVERT_API_KEY||localStorage.getItem("cloudconvert_api_key")||t||null}prepareHtmlForMaxFidelity(t){console.log("üé® Preparando HTML para m√°xima fidelidade...");const n=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset="utf-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <style>\n          /* CSS ultra-otimizado para fidelidade 100% */\n          * {\n            box-sizing: border-box !important;\n            margin: 0 !important;\n            padding: 0 !important;\n          }\n          \n          html, body {\n            width: 210mm !important;\n            min-height: 297mm !important;\n            font-family: 'Times New Roman', 'Liberation Serif', serif !important;\n            font-size: 12pt !important;\n            line-height: 1.15 !important;\n            color: #000000 !important;\n            background: #ffffff !important;\n            -webkit-print-color-adjust: exact !important;\n            print-color-adjust: exact !important;\n            overflow: visible !important;\n          }\n          \n          body {\n            padding: 25.4mm 20mm !important; /* Margens A4 padr√£o */\n            width: 210mm !important;\n            min-height: 297mm !important;\n            background: white !important;\n            display: block !important;\n            visibility: visible !important;\n          }\n          \n          /* Par√°grafos com espa√ßamento Word */\n          p, p.normal {\n            margin: 0 0 6pt 0 !important;\n            padding: 0 !important;\n            text-align: justify !important;\n            text-justify: inter-word !important;\n            color: #000000 !important;\n            background: transparent !important;\n            font-size: 12pt !important;\n            line-height: 1.15 !important;\n            orphans: 2 !important;\n            widows: 2 !important;\n          }\n          \n          /* T√≠tulos com formata√ß√£o Word exata */\n          h1.title {\n            text-align: center !important;\n            font-size: 16pt !important;\n            font-weight: bold !important;\n            margin: 0 0 12pt 0 !important;\n            page-break-after: avoid !important;\n          }\n          \n          h1.heading1 {\n            font-size: 14pt !important;\n            font-weight: bold !important;\n            margin: 12pt 0 6pt 0 !important;\n            page-break-after: avoid !important;\n          }\n          \n          h2.heading2 {\n            font-size: 13pt !important;\n            font-weight: bold !important;\n            margin: 10pt 0 6pt 0 !important;\n            page-break-after: avoid !important;\n          }\n          \n          h3.heading3 {\n            font-size: 12pt !important;\n            font-weight: bold !important;\n            margin: 8pt 0 4pt 0 !important;\n            page-break-after: avoid !important;\n          }\n          \n          p.subtitle {\n            text-align: center !important;\n            font-style: italic !important;\n            margin: 6pt 0 12pt 0 !important;\n          }\n          \n          /* Formata√ß√£o de texto */\n          strong.bold, strong, b {\n            font-weight: bold !important;\n            color: inherit !important;\n          }\n          \n          em.italic, em, i {\n            font-style: italic !important;\n            color: inherit !important;\n          }\n          \n          u {\n            text-decoration: underline !important;\n            color: inherit !important;\n          }\n          \n          /* Tabelas com bordas exatas */\n          table.word-table {\n            width: 100% !important;\n            border-collapse: collapse !important;\n            margin: 6pt 0 !important;\n            page-break-inside: avoid !important;\n            background: white !important;\n          }\n          \n          td.table-cell, th.table-header {\n            border: 1pt solid #000000 !important;\n            padding: 4pt 6pt !important;\n            vertical-align: top !important;\n            text-align: left !important;\n            background: white !important;\n            font-size: 11pt !important;\n            line-height: 1.1 !important;\n          }\n          \n          th.table-header {\n            font-weight: bold !important;\n            background-color: #f0f0f0 !important;\n            text-align: center !important;\n          }\n          \n          /* Listas com espa√ßamento Word */\n          ul {\n            margin: 6pt 0 6pt 18pt !important;\n            padding: 0 !important;\n            list-style-type: disc !important;\n          }\n          \n          ol {\n            margin: 6pt 0 6pt 18pt !important;\n            padding: 0 !important;\n            list-style-type: decimal !important;\n          }\n          \n          li.list-item, li {\n            margin: 0 0 3pt 0 !important;\n            padding: 0 !important;\n            text-align: justify !important;\n            page-break-inside: avoid !important;\n          }\n          \n          /* Cita√ß√µes */\n          blockquote.quote {\n            margin: 6pt 36pt !important;\n            padding: 0 !important;\n            font-style: italic !important;\n            text-align: justify !important;\n          }\n          \n          /* Imagens */\n          img {\n            max-width: 100% !important;\n            height: auto !important;\n            display: block !important;\n            margin: 6pt auto !important;\n          }\n          \n          /* Quebras de p√°gina */\n          .page-break {\n            page-break-before: always !important;\n            height: 0 !important;\n            margin: 0 !important;\n            padding: 0 !important;\n          }\n          \n          /* Evitar quebras √≥rf√£s */\n          p, h1, h2, h3, h4, h5, h6 {\n            page-break-inside: avoid !important;\n          }\n          \n          h1, h2, h3, h4, h5, h6 {\n            page-break-after: avoid !important;\n          }\n          \n          /* Manter listas unidas */\n          ul, ol {\n            page-break-inside: avoid !important;\n          }\n          \n          /* Espa√ßamento de linha preservado */\n          br {\n            display: block !important;\n            margin: 3pt 0 !important;\n            content: "" !important;\n          }\n          \n          /* Alinhamentos espec√≠ficos */\n          [style*="text-align: center"], .center {\n            text-align: center !important;\n          }\n          \n          [style*="text-align: right"], .right {\n            text-align: right !important;\n          }\n          \n          [style*="text-align: left"], .left {\n            text-align: left !important;\n          }\n          \n          /* Preservar cores se houver */\n          [style*="color"] {\n            color: inherit !important;\n          }\n          \n          /* Simular campos de formul√°rio */\n          ._underline {\n            border-bottom: 1pt solid #000 !important;\n            display: inline-block !important;\n            min-width: 3cm !important;\n            height: 1.2em !important;\n          }\n          \n          ._signature {\n            border-bottom: 1pt solid #000 !important;\n            display: inline-block !important;\n            width: 6cm !important;\n            height: 1.5em !important;\n            margin: 6pt 0 !important;\n          }\n        </style>\n      </head>\n      <body>\n        ${t}\n      </body>\n      </html>\n    `;return n}async renderHtmlToImageOptimized(t){try{console.log("üñºÔ∏è Renderizando HTML otimizado...");const n=document.createElement("iframe");n.style.cssText="\n        position: absolute;\n        left: -9999px;\n        top: -9999px;\n        width: 794px;  /* A4 width em 96 DPI */\n        height: 1123px; /* A4 height em 96 DPI */\n        border: none;\n        background: white;\n        visibility: hidden;\n        z-index: -1000;\n      ",document.body.appendChild(n);try{n.contentDocument.open(),n.contentDocument.write(t),n.contentDocument.close(),await new Promise((t=>{n.onload=t,setTimeout(t,3e3)}));const e=n.contentDocument.body,o=await this.html2canvas(e,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:794,height:e.scrollHeight,windowWidth:794,windowHeight:e.scrollHeight,x:0,y:0,scrollX:0,scrollY:0,foreignObjectRendering:!1,imageTimeout:3e4,removeContainer:!1,logging:!1,letterRendering:!0,onclone:t=>{t.body.style.transform="scale(1)",t.body.style.transformOrigin="top left"}});return console.log("‚úÖ Imagem otimizada renderizada:",o.width+"x"+o.height),{dataUrl:o.toDataURL("image/png",1),width:o.width,height:o.height}}finally{n&&n.parentNode&&document.body.removeChild(n)}}catch(n){throw new Error(`Erro na renderiza√ß√£o otimizada: ${n.message}`)}}async createPdfFromImageOptimized(t){try{console.log("üìÑ Criando PDF otimizado...");const n=new this.jsPDF({orientation:"portrait",unit:"mm",format:"a4",compress:!0}),e=210,o=297,a=0,i=e-2*a,r=o-2*a,l=i/(.264583*t.width),s=i,m=.264583*t.height*l,d=Math.ceil(m/r);console.log(`üìÑ Ser√° necess√°rio ${d} p√°gina(s) otimizada(s)`);for(let c=0;c<d;c++){c>0&&n.addPage();const e=c*r,o=a-e;n.addImage(t.dataUrl,"PNG",a,o,s,m,void 0,"FAST"),console.log(`‚úÖ P√°gina otimizada ${c+1}/${d}`)}const p=n.output("blob");return console.log("‚úÖ PDF otimizado criado:",p.size,"bytes"),p}catch(n){throw new Error(`Erro ao criar PDF otimizado: ${n.message}`)}}async extractHtmlFromWord(t){try{console.log("üìÑ Baixando arquivo Word...");const n=await fetch(t);if(!n.ok)throw new Error(`Erro ao baixar arquivo: ${n.status}`);const e=await n.arrayBuffer();console.log("üìÑ Arquivo baixado:",e.byteLength,"bytes");const o={styleMap:["p[style-name='Title'] => h1.title","p[style-name='Heading 1'] => h1","p[style-name='Heading 2'] => h2","p[style-name='Heading 3'] => h3","p[style-name='Subtitle'] => p.subtitle","p[style-name='Quote'] => blockquote","p[style-name='List Paragraph'] => ul > li","r[style-name='Strong'] => strong","r[style-name='Emphasis'] => em","table => table.word-table","tr => tr","td => td"],includeDefaultStyleMap:!0,includeEmbeddedStyleMap:!0,convertImage:this.mammoth.images.imgElement((function(t){return t.read("base64").then((function(n){return{src:"data:"+t.contentType+";base64,"+n}}))}))},a=await this.mammoth.convertToHtml({arrayBuffer:e},o);if(!a.value||a.value.length<50)throw new Error("Conte√∫do HTML extra√≠do insuficiente");return console.log("‚úÖ HTML extra√≠do:",a.value.length,"caracteres"),a.messages.length>0&&console.log("‚ö†Ô∏è Avisos:",a.messages.length),a.value}catch(n){throw new Error(`Erro ao extrair HTML: ${n.message}`)}}prepareHtmlForRendering(t){console.log("üé® Preparando HTML para renderiza√ß√£o...");const n=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset="utf-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <style>\n          * {\n            box-sizing: border-box;\n          }\n          \n          html, body {\n            width: 794px !important; /* A4 width em pixels */\n            min-height: 1123px; /* A4 height em pixels */\n            font-family: 'Times New Roman', serif !important;\n            font-size: 11pt !important;\n            line-height: 1.3 !important;\n            color: #000000 !important;\n            background: #ffffff !important;\n            margin: 0 !important;\n            padding: 0 !important;\n            -webkit-print-color-adjust: exact;\n            print-color-adjust: exact;\n            overflow: visible !important;\n          }\n          \n          body {\n            padding: 60px 40px !important; /* Margens em pixels */\n            width: 794px !important;\n            min-height: 1123px !important;\n            background: white !important;\n            display: block !important;\n            visibility: visible !important;\n          }\n          \n          /* Preserve Word formatting */\n          p {\n            margin: 8px 0 !important;\n            padding: 0 !important;\n            text-align: justify !important;\n            text-justify: inter-word;\n            color: #000000 !important;\n            background: transparent !important;\n            display: block !important;\n            visibility: visible !important;\n            font-size: 11pt !important;\n            line-height: 1.3 !important;\n          }\n          \n          h1, h2, h3, h4, h5, h6 {\n            margin: 16px 0 8px 0 !important;\n            padding: 0 !important;\n            font-weight: bold !important;\n            color: #000000 !important;\n            background: transparent !important;\n            display: block !important;\n            visibility: visible !important;\n            page-break-after: avoid;\n          }\n          \n          h1 { font-size: 16pt !important; }\n          h2 { font-size: 14pt !important; }\n          h3 { font-size: 12pt !important; }\n          \n          h1.title {\n            text-align: center;\n            font-size: 18pt;\n            margin: 24pt 0 18pt 0;\n          }\n          \n          .subtitle {\n            text-align: center;\n            font-style: italic;\n            margin: 12pt 0;\n          }\n          \n          strong, b {\n            font-weight: bold !important;\n            color: #000000 !important;\n            background: transparent !important;\n            display: inline !important;\n            visibility: visible !important;\n          }\n          \n          em, i {\n            font-style: italic !important;\n            color: #000000 !important;\n            background: transparent !important;\n            display: inline !important;\n            visibility: visible !important;\n          }\n          \n          u {\n            text-decoration: underline !important;\n            color: #000000 !important;\n            background: transparent !important;\n            display: inline !important;\n            visibility: visible !important;\n          }\n          \n          /* Tables */\n          table {\n            width: 100% !important;\n            border-collapse: collapse !important;\n            margin: 16px 0 !important;\n            background: white !important;\n            color: #000000 !important;\n            display: table !important;\n            visibility: visible !important;\n            page-break-inside: avoid;\n          }\n          \n          table.word-table {\n            border: 1px solid #000000 !important;\n          }\n          \n          td, th {\n            border: 1px solid #000000 !important;\n            padding: 8px 12px !important;\n            vertical-align: top !important;\n            text-align: left !important;\n            background: white !important;\n            color: #000000 !important;\n            display: table-cell !important;\n            visibility: visible !important;\n            font-size: 11pt !important;\n          }\n          \n          th {\n            font-weight: bold !important;\n            background-color: #f2f2f2 !important;\n            color: #000000 !important;\n          }\n          \n          /* Lists - Preservar numera√ß√£o */\n          ul, ol {\n            margin: 12px 0 !important;\n            padding-left: 30px !important;\n            color: #000000 !important;\n            background: transparent !important;\n            display: block !important;\n            visibility: visible !important;\n          }\n          \n          ol {\n            list-style-type: decimal !important;\n            counter-reset: list-counter !important;\n          }\n          \n          ul {\n            list-style-type: disc !important;\n          }\n          \n          li {\n            margin: 4px 0 !important;\n            padding: 2px 0 !important;\n            color: #000000 !important;\n            background: transparent !important;\n            display: list-item !important;\n            visibility: visible !important;\n            list-style-position: outside !important;\n          }\n          \n          /* Numera√ß√£o espec√≠fica para documentos */\n          li::marker {\n            color: #000000 !important;\n            font-weight: normal !important;\n          }\n          \n          /* Preservar numera√ß√£o customizada */\n          li[data-list-text] {\n            position: relative !important;\n          }\n          \n          li[data-list-text]::before {\n            content: attr(data-list-text) !important;\n            position: absolute !important;\n            left: -30px !important;\n            color: #000000 !important;\n            font-weight: normal !important;\n          }\n          \n          /* Block quotes */\n          blockquote {\n            margin: 12pt 24pt;\n            padding: 8pt 12pt;\n            border-left: 3pt solid #ccc;\n            background-color: #f9f9f9;\n          }\n          \n          /* Images */\n          img {\n            max-width: 100%;\n            height: auto;\n            display: block;\n            margin: 8pt auto;\n          }\n          \n          /* Page breaks e quebras inteligentes */\n          .page-break {\n            page-break-before: always;\n          }\n          \n          /* Evitar quebras no meio de se√ß√µes importantes */\n          h1, h2, h3, h4, h5, h6 {\n            page-break-after: avoid !important;\n            page-break-inside: avoid !important;\n          }\n          \n          /* Manter par√°grafos unidos com t√≠tulos seguintes */\n          p + h1, p + h2, p + h3, p + h4, p + h5, p + h6 {\n            page-break-before: avoid !important;\n          }\n          \n          /* Evitar quebras em listas */\n          li {\n            page-break-inside: avoid !important;\n          }\n          \n          /* Manter se√ß√µes importantes unidas */\n          .keep-together {\n            page-break-inside: avoid !important;\n          }\n          \n          /* Preserve spacing */\n          br {\n            display: block;\n            margin: 4pt 0;\n            content: "";\n          }\n          \n          /* Center alignment */\n          .center, [style*="text-align: center"] {\n            text-align: center !important;\n          }\n          \n          /* Right alignment */\n          .right, [style*="text-align: right"] {\n            text-align: right !important;\n          }\n          \n          /* Preserve font sizes */\n          [style*="font-size"] {\n            line-height: 1.2 !important;\n          }\n          \n          /* Preserve colors */\n          [style*="color"] {\n            color: inherit !important;\n          }\n          \n          /* Form fields simulation */\n          ._underline {\n            border-bottom: 1pt solid #000;\n            display: inline-block;\n            min-width: 100pt;\n          }\n          \n          /* Signature areas */\n          ._signature {\n            border-bottom: 1pt solid #000;\n            display: inline-block;\n            width: 200pt;\n            height: 20pt;\n            margin: 12pt 0;\n          }\n          \n          /* Footer/header simulation */\n          ._footer {\n            position: absolute;\n            bottom: 2cm;\n            left: 2.54cm;\n            right: 2.54cm;\n            font-size: 9pt;\n            text-align: center;\n            color: #666;\n          }\n        </style>\n      </head>\n      <body>\n        ${t}\n      </body>\n      </html>\n    `;return console.log("‚úÖ HTML preparado para renderiza√ß√£o"),n}async renderHtmlToImage(t){try{console.log("üñºÔ∏è Renderizando HTML p√°gina por p√°gina...");const n=this.addPageBreaksToHtml(t);return await this.renderPagesIndividually(n)}catch(n){return console.error("‚ùå Erro na renderiza√ß√£o por p√°ginas:",n),console.log("üîÑ Tentando m√©todo de fallback..."),await this.renderHtmlToImageFallback(t)}}addPageBreaksToHtml(t){console.log("üìÑ Adicionando quebras de p√°gina inteligentes...");let n=t.replace(/<h1/g,'<div class="page-break"></div><h1').replace(/<h2/g,'<div class="section-break"></div><h2').replace(/DO OBJETO/g,'<div class="page-break"></div>DO OBJETO').replace(/DO PEDIDO DE ESCLARECIMENTOS/g,'<div class="page-break"></div>DO PEDIDO DE ESCLARECIMENTOS').replace(/DAS DISPOSI√á√ïES GERAIS/g,'<div class="page-break"></div>DAS DISPOSI√á√ïES GERAIS').replace(/DOS ANEXOS/g,'<div class="page-break"></div>DOS ANEXOS');return n}async renderPagesIndividually(t){try{console.log("üìÑ Renderizando p√°ginas individuais...");const n=document.createElement("iframe");n.style.cssText="\n        position: absolute;\n        left: -9999px;\n        top: -9999px;\n        width: 794px;\n        height: 1123px;\n        border: none;\n        background: white;\n        visibility: hidden;\n        z-index: -1000;\n      ",document.body.appendChild(n);try{const e=`\n          <!DOCTYPE html>\n          <html>\n          <head>\n            <meta charset="utf-8">\n            <style>\n              @page {\n                size: A4;\n                margin: 20mm;\n              }\n              \n              ${this.getPrintCSS()}\n              \n              body {\n                font-family: 'Times New Roman', serif !important;\n                font-size: 11pt !important;\n                line-height: 1.3 !important;\n                margin: 0 !important;\n                padding: 0 !important;\n                background: white !important;\n                color: black !important;\n              }\n              \n              .page-break {\n                page-break-before: always !important;\n                height: 0 !important;\n                margin: 0 !important;\n                padding: 0 !important;\n              }\n              \n              .section-break {\n                page-break-before: avoid !important;\n                margin-top: 20px !important;\n              }\n            </style>\n          </head>\n          <body>\n            ${t}\n          </body>\n          </html>\n        `;n.contentDocument.open(),n.contentDocument.write(e),n.contentDocument.close(),await new Promise((t=>{n.onload=t,setTimeout(t,2e3)}));const o=n.contentDocument.body;console.log("üìÑ Conte√∫do carregado:",o.innerText.substring(0,100)+"...");const a=await this.html2canvas(o,{scale:1.5,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:794,height:o.scrollHeight,windowWidth:794,windowHeight:o.scrollHeight,x:0,y:0,scrollX:0,scrollY:0,foreignObjectRendering:!1,imageTimeout:15e3,removeContainer:!1,logging:!1,letterRendering:!0});return console.log("‚úÖ Imagem p√°gina renderizada:",a.width+"x"+a.height),{dataUrl:a.toDataURL("image/png",1),width:a.width,height:a.height}}finally{n&&n.parentNode&&document.body.removeChild(n)}}catch(n){throw new Error(`Erro na renderiza√ß√£o por p√°ginas: ${n.message}`)}}getPrintCSS(){return"\n      * {\n        box-sizing: border-box !important;\n      }\n      \n      p {\n        margin: 6px 0 !important;\n        text-align: justify !important;\n        orphans: 3 !important;\n        widows: 3 !important;\n      }\n      \n      h1, h2, h3, h4, h5, h6 {\n        margin: 12px 0 6px 0 !important;\n        font-weight: bold !important;\n        page-break-after: avoid !important;\n        page-break-inside: avoid !important;\n        orphans: 4 !important;\n        widows: 4 !important;\n      }\n      \n      h1 { font-size: 16pt !important; }\n      h2 { font-size: 14pt !important; }\n      h3 { font-size: 12pt !important; }\n      \n      ul, ol {\n        margin: 8px 0 !important;\n        padding-left: 25px !important;\n        page-break-inside: avoid !important;\n      }\n      \n      li {\n        margin: 3px 0 !important;\n        page-break-inside: avoid !important;\n      }\n      \n      table {\n        width: 100% !important;\n        border-collapse: collapse !important;\n        margin: 10px 0 !important;\n        page-break-inside: avoid !important;\n      }\n      \n      td, th {\n        border: 1px solid #000 !important;\n        padding: 6px 8px !important;\n        font-size: 10pt !important;\n      }\n      \n      th {\n        font-weight: bold !important;\n        background-color: #f0f0f0 !important;\n      }\n      \n      strong, b {\n        font-weight: bold !important;\n      }\n      \n      em, i {\n        font-style: italic !important;\n      }\n      \n      u {\n        text-decoration: underline !important;\n      }\n    "}async renderHtmlToImageFallback(t){try{console.log("üîÑ Usando m√©todo de fallback para renderiza√ß√£o...");const n=document.createElement("div");n.innerHTML=t.replace(/<html[^>]*>|<\/html>|<head[^>]*>.*?<\/head>|<body[^>]*>|<\/body>/gs,""),n.style.cssText="\n        position: absolute;\n        left: -9999px;\n        top: -9999px;\n        width: 794px;\n        padding: 40px;\n        background: white;\n        font-family: 'Times New Roman', serif;\n        font-size: 11pt;\n        line-height: 1.4;\n        color: black;\n        visibility: visible;\n        z-index: 9999;\n      ",document.body.appendChild(n);try{await new Promise((t=>setTimeout(t,1e3)));const t=await this.html2canvas(n,{scale:1,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!0});return console.log("‚úÖ Fallback renderizado:",t.width+"x"+t.height),{dataUrl:t.toDataURL("image/png",1),width:t.width,height:t.height}}finally{n&&n.parentNode&&document.body.removeChild(n)}}catch(n){throw console.error("‚ùå Erro no fallback:",n),new Error(`Falha na renderiza√ß√£o: ${n.message}`)}}async createPdfFromImage(t){try{if(console.log("üìÑ Criando PDF com m√©todo simplificado..."),console.log("üñºÔ∏è Dados da imagem:",{width:t.width,height:t.height,dataUrlLength:t.dataUrl.length}),!t.dataUrl||t.dataUrl.length<100)throw new Error("Dados de imagem inv√°lidos");const n=new this.jsPDF({orientation:"portrait",unit:"mm",format:"a4"}),e=210,o=297,a=10,i=e-2*a,r=o-2*a,l=i/(.264583*t.width),s=i,m=.264583*t.height*l;console.log(`üìê Imagem ser√° renderizada: ${s.toFixed(1)}mm x ${m.toFixed(1)}mm`);const d=Math.ceil(m/r);console.log(`üìÑ Ser√° necess√°rio ${d} p√°gina(s)`);const p=new Image;await new Promise(((n,e)=>{p.onload=n,p.onerror=e,p.src=t.dataUrl}));const c=this.calculateSmartPageBreaks(d,r,m);console.log("üìÑ Quebras inteligentes calculadas:",c.length,"p√°ginas");for(let h=0;h<c.length;h++){h>0&&n.addPage();const e=c[h].startY,o=c[h].endY,i=o-e;if(i>0){const r=a-e;n.addImage(t.dataUrl,"PNG",a,r,s,m,void 0,"FAST"),console.log(`‚úÖ P√°gina ${h+1}/${c.length} - Y: ${e.toFixed(1)} ‚Üí ${o.toFixed(1)}mm (altura: ${i.toFixed(1)}mm)`)}}const g=n.output("blob");return console.log("‚úÖ PDF criado:",g.size,"bytes"),g}catch(n){return console.error("‚ùå Erro ao criar PDF:",n),console.log("üîÑ Tentando criar PDF de fallback..."),await this.createFallbackPdf("Erro na convers√£o")}}calculateSmartPageBreaks(t,n,e){console.log("üîß Calculando quebras inteligentes com detec√ß√£o melhorada...");const o=[];let a=0;while(a<e){let t=Math.min(a+n,e);const i=a+.75*n,r=t;console.log(`üìè P√°gina atual: ${a.toFixed(1)} ‚Üí ${t.toFixed(1)}mm (zona de risco: ${i.toFixed(1)} ‚Üí ${r.toFixed(1)}mm)`),r-i>10&&(t=i,console.log(`‚ö†Ô∏è Reduzindo p√°gina para evitar zona de risco. Novo fim: ${t.toFixed(1)}mm`));const l=a/e,s=this.detectSectionInCurrentPage(l,a,t,n);s.adjusted&&(t=s.newEnd,console.log(`üéØ Se√ß√£o detectada: ${s.reason}. Ajustado para: ${t.toFixed(1)}mm`));const m=.5*n;if(t-a<m&&a+m<e&&(t=a+m,console.log(`üìè Garantindo altura m√≠nima da p√°gina: ${t.toFixed(1)}mm`)),o.push({startY:a,endY:t}),console.log(`‚úÖ P√°gina ${o.length}: ${a.toFixed(1)} ‚Üí ${t.toFixed(1)}mm (altura: ${(t-a).toFixed(1)}mm)`),a=t,o.length>25){console.log("‚ö†Ô∏è Limitando a 25 p√°ginas para evitar loop infinito");break}}return console.log(`üìÑ Quebras inteligentes calculadas: ${o.length} p√°ginas`),o}detectSectionInCurrentPage(t,n,e,o){const a=[{name:"DO OBJETO",progress:.15,risk:.8},{name:"DAS CONDI√á√ïES DE PARTICIPA√á√ÉO",progress:.35,risk:.9},{name:"DO PEDIDO DE ESCLARECIMENTOS",progress:.55,risk:.7},{name:"DAS DISPOSI√á√ïES GERAIS",progress:.75,risk:.6},{name:"DOS ANEXOS",progress:.85,risk:.5}];for(const i of a){const a=i.progress,r=.1;if(Math.abs(t-a)<r){const t=n+.8*o;if(e>t)return console.log(`üö® Poss√≠vel se√ß√£o '${i.name}' detectada em ~${(100*a).toFixed(0)}% do documento`),{adjusted:!0,newEnd:Math.max(t-5,n+.6*o),reason:`Poss√≠vel ${i.name}`}}}return{adjusted:!1}}async createFallbackPdf(t){console.log("‚ö†Ô∏è Usando m√©todo de fallback..."),await this.loadLibraries();const n=new this.jsPDF;return n.setFontSize(16),n.setFont("helvetica","bold"),n.text("CONVERS√ÉO AUTOM√ÅTICA",105,30,{align:"center"}),n.setFontSize(14),n.setFont("helvetica","normal"),n.text("Documento Word Convertido",105,45,{align:"center"}),n.setFontSize(12),n.text("Status: Convers√£o com formata√ß√£o limitada",20,70),n.text(`Arquivo original: ${t}`,20,85),n.text(`Data de convers√£o: ${(new Date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}`,20,100),n.setFontSize(11),n.text("OBSERVA√á√ÉO:",20,125),n.text("O sistema detectou que o documento Word possui formata√ß√£o complexa",20,140),n.text("que n√£o p√¥de ser totalmente preservada na convers√£o autom√°tica.",20,155),n.text("Para obter um PDF com formata√ß√£o id√™ntica ao documento original,",20,175),n.text("recomendamos usar uma das seguintes alternativas:",20,190),n.text("‚Ä¢ Microsoft Word: Arquivo ‚Üí Salvar como ‚Üí PDF",25,210),n.text("‚Ä¢ LibreOffice Writer: Arquivo ‚Üí Exportar como PDF",25,225),n.text("‚Ä¢ Google Docs: Arquivo ‚Üí Fazer download ‚Üí PDF",25,240),n.text("‚Ä¢ Ferramentas online: IlovePDF, SmallPDF, etc.",25,255),n.setFontSize(9),n.setTextColor(100,100,100),n.text("Sistema ComprarBem - Convers√£o autom√°tica de documentos",105,280,{align:"center"}),n.output("blob")}async convertUsingDocx2Pdf(t,n){try{let e;console.log("üöÄ Tentando convers√£o PREMIUM com docx2pdf...");try{e=await Promise.resolve().then((function(){var t=new Error("Cannot find module 'docx2pdf'");throw t.code="MODULE_NOT_FOUND",t}))}catch{throw new Error("docx2pdf n√£o dispon√≠vel")}const o=await fetch(t),a=await o.arrayBuffer(),i=await e.convert(a,{preserveFormatting:!0,preserveTables:!0,preserveImages:!0,preserveLayout:!0,quality:"high"});return{blob:new Blob([i],{type:"application/pdf"}),fileName:`${n}_Premium.pdf`}}catch(e){throw new Error(`Docx2PDF falhou: ${e.message}`)}}}const a=new o;async function i(t,n){try{return await a.convertWordToPdf(t,n)}catch(e){return console.warn("Fallback para convers√£o simples:",e.message),await a.loadLibraries(),{blob:await a.createFallbackPdf(n),fileName:`${n}_Fallback.pdf`}}}}}]);
//# sourceMappingURL=130.c618e48a.js.map