(()=>{"use strict";var a={452:(a,t,e)=>{e.d(t,{ND:()=>r});var o=e(9119);const i="https://ruagsbbczuwgfflgcaol.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1YWdzYmJjenV3Z2ZmbGdjYW9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ0Njg5MDQsImV4cCI6MjA2MDA0NDkwNH0.S2KD6-9DpBYAOsodjibI7LGa04CspZZ5OdRQagNjoK8",r=(0,o.UU)(i,s)},3405:(a,t,e)=>{e.d(t,{enviarEmailParticipanteStatus:()=>n,lY:()=>l});var o=e(452),i=e(365);const s={from:{email:"cpm@suaorganizacao.com.br",name:"CPM - Comiss√£o de Padroniza√ß√£o de Materiais"},provider:{apiKey:{NODE_ENV:"production",BASE_URL:"/ComprarBem/"}.VUE_APP_EMAIL_API_KEY,apiUrl:"https://api.sendgrid.v3/mail/send"}},r={diligencia:{subject:"Dilig√™ncia Solicitada - Produto em An√°lise",template:a=>`\n      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">\n        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center;">\n          <h1>üìã Dilig√™ncia Solicitada</h1>\n          <p>Comiss√£o de Padroniza√ß√£o de Materiais</p>\n        </div>\n        \n        <div style="padding: 30px; background: #f8f9fa;">\n          <h2 style="color: #333;">Prezado(a) Fornecedor,</h2>\n          \n          <p>Foi solicitada uma <strong>dilig√™ncia</strong> para o produto em an√°lise:</p>\n          \n          <div style="background: white; padding: 20px; border-left: 4px solid #667eea; margin: 20px 0;">\n            <h3 style="color: #667eea; margin-top: 0;">üì¶ Dados do Produto:</h3>\n            <p><strong>Nome:</strong> ${a.produto.nome}</p>\n            <p><strong>Marca:</strong> ${a.produto.marca}</p>\n            <p><strong>Modelo:</strong> ${a.produto.modelo}</p>\n            <p><strong>Fabricante:</strong> ${a.produto.fabricante}</p>\n          </div>\n          \n          <div style="background: #fff3cd; padding: 20px; border-left: 4px solid #ffc107; margin: 20px 0;">\n            <h3 style="color: #856404; margin-top: 0;">‚ö†Ô∏è Tipo de Dilig√™ncia:</h3>\n            <p><strong>${a.diligencia.tipo}</strong></p>\n            <p>${a.diligencia.descricao}</p>\n          </div>\n          \n          <div style="background: #f8d7da; padding: 20px; border-left: 4px solid #dc3545; margin: 20px 0;">\n            <h3 style="color: #721c24; margin-top: 0;">‚è∞ Prazo para Resposta:</h3>\n            <p><strong>${a.diligencia.prazo_dias} dias √∫teis</strong></p>\n            <p><strong>Data Limite:</strong> ${new Date(a.diligencia.data_limite).toLocaleDateString("pt-BR")}</p>\n          </div>\n          \n          <div style="background: #d4edda; padding: 20px; border-left: 4px solid #28a745; margin: 20px 0;">\n            <h3 style="color: #155724; margin-top: 0;">üìù Instru√ß√µes:</h3>\n            <ul>\n              <li>Responda a esta dilig√™ncia dentro do prazo estabelecido</li>\n              <li>Envie todos os documentos solicitados em formato PDF</li>\n              <li>Em caso de d√∫vidas, entre em contato conosco</li>\n              <li>O n√£o atendimento da dilig√™ncia pode resultar na reprova√ß√£o do produto</li>\n            </ul>\n          </div>\n          \n          <div style="text-align: center; margin: 30px 0;">\n            <p style="color: #666;">Para responder esta dilig√™ncia, entre em contato atrav√©s do nosso sistema ou envie os documentos por email.</p>\n          </div>\n          \n          <hr style="border: none; border-top: 1px solid #ddd; margin: 30px 0;">\n          \n          <div style="color: #666; font-size: 12px;">\n            <p><strong>CPM - Comiss√£o de Padroniza√ß√£o de Materiais</strong></p>\n            <p>Este √© um email autom√°tico. N√£o responda diretamente a este email.</p>\n            <p>Data de envio: ${(new Date).toLocaleDateString("pt-BR")} √†s ${(new Date).toLocaleTimeString("pt-BR")}</p>\n          </div>\n        </div>\n      </div>\n    `},participanteStatus:{subject:"{{titulo status}}",template:a=>`\nSUBJECT: ${"aprovado"===a.status?"‚úÖ APROVADO":"‚ùå REJEITADO"} - Sua empresa foi ${"aprovado"===a.status?"aprovada":"rejeitada"} no Edital ${a.numero_edital}\n\nPrezado(a) ${a.representante_legal},\n\n${"aprovado"===a.status?"√â com grande satisfa√ß√£o que informamos que sua empresa foi APROVADA para participar do processo de pr√©-qualifica√ß√£o!":"Informamos que sua empresa foi REJEITADA no processo de pr√©-qualifica√ß√£o."}\n\n=== DADOS DA EMPRESA ===\nRaz√£o Social: ${a.razao_social}\nCNPJ: ${a.cnpj}\nRepresentante Legal: ${a.representante_legal}\nEmail: ${a.email_empresa}\nTelefone: ${a.telefone}\n\n=== DADOS DO EDITAL ===\nN√∫mero: ${a.numero_edital}\nDescri√ß√£o: ${a.descricao_edital}\nData da Decis√£o: ${a.data_decisao}\nStatus: ${a.status.toUpperCase()}\n\n${"aprovado"===a.status?`=== PR√ìXIMOS PASSOS ===\n1. Documenta√ß√£o T√©cnica: Envie os documentos t√©cnicos dos produtos conforme especificado no edital\n2. Amostras (se aplic√°vel): Providencie as amostras f√≠sicas quando solicitado\n3. An√°lise CPM: Aguarde a an√°lise t√©cnica da Comiss√£o de Padroniza√ß√£o de Materiais\n4. Emiss√£o DCB: Ap√≥s aprova√ß√£o t√©cnica, ser√° emitido o DCB (Declara√ß√£o de Conformidade de Bem)\n5. Cat√°logo Eletr√¥nico: Produtos aprovados entrar√£o no cat√°logo para licita√ß√µes\n\n=== INFORMA√á√ïES IMPORTANTES ===\n- Esta aprova√ß√£o √© para participa√ß√£o no processo, n√£o garante aprova√ß√£o final dos produtos\n- Todos os produtos passar√£o por an√°lise t√©cnica rigorosa pela CPM\n- Documenta√ß√£o incompleta ou inadequada pode resultar em reprova√ß√£o\n- Mantenha seus dados atualizados em nosso sistema\n- Acompanhe o status atrav√©s do nosso portal\n\n=== PRAZOS ===\nEnvio de Documenta√ß√£o: ${a.prazo_documentacao}\nAn√°lise T√©cnica: At√© 30 dias √∫teis ap√≥s recebimento completo\nResultado Final: Ser√° comunicado por email e sistema`:`=== MOTIVO DA REJEI√á√ÉO ===\n${a.motivo_rejeicao||"Documenta√ß√£o n√£o atende aos requisitos do edital"}\n\n=== COMO PROCEDER ===\n- Revise a documenta√ß√£o enviada\n- Corrija os problemas identificados\n- Voc√™ pode se candidatar novamente em editais futuros\n- Em caso de d√∫vidas, entre em contato conosco`}\n\n=== CONTATO ===\nEmail: ${a.email_suporte}\nTelefone: ${a.telefone_suporte}\nHor√°rio: Segunda a Sexta, 8h √†s 17h\n\n=== SISTEMA COMPRARBEM ===\nAcesse: ${a.link_sistema}\n\n${a.nome_organizacao}\nEmail: ${a.email_organizacao}\nTelefone: ${a.telefone_organizacao}\nEndere√ßo: ${a.endereco_organizacao}\n\n---\nEste √© um email autom√°tico. N√£o responda diretamente a este email.\nEmail enviado em ${a.data_envio} √†s ${a.hora_envio}\n    `}};async function n(a,t,e="aprovado",o=null){try{console.log(`üìß Iniciando envio de email de ${e} para participante...`,a.email);const s={representante_legal:a.representante_legal,razao_social:a.razao_social,cnpj:a.cnpj,email_empresa:a.email,telefone:a.telefone||"N√£o informado",status:e,motivo_rejeicao:o,numero_edital:t.numero||"N/A",descricao_edital:t.descricao||"Edital de Pr√©-Qualifica√ß√£o",data_decisao:(new Date).toLocaleDateString("pt-BR"),prazo_documentacao:"30 dias √∫teis a partir desta data",link_sistema:window.location.origin,email_suporte:"comprarbemteste@gmail.com",telefone_suporte:"(61) 3315-2425",nome_organizacao:"Minist√©rio da Sa√∫de",email_organizacao:"cpm@saude.gov.br",telefone_organizacao:"(61) 3315-2425",endereco_organizacao:"Bras√≠lia - DF",data_envio:(new Date).toLocaleDateString("pt-BR"),hora_envio:(new Date).toLocaleTimeString("pt-BR")},n=r.participanteStatus.template(s),l="aprovado"===e?`‚úÖ APROVADO - Sua empresa foi aprovada no Edital ${s.numero_edital}`:`‚ùå REJEITADO - Sua empresa foi rejeitada no Edital ${s.numero_edital}`,d={serviceId:"service_7sv1naw",templateId:"template_nyiw2ua",publicKey:"DqGKMNJ87ch3qVxGv"},u={numero_edital:s.numero_edital,email_empresa:s.email_empresa,message:n,name:s.representante_legal,email:s.email_suporte,subject:l,status_participante:e,motivo_rejeicao:o||""};console.log(`üìß Enviando email de ${e} via EmailJS...`),console.log("üìß Para:",s.email_empresa),console.log("üìß Edital:",s.numero_edital),console.log("üìß Subject:",l),console.log("üìß Status:",e),console.log("üìß Motivo Rejei√ß√£o:",o),console.log("üìß Par√¢metros EmailJS:",u);const m=await i.Ay.send(d.serviceId,d.templateId,u,d.publicKey);return console.log(`üéâ EMAIL DE ${e.toUpperCase()} ENVIADO COM SUCESSO!`,m),await c({tipo:`participante_${e}`,destinatario:a.email,assunto:l,participante_id:a.id,edital_id:t.id,status:"enviado"}),{sucesso:!0,mensagem:`Email de ${e} enviado com sucesso!`,destinatario:a.email}}catch(s){throw console.error(`‚ùå Erro ao enviar email de ${e}:`,s),await c({tipo:`participante_${e}`,destinatario:a.email,assunto:`${"aprovado"===e?"‚úÖ APROVADO":"‚ùå REJEITADO"} - Edital ${t.numero}`,participante_id:a.id,edital_id:t.id,status:"erro",erro:s.message}),new Error(`Falha ao enviar email de ${e}: `+s.message)}}async function l(a){try{console.log("üìß Iniciando envio de email de dilig√™ncia...",a);try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);t.emailRemetente&&(s.from.email=t.emailRemetente),t.nomeRemetente&&(s.from.name=t.nomeRemetente)}}catch(t){console.error("Erro ao carregar configura√ß√µes do usu√°rio:",t)}if(!a.produto||!a.diligencia||!a.destinatario)throw new Error("Dados incompletos para envio do email");const l={personalizations:[{to:[{email:a.destinatario,name:a.produto.fabricante}]}],from:{email:s.from.email,name:s.from.name},subject:r.diligencia.subject,content:[{type:"text/html",value:r.diligencia.template(a)}]},{data:c,error:d}=await o.ND.from("emails_enviados").insert({tipo:"diligencia",destinatario:a.destinatario,assunto:r.diligencia.subject,produto_id:a.produto.id,diligencia_id:a.diligencia.id,status:"enviando",tentativas:1}).select().single();if(d&&console.error("‚ùå Erro ao registrar log de email:",d),"sendgrid"==={NODE_ENV:"production",BASE_URL:"/ComprarBem/"}.VUE_APP_EMAIL_PROVIDER&&{NODE_ENV:"production",BASE_URL:"/ComprarBem/"}.VUE_APP_SENDGRID_API_KEY){console.log("üìß Enviando email via EmailJS (usando SendGrid configurado)...");try{const t={to_email:a.destinatario,fabricante:a.produto.fabricante,produto_nome:a.produto.nome,produto_marca:a.produto.marca,produto_modelo:a.produto.modelo,cnpj:a.produto.cnpj||"N√£o informado",tipo_diligencia:a.diligencia.tipo,descricao_diligencia:a.diligencia.descricao,prazo_dias:"30",data_limite:new Date(a.diligencia.data_limite).toLocaleDateString("pt-BR"),data_envio:(new Date).toLocaleDateString("pt-BR")+" √†s "+(new Date).toLocaleTimeString("pt-BR"),nome_responsavel:"William Martins",cargo_responsavel:"Analista CPM",email_responsavel:"comprarbemteste@gmail.com"};console.log("üìß Enviando email via EmailJS..."),console.log("üìß Dados preparados:",t);const s={serviceId:"service_7sv1naw",templateId:"template_vbp986f",publicKey:"DqGKMNJ87ch3qVxGv"};try{console.log("üìß Enviando email REAL via EmailJS..."),console.log("üìß Configura√ß√£o:",s),console.log("üìß Dados:",t);const a=await i.Ay.send(s.serviceId,s.templateId,t,s.publicKey);console.log("üéâ EMAIL ENVIADO COM SUCESSO!",a)}catch(e){throw console.error("‚ùå Erro no EmailJS:",e),e}return c&&await o.ND.from("emails_enviados").update({status:"enviado",data_envio:(new Date).toISOString(),corpo:t.message}).eq("id",c.id),console.log("‚úÖ EMAIL PREPARADO COM SUCESSO!"),console.log("üìß Para:",t.to_email),console.log("üìß Assunto:",t.subject),{success:!0,message:"Email preparado com sucesso! (SendGrid configurado)",emailId:c?.id}}catch(n){return console.error("‚ùå Erro ao preparar email:",n),c&&await o.ND.from("emails_enviados").update({status:"desenvolvimento",data_envio:(new Date).toISOString(),erro_detalhes:"Erro na prepara√ß√£o do email"}).eq("id",c.id),{success:!0,message:"Dilig√™ncia criada (modo desenvolvimento)",emailId:c?.id,development:!0}}}return console.log("üîÑ Modo desenvolvimento - Simulando envio de email"),console.log("üìß Email Data:",l),await new Promise((a=>setTimeout(a,1e3))),c&&await o.ND.from("emails_enviados").update({status:"enviado",data_envio:(new Date).toISOString()}).eq("id",c.id),{success:!0,message:"Email enviado com sucesso (simulado)",emailId:c?.id}}catch(t){return console.error("‚ùå Erro ao enviar email de dilig√™ncia:",t),{success:!1,message:t.message||"Erro interno no envio do email",error:t}}}async function c(a){try{const{error:t}=await o.ND.from("emails_enviados").insert({tipo:a.tipo,destinatario:a.destinatario,assunto:a.assunto,participante_id:a.participante_id||null,edital_id:a.edital_id||null,produto_id:a.produto_id||null,diligencia_id:a.diligencia_id||null,status:a.status,erro:a.erro||null,tentativas:1,criado_em:(new Date).toISOString()});t?console.warn("‚ö†Ô∏è Erro ao registrar email no banco:",t):console.log("‚úÖ Email registrado no banco com sucesso")}catch(t){console.warn("‚ö†Ô∏è Falha ao registrar email no banco:",t)}}const d={serviceId:"service_7sv1naw",templateId:"template_nyiw2ua",publicKey:"DqGKMNJ87ch3qVxGv"};i.Ay.init(d.publicKey)},6532:(a,t,e)=>{var o=e(6848),i=function(){var a=this,t=a._self._c;return t("div",{attrs:{id:"app"}},[t("router-view"),t("AIChat")],1)},s=[],r=function(){var a=this,t=a._self._c;return t("div",{staticClass:"ai-chat",class:{"ai-chat--expanded":a.isExpanded}},[a.isExpanded?t("div",{staticClass:"ai-chat__window"},[t("div",{staticClass:"ai-chat__header"},[a._m(1),t("button",{staticClass:"ai-chat__close",on:{click:a.toggleChat}},[t("i",{staticClass:"fas fa-times"})])]),t("div",{ref:"messagesContainer",staticClass:"ai-chat__messages"},[a._l(a.messages,(function(e,o){return t("div",{key:o,class:["ai-chat__message",`ai-chat__message--${e.type}`,{"ai-chat__message--status":e.isStatus}]},["assistant"===e.type?t("div",{staticClass:"ai-chat__message-avatar"},[t("i",{staticClass:"fas fa-robot"}),t("i",{staticClass:"fas fa-bolt ai-chat__bolt-small"})]):a._e(),t("div",{staticClass:"ai-chat__message-content"},[e.isStatus?t("span",{staticClass:"ai-chat__status-text"},[t("i",{staticClass:"fas fa-spinner fa-spin"}),a._v(" "+a._s(e.text)+" ")]):t("span",[a._v(a._s(e.text))])])])})),a.isLoading?t("div",{staticClass:"ai-chat__message ai-chat__message--assistant"},[a._m(2),a._m(3)]):a._e()],2),t("div",{staticClass:"ai-chat__input"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.currentMessage,expression:"currentMessage"}],attrs:{placeholder:"Digite sua d√∫vida sobre licita√ß√µes...",rows:"2"},domProps:{value:a.currentMessage},on:{keydown:function(t){return!t.type.indexOf("key")&&a._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),a.sendMessage.apply(null,arguments))},input:function(t){t.target.composing||(a.currentMessage=t.target.value)}}}),t("button",{staticClass:"ai-chat__send",attrs:{disabled:a.isLoading||!a.currentMessage.trim()},on:{click:a.sendMessage}},[t("i",{staticClass:"fas fa-paper-plane"})])])]):t("button",{staticClass:"ai-chat__button",attrs:{title:"QualiBot 2.0 - Seu Assistente de Licita√ß√µes"},on:{click:a.toggleChat}},[a._m(0),a.hasInteracted?a._e():t("div",{staticClass:"ai-chat__notification"},[t("i",{staticClass:"fas fa-bolt"}),a._v(" Como posso ajudar? ")])])])},n=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"ai-chat__button-content"},[t("i",{staticClass:"fas fa-robot"}),t("span",{staticClass:"ai-chat__button-label"},[a._v("QualiBot 2.0")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"ai-chat__header-info"},[t("div",{staticClass:"ai-chat__logo"},[t("i",{staticClass:"fas fa-robot"}),t("i",{staticClass:"fas fa-bolt ai-chat__bolt"})]),t("div",[t("h3",[a._v("QualiBot 2.0")]),t("span",{staticClass:"ai-chat__status"},[t("span",{staticClass:"ai-chat__status-dot"}),a._v(" Online e Pronto ")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"ai-chat__message-avatar"},[t("i",{staticClass:"fas fa-robot"}),t("i",{staticClass:"fas fa-bolt ai-chat__bolt-small"})])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"ai-chat__typing"},[t("span"),t("span"),t("span")])}];const l="AIzaSyAf-Oe56q4Rao0OodEOtnEjtI_FpOmDg6I",c=[{name:"gemini-2.0-flash-exp",url:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent",description:"Gemini 2.0 Flash (Mais Novo e R√°pido - Experimental)"},{name:"gemini-1.5-flash",url:"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent",description:"Gemini 1.5 Flash (R√°pido e Eficiente)"},{name:"gemini-1.5-pro",url:"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent",description:"Gemini 1.5 Pro (Mais Avan√ßado)"},{name:"gemini-1.0-pro",url:"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.0-pro:generateContent",description:"Gemini 1.0 Pro (Vers√£o Est√°vel)"}],d={maxRetries:3,baseDelay:800,maxDelay:12e3,backoffFactor:1.8},u=a=>new Promise((t=>setTimeout(t,a))),m=a=>{const t=d.baseDelay*Math.pow(d.backoffFactor,a);return Math.min(t,d.maxDelay)},p=(a,t)=>{if(a&&a.message&&a.message.includes("Failed to fetch"))return!0;if(t){const a=t.status;return 429===a||503===a||502===a||504===a}return!1},v=a=>{try{return JSON.parse(a)}catch(t){return console.error("Erro ao fazer parse do JSON:",t),console.error("Texto que causou erro:",a),null}},g=async(a,t,e=0)=>{try{const o=`${a.url}?key=${l}`;console.log(`Tentando modelo ${a.name} (tentativa ${e+1}/${d.maxRetries+1})`);const i=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Voc√™ √© o QualiBot 2.0, um assistente especializado em licita√ß√µes e compras p√∫blicas, com foco em ajudar os usu√°rios de forma r√°pida e eficiente. Responda a seguinte pergunta de forma clara e objetiva, usando sua expertise em licita√ß√µes: ${t}`}]}]})});console.log(`Resposta do modelo ${a.name}:`,{status:i.status,statusText:i.statusText,ok:i.ok});const s=await i.text();if(!i.ok){const o=p(null,i);if(o&&e<d.maxRetries){const o=m(e);return console.log(`Erro tempor√°rio (${i.status}) no modelo ${a.name}. Aguardando ${o}ms...`),await u(o),g(a,t,e+1)}let r=v(s);r||(r={error:{message:`Erro HTTP ${i.status}: ${i.statusText||"Erro desconhecido"}`}}),console.error(`Erro no modelo ${a.name}:`,r);let n=`Modelo ${a.name} falhou`;throw r.error&&r.error.message?n+=`: ${r.error.message}`:n+=`: ${i.status} ${i.statusText||"Erro desconhecido"}`,new Error(n)}const r=v(s);if(!r){if(e<d.maxRetries){const o=m(e);return console.log(`Erro de parse no modelo ${a.name}. Aguardando ${o}ms...`),await u(o),g(a,t,e+1)}throw new Error(`Modelo ${a.name} retornou resposta inv√°lida`)}if(!r.candidates||!r.candidates[0]?.content?.parts?.[0]?.text){if(console.error(`Formato inv√°lido no modelo ${a.name}:`,r),e<d.maxRetries){const o=m(e);return console.log(`Formato inv√°lido no modelo ${a.name}. Aguardando ${o}ms...`),await u(o),g(a,t,e+1)}throw new Error(`Modelo ${a.name} retornou formato inv√°lido`)}return console.log(`‚úÖ Sucesso com modelo ${a.name}!`),{text:r.candidates[0].content.parts[0].text,modelUsed:a.name}}catch(o){if(console.error(`Erro na tentativa ${e+1} do modelo ${a.name}:`,o),p(o,null)&&e<d.maxRetries){const o=m(e);return console.log(`Erro de rede no modelo ${a.name}. Aguardando ${o}ms...`),await u(o),g(a,t,e+1)}throw o}},h={async chat(a){let t=null,e=[];for(let i=0;i<c.length;i++){const s=c[i];e.push(s.name);try{console.log(`üöÄ Tentando modelo ${i+1}/${c.length}: ${s.name}`);const t=await g(s,a);return console.log(`‚úÖ Resposta obtida com sucesso usando: ${t.modelUsed}`),t.text}catch(o){if(t=o,console.error(`‚ùå Modelo ${s.name} falhou:`,o.message),i<c.length-1){console.log(`üîÑ Tentando pr√≥ximo modelo: ${c[i+1].name}`);continue}}}if(console.error("‚ùå Todos os modelos falharam. Modelos tentados:",e),console.error("√öltimo erro:",t),t&&t.message&&t.message.includes("Failed to fetch"))throw new Error("N√£o foi poss√≠vel conectar aos servi√ßos de IA. Verifique sua conex√£o com a internet.");if(t&&t.message&&(t.message.includes("503")||t.message.includes("sobrecarregado")))throw new Error("Todos os servi√ßos de IA est√£o temporariamente sobrecarregados. Tente novamente em alguns minutos.");if(t&&t.message&&t.message.includes("429"))throw new Error("Limite de requisi√ß√µes atingido. Aguarde alguns minutos antes de tentar novamente.");throw new Error("Todos os servi√ßos de IA est√£o temporariamente indispon√≠veis. Tente novamente mais tarde.")}},f={name:"AIChat",data(){return{isExpanded:!1,hasInteracted:!1,messages:[{type:"assistant",text:"Ol√°! Sou o QualiBot 2.0, seu assistente virtual especializado em licita√ß√µes e compras p√∫blicas. Como posso ajudar hoje?"}],currentMessage:"",isLoading:!1}},methods:{toggleChat(){this.isExpanded=!this.isExpanded,this.hasInteracted=!0,this.isExpanded&&this.$nextTick((()=>{this.scrollToBottom()}))},async sendMessage(){if(!this.currentMessage.trim()||this.isLoading)return;const a=this.currentMessage.trim();this.messages.push({type:"user",text:a}),this.currentMessage="",this.isLoading=!0;const t={type:"assistant",text:"Processando sua solicita√ß√£o...",isStatus:!0};this.messages.push(t);const e=a=>{const t=this.messages.findIndex((a=>a.isStatus));-1!==t&&(this.messages[t].text=a)},o=console.log;console.log=(...a)=>{const t=a.join(" ");if(t.includes("üöÄ Tentando modelo")){const a=t.match(/üöÄ Tentando modelo \d+\/\d+: (.+)/);a&&e(`Tentando modelo ${a[1]}...`)}else if(t.includes("Erro tempor√°rio"))e("Erro tempor√°rio detectado, tentando novamente...");else if(t.includes("üîÑ Tentando pr√≥ximo modelo")){const a=t.match(/üîÑ Tentando pr√≥ximo modelo: (.+)/);if(a){let t=a[1];t.includes("gemini-2.0-flash-exp")?t="Gemini 2.0 Flash (Experimental)":t.includes("gemini-1.5-flash")?t="Gemini 1.5 Flash":t.includes("gemini-1.5-pro")?t="Gemini 1.5 Pro":t.includes("gemini-1.0-pro")&&(t="Gemini 1.0 Pro"),e(`Tentando modelo alternativo: ${t}...`)}}o.apply(console,a)};try{const t=await h.chat(a);console.log=o;const e=this.messages.findIndex((a=>a.isStatus));-1!==e&&this.messages.splice(e,1),this.messages.push({type:"assistant",text:t})}catch(i){console.error("Erro no chat:",i),console.log=o;const a=this.messages.findIndex((a=>a.isStatus));-1!==a&&this.messages.splice(a,1);let t="Desculpe, estou enfrentando algumas dificuldades t√©cnicas no momento.";i.message.includes("sobrecarregado")||i.message.includes("overloaded")?t="O servi√ßo est√° temporariamente sobrecarregado devido ao alto volume de usu√°rios. J√° tentei v√°rias vezes automaticamente. Por favor, aguarde alguns minutos e tente novamente.":i.message.includes("conex√£o")||i.message.includes("network")?t="Problema de conex√£o detectado. Verifique sua internet e tente novamente.":(i.message.includes("indispon√≠vel")||i.message.includes("unavailable"))&&(t="O servi√ßo est√° temporariamente indispon√≠vel. Nossa equipe j√° est√° trabalhando nisso. Tente novamente em alguns minutos."),this.messages.push({type:"assistant",text:t+"\n\nüí° **Dica**: Se o problema persistir, voc√™ pode tentar reformular sua pergunta ou contactar o suporte atrav√©s do menu principal."})}finally{this.isLoading=!1,this.$nextTick((()=>{this.scrollToBottom()}))}},scrollToBottom(){const a=this.$refs.messagesContainer;a.scrollTop=a.scrollHeight}}},_=f;var C=e(1656),b=(0,C.A)(_,r,n,!1,null,"26facc0e",null);const D=b.exports,w={name:"App",components:{AIChat:D}},E=w;var A=(0,C.A)(E,i,s,!1,null,null,null);const y=A.exports;var x=e(6178),P=function(){var a=this,t=a._self._c;return t("div",{staticClass:"home"},[t("Login")],1)},S=[],N=function(){var a=this,t=a._self._c;return t("div",{staticClass:"login-container"},[t("div",{staticClass:"login-card"},[t("h2",[a._v("Comprar Bem: Compras Inteligentes")]),t("p",[a._v("Sa√∫de e Administra√ß√£o")]),t("div",{staticClass:"tabs"},[t("button",{class:{active:"login"===a.activeTab},on:{click:function(t){a.activeTab="login"}}},[a._v("Login")]),t("button",{class:{active:"register"===a.activeTab},on:{click:function(t){a.activeTab="register"}}},[a._v("Registrar")])]),"login"===a.activeTab?t("div",[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[a._v("E-mail")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.email,expression:"email"}],attrs:{id:"email",type:"email",placeholder:"Seu e-mail",required:""},domProps:{value:a.email},on:{input:function(t){t.target.composing||(a.email=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"password"}},[a._v("Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.password,expression:"password"}],attrs:{id:"password",type:"password",placeholder:"Sua senha",required:""},domProps:{value:a.password},on:{input:function(t){t.target.composing||(a.password=t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{disabled:a.loading},on:{click:a.login}},[a._v(" "+a._s(a.loading?"Entrando...":"Entrar")+" ")])]):a._e(),"register"===a.activeTab?t("div",[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registerEmail"}},[a._v("E-mail")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.registerEmail,expression:"registerEmail"}],attrs:{id:"registerEmail",type:"email",placeholder:"Seu e-mail",required:""},domProps:{value:a.registerEmail},on:{input:function(t){t.target.composing||(a.registerEmail=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registerPassword"}},[a._v("Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.registerPassword,expression:"registerPassword"}],attrs:{id:"registerPassword",type:"password",placeholder:"Sua senha",required:""},domProps:{value:a.registerPassword},on:{input:function(t){t.target.composing||(a.registerPassword=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"confirmPassword"}},[a._v("Confirmar Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.confirmPassword,expression:"confirmPassword"}],attrs:{id:"confirmPassword",type:"password",placeholder:"Confirme sua senha",required:""},domProps:{value:a.confirmPassword},on:{input:function(t){t.target.composing||(a.confirmPassword=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeInstitucional"}},[a._v("Nome da Institui√ß√£o")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nomeInstitucional,expression:"nomeInstitucional"}],attrs:{id:"nomeInstitucional",type:"text",placeholder:"Nome da sua institui√ß√£o",required:""},domProps:{value:a.nomeInstitucional},on:{input:function(t){t.target.composing||(a.nomeInstitucional=t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{type:"button"},on:{click:a.register}},[a._v(" "+a._s(a.loading?"Registrando...":"Registrar")+" ")]),t("button",{staticClass:"btn-test",staticStyle:{"margin-top":"10px"},on:{click:a.testeSimples}},[a._v(" Teste Simples ")]),a.validRegistration?a._e():t("div",{staticClass:"validation-info"},[t("p",[a._v("O formul√°rio n√£o est√° v√°lido porque:")]),t("ul",[a.registerEmail?a._e():t("li",[a._v("Falta o e-mail")]),a.registerPassword?a._e():t("li",[a._v("Falta a senha")]),a.registerPassword&&a.registerPassword.length<6?t("li",[a._v("A senha precisa ter pelo menos 6 caracteres")]):a._e(),a.registerPassword!==a.confirmPassword?t("li",[a._v("As senhas n√£o conferem")]):a._e(),a.nomeInstitucional?a._e():t("li",[a._v("Falta o nome da institui√ß√£o")])])])]):a._e(),a.errorMsg?t("p",{staticClass:"error-message"},[a._v(a._s(a.errorMsg))]):a._e(),t("div",{staticClass:"rdm-access"},[t("hr",{staticStyle:{margin:"20px 0"}}),a._m(0),t("router-link",{staticClass:"btn-rdm",attrs:{to:"/rdm"}},[a._v(" üìù Acessar Dashboard RDM ")]),t("p",{staticStyle:{"font-size":"12px",color:"#888","text-align":"center","margin-top":"10px"}},[a._v(" Para usu√°rios cadastrados emitir Requisi√ß√µes de Materiais ")])],1),"register"===a.activeTab?t("div",{staticClass:"test-buttons"},[t("button",{staticClass:"btn-test",on:{click:a.testarSupabase}},[a._v("Testar Conex√£o Supabase")])]):a._e()])])},R=[function(){var a=this,t=a._self._c;return t("p",{staticStyle:{"text-align":"center",color:"#666","margin-bottom":"15px"}},[t("strong",[a._v("üè• Sistema RDM Online")])])}],M=e(452),$=e(4963);const I={name:"Login",data(){return{activeTab:"login",email:"",password:"",registerEmail:"",registerPassword:"",confirmPassword:"",nomeInstitucional:"",loading:!1,errorMsg:""}},computed:{validRegistration(){return this.registerEmail&&this.registerPassword&&this.registerPassword===this.confirmPassword&&this.nomeInstitucional&&this.registerPassword.length>=6}},mounted(){console.log("Componente Login montado",{activeTab:this.activeTab})},watch:{activeTab(a){console.log("Aba ativa alterada para:",a)},registerEmail(a){console.log("E-mail de registro alterado:",a)},registerPassword(a){console.log("Senha de registro alterada:",a?"****":"")}},methods:{async testarSupabase(){console.log("Testando conex√£o com Supabase...");try{const{data:a,error:t}=await M.ND.from("tenants").select("*").limit(1);console.log("Resultado do teste tabela tenants:",{data:a,error:t}),t?alert(`Erro ao acessar tabela: ${t.message}`):alert(`Conex√£o OK! ${a?a.length:0} registros encontrados.`);const e=(0,$.A)();console.log("Teste UUID gerado:",e)}catch(a){console.error("Erro no teste:",a),alert(`Erro na conex√£o: ${a.message}`)}},async login(){try{this.loading=!0,this.errorMsg="";const{error:a}=await M.ND.auth.signInWithPassword({email:this.email,password:this.password});if(a)throw a;this.$router.push("/dashboard")}catch(a){this.errorMsg=a.message||"Erro ao fazer login"}finally{this.loading=!1}},async register(){if(console.log("M√©todo register chamado",{email:this.registerEmail,password:"****",nomeInstitucional:this.nomeInstitucional}),!this.validRegistration)return console.log("Formul√°rio inv√°lido"),void(this.errorMsg="Verifique os campos do formul√°rio");try{this.loading=!0,this.errorMsg="",console.log("Iniciando registro de usu√°rio no Supabase...");const{data:t,error:e}=await M.ND.auth.signUp({email:this.registerEmail,password:this.registerPassword});if(console.log("Resposta do registro de usu√°rio:",{authData:t,authError:e}),e&&!e.message.includes("already registered"))throw e;const o=t?.user?.id;console.log("ID da autentica√ß√£o:",o);const i=(0,$.A)(),s=(0,$.A)();try{const{error:a}=await M.ND.from("usuarios").delete().eq("email",this.registerEmail);a&&console.warn("Aviso ao tentar remover usu√°rio existente:",a)}catch(a){console.warn("Erro ao tentar remover usu√°rio:",a)}console.log("Criando tenant...");const{data:r,error:n}=await M.ND.from("tenants").insert({id:i,nome:this.nomeInstitucional,descricao:`Tenant para ${this.registerEmail}`,ativo:!0}).select();if(n)throw new Error(`Erro ao criar tenant: ${n.message}`);console.log("Criando usu√°rio...");const{data:l,error:c}=await M.ND.from("usuarios").insert({id:s,email:this.registerEmail,nome:this.nomeInstitucional,tenant_id:i,tipo:"admin",ativo:!0}).select();if(c)throw c.message.includes("duplicate key")?(this.errorMsg="Este email j√° est√° registrado. Por favor, contate o suporte.",new Error(`Email j√° existe na base de dados: ${c.message}`)):new Error(`Erro ao criar usu√°rio: ${c.message}`);console.log("Atualizando tenant com user_id...");const{error:d}=await M.ND.from("tenants").update({user_id:o}).eq("id",i);d&&console.warn("Aviso: N√£o foi poss√≠vel atualizar o tenant com user_id:",d),console.log("Registro conclu√≠do com sucesso!"),alert("Registro realizado com sucesso! Verifique seu e-mail para confirmar a conta."),this.activeTab="login",this.email=this.registerEmail}catch(t){console.error("Erro detalhado no registro:",t),this.errorMsg=this.errorMsg||t.message||"Erro ao fazer registro"}finally{this.loading=!1}},testeSimples(){console.log("Bot√£o de teste simples clicado"),alert("Teste de evento de clique funcionando!")}}},T=I;var O=(0,C.A)(T,N,R,!1,null,"6d99fded",null);const k=O.exports,F={name:"Home",components:{Login:k}},B=F;var q=(0,C.A)(B,P,S,!1,null,null,null);const z=q.exports;var L=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Cat√°logo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classifica√ß√£o")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("‚ñº")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("üë§")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("‚öôÔ∏è")]),t("span",[a._v("Configura√ß√µes")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("üìß")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("üö™")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("DashboardCPM")],1)])},U=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras P√∫blicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("üë§")])])}],V=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard"},[t("h2",[a._v("Painel CPM")]),t("div",{staticClass:"tabs"},[t("div",{staticClass:"tab",class:{active:"dashboard"===a.activeTab},on:{click:function(t){a.activeTab="dashboard"}}},[a._v(" Dashboard ")]),t("div",{staticClass:"tab",class:{active:"editais"===a.activeTab},on:{click:function(t){a.activeTab="editais"}}},[a._v(" Editais de Pr√©-Qualifica√ß√£o ")]),t("div",{staticClass:"tab",class:{active:"pesquisa"===a.activeTab},on:{click:function(t){a.activeTab="pesquisa"}}},[a._v(" Pesquisa de Mercado ")]),t("div",{staticClass:"tab",class:{active:"despadronizadas"===a.activeTab},on:{click:function(t){a.activeTab="despadronizadas"}}},[a._v(" Marcas Despadronizadas ")]),t("div",{staticClass:"tab",class:{active:"certificados"===a.activeTab},on:{click:function(t){a.activeTab="certificados"}}},[a._v(" Emiss√£o de Certificados (DCB) ")]),t("div",{staticClass:"tab",class:{active:"usuarios"===a.activeTab},on:{click:function(t){a.activeTab="usuarios"}}},[a._v(" Cadastro de Usu√°rios ")]),t("div",{staticClass:"tab",class:{active:"reclamacoes"===a.activeTab},on:{click:function(t){a.activeTab="reclamacoes"}}},[a._v(" Avalia√ß√µes de Usu√°rios ")])]),"dashboard"===a.activeTab?t("div",[t("div",{staticClass:"stats-container"},[t("div",{staticClass:"stat-card status-pendente-card"},[t("h3",[a._v("Produtos em Avalia√ß√£o")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.pendentes))])]),t("div",{staticClass:"stat-card status-aprovado-card"},[t("h3",[a._v("Produtos Aprovados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.aprovados))])]),t("div",{staticClass:"stat-card status-reprovado-card"},[t("h3",[a._v("Produtos Reprovados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.reprovados))])])]),t("div",{staticClass:"recent-products"},[t("div",{staticClass:"section-header"},[t("h3",[a._v("üìã Requerimentos Recentes")]),t("div",{staticClass:"pagination-controls"},[t("label",[a._v("Itens por p√°gina:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.itensPorPagina,expression:"itensPorPagina"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.itensPorPagina=t.target.multiple?e:e[0]},a.aplicarPaginacao]}},[t("option",{attrs:{value:"5"}},[a._v("5")]),t("option",{attrs:{value:"10"}},[a._v("10")]),t("option",{attrs:{value:"20"}},[a._v("20")]),t("option",{attrs:{value:"50"}},[a._v("50")])])])]),t("div",{staticClass:"filtros-inline"},[t("div",{staticClass:"filtro-inline"},[t("label",[a._v("üî§ Nome:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.nome,expression:"filtros.nome"}],attrs:{type:"text",placeholder:"Filtrar por nome..."},domProps:{value:a.filtros.nome},on:{input:[function(t){t.target.composing||a.$set(a.filtros,"nome",t.target.value)},a.aplicarFiltros]}})]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("üè∑Ô∏è Marca:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.marca,expression:"filtros.marca"}],attrs:{type:"text",placeholder:"Filtrar por marca..."},domProps:{value:a.filtros.marca},on:{input:[function(t){t.target.composing||a.$set(a.filtros,"marca",t.target.value)},a.aplicarFiltros]}})]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("üìä Status:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtros.status,expression:"filtros.status"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtros,"status",t.target.multiple?e:e[0])},a.aplicarFiltros]}},[t("option",{attrs:{value:""}},[a._v("Todos")]),t("option",{attrs:{value:"pendente"}},[a._v("Em Avalia√ß√£o")]),t("option",{attrs:{value:"aprovado"}},[a._v("Aprovado")]),t("option",{attrs:{value:"reprovado"}},[a._v("Reprovado")]),t("option",{attrs:{value:"em_analise"}},[a._v("Em An√°lise")])])]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("üìÖ Data:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.data,expression:"filtros.data"}],attrs:{type:"date"},domProps:{value:a.filtros.data},on:{change:a.aplicarFiltros,input:function(t){t.target.composing||a.$set(a.filtros,"data",t.target.value)}}})]),t("button",{staticClass:"btn-limpar-filtros",on:{click:a.limparFiltros}},[a._v(" üóëÔ∏è Limpar ")])]),a.produtosPaginados.length>0?t("table",[a._m(0),t("tbody",a._l(a.produtosPaginados,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.marca))]),t("td",["aprovado"===e.status?t("span",{staticStyle:{"background-color":"#2ecc71",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")]):"pendente"===e.status?t("span",{staticStyle:{"background-color":"#f39c12",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")]):"reprovado"===e.status?t("span",{staticStyle:{"background-color":"#e74c3c",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")]):"em_analise"===e.status?t("span",{staticStyle:{"background-color":"#3498db",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")]):"diligencia"===e.status?t("span",{staticStyle:{"background-color":"#9b59b6",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")]):t("span",{staticStyle:{"background-color":"#6c757d",color:"white",display:"inline-block",padding:"5px 10px","border-radius":"20px","font-size":"12px","text-transform":"uppercase","font-weight":"bold","min-width":"80px","text-align":"center"}},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")])]),t("td",[a._v(a._s(a.formatDate(e.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.verProduto(e.id)}}},[a._v("Visualizar")])])])})),0)]):a._e(),a.totalPaginas>1?t("div",{staticClass:"paginacao"},[t("div",{staticClass:"paginacao-info"},[a._v(" P√°gina "+a._s(a.paginaAtual)+" de "+a._s(a.totalPaginas)+" ")]),t("div",{staticClass:"paginacao-botoes"},[t("button",{staticClass:"btn-paginacao",attrs:{disabled:1===a.paginaAtual},on:{click:function(t){return a.irParaPagina(a.paginaAtual-1)}}},[a._v(" ‚óÄÔ∏è Anterior ")]),t("span",{staticClass:"numeros-pagina"},a._l(a.paginasVisiveis,(function(e){return t("button",{key:e,class:["btn-numero",{active:e===a.paginaAtual}],on:{click:function(t){return a.irParaPagina(e)}}},[a._v(" "+a._s(e)+" ")])})),0),t("button",{staticClass:"btn-paginacao",attrs:{disabled:a.paginaAtual===a.totalPaginas},on:{click:function(t){return a.irParaPagina(a.paginaAtual+1)}}},[a._v(" ‚ñ∂Ô∏è Pr√≥xima ")])])]):0===a.produtos.length?t("p",[a._v("Nenhum requerimento cadastrado.")]):a.temFiltrosAplicados?t("p",[a._v("Nenhum produto encontrado com os filtros aplicados.")]):a._e()]),t("div",{staticClass:"diligencia-section"},[t("div",{staticClass:"section-header"},[t("h3",[a._v("üîç Requerimentos com Dilig√™ncias")]),t("div",{staticClass:"pagination-controls"},[t("label",[a._v("Itens por p√°gina:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.itensPorPaginaDiligencia,expression:"itensPorPaginaDiligencia"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.itensPorPaginaDiligencia=t.target.multiple?e:e[0]},a.aplicarPaginacaoDiligencia]}},[t("option",{attrs:{value:"5"}},[a._v("5")]),t("option",{attrs:{value:"10"}},[a._v("10")]),t("option",{attrs:{value:"20"}},[a._v("20")])])])]),t("div",{staticClass:"filtros-inline"},[t("div",{staticClass:"filtro-inline"},[t("label",[a._v("üîç Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDiligencia.busca,expression:"filtrosDiligencia.busca"}],attrs:{type:"text",placeholder:"Nome, marca ou fabricante..."},domProps:{value:a.filtrosDiligencia.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtrosDiligencia,"busca",t.target.value)},a.aplicarFiltrosDiligencia]}})]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("üè∑Ô∏è Marca:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDiligencia.marca,expression:"filtrosDiligencia.marca"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtrosDiligencia,"marca",t.target.multiple?e:e[0])},a.aplicarFiltrosDiligencia]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),a._l(a.marcasUnicas,(function(e){return t("option",{key:e,domProps:{value:e}},[a._v(" "+a._s(e)+" ")])}))],2)]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("üìÖ Data:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDiligencia.data,expression:"filtrosDiligencia.data"}],attrs:{type:"date"},domProps:{value:a.filtrosDiligencia.data},on:{change:a.aplicarFiltrosDiligencia,input:function(t){t.target.composing||a.$set(a.filtrosDiligencia,"data",t.target.value)}}})]),t("button",{staticClass:"btn-limpar-filtros",on:{click:a.limparFiltrosDiligencia}},[a._v(" üóëÔ∏è Limpar ")])]),a.diligenciasPaginadas.length>0?t("table",[a._m(1),t("tbody",a._l(a.diligenciasPaginadas,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.marca))]),a._m(2,!0),t("td",[a._v(a._s(a.formatDate(e.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.verProduto(e.id)}}},[a._v("Visualizar")]),t("button",{staticClass:"btn-small btn-diligencia",on:{click:function(t){return a.visualizarDiligencias(e.id)}}},[a._v("Ver Dilig√™ncias")])])])})),0)]):a._e(),a.totalPaginasDiligencia>1?t("div",{staticClass:"paginacao"},[t("div",{staticClass:"paginacao-info"},[a._v(" P√°gina "+a._s(a.paginaAtualDiligencia)+" de "+a._s(a.totalPaginasDiligencia)+" ")]),t("div",{staticClass:"paginacao-botoes"},[t("button",{staticClass:"btn-paginacao",attrs:{disabled:1===a.paginaAtualDiligencia},on:{click:function(t){return a.irParaPaginaDiligencia(a.paginaAtualDiligencia-1)}}},[a._v(" ‚óÄÔ∏è Anterior ")]),t("span",{staticClass:"numeros-pagina"},a._l(a.paginasVisiveisDiligencia,(function(e){return t("button",{key:e,class:["btn-numero",{active:e===a.paginaAtualDiligencia}],on:{click:function(t){return a.irParaPaginaDiligencia(e)}}},[a._v(" "+a._s(e)+" ")])})),0),t("button",{staticClass:"btn-paginacao",attrs:{disabled:a.paginaAtualDiligencia===a.totalPaginasDiligencia},on:{click:function(t){return a.irParaPaginaDiligencia(a.paginaAtualDiligencia+1)}}},[a._v(" ‚ñ∂Ô∏è Pr√≥xima ")])])]):0===a.produtosComDiligencia.length?t("p",[a._v("Nenhum requerimento com dilig√™ncia encontrado.")]):a.temFiltrosDiligenciaAplicados?t("p",[a._v("Nenhuma dilig√™ncia encontrada com os filtros aplicados.")]):a._e()])]):a._e(),"pesquisa"===a.activeTab?t("div",{staticClass:"pesquisa-mercado"},[t("div",{staticClass:"pesquisa-mercado-container"},[t("div",{staticClass:"sub-tabs"},[t("div",{staticClass:"sub-tab",class:{active:"pesquisa-tecnica"===a.activeSubTab},on:{click:function(t){a.activeSubTab="pesquisa-tecnica"}}},[a._v(" ü§ñ PesquisaBot ")]),t("div",{staticClass:"sub-tab",class:{active:"cotacoes"===a.activeSubTab},on:{click:function(t){a.activeSubTab="cotacoes"}}},[a._v(" üí∞ Cota√ß√µes ")]),t("div",{staticClass:"sub-tab",class:{active:"comparativo"===a.activeSubTab},on:{click:function(t){a.activeSubTab="comparativo"}}},[a._v(" üìä Comparativo ")]),t("div",{staticClass:"sub-tab",class:{active:"analise-precos"===a.activeSubTab},on:{click:function(t){a.activeSubTab="analise-precos"}}},[a._v(" üìà An√°lise de Pre√ßos ")]),t("div",{staticClass:"sub-tab",class:{active:"relatorios"===a.activeSubTab},on:{click:function(t){a.activeSubTab="relatorios"}}},[a._v(" üìã Relat√≥rios ")]),t("div",{staticClass:"sub-tab",class:{active:"bancos-precos"===a.activeSubTab},on:{click:function(t){a.activeSubTab="bancos-precos"}}},[a._v(" üè¶ Bancos de Pre√ßos ")])]),"pesquisa-tecnica"===a.activeSubTab?t("div",{staticClass:"sub-content"},[t("div",{staticClass:"pesquisa-bot-section"},[a._m(3),t("PesquisaBot")],1)]):a._e(),"cotacoes"===a.activeSubTab?t("div",{staticClass:"sub-content"},[t("div",{staticClass:"cotacoes-section"},[a._m(4),t("div",{staticClass:"cotacoes-actions"},[t("button",{staticClass:"btn-primary",on:{click:function(t){return a.$swal({title:"üí∞ Nova Cota√ß√£o",text:"Funcionalidade em desenvolvimento",icon:"info"})}}},[a._v(" ‚ûï Nova Cota√ß√£o ")]),t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.$swal({title:"üì• Importar Cota√ß√µes",text:"Funcionalidade em desenvolvimento - Importa√ß√£o de planilhas Excel/CSV",icon:"info"})}}},[a._v(" üì• Importar Cota√ß√µes ")])]),t("div",{staticClass:"cotacoes-grid"},[0===a.cotacoes.length?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("üí∞")]),t("h3",[a._v("Nenhuma cota√ß√£o registrada")]),t("p",[a._v("Comece registrando cota√ß√µes de fornecedores para an√°lise de pre√ßos.")])]):t("div",a._l(a.cotacoes,(function(e){return t("div",{key:e.id,staticClass:"cotacao-card"},[t("div",{staticClass:"cotacao-header"},[t("h5",[a._v(a._s(e.produto))]),t("span",{staticClass:"cotacao-data"},[a._v(a._s(a.formatDate(e.data)))])]),t("div",{staticClass:"cotacao-content"},[t("p",[t("strong",[a._v("Fornecedor:")]),a._v(" "+a._s(e.fornecedor))]),t("p",[t("strong",[a._v("Pre√ßo:")]),a._v(" "+a._s(a.formatCurrency(e.preco)))]),t("p",[t("strong",[a._v("Prazo:")]),a._v(" "+a._s(e.prazo))])]),t("div",{staticClass:"cotacao-actions"},[t("button",{staticClass:"btn-small",on:{click:function(t){return a.$swal({title:"‚úèÔ∏è Editar Cota√ß√£o",text:"Funcionalidade em desenvolvimento",icon:"info"})}}},[a._v("Editar")]),t("button",{staticClass:"btn-small btn-danger",on:{click:function(t){return a.$swal({title:"üóëÔ∏è Remover Cota√ß√£o",text:"Funcionalidade em desenvolvimento",icon:"info"})}}},[a._v("Remover")])])])})),0)])])]):a._e(),"comparativo"===a.activeSubTab?t("div",{staticClass:"sub-content"},[t("div",{staticClass:"comparativo-section"},[a._m(5),t("div",{staticClass:"comparativo-actions"},[t("button",{staticClass:"btn-primary",on:{click:function(t){return a.$swal({title:"üìä Novo Comparativo",text:"Funcionalidade em desenvolvimento - Comparativo t√©cnico detalhado",icon:"info"})}}},[a._v(" ‚ûï Novo Comparativo ")]),t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.$swal({title:"üìä Gerar Relat√≥rio",text:"Funcionalidade em desenvolvimento - Gera√ß√£o de relat√≥rio comparativo",icon:"info"})}}},[a._v(" üìä Gerar Relat√≥rio ")])]),a._m(6)])]):a._e(),"analise-precos"===a.activeSubTab?t("div",{staticClass:"sub-content"},[t("div",{staticClass:"analise-precos-section"},[a._m(7),t("div",{staticClass:"analise-actions"},[t("button",{staticClass:"btn-primary",on:{click:function(t){return a.$swal({title:"üìà Gerar An√°lise",text:"Funcionalidade em desenvolvimento - An√°lise estat√≠stica de pre√ßos",icon:"info"})}}},[a._v(" üìà Gerar An√°lise ")]),t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.$swal({title:"üì§ Exportar Dados",text:"Funcionalidade em desenvolvimento - Exporta√ß√£o de dados",icon:"info"})}}},[a._v(" üì§ Exportar Dados ")])]),a._m(8)])]):a._e(),"relatorios"===a.activeSubTab?t("div",{staticClass:"sub-content"},[t("div",{staticClass:"relatorios-section"},[a._m(9),t("div",{staticClass:"relatorios-grid"},[t("div",{staticClass:"relatorio-card"},[t("div",{staticClass:"relatorio-icon"},[a._v("üìä")]),t("h5",[a._v("Relat√≥rio de Pesquisa de Mercado")]),t("p",[a._v("Relat√≥rio completo com an√°lise t√©cnica e de pre√ßos")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return a.$swal({title:"üìä Relat√≥rio de Mercado",text:"Funcionalidade em desenvolvimento - Relat√≥rio completo de pesquisa",icon:"info"})}}},[a._v("Gerar")])]),t("div",{staticClass:"relatorio-card"},[t("div",{staticClass:"relatorio-icon"},[a._v("üí∞")]),t("h5",[a._v("Relat√≥rio de Cota√ß√µes")]),t("p",[a._v("Comparativo de pre√ßos e condi√ß√µes de fornecedores")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return a.$swal({title:"üí∞ Relat√≥rio de Cota√ß√µes",text:"Funcionalidade em desenvolvimento - Comparativo de pre√ßos",icon:"info"})}}},[a._v("Gerar")])]),t("div",{staticClass:"relatorio-card"},[t("div",{staticClass:"relatorio-icon"},[a._v("üìà")]),t("h5",[a._v("Relat√≥rio de An√°lise de Pre√ßos")]),t("p",[a._v("An√°lise estat√≠stica de varia√ß√£o de pre√ßos")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return a.$swal({title:"üìà Relat√≥rio de An√°lise",text:"Funcionalidade em desenvolvimento - An√°lise estat√≠stica",icon:"info"})}}},[a._v("Gerar")])])])])]):a._e(),"bancos-precos"===a.activeSubTab?t("div",{staticClass:"sub-content"},[t("div",{staticClass:"bancos-precos-section"},[a._m(10),t("div",{staticClass:"bancos-grid"},[t("div",{staticClass:"banco-card"},[t("div",{staticClass:"banco-icon"},[a._v("üèõÔ∏è")]),t("h5",[a._v("Banco de Pre√ßos do Governo Federal")]),t("p",[a._v("Consulta ao banco de pre√ßos oficial do governo")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return a.$swal({title:"üèõÔ∏è Banco Federal",text:"Funcionalidade em desenvolvimento - Consulta ao banco de pre√ßos oficial",icon:"info"})}}},[a._v("Consultar")])]),t("div",{staticClass:"banco-card"},[t("div",{staticClass:"banco-icon"},[a._v("üè•")]),t("h5",[a._v("Banco de Pre√ßos em Sa√∫de")]),t("p",[a._v("Pre√ßos de medicamentos e materiais m√©dicos")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return a.$swal({title:"üè• Banco de Sa√∫de",text:"Funcionalidade em desenvolvimento - Pre√ßos de medicamentos e materiais",icon:"info"})}}},[a._v("Consultar")])]),t("div",{staticClass:"banco-card"},[t("div",{staticClass:"banco-icon"},[a._v("üè¢")]),t("h5",[a._v("Outros Bancos Estaduais")]),t("p",[a._v("Consulta a bancos de pre√ßos estaduais")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return a.$swal({title:"üè¢ Bancos Estaduais",text:"Funcionalidade em desenvolvimento - Consulta a bancos estaduais",icon:"info"})}}},[a._v("Consultar")])])]),a._m(11)])]):a._e()])]):a._e(),"editais"===a.activeTab?t("div",{staticClass:"editais"},[t("div",{staticClass:"editais-container"},[t("div",{staticClass:"editais-stats"},[t("div",{staticClass:"stat-card editais-ativos"},[t("h4",[a._v("üìã Publicados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.editaisAtivos.length))]),t("small",[a._v("Recebendo documenta√ß√£o")])]),t("div",{staticClass:"stat-card editais-rascunho"},[t("h4",[a._v("‚úèÔ∏è Em Elabora√ß√£o")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.editaisRascunho.length))]),t("small",[a._v("Aguardando publica√ß√£o")])]),t("div",{staticClass:"stat-card editais-finalizados"},[t("h4",[a._v("‚úÖ Finalizados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.editaisFinalizados.length))]),t("small",[a._v("Processos conclu√≠dos")])])]),t("div",{staticClass:"editais-actions"},[t("div",{staticClass:"actions-left"},[t("button",{staticClass:"btn-primary",on:{click:a.abrirModalNovoEdital}},[a._v(" ‚ûï Novo Edital ")]),t("button",{staticClass:"btn-secondary",attrs:{disabled:a.loadingEditais},on:{click:a.carregarEditais}},[a._v(" üîÑ Atualizar ")])]),t("div",{staticClass:"actions-right"},[t("div",{staticClass:"filtro-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroEditais.busca,expression:"filtroEditais.busca"}],attrs:{type:"text",placeholder:"üîç Buscar edital..."},domProps:{value:a.filtroEditais.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtroEditais,"busca",t.target.value)},a.aplicarFiltrosEditais]}})]),t("div",{staticClass:"filtro-group"},[t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtroEditais.status,expression:"filtroEditais.status"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtroEditais,"status",t.target.multiple?e:e[0])},a.aplicarFiltrosEditais]}},[t("option",{attrs:{value:""}},[a._v("Todos os Status")]),t("option",{attrs:{value:"RASCUNHO"}},[a._v("üìù Em Elabora√ß√£o")]),t("option",{attrs:{value:"PUBLICADO"}},[a._v("üìã Publicado")]),t("option",{attrs:{value:"CANCELADO"}},[a._v("‚ùå Cancelado")])])])])]),a.loadingEditais?t("div",{staticClass:"loading-state"},[t("div",{staticClass:"loading-spinner"}),t("p",[a._v("Carregando editais...")])]):a.editaisFiltrados.length>0?t("div",{staticClass:"editais-grid"},a._l(a.editaisFiltrados,(function(e){return t("div",{key:e.id,staticClass:"edital-card",class:{"status-ativo":"PUBLICADO"===e.status,"status-rascunho":"RASCUNHO"===e.status,"status-cancelado":"CANCELADO"===e.status}},[t("div",{staticClass:"edital-header"},[t("div",{staticClass:"edital-numero"},[a._v(a._s(e.numero))]),t("div",{staticClass:"edital-status"},["PUBLICADO"===e.status?t("span",{staticClass:"badge status-publicado"},[a._v("üìã Publicado")]):"RASCUNHO"===e.status?t("span",{staticClass:"badge status-rascunho"},[a._v("‚úèÔ∏è Em Elabora√ß√£o")]):"CANCELADO"===e.status?t("span",{staticClass:"badge status-cancelado"},[a._v("‚ùå Cancelado")]):a._e()])]),t("div",{staticClass:"edital-content"},[t("h4",[a._v(a._s(e.descricao))]),t("div",{staticClass:"edital-info"},["PUBLICADO"===e.status?[t("p",[t("strong",[a._v("üìÖ Publica√ß√£o:")]),a._v(" "+a._s(a.formatDate(e.data_publicacao)))]),e.data_limite_impugnacao?t("p",[t("strong",[a._v("‚è∞ Prazo Impugna√ß√£o:")]),a._v(" "+a._s(a.formatDate(e.data_limite_impugnacao))+" ")]):a._e()]:a._e()],2)]),t("div",{staticClass:"edital-actions"},[t("button",{staticClass:"btn-secondary btn-small",on:{click:function(t){return a.visualizarEdital(e)}}},[a._v(" üëÅÔ∏è Visualizar ")]),"RASCUNHO"===e.status?t("button",{staticClass:"btn-primary btn-small",on:{click:function(t){return a.editarEdital(e)}}},[a._v(" ‚úèÔ∏è Editar ")]):a._e(),t("div",{staticClass:"dropdown"},[t("button",{staticClass:"btn-secondary btn-small dropdown-toggle"},[a._v("‚ãÆ")]),t("div",{staticClass:"dropdown-menu"},[e.url_documento?t("a",{on:{click:function(t){return a.baixarDocumento(e)}}},[a._v("üì• Baixar PDF")]):a._e(),t("a",{on:{click:function(t){return a.duplicarEdital(e)}}},[a._v("üìã Duplicar")]),"RASCUNHO"===e.status?t("a",{staticClass:"text-danger",on:{click:function(t){return a.cancelarEdital(e)}}},[a._v("‚ùå Cancelar")]):a._e()])])])])})),0):t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("üìã")]),t("h3",[a._v("Nenhum edital encontrado")]),a.filtroEditais.busca||a.filtroEditais.status?t("p",[a._v(" Nenhum edital corresponde aos filtros aplicados. ")]):t("p",[a._v(' Ainda n√£o h√° editais cadastrados. Clique em "Novo Edital" para come√ßar. ')]),t("button",{staticClass:"btn-primary",on:{click:a.abrirModalNovoEdital}},[a._v(" ‚ûï Criar Primeiro Edital ")])])]),a.modalNovoEdital?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalNovoEdital}},[t("div",{staticClass:"modal-content large",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("üìã Selecionar Minuta Padr√£o")]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalNovoEdital}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"minuta-selecao"},[a._m(12),t("div",{staticClass:"minutas-actions"},[t("button",{staticClass:"btn-secondary",on:{click:a.abrirModalAddMinuta}},[a._v(" ‚ûï Adicionar Nova Minuta Padr√£o ")])]),t("div",{staticClass:"minutas-grid"},a._l(a.minutasDisponiveis,(function(e){return t("div",{key:e.id,staticClass:"minuta-card",class:{selected:a.minutaSelecionada===e.id},on:{click:function(t){return a.selecionarMinuta(e)}}},[t("div",{staticClass:"minuta-header"},[t("div",{staticClass:"minuta-icon"},[e.eh_padrao_sistema?t("span",[a._v("üèõÔ∏è")]):t("span",[a._v("üìÑ")])]),t("div",{staticClass:"minuta-info"},[t("h5",[a._v(a._s(e.nome))]),t("p",{staticClass:"minuta-categoria"},[a._v(a._s(e.categoria||"Geral"))])])]),t("div",{staticClass:"minuta-description"},[t("p",[a._v(a._s(e.descricao||"Sem descri√ß√£o"))])]),t("div",{staticClass:"minuta-meta"},[t("small",[e.eh_padrao_sistema?t("span",{staticClass:"badge badge-system"},[a._v("Sistema")]):t("span",{staticClass:"badge badge-custom"},[a._v("Personalizada")])])])])})),0),0===a.minutasDisponiveis.length?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("üìã")]),t("h3",[a._v("Nenhuma minuta padr√£o dispon√≠vel")]),t("p",[a._v("Adicione uma minuta padr√£o para come√ßar a criar editais.")]),t("button",{staticClass:"btn-primary",on:{click:a.abrirModalAddMinuta}},[a._v(" ‚ûï Adicionar Primeira Minuta ")])]):a._e()]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharModalNovoEdital}},[a._v(" Cancelar ")]),t("button",{staticClass:"btn-primary",attrs:{disabled:!a.minutaSelecionada||a.criandoEdital},on:{click:a.processarCriacaoEdital}},[a._v(" "+a._s(a.criandoEdital?"Criando...":"Criar Edital com Minuta Selecionada")+" ")])])])])]):a._e(),a.modalAddMinuta?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalAddMinuta}},[t("div",{staticClass:"modal-content medium",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("‚ûï Adicionar Nova Minuta Padr√£o")]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalAddMinuta}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarNovaMinuta.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"minuta-nome"}},[a._v("Nome da Minuta*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaMinuta.nome,expression:"novaMinuta.nome"}],attrs:{id:"minuta-nome",type:"text",placeholder:"Ex: Minuta para Material de Escrit√≥rio",required:""},domProps:{value:a.novaMinuta.nome},on:{input:function(t){t.target.composing||a.$set(a.novaMinuta,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"minuta-categoria"}},[a._v("Categoria")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.novaMinuta.categoria,expression:"novaMinuta.categoria"}],attrs:{id:"minuta-categoria"},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.novaMinuta,"categoria",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:"geral"}},[a._v("Geral")]),t("option",{attrs:{value:"medicamentos"}},[a._v("Medicamentos")]),t("option",{attrs:{value:"material_escritorio"}},[a._v("Material de Escrit√≥rio")]),t("option",{attrs:{value:"material_medico"}},[a._v("Material M√©dico")]),t("option",{attrs:{value:"equipamentos"}},[a._v("Equipamentos")]),t("option",{attrs:{value:"servicos"}},[a._v("Servi√ßos")]),t("option",{attrs:{value:"outros"}},[a._v("Outros")])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"minuta-descricao"}},[a._v("Descri√ß√£o")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.novaMinuta.descricao,expression:"novaMinuta.descricao"}],attrs:{id:"minuta-descricao",rows:"3",placeholder:"Descri√ß√£o opcional da minuta..."},domProps:{value:a.novaMinuta.descricao},on:{input:function(t){t.target.composing||a.$set(a.novaMinuta,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"minuta-arquivo"}},[a._v("Arquivo da Minuta (Word)*")]),t("input",{attrs:{id:"minuta-arquivo",type:"file",accept:".docx,.doc",required:""},on:{change:a.handleMinutaUpload}}),t("small",[a._v("Arquivo Word (.docx ou .doc) com a minuta padr√£o (m√°ximo 10MB)")])]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharModalAddMinuta}},[a._v(" Cancelar ")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.salvandoMinuta}},[a._v(" "+a._s(a.salvandoMinuta?"Salvando...":"Salvar Minuta")+" ")])])])])])]):a._e(),a.modalVisualizarEdital?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalVisualizarEdital}},[t("div",{staticClass:"modal-content large",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("üëÅÔ∏è "+a._s(a.editalSelecionado.numero)+" - "+a._s(a.editalSelecionado.descricao))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalVisualizarEdital}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"edital-detalhes"},[t("div",{staticClass:"info-section"},[t("h4",[a._v("üìã Informa√ß√µes Gerais")]),t("div",{staticClass:"info-grid"},[t("div",[t("strong",[a._v("N√∫mero:")]),a._v(" "+a._s(a.editalSelecionado.numero))]),t("div",[t("strong",[a._v("Status:")]),t("span",{class:"badge status-"+a.editalSelecionado.status.toLowerCase()},[a._v(" "+a._s(a.editalSelecionado.status)+" ")])]),"PUBLICADO"===a.editalSelecionado.status?[t("div",[t("strong",[a._v("Data Publica√ß√£o:")]),a._v(" "+a._s(a.formatDate(a.editalSelecionado.data_publicacao)))]),a.editalSelecionado.data_limite_impugnacao?t("div",[t("strong",[a._v("Prazo Impugna√ß√£o:")]),a._v(" "+a._s(a.formatDate(a.editalSelecionado.data_limite_impugnacao))+" ")]):a._e()]:a._e()],2)]),"RASCUNHO"===a.editalSelecionado.status?t("div",{staticClass:"info-section"},[t("h4",[a._v("üìÑ Minuta Padr√£o")]),t("div",{staticClass:"minuta-workflow"},[t("div",{staticClass:"workflow-step",class:{active:!0}},[t("div",{staticClass:"step-number"},[a._v("1")]),t("div",{staticClass:"step-content"},[t("h5",[a._v("Baixar Minuta")]),t("p",[a._v("Baixe a minuta padr√£o selecionada")]),t("button",{staticClass:"btn-primary btn-small",on:{click:function(t){return a.baixarMinutaPadrao(a.editalSelecionado)}}},[a._v(" üì• Baixar Minuta Padr√£o ")])])]),t("div",{staticClass:"workflow-step",class:{active:a.editalSelecionado.minuta_preenchida_url}},[t("div",{staticClass:"step-number"},[a._v("2")]),t("div",{staticClass:"step-content"},[t("h5",[a._v("Enviar Minuta Preenchida")]),t("p",[a._v("Ap√≥s preencher, envie a minuta")]),a.editalSelecionado.minuta_preenchida_url?t("div",[t("p",{staticClass:"success-text"},[a._v("‚úÖ Minuta preenchida enviada")]),t("button",{staticClass:"btn-secondary btn-small",on:{click:function(t){return a.visualizarMinutaPreenchida(a.editalSelecionado)}}},[a._v(" üëÅÔ∏è Visualizar ")])]):t("div",[t("input",{ref:"minutaPreenchidaInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".docx,.doc"},on:{change:a.handleMinutaPreenchidaUpload}}),t("button",{staticClass:"btn-primary btn-small",on:{click:function(t){return a.$refs.minutaPreenchidaInput.click()}}},[a._v(" üì§ Enviar Minuta Preenchida ")])])])]),t("div",{staticClass:"workflow-step",class:{active:a.editalSelecionado.pdf_convertido_url}},[t("div",{staticClass:"step-number"},[a._v("3")]),t("div",{staticClass:"step-content"},[t("h5",[a._v("Converter para PDF")]),t("p",[a._v("Finalizar e publicar edital")]),a.editalSelecionado.minuta_preenchida_url&&!a.editalSelecionado.pdf_convertido_url?t("div",[t("button",{staticClass:"btn-primary btn-small",on:{click:function(t){return a.processarConversaoPDF(a.editalSelecionado)}}},[a._v(" üìã Converter para PDF e Publicar ")])]):a.editalSelecionado.pdf_convertido_url?t("div",[t("p",{staticClass:"success-text"},[a._v("‚úÖ PDF gerado e publicado")])]):a._e()])])])]):a._e(),a.editalSelecionado.conteudo?t("div",{staticClass:"info-section"},[t("h4",[a._v("üìÑ Conte√∫do")]),t("div",{staticClass:"conteudo-texto"},[a._v(a._s(a.editalSelecionado.conteudo))])]):a._e(),t("div",{staticClass:"info-section"},[t("h4",[a._v("üìä Estat√≠sticas")]),t("div",{staticClass:"stats-grid"},[t("div",{staticClass:"mini-stat"}),t("div",{staticClass:"mini-stat"},[t("span",{staticClass:"mini-stat-value"},[a._v(a._s(a.editalSelecionado.produtos_submetidos||0))]),t("span",{staticClass:"mini-stat-label"},[a._v("Produtos Submetidos")])]),t("div",{staticClass:"mini-stat"},[t("span",{staticClass:"mini-stat-value"},[a._v(a._s(a.editalSelecionado.impugnacoes_count||0))]),t("span",{staticClass:"mini-stat-label"},[a._v("Impugna√ß√µes")])])])])]),t("div",{staticClass:"modal-actions"},[a.editalSelecionado.url_documento||a.editalSelecionado.pdf_convertido_url?t("button",{staticClass:"btn-primary",on:{click:function(t){return a.abrirDocumento(a.editalSelecionado.url_documento||a.editalSelecionado.pdf_convertido_url)}}},[a._v(" üìÑ Abrir PDF ")]):a._e(),a.editalSelecionado.url_documento||a.editalSelecionado.pdf_convertido_url?t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.baixarDocumento(a.editalSelecionado)}}},[a._v(" üì• Baixar PDF ")]):a._e(),t("button",{staticClass:"btn-secondary",on:{click:a.fecharModalVisualizarEdital}},[a._v(" Fechar ")])])])])]):a._e(),t("div",{staticClass:"impugnacoes-section"},[t("h3",[a._v("Impugna√ß√µes ao Edital")]),a.impugnacoes.length>0?t("table",[a._m(13),t("tbody",a._l(a.impugnacoes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.impugnante))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[a._v(a._s(a.formatDate(e.data_impugnacao)))]),t("td",[a._v(a._s(a.formatDate(e.prazo_final)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getImpugnacaoStatusClass(e.status)},[a._v(" "+a._s(e.status)+" ")])]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.analisarImpugnacao(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("N√£o h√° impugna√ß√µes apresentadas.")])])]):a._e(),"despadronizadas"===a.activeTab?t("div",{staticClass:"marcas-despadronizadas"},[a._m(14)]):a._e(),"certificados"===a.activeTab?t("div",{staticClass:"certificados-dcb"},[t("div",{staticClass:"dcb-container"},[t("div",{staticClass:"dcb-stats"},[t("div",{staticClass:"stat-card dcb-pendentes"},[t("h4",[a._v("üü° Prontos para DCB")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.produtosProntosDCB.length))]),t("small",[a._v("Produtos aprovados sem DCB")])]),t("div",{staticClass:"stat-card dcb-emitidos"},[t("h4",[a._v("‚úÖ DCBs Emitidas")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.dcbsEmitidos.length))]),t("small",[a._v("Certificados v√°lidos")])]),t("div",{staticClass:"stat-card dcb-vencendo"},[t("h4",[a._v("‚ö†Ô∏è DCBs Vencendo")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.dcbsVencendo.length))]),t("small",[a._v("Pr√≥ximos 30 dias")])]),t("div",{staticClass:"stat-card dcb-vencidos"},[t("h4",[a._v("üî¥ DCBs Vencidas")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.dcbsVencidos.length))]),t("small",[a._v("Precisam renova√ß√£o")])])]),t("div",{staticClass:"dcb-tabs"},[t("div",{staticClass:"dcb-tab",class:{active:"emitir"===a.activeTabDCB},on:{click:function(t){a.activeTabDCB="emitir"}}},[a._v(" üìù Emitir DCB ")]),t("div",{staticClass:"dcb-tab",class:{active:"historico"===a.activeTabDCB},on:{click:function(t){a.activeTabDCB="historico"}}},[a._v(" üìã Hist√≥rico DCBs ")]),t("div",{staticClass:"dcb-tab",class:{active:"vencimentos"===a.activeTabDCB},on:{click:function(t){a.activeTabDCB="vencimentos"}}},[a._v(" ‚è∞ Controle Vencimentos ")])]),"emitir"===a.activeTabDCB?t("div",{staticClass:"dcb-content"},[a._m(15),t("div",{staticClass:"filtros-dcb"},[t("div",{staticClass:"filtro-group"},[t("label",[a._v("üîç Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDCB.busca,expression:"filtrosDCB.busca"}],attrs:{type:"text",placeholder:"Nome, marca ou fabricante..."},domProps:{value:a.filtrosDCB.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtrosDCB,"busca",t.target.value)},a.aplicarFiltrosDCB]}})]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("üìÇ Categoria:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDCB.categoria,expression:"filtrosDCB.categoria"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtrosDCB,"categoria",t.target.multiple?e:e[0])},a.aplicarFiltrosDCB]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),t("option",{attrs:{value:"medicamentos"}},[a._v("Medicamentos")]),t("option",{attrs:{value:"materiais_medicos"}},[a._v("Materiais M√©dicos")]),t("option",{attrs:{value:"equipamentos"}},[a._v("Equipamentos")]),t("option",{attrs:{value:"administrativo"}},[a._v("Administrativo")])])]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("üìÖ Data Aprova√ß√£o:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDCB.dataAprovacao,expression:"filtrosDCB.dataAprovacao"}],attrs:{type:"date"},domProps:{value:a.filtrosDCB.dataAprovacao},on:{change:a.aplicarFiltrosDCB,input:function(t){t.target.composing||a.$set(a.filtrosDCB,"dataAprovacao",t.target.value)}}})]),t("button",{staticClass:"btn-limpar",on:{click:a.limparFiltrosDCB}},[a._v("üóëÔ∏è Limpar")])]),a.produtosProntosDCBFiltrados.length>0?t("div",{staticClass:"produtos-dcb-lista"},a._l(a.produtosProntosDCBFiltrados,(function(e){return t("div",{key:e.id,staticClass:"produto-dcb-card"},[t("div",{staticClass:"produto-info"},[t("div",{staticClass:"produto-header"},[t("h4",[a._v(a._s(e.nome))]),t("span",{staticClass:"status-badge status-aprovado"},[a._v("‚úÖ Aprovado")])]),t("div",{staticClass:"produto-details"},[t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(e.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(e.modelo||"N/A"))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(e.fabricante))]),t("p",[t("strong",[a._v("Data Aprova√ß√£o:")]),a._v(" "+a._s(a.formatDate(e.data_aprovacao||e.aprovado_em||e.criado_em)))])])]),t("div",{staticClass:"produto-actions"},[t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.visualizarProdutoDetalhes(e)}}},[a._v(" üëÅÔ∏è Detalhes ")]),t("button",{staticClass:"btn-primary",attrs:{disabled:a.emitindoDCB===e.id},on:{click:function(t){return a.emitirDCB(e)}}},[a.emitindoDCB===e.id?t("span",[a._v("‚è≥ Emitindo...")]):t("span",[a._v("üìú Emitir DCB")])])])])})),0):0===a.produtosProntosDCB.length?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("üìù")]),t("h3",[a._v("Nenhum produto pronto para DCB")]),t("p",[a._v("Todos os produtos aprovados j√° possuem DCB emitido ou n√£o h√° produtos aprovados.")])]):t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("üîç")]),t("h3",[a._v("Nenhum produto encontrado")]),t("p",[a._v("Nenhum produto corresponde aos filtros aplicados.")])])]):a._e(),"historico"===a.activeTabDCB?t("div",{staticClass:"dcb-content"},[a._m(16),t("div",{staticClass:"filtros-dcb"},[t("div",{staticClass:"filtro-group"},[t("label",[a._v("üî¢ N√∫mero DCB:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosHistorico.numeroDCB,expression:"filtrosHistorico.numeroDCB"}],attrs:{type:"text",placeholder:"Ex: 001/2024"},domProps:{value:a.filtrosHistorico.numeroDCB},on:{input:[function(t){t.target.composing||a.$set(a.filtrosHistorico,"numeroDCB",t.target.value)},a.aplicarFiltrosHistorico]}})]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("üìä Status:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtrosHistorico.status,expression:"filtrosHistorico.status"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtrosHistorico,"status",t.target.multiple?e:e[0])},a.aplicarFiltrosHistorico]}},[t("option",{attrs:{value:""}},[a._v("Todos")]),t("option",{attrs:{value:"ativo"}},[a._v("Ativo")]),t("option",{attrs:{value:"vencido"}},[a._v("Vencido")]),t("option",{attrs:{value:"revogado"}},[a._v("Revogado")])])]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("üìÖ Per√≠odo:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosHistorico.dataInicio,expression:"filtrosHistorico.dataInicio"}],attrs:{type:"date"},domProps:{value:a.filtrosHistorico.dataInicio},on:{change:a.aplicarFiltrosHistorico,input:function(t){t.target.composing||a.$set(a.filtrosHistorico,"dataInicio",t.target.value)}}}),t("span",[a._v("at√©")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosHistorico.dataFim,expression:"filtrosHistorico.dataFim"}],attrs:{type:"date"},domProps:{value:a.filtrosHistorico.dataFim},on:{change:a.aplicarFiltrosHistorico,input:function(t){t.target.composing||a.$set(a.filtrosHistorico,"dataFim",t.target.value)}}})])]),a.dcbsHistoricoFiltrados.length>0?t("div",{staticClass:"dcb-historico-tabela"},[t("table",[a._m(17),t("tbody",a._l(a.dcbsHistoricoFiltrados,(function(e){return t("tr",{key:e.id},[t("td",{staticClass:"dcb-numero"},[a._v(a._s(e.numero_dcb))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[a._v(a._s(e.produto_marca))]),t("td",[a._v(a._s(a.formatDate(e.data_emissao)))]),t("td",[a._v(a._s(a.formatDate(e.data_validade)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusDCBClass(e.status)},[a._v(" "+a._s(a.formatStatusDCB(e.status))+" ")])]),t("td",[t("div",{staticClass:"acoes-dcb"},[t("button",{staticClass:"btn-small",on:{click:function(t){return a.visualizarDCB(e)}}},[a._v(" üëÅÔ∏è Ver ")]),t("button",{staticClass:"btn-small",on:{click:function(t){return a.downloadDCB(e)}}},[a._v(" üì• PDF ")]),"ativo"===e.status?t("button",{staticClass:"btn-small btn-danger",on:{click:function(t){return a.revogarDCB(e)}}},[a._v(" üö´ Revogar ")]):a._e()])])])})),0)])]):t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("üìã")]),t("h3",[a._v("Nenhum DCB encontrado")]),t("p",[a._v("Nenhum certificado corresponde aos filtros aplicados.")])])]):a._e(),"vencimentos"===a.activeTabDCB?t("div",{staticClass:"dcb-content"},[a._m(18),t("div",{staticClass:"alertas-vencimento"},[a.dcbsVencendo.length>0?t("div",{staticClass:"alerta-warning"},[t("div",{staticClass:"alerta-icon"},[a._v("‚ö†Ô∏è")]),t("div",{staticClass:"alerta-content"},[t("h4",[a._v(a._s(a.dcbsVencendo.length)+" DCB(s) vencendo nos pr√≥ximos 30 dias")]),t("p",[a._v("√â recomendado iniciar o processo de renova√ß√£o.")])])]):a._e(),a.dcbsVencidos.length>0?t("div",{staticClass:"alerta-danger"},[t("div",{staticClass:"alerta-icon"},[a._v("üî¥")]),t("div",{staticClass:"alerta-content"},[t("h4",[a._v(a._s(a.dcbsVencidos.length)+" DCB(s) vencido(s)")]),t("p",[a._v("Produtos n√£o podem ser utilizados em licita√ß√µes at√© renova√ß√£o.")])])]):a._e()]),a.dcbsVencendo.length>0?t("div",{staticClass:"dcb-vencimento-section"},[t("h4",[a._v("‚ö†Ô∏è DCBs Vencendo (Pr√≥ximos 30 dias)")]),t("div",{staticClass:"dcb-vencimento-lista"},a._l(a.dcbsVencendo,(function(e){return t("div",{key:e.id,staticClass:"dcb-vencimento-card warning"},[t("div",{staticClass:"dcb-info"},[t("h5",[a._v(a._s(e.numero_dcb)+" - "+a._s(e.produto_nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(e.produto_marca))]),t("p",[t("strong",[a._v("Vence em:")]),a._v(" "+a._s(a.formatDate(e.data_validade)))]),t("p",[t("strong",[a._v("Dias restantes:")]),a._v(" "+a._s(a.calcularDiasRestantes(e.data_validade)))])]),t("div",{staticClass:"dcb-actions"},[t("button",{staticClass:"btn-warning",on:{click:function(t){return a.iniciarRenovacao(e)}}},[a._v(" üîÑ Renovar ")]),t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.visualizarDCB(e)}}},[a._v(" üëÅÔ∏è Ver DCB ")])])])})),0)]):a._e(),a.dcbsVencidos.length>0?t("div",{staticClass:"dcb-vencimento-section"},[t("h4",[a._v("üî¥ DCBs Vencidos")]),t("div",{staticClass:"dcb-vencimento-lista"},a._l(a.dcbsVencidos,(function(e){return t("div",{key:e.id,staticClass:"dcb-vencimento-card danger"},[t("div",{staticClass:"dcb-info"},[t("h5",[a._v(a._s(e.numero_dcb)+" - "+a._s(e.produto_nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(e.produto_marca))]),t("p",[t("strong",[a._v("Venceu em:")]),a._v(" "+a._s(a.formatDate(e.data_validade)))]),t("p",[t("strong",[a._v("Vencido h√°:")]),a._v(" "+a._s(a.calcularDiasVencidos(e.data_validade))+" dias")])]),t("div",{staticClass:"dcb-actions"},[t("button",{staticClass:"btn-danger",on:{click:function(t){return a.renovarDCBVencido(e)}}},[a._v(" üîÑ Renovar Urgente ")]),t("button",{staticClass:"btn-secondary",on:{click:function(t){return a.visualizarDCB(e)}}},[a._v(" üëÅÔ∏è Ver DCB ")])])])})),0)]):a._e(),0===a.dcbsVencendo.length&&0===a.dcbsVencidos.length?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("‚úÖ")]),t("h3",[a._v("Todos os DCBs est√£o em dia!")]),t("p",[a._v("N√£o h√° certificados vencidos ou pr√≥ximos ao vencimento.")])]):a._e()]):a._e()]),a.modalProdutoDetalhes?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalDetalhes}},[t("div",{staticClass:"modal-content produto-detalhes-modal",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("üìã Detalhes do Produto")]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalDetalhes}},[a._v("‚úï")])]),a.produtoSelecionado?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"produto-detalhes-grid"},[t("div",{staticClass:"detalhes-section"},[t("h4",[a._v("üì¶ Informa√ß√µes B√°sicas")]),t("p",[t("strong",[a._v("Nome:")]),a._v(" "+a._s(a.produtoSelecionado.nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoSelecionado.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoSelecionado.modelo||"N/A"))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoSelecionado.fabricante))]),t("p",[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produtoSelecionado.cnpj_fabricante||a.produtoSelecionado.cnpj||"N√£o informado"))])]),t("div",{staticClass:"detalhes-section"},[t("h4",[a._v("‚úÖ Status da Aprova√ß√£o")]),t("p",[t("strong",[a._v("Status:")]),t("span",{staticClass:"status-badge status-aprovado"},[a._v(a._s(a.formatarStatus(a.produtoSelecionado.status)))])]),t("p",[t("strong",[a._v("Data Aprova√ß√£o:")]),a._v(" "+a._s(a.formatDate(a.produtoSelecionado.data_aprovacao||a.produtoSelecionado.aprovado_em||a.produtoSelecionado.criado_em)))]),t("p",[t("strong",[a._v("Aprovado por:")]),a._v(" "+a._s(a.produtoSelecionado.aprovado_por_nome||"Sistema"))])])]),a.produtoSelecionado.especificacoes_tecnicas?t("div",{staticClass:"detalhes-section"},[t("h4",[a._v("üîß Especifica√ß√µes T√©cnicas")]),t("pre",[a._v(a._s(a.formatarEspecificacoes(a.produtoSelecionado.especificacoes_tecnicas)))])]):a._e(),a.produtoSelecionado.observacoes_internas?t("div",{staticClass:"detalhes-section"},[t("h4",[a._v("üìù Observa√ß√µes")]),t("p",[a._v(a._s(a.produtoSelecionado.observacoes_internas))])]):a._e()]):a._e(),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn-secondary",on:{click:a.fecharModalDetalhes}},[a._v("Fechar")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return a.emitirDCB(a.produtoSelecionado)}}},[a._v(" üìú Emitir DCB ")])])])]):a._e(),a.modalVisualizarDCB?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalDCB}},[t("div",{staticClass:"modal-content dcb-visualizar-modal",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("üìú Visualizar DCB")]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalDCB}},[a._v("‚úï")])]),a.dcbSelecionado?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"dcb-preview"},[t("div",{staticClass:"dcb-header"},[t("h2",[a._v("DECLARA√á√ÉO DE CONFORMIDADE DE BEM")]),t("h3",[a._v("DCB N¬∫ "+a._s(a.dcbSelecionado.numero_dcb))])]),t("div",{staticClass:"dcb-content-preview"},[t("div",{staticClass:"dcb-section"},[t("h4",[a._v("PRODUTO CERTIFICADO")]),t("p",[t("strong",[a._v("Nome:")]),a._v(" "+a._s(a.dcbSelecionado.produto_nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.dcbSelecionado.produto_marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.dcbSelecionado.produto_modelo||"N/A"))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.dcbSelecionado.produto_fabricante))])]),t("div",{staticClass:"dcb-section"},[t("h4",[a._v("DADOS DO CERTIFICADO")]),t("p",[t("strong",[a._v("Data de Emiss√£o:")]),a._v(" "+a._s(a.formatDate(a.dcbSelecionado.data_emissao)))]),t("p",[t("strong",[a._v("Validade:")]),a._v(" "+a._s(a.formatDate(a.dcbSelecionado.data_validade)))]),t("p",[t("strong",[a._v("Status:")]),t("span",{staticClass:"status-badge",class:a.getStatusDCBClass(a.dcbSelecionado.status)},[a._v(" "+a._s(a.formatStatusDCB(a.dcbSelecionado.status))+" ")])])])])])]):a._e(),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn-secondary",on:{click:a.fecharModalDCB}},[a._v("Fechar")]),t("button",{staticClass:"btn-primary",on:{click:function(t){return a.downloadDCB(a.dcbSelecionado)}}},[a._v(" üì• Download PDF ")])])])]):a._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:a.modalParticipantes,expression:"modalParticipantes"}],staticClass:"modal-participantes-overlay"},[t("div",{staticClass:"modal-participantes-content"},[t("div",{staticClass:"modal-participantes-header"},[t("h3",[a._v("üë• Participantes - "+a._s(a.editalSelecionado.numero))]),t("button",{staticClass:"btn-close-participantes",on:{click:a.fecharModalParticipantes}},[a._v("√ó")])]),t("div",{staticClass:"modal-participantes-body"},[t("div",{staticClass:"participantes-header"},[t("div",{staticClass:"filtros-participantes"},[t("div",{staticClass:"filtro-group"},[t("label",[a._v("üîç Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroParticipantes.busca,expression:"filtroParticipantes.busca"}],attrs:{type:"text",placeholder:"Nome, CNPJ, representante..."},domProps:{value:a.filtroParticipantes.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtroParticipantes,"busca",t.target.value)},a.aplicarFiltrosParticipantes]}})]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("üìä Status:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtroParticipantes.status,expression:"filtroParticipantes.status"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtroParticipantes,"status",t.target.multiple?e:e[0])},a.aplicarFiltrosParticipantes]}},[t("option",{attrs:{value:""}},[a._v("Todos")]),t("option",{attrs:{value:"INTERESSADO"}},[a._v("Interessado")]),t("option",{attrs:{value:"DOCUMENTACAO_ENVIADA"}},[a._v("Documenta√ß√£o Enviada")]),t("option",{attrs:{value:"EM_AVALIACAO"}},[a._v("Em Avalia√ß√£o")]),t("option",{attrs:{value:"APROVADO"}},[a._v("Aprovado")]),t("option",{attrs:{value:"REPROVADO"}},[a._v("Reprovado")]),t("option",{attrs:{value:"DESISTENTE"}},[a._v("Desistente")])])])]),t("button",{staticClass:"btn-primary",on:{click:a.abrirModalNovoParticipante}},[a._v(" ‚ûï Adicionar Participante ")])]),a.loadingParticipantes?t("div",{staticClass:"loading-state"},[t("div",{staticClass:"spinner"}),t("p",[a._v("Carregando participantes...")])]):a.participantesFiltrados.length>0?t("div",{staticClass:"participantes-lista"},a._l(a.participantesFiltrados,(function(e){return t("div",{key:e.id,staticClass:"participante-card"},[t("div",{staticClass:"participante-info"},[t("div",{staticClass:"participante-header"},[t("h4",[a._v(a._s(e.razao_social))]),t("span",{staticClass:"status-badge",class:a.getStatusClass(e.status)},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")])]),t("div",{staticClass:"participante-details"},[t("p",[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.formatarCNPJ(e.cnpj)))]),t("p",[t("strong",[a._v("Representante:")]),a._v(" "+a._s(e.representante_legal))]),t("p",[t("strong",[a._v("Email:")]),a._v(" "+a._s(e.email))]),e.telefone?t("p",[t("strong",[a._v("Telefone:")]),a._v(" "+a._s(e.telefone))]):a._e(),t("p",[t("strong",[a._v("Data Participa√ß√£o:")]),a._v(" "+a._s(a.formatDate(e.data_participacao)))]),e.data_envio_documentacao?t("p",[t("strong",[a._v("Documenta√ß√£o Enviada:")]),a._v(" "+a._s(a.formatDate(e.data_envio_documentacao))+" ")]):a._e(),e.observacoes?t("p",[t("strong",[a._v("Observa√ß√µes:")]),a._v(" "+a._s(e.observacoes)+" ")]):a._e()])]),t("div",{staticClass:"participante-actions"},[t("button",{staticClass:"btn-secondary btn-small",on:{click:function(t){return a.editarParticipante(e)}}},[a._v(" ‚úèÔ∏è Editar ")]),t("button",{staticClass:"btn-danger btn-small",on:{click:function(t){return a.removerParticipante(e)}}},[a._v(" üóëÔ∏è Remover ")])])])})),0):t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("üë•")]),t("h3",[a._v("Nenhum participante encontrado")]),a.filtroParticipantes.busca||a.filtroParticipantes.status?t("p",[a._v(" Nenhum participante corresponde aos filtros aplicados. ")]):t("p",[a._v(' Ainda n√£o h√° participantes neste edital. Clique em "Adicionar Participante" para come√ßar. ')])])]),t("div",{staticClass:"modal-participantes-footer"},[t("button",{staticClass:"btn-secondary",on:{click:a.fecharModalParticipantes}},[a._v("Fechar")])])])]),a.modalNovoParticipante?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalNovoParticipante}},[t("div",{staticClass:"modal-content large",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.participanteAtual.id?"‚úèÔ∏è Editar Participante":"‚ûï Novo Participante"))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalNovoParticipante}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarParticipante.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"razao_social"}},[a._v("Raz√£o Social*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.razao_social,expression:"participanteAtual.razao_social"}],attrs:{id:"razao_social",type:"text",placeholder:"Nome da empresa",required:""},domProps:{value:a.participanteAtual.razao_social},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"razao_social",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cnpj"}},[a._v("CNPJ*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.cnpj,expression:"participanteAtual.cnpj"}],attrs:{id:"cnpj",type:"text",placeholder:"00.000.000/0000-00",required:""},domProps:{value:a.participanteAtual.cnpj},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"cnpj",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"representante_legal"}},[a._v("Representante Legal*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.representante_legal,expression:"participanteAtual.representante_legal"}],attrs:{id:"representante_legal",type:"text",placeholder:"Nome do representante",required:""},domProps:{value:a.participanteAtual.representante_legal},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"representante_legal",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[a._v("Email*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.email,expression:"participanteAtual.email"}],attrs:{id:"email",type:"email",placeholder:"contato@empresa.com",required:""},domProps:{value:a.participanteAtual.email},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"email",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"telefone"}},[a._v("Telefone")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.telefone,expression:"participanteAtual.telefone"}],attrs:{id:"telefone",type:"text",placeholder:"(11) 99999-9999"},domProps:{value:a.participanteAtual.telefone},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"telefone",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"status"}},[a._v("Status")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.status,expression:"participanteAtual.status"}],attrs:{id:"status"},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.participanteAtual,"status",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:"INTERESSADO"}},[a._v("Interessado")]),t("option",{attrs:{value:"DOCUMENTACAO_ENVIADA"}},[a._v("Documenta√ß√£o Enviada")]),t("option",{attrs:{value:"EM_AVALIACAO"}},[a._v("Em Avalia√ß√£o")]),t("option",{attrs:{value:"APROVADO"}},[a._v("Aprovado")]),t("option",{attrs:{value:"REPROVADO"}},[a._v("Reprovado")]),t("option",{attrs:{value:"DESISTENTE"}},[a._v("Desistente")])])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"endereco"}},[a._v("Endere√ßo")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.endereco,expression:"participanteAtual.endereco"}],attrs:{id:"endereco",type:"text",placeholder:"Endere√ßo completo da empresa"},domProps:{value:a.participanteAtual.endereco},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"endereco",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"observacoes"}},[a._v("Observa√ß√µes")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.participanteAtual.observacoes,expression:"participanteAtual.observacoes"}],attrs:{id:"observacoes",rows:"3",placeholder:"Observa√ß√µes sobre a participa√ß√£o..."},domProps:{value:a.participanteAtual.observacoes},on:{input:function(t){t.target.composing||a.$set(a.participanteAtual,"observacoes",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharModalNovoParticipante}},[a._v(" Cancelar ")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit"}},[a._v(" "+a._s(a.participanteAtual.id?"Atualizar":"Adicionar")+" Participante ")])])])])])]):a._e()]):a._e(),"usuarios"===a.activeTab?t("div",{staticClass:"usuarios-section"},[a._m(19),t("div",{staticClass:"section-actions"},[t("button",{staticClass:"btn-primary",on:{click:a.abrirModalNovoUsuario}},[a._v(" ‚ûï Cadastrar Novo Usu√°rio ")])]),t("div",{staticClass:"usuarios-container"},[t("div",{staticClass:"filtros-usuarios"},[t("div",{staticClass:"filtro-group"},[t("label",[a._v("üîç Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroUsuarios.busca,expression:"filtroUsuarios.busca"}],attrs:{type:"text",placeholder:"Nome, unidade, coordenador..."},domProps:{value:a.filtroUsuarios.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtroUsuarios,"busca",t.target.value)},a.aplicarFiltrosUsuarios]}})]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("üè¢ Unidade:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtroUsuarios.unidade,expression:"filtroUsuarios.unidade"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtroUsuarios,"unidade",t.target.multiple?e:e[0])},a.aplicarFiltrosUsuarios]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),a._l(a.unidadesUnicas,(function(e){return t("option",{key:e,domProps:{value:e}},[a._v(" "+a._s(e)+" ")])}))],2)])]),a.usuariosFiltrados.length>0?t("div",{staticClass:"usuarios-grid"},a._l(a.usuariosFiltrados,(function(e){return t("div",{key:e.id,staticClass:"usuario-card"},[t("div",{staticClass:"usuario-header"},[t("h4",[a._v(a._s(e.nome_usuario))]),t("div",{staticClass:"status-badges"},[t("span",{staticClass:"status-badge status-ativo"},[a._v("Ativo")]),e.user_id?t("span",{class:["status-convite",e.convite_aceito?"aceito":e.convite_enviado?"enviado":"pendente"]},[a._v(" "+a._s(e.convite_aceito?"üü¢ Conectado":e.convite_enviado?"üìß Convite Enviado":"‚è≥ Convite Pendente")+" ")]):a._e()])]),t("div",{staticClass:"usuario-details"},[t("p",[t("strong",[a._v("Unidade/Setor:")]),a._v(" "+a._s(e.unidade_setor))]),t("p",[t("strong",[a._v("Coordenador:")]),a._v(" "+a._s(e.nome_coordenador))]),t("p",[t("strong",[a._v("Telefone:")]),a._v(" "+a._s(e.telefone))]),t("p",[t("strong",[a._v("Email:")]),a._v(" "+a._s(e.email))]),t("p",[t("strong",[a._v("Materiais:")]),a._v(" "+a._s(e.materiais?.length||0)+" cadastrados")]),t("p",[t("strong",[a._v("Pr√≥ximo RDM:")]),t("span",{staticClass:"data-rdm"},[a._v(a._s(a.calcularProximoRDM(e)))])])]),t("div",{staticClass:"usuario-actions"},[t("button",{staticClass:"btn-secondary btn-small",on:{click:function(t){return a.editarUsuario(e)}}},[a._v(" ‚úèÔ∏è Editar ")]),t("button",{staticClass:"btn-info btn-small",on:{click:function(t){return a.verMateriaisUsuario(e)}}},[a._v(" üì¶ Materiais ")]),e.user_id&&!e.convite_aceito?t("button",{staticClass:"btn-reenviar btn-small",on:{click:function(t){return a.reenviarConvite(e)}}},[a._v(" üìß Reenviar Convite ")]):a._e(),t("button",{staticClass:"btn-danger btn-small",on:{click:function(t){return a.removerUsuario(e)}}},[a._v(" üóëÔ∏è Remover ")])])])})),0):t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("üë•")]),t("h3",[a._v("Nenhum usu√°rio cadastrado")]),t("p",[a._v('Clique em "Cadastrar Novo Usu√°rio" para come√ßar.')])])]),a.modalNovoUsuario?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalNovoUsuario}},[t("div",{staticClass:"modal-content large",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.usuarioAtual.id?"‚úèÔ∏è Editar Usu√°rio":"üë• Novo Usu√°rio"))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModalNovoUsuario}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarUsuario.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome_usuario"}},[a._v("Nome do Usu√°rio/Unidade*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.nome_usuario,expression:"usuarioAtual.nome_usuario"}],attrs:{id:"nome_usuario",type:"text",placeholder:"Ex: Departamento de Compras, Jo√£o Silva",required:""},domProps:{value:a.usuarioAtual.nome_usuario},on:{input:function(t){t.target.composing||a.$set(a.usuarioAtual,"nome_usuario",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"unidade_setor"}},[a._v("Unidade/Setor*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.unidade_setor,expression:"usuarioAtual.unidade_setor"}],attrs:{id:"unidade_setor",type:"text",placeholder:"Ex: Secretaria da Sa√∫de",required:""},domProps:{value:a.usuarioAtual.unidade_setor},on:{input:function(t){t.target.composing||a.$set(a.usuarioAtual,"unidade_setor",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome_coordenador"}},[a._v("Nome do Coordenador*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.nome_coordenador,expression:"usuarioAtual.nome_coordenador"}],attrs:{id:"nome_coordenador",type:"text",placeholder:"Nome completo do respons√°vel",required:""},domProps:{value:a.usuarioAtual.nome_coordenador},on:{input:function(t){t.target.composing||a.$set(a.usuarioAtual,"nome_coordenador",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"telefone_usuario"}},[a._v("Telefone*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.telefone,expression:"usuarioAtual.telefone"}],attrs:{id:"telefone_usuario",type:"tel",placeholder:"(00) 00000-0000",required:""},domProps:{value:a.usuarioAtual.telefone},on:{input:function(t){t.target.composing||a.$set(a.usuarioAtual,"telefone",t.target.value)}}})])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email_usuario"}},[a._v("Email*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.email,expression:"usuarioAtual.email"}],attrs:{id:"email_usuario",type:"email",placeholder:"email@exemplo.com",required:""},domProps:{value:a.usuarioAtual.email},on:{input:function(t){t.target.composing||a.$set(a.usuarioAtual,"email",t.target.value)}}})]),t("div",{staticClass:"login-system-section"},[t("h4",[a._v("üîê Sistema de Login")]),t("div",{staticClass:"form-group checkbox-group"},[t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.usuarioAtual.criar_login,expression:"usuarioAtual.criar_login"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(a.usuarioAtual.criar_login)?a._i(a.usuarioAtual.criar_login,null)>-1:a.usuarioAtual.criar_login},on:{change:[function(t){var e=a.usuarioAtual.criar_login,o=t.target,i=!!o.checked;if(Array.isArray(e)){var s=null,r=a._i(e,s);o.checked?r<0&&a.$set(a.usuarioAtual,"criar_login",e.concat([s])):r>-1&&a.$set(a.usuarioAtual,"criar_login",e.slice(0,r).concat(e.slice(r+1)))}else a.$set(a.usuarioAtual,"criar_login",i)},a.toggleLoginSystem]}}),t("span",{staticClass:"checkmark"},[a._v("‚úì")]),a._v(" Permitir login no sistema (Dashboard RDM Online) ")]),t("p",{staticClass:"help-text"},[a._v(" Ao marcar esta op√ß√£o, o usu√°rio receber√° um email com senha de acesso e instru√ß√µes para usar o sistema RDM. ")])]),a.usuarioAtual.criar_login?t("div",{staticClass:"convite-info"},[t("div",{staticClass:"info-card"},[t("h5",[a._v("üìß Convite Autom√°tico")]),t("p",[a._v("Ser√° enviado automaticamente um email para "),t("strong",[a._v(a._s(a.usuarioAtual.email))]),a._v(" com:")]),a._m(20)])]):a._e()]),t("div",{staticClass:"materiais-section"},[t("h4",[a._v("üì¶ Materiais sob Responsabilidade")]),t("div",{staticClass:"materiais-lista"},[a._l(a.usuarioAtual.materiais,(function(e,o){return t("div",{key:o,staticClass:"material-item"},[t("div",{staticClass:"material-fields-novo"},[t("div",{staticClass:"material-select"},[t("label",[a._v("üì¶ Material/Produto:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.produto_id,expression:"material.produto_id"}],attrs:{disabled:a.loadingProdutos,required:""},on:{change:[function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(e,"produto_id",t.target.multiple?o:o[0])},function(t){return a.selecionarProduto(o,t)}]}},[a.loadingProdutos?t("option",{attrs:{value:""}},[a._v("‚è≥ Carregando produtos...")]):0===a.produtosDisponiveis.length?t("option",{attrs:{value:""}},[a._v("Nenhum produto encontrado")]):t("option",{attrs:{value:""}},[a._v("Selecione um produto...")]),a._l(a.produtosDisponiveis,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" - "+a._s(e.marca||"S/Marca")+" ("+a._s(e.codigo_material||e.modelo||"S/C√≥digo")+") ")])})),t("option",{attrs:{value:"NOVO"}},[a._v("‚ûï Cadastrar Novo Material")])],2)]),"NOVO"===e.produto_id?t("div",{staticClass:"novo-material"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.nome,expression:"material.nome"}],attrs:{type:"text",placeholder:"Nome do novo material",required:""},domProps:{value:e.nome},on:{input:function(t){t.target.composing||a.$set(e,"nome",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.codigo,expression:"material.codigo"}],attrs:{type:"text",placeholder:"C√≥digo do material",required:""},domProps:{value:e.codigo},on:{input:function(t){t.target.composing||a.$set(e,"codigo",t.target.value)}}})]):a._e(),t("div",{staticClass:"material-periodo"},[t("label",[a._v("üìÖ Periodicidade RDM:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.periodicidade_rdm,expression:"material.periodicidade_rdm"}],attrs:{required:""},on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(e,"periodicidade_rdm",t.target.multiple?o:o[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecionar...")]),t("option",{attrs:{value:"mensal"}},[a._v("Mensal")]),t("option",{attrs:{value:"bimestral"}},[a._v("Bimestral")]),t("option",{attrs:{value:"trimestral"}},[a._v("Trimestral")]),t("option",{attrs:{value:"semestral"}},[a._v("Semestral")]),t("option",{attrs:{value:"anual"}},[a._v("Anual")])])]),t("button",{staticClass:"btn-danger btn-small",attrs:{type:"button",title:"Remover material"},on:{click:function(t){return a.removerMaterial(o)}}},[a._v(" üóëÔ∏è ")])])])})),t("div",{staticClass:"material-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button",disabled:a.loadingProdutos},on:{click:a.adicionarMaterial}},[a.loadingProdutos?t("span",[a._v("‚è≥")]):t("span",[a._v("‚ûï")]),a._v(" Adicionar Material ")]),t("button",{staticClass:"btn-info btn-small",attrs:{type:"button",disabled:a.loadingProdutos},on:{click:a.carregarProdutos}},[a.loadingProdutos?t("span",[a._v("‚è≥")]):t("span",[a._v("üîÑ")]),a._v(" Atualizar Lista ")])]),a.loadingProdutos?a._e():t("div",{staticClass:"debug-info"},[t("small",[a._v(" üìä Debug: "+a._s(a.produtosDisponiveis.length)+" produtos dispon√≠veis "),a.currentTenantId?t("span",[a._v("(Tenant: "+a._s(a.currentTenantId.substring(0,8))+"...)")]):a._e(),t("br"),a._v(" üìã Materiais do usu√°rio: "+a._s(a.usuarioAtual.materiais?.length||0)+" "),a.usuarioAtual.materiais?.length>0?t("span",[a._v(" ("+a._s(a.usuarioAtual.materiais.map((a=>a.nome||"Sem nome")).join(", "))+") ")]):a._e()])])],2)]),t("div",{staticClass:"modal-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharModalNovoUsuario}},[a._v(" Cancelar ")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit"}},[a._v(" "+a._s(a.usuarioAtual.id?"Atualizar":"Cadastrar")+" Usu√°rio ")])])])])])]):a._e()]):a._e(),"reclamacoes"===a.activeTab?t("div",{staticClass:"avaliacoes-section"},[a._m(21),t("div",{staticClass:"section-actions"},[t("small",{staticStyle:{color:"#666"}},[a._v(" üìä Total: "+a._s(a.avaliacoes.length)+" | Filtradas: "+a._s(a.avaliacoesFiltradas.length)+" ")])]),t("div",{staticClass:"filtros-avaliacoes"},[t("div",{staticClass:"filtro-group"},[t("label",[a._v("üîç Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroAvaliacoes.busca,expression:"filtroAvaliacoes.busca"}],attrs:{type:"text",placeholder:"Material, usu√°rio, coment√°rio..."},domProps:{value:a.filtroAvaliacoes.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtroAvaliacoes,"busca",t.target.value)},a.aplicarFiltrosAvaliacoes]}})]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("‚≠ê Avalia√ß√£o:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtroAvaliacoes.rating,expression:"filtroAvaliacoes.rating"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtroAvaliacoes,"rating",t.target.multiple?e:e[0])},a.aplicarFiltrosAvaliacoes]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),t("option",{attrs:{value:"5"}},[a._v("‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 estrelas)")]),t("option",{attrs:{value:"4"}},[a._v("‚≠ê‚≠ê‚≠ê‚≠ê (4 estrelas)")]),t("option",{attrs:{value:"3"}},[a._v("‚≠ê‚≠ê‚≠ê (3 estrelas)")]),t("option",{attrs:{value:"2"}},[a._v("‚≠ê‚≠ê (2 estrelas)")]),t("option",{attrs:{value:"1"}},[a._v("‚≠ê (1 estrela)")])])]),t("div",{staticClass:"filtro-group"},[t("label",[a._v("üë§ Usu√°rio:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroAvaliacoes.usuario,expression:"filtroAvaliacoes.usuario"}],attrs:{type:"text",placeholder:"Nome do usu√°rio..."},domProps:{value:a.filtroAvaliacoes.usuario},on:{input:[function(t){t.target.composing||a.$set(a.filtroAvaliacoes,"usuario",t.target.value)},a.aplicarFiltrosAvaliacoes]}})])]),a.avaliacoesFiltradas.length>0?t("div",{staticClass:"avaliacoes-lista"},a._l(a.avaliacoesFiltradas,(function(e){return t("div",{key:e.id,staticClass:"avaliacao-card"},[t("div",{staticClass:"avaliacao-header"},[t("h4",[a._v(a._s(e.usuario_rdm?.nome_usuario||"Usu√°rio n√£o encontrado"))]),t("div",{staticClass:"rating-display"},[a._l(5,(function(o){return t("span",{key:o,staticClass:"star",class:{active:e.rating>=o}},[a._v("‚≠ê")])})),t("span",{staticClass:"rating-text"},[a._v(a._s(e.rating)+"/5")])],2)]),t("div",{staticClass:"avaliacao-content"},[t("div",{staticClass:"avaliacao-info"},[t("p",[t("strong",[a._v("Unidade/Setor:")]),a._v(" "+a._s(e.usuario_rdm?.unidade_setor||"N/A"))]),t("p",[t("strong",[a._v("Material:")]),a._v(" "+a._s(e.material_nome)+" ("+a._s(e.material_codigo)+")")]),t("p",[t("strong",[a._v("Data:")]),a._v(" "+a._s(a.formatDate(e.criado_em)))]),t("p",[t("strong",[a._v("Contato:")]),a._v(" "+a._s(e.usuario_rdm?.email||"N/A")+" | "+a._s(e.usuario_rdm?.telefone||"N/A"))])]),t("div",{staticClass:"avaliacao-detalhes"},[e.comentario?t("div",{staticClass:"comentario-texto"},[t("h5",[a._v("üí¨ Coment√°rio:")]),t("p",[a._v(a._s(e.comentario))])]):a._e(),e.comentario?a._e():t("div",{staticClass:"sem-comentario"},[a._m(22,!0)])])])])})),0):a._e(),0===a.avaliacoesFiltradas.length?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[a._v("‚≠ê")]),t("h3",[a._v("Nenhuma avalia√ß√£o encontrada")]),t("p",[a._v("Quando houver avalia√ß√µes de materiais, elas aparecer√£o aqui.")])]):a._e()]):a._e()])},j=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("A√ß√µes")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("A√ß√µes")])])])},function(){var a=this,t=a._self._c;return t("td",[t("span",{staticClass:"status-badge status-diligencia"},[a._v(" Dilig√™ncia ")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-intro"},[t("h4",[a._v("ü§ñ PesquisaBot - Assistente de Pesquisa T√©cnica")]),t("p",[a._v("Ferramenta especializada para buscar informa√ß√µes t√©cnicas sobre produtos e marcas, incluindo manuais, laudos, normas, certifica√ß√µes e informa√ß√µes regulat√≥rias.")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-intro"},[t("h4",[a._v("üí∞ Registro de Cota√ß√µes de Fornecedores")]),t("p",[a._v("Registre e gerencie cota√ß√µes de fornecedores para produtos espec√≠ficos, incluindo pre√ßos, condi√ß√µes de pagamento e prazos de entrega.")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-intro"},[t("h4",[a._v("üìä Comparativo T√©cnico de Produtos")]),t("p",[a._v("Compare especifica√ß√µes t√©cnicas, pre√ßos e condi√ß√µes gerais de produtos similares de diferentes fornecedores.")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("üöß Em desenvolvimento")]),t("p",[a._v("Funcionalidade em constru√ß√£o - Comparativo t√©cnico detalhado de produtos")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-intro"},[t("h4",[a._v("üìà An√°lise de Varia√ß√£o de Pre√ßos")]),t("p",[a._v("Analise a varia√ß√£o de pre√ßos ao longo do tempo e identifique tend√™ncias de mercado.")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("üöß Em desenvolvimento")]),t("p",[a._v("Funcionalidade em constru√ß√£o - An√°lise estat√≠stica de varia√ß√£o de pre√ßos")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-intro"},[t("h4",[a._v("üìã Gera√ß√£o de Relat√≥rios")]),t("p",[a._v("Gere relat√≥rios consolidados para instru√ß√£o de processos de compras e padroniza√ß√£o.")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-intro"},[t("h4",[a._v("üè¶ Integra√ß√£o com Bancos de Pre√ßos P√∫blicos")]),t("p",[a._v("Consulte e integre dados de bancos de pre√ßos p√∫blicos para refer√™ncia de mercado.")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("üöß Em desenvolvimento")]),t("p",[a._v("Funcionalidade em constru√ß√£o - Integra√ß√£o autom√°tica com APIs de bancos de pre√ßos")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-intro"},[t("h4",[a._v("Escolha uma minuta padr√£o para criar o edital:")]),t("p",[a._v("Selecione uma das minutas padr√£o dispon√≠veis. Ap√≥s a sele√ß√£o, o edital ser√° criado em elabora√ß√£o.")])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Impugnante")]),t("th",[a._v("Produto")]),t("th",[a._v("Data da Impugna√ß√£o")]),t("th",[a._v("Prazo Final")]),t("th",[a._v("Status")]),t("th",[a._v("Documenta√ß√£o")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Marcas Despadronizadas")]),t("p",[a._v("Este m√≥dulo permitir√° gerenciar marcas e modelos que foram despadronizados ou que n√£o atendem mais aos requisitos de padroniza√ß√£o.")]),t("p",[a._v("Funcionalidades que ser√£o implementadas:")]),t("ul",[t("li",[a._v("Registro de marcas e modelos despadronizados")]),t("li",[a._v("Motivos e justificativas para despadroniza√ß√£o")]),t("li",[a._v("Hist√≥rico de despadroniza√ß√µes")]),t("li",[a._v("Restri√ß√µes de uso para modelos despadronizados")]),t("li",[a._v("Notifica√ß√£o aos setores sobre despadroniza√ß√µes")]),t("li",[a._v("Relat√≥rios de impacto por despadroniza√ß√£o")]),t("li",[a._v("Registro de comunica√ß√µes aos √≥rg√£os de controle")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-header"},[t("h3",[a._v("üìù Produtos Prontos para Certifica√ß√£o DCB")]),t("p",[a._v("Produtos aprovados pela CPM que ainda n√£o possuem DCB emitido.")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-header"},[t("h3",[a._v("üìã Hist√≥rico de DCBs Emitidas")]),t("p",[a._v("Todos os certificados DCB emitidos pelo sistema.")])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("N√∫mero DCB")]),t("th",[a._v("Produto")]),t("th",[a._v("Marca")]),t("th",[a._v("Data Emiss√£o")]),t("th",[a._v("Validade")]),t("th",[a._v("Status")]),t("th",[a._v("A√ß√µes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-header"},[t("h3",[a._v("‚è∞ Controle de Vencimentos DCB")]),t("p",[a._v("Monitoramento de DCBs pr√≥ximos ao vencimento ou j√° vencidos.")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-header"},[t("h2",[a._v("üë• Cadastro de Usu√°rios")]),t("p",[a._v("Gest√£o de usu√°rios autorizados a emitir RDMs no sistema")])])},function(){var a=this,t=a._self._c;return t("ul",[t("li",[a._v("Senha de acesso definitiva")]),t("li",[a._v("Link direto para o sistema")]),t("li",[a._v("Instru√ß√µes de uso do Dashboard RDM")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"section-header"},[t("h2",[a._v("‚≠ê Avalia√ß√µes de Usu√°rios")]),t("p",[a._v("Visualiza√ß√£o das avalia√ß√µes e feedbacks dos usu√°rios sobre materiais")])])},function(){var a=this,t=a._self._c;return t("p",[t("em",[a._v("Nenhum coment√°rio adicional fornecido.")])])}],J=e(365),G=function(){var a=this,t=a._self._c;return t("div",{staticClass:"pesquisa-bot"},[a._m(0),t("div",{staticClass:"search-form"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"produto"}},[a._v("Produto *")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.formData.produto,expression:"formData.produto"}],attrs:{id:"produto",type:"text",placeholder:"Ex: Luvas de procedimento, M√°scara N95, etc.",required:""},domProps:{value:a.formData.produto},on:{input:function(t){t.target.composing||a.$set(a.formData,"produto",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"marca"}},[a._v("Marca *")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.formData.marca,expression:"formData.marca"}],attrs:{id:"marca",type:"text",placeholder:"Ex: 3M, Medline, etc.",required:""},domProps:{value:a.formData.marca},on:{input:function(t){t.target.composing||a.$set(a.formData,"marca",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"especificacoes"}},[a._v("Especifica√ß√µes T√©cnicas (opcional)")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.formData.especificacoes,expression:"formData.especificacoes"}],attrs:{id:"especificacoes",placeholder:"Descreva especifica√ß√µes t√©cnicas espec√≠ficas que deseja pesquisar...",rows:"3"},domProps:{value:a.formData.especificacoes},on:{input:function(t){t.target.composing||a.$set(a.formData,"especificacoes",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Categorias de Busca")]),t("div",{staticClass:"categories-grid"},a._l(a.categorias,(function(e){return t("div",{key:e.id,staticClass:"category-item"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.categoriasEscolhidas,expression:"categoriasEscolhidas"}],attrs:{id:e.id,type:"checkbox"},domProps:{value:e.id,checked:Array.isArray(a.categoriasEscolhidas)?a._i(a.categoriasEscolhidas,e.id)>-1:a.categoriasEscolhidas},on:{change:function(t){var o=a.categoriasEscolhidas,i=t.target,s=!!i.checked;if(Array.isArray(o)){var r=e.id,n=a._i(o,r);i.checked?n<0&&(a.categoriasEscolhidas=o.concat([r])):n>-1&&(a.categoriasEscolhidas=o.slice(0,n).concat(o.slice(n+1)))}else a.categoriasEscolhidas=s}}}),t("label",{attrs:{for:e.id}},[t("strong",[a._v(a._s(e.nome))]),t("span",[a._v(a._s(e.descricao))])])])})),0)]),t("div",{staticClass:"action-buttons"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.selecionarTodas}},[a._v(" Selecionar Todas ")]),t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.limparSelecao}},[a._v(" Limpar Sele√ß√£o ")]),t("button",{staticClass:"btn-primary",attrs:{disabled:!a.podeRealizar||a.carregando},on:{click:a.buscarInformacoes}},[a.carregando?t("i",{staticClass:"fas fa-spinner fa-spin"}):t("i",{staticClass:"fas fa-search"}),a._v(" "+a._s(a.carregando?"Pesquisando...":"Pesquisar")+" ")])])]),a.carregando?t("div",{staticClass:"loading-status"},[t("div",{staticClass:"progress-info"},[t("p",[a._v(a._s(a.statusAtual))]),t("div",{staticClass:"progress-bar"},[t("div",{staticClass:"progress-fill",style:{width:a.progresso+"%"}})])])]):a._e(),a.resultados.length>0?t("div",{staticClass:"results-section"},[t("h3",[a._v("Resultados da Pesquisa")]),t("div",{staticClass:"consolidation-section"},[t("button",{staticClass:"btn-consolidate",attrs:{disabled:a.gerandoRelatorio},on:{click:a.gerarRelatorioConsolidado}},[a.gerandoRelatorio?t("i",{staticClass:"fas fa-spinner fa-spin"}):t("i",{staticClass:"fas fa-file-alt"}),a._v(" "+a._s(a.gerandoRelatorio?"Gerando Relat√≥rio...":"Gerar Relat√≥rio Consolidado")+" ")])]),a.relatorioConsolidado?t("div",{staticClass:"consolidated-report"},[t("h4",[a._v("Relat√≥rio Consolidado")]),t("div",{staticClass:"report-content",domProps:{innerHTML:a._s(a.formatarTexto(a.relatorioConsolidado.relatorio))}}),t("div",{staticClass:"report-meta"},[t("small",[a._v("Gerado em: "+a._s(a.formatarData(a.relatorioConsolidado.timestamp)))])])]):a._e(),t("div",{staticClass:"results-grid"},a._l(a.resultados,(function(e){return t("div",{key:e.categoria,staticClass:"result-card"},[t("div",{staticClass:"result-header"},[t("h4",[a._v(a._s(a.getCategoriaInfo(e.categoria).nome))]),t("span",{staticClass:"result-timestamp"},[a._v(a._s(a.formatarData(e.timestamp)))])]),t("div",{staticClass:"result-content"},[t("div",{domProps:{innerHTML:a._s(a.formatarTexto(e.resultado))}})]),t("div",{staticClass:"result-sources"},[t("strong",[a._v("Fontes consultadas:")]),t("ul",a._l(a.getCategoriaInfo(e.categoria).fontes,(function(e){return t("li",{key:e},[a._v(" "+a._s(e)+" ")])})),0)])])})),0)]):a._e(),a.historico.length>0?t("div",{staticClass:"history-section"},[t("h3",[a._v("Hist√≥rico de Pesquisas")]),t("div",{staticClass:"history-list"},a._l(a.historico.slice(0,5),(function(e,o){return t("div",{key:o,staticClass:"history-item",on:{click:function(t){return a.carregarPesquisa(e)}}},[t("div",{staticClass:"history-info"},[t("strong",[a._v(a._s(e.produto)+" - "+a._s(e.marca))]),t("span",[a._v(a._s(a.formatarData(e.timestamp)))])]),t("div",{staticClass:"history-categories"},[a._v(" "+a._s(e.categorias.length)+" categoria(s) pesquisada(s) ")])])})),0)]):a._e()])},H=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"header"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-search"})]),t("div",{staticClass:"title"},[t("h2",[a._v("PesquisaBot")]),t("p",[a._v("Assistente especializado em pesquisas t√©cnicas de produtos")])])])}],Y=e(6288);const K="AIzaSyAf-Oe56q4Rao0OodEOtnEjtI_FpOmDg6I";class W{constructor(){this.genAI=new Y.ij(K),this.model=this.genAI.getGenerativeModel({model:"gemini-1.5-flash"})}getCategoriasBusca(){return[{id:"manuais",nome:"Manuais do Fabricante",descricao:"Manuais t√©cnicos e de instru√ß√µes do fabricante",fontes:["Sites oficiais dos fabricantes","Portais t√©cnicos","Documenta√ß√£o oficial"]},{id:"laudos",nome:"Laudos e Testes",descricao:"Laudos t√©cnicos e resultados de testes de funcionalidade",fontes:["Laborat√≥rios certificados","Institutos de pesquisa","√ìrg√£os reguladores"]},{id:"normas",nome:"Normas T√©cnicas",descricao:"Normas ABNT, NR e outras regulamenta√ß√µes t√©cnicas",fontes:["ABNT","Minist√©rio do Trabalho","√ìrg√£os reguladores setoriais"]},{id:"anvisa",nome:"Informa√ß√µes ANVISA",descricao:"Registros, alertas e informa√ß√µes da ANVISA",fontes:["Portal ANVISA","Sistema de notifica√ß√µes","Boletins t√©cnicos"]},{id:"vigilancia",nome:"Vigil√¢ncia Sanit√°ria",descricao:"Informa√ß√µes de vigil√¢ncias sanit√°rias estaduais e municipais",fontes:["√ìrg√£os estaduais","Vigil√¢ncias municipais","Sistemas de notifica√ß√£o"]},{id:"reclamacoes",nome:"Reclama√ß√µes de Usu√°rios",descricao:"Reclama√ß√µes e avalia√ß√µes de usu√°rios sobre produtos",fontes:["Reclame Aqui","Procon","F√≥runs especializados"]},{id:"recalls",nome:"Recalls e Alertas",descricao:"Recalls de produtos e alertas de seguran√ßa",fontes:["Portal do Consumidor","INMETRO","Fabricantes"]},{id:"certificacoes",nome:"Certifica√ß√µes",descricao:"Certifica√ß√µes de qualidade e conformidade",fontes:["INMETRO","Organismos certificadores","ISO"]}]}gerarPromptEspecializado(a,t,e,o){const i={manuais:`\n        Voc√™ √© um especialista em pesquisa t√©cnica de produtos. Preciso encontrar informa√ß√µes sobre manuais do fabricante para:\n        \n        Produto: ${t}\n        Marca: ${e}\n        Especifica√ß√µes: ${o}\n        \n        Por favor, forne√ßa informa√ß√µes detalhadas sobre:\n        1. Onde encontrar o manual oficial do fabricante\n        2. Especifica√ß√µes t√©cnicas principais\n        3. Instru√ß√µes de uso e instala√ß√£o\n        4. Requisitos de manuten√ß√£o\n        5. Garantias e condi√ß√µes de uso\n        \n        Seja espec√≠fico e cite fontes confi√°veis quando poss√≠vel.\n      `,laudos:`\n        Voc√™ √© um especialista em an√°lise t√©cnica de produtos. Preciso encontrar informa√ß√µes sobre laudos e testes para:\n        \n        Produto: ${t}\n        Marca: ${e}\n        Especifica√ß√µes: ${o}\n        \n        Por favor, forne√ßa informa√ß√µes sobre:\n        1. Laudos t√©cnicos dispon√≠veis\n        2. Testes de funcionalidade realizados\n        3. Certifica√ß√µes de qualidade\n        4. Resultados de desempenho\n        5. Laborat√≥rios que realizaram os testes\n        \n        Priorize informa√ß√µes de fontes oficiais e laborat√≥rios certificados.\n      `,normas:`\n        Voc√™ √© um especialista em normas t√©cnicas. Preciso encontrar informa√ß√µes sobre regulamenta√ß√µes para:\n        \n        Produto: ${t}\n        Marca: ${e}\n        Especifica√ß√µes: ${o}\n        \n        Por favor, identifique:\n        1. Normas ABNT aplic√°veis\n        2. Normas Regulamentadoras (NR) relevantes\n        3. Outras regulamenta√ß√µes t√©cnicas\n        4. Requisitos de conformidade\n        5. Certifica√ß√µes obrigat√≥rias\n        \n        Cite os n√∫meros das normas e √≥rg√£os respons√°veis.\n      `,anvisa:`\n        Voc√™ √© um especialista em regulamenta√ß√µes sanit√°rias. Preciso encontrar informa√ß√µes da ANVISA sobre:\n        \n        Produto: ${t}\n        Marca: ${e}\n        Especifica√ß√µes: ${o}\n        \n        Por favor, pesquise:\n        1. Registro na ANVISA (se aplic√°vel)\n        2. Alertas ou notifica√ß√µes\n        3. Restri√ß√µes de uso\n        4. Classifica√ß√£o de risco\n        5. Hist√≥rico de irregularidades\n        \n        Foque em informa√ß√µes oficiais do portal da ANVISA.\n      `,vigilancia:`\n        Voc√™ √© um especialista em vigil√¢ncia sanit√°ria. Preciso encontrar informa√ß√µes sobre:\n        \n        Produto: ${t}\n        Marca: ${e}\n        Especifica√ß√µes: ${o}\n        \n        Por favor, pesquise em vigil√¢ncias sanit√°rias:\n        1. Notifica√ß√µes estaduais\n        2. Alertas municipais\n        3. Interdi√ß√µes ou apreens√µes\n        4. Irregularidades encontradas\n        5. Medidas cautelares\n        \n        Inclua informa√ß√µes de diferentes estados quando relevante.\n      `,reclamacoes:`\n        Voc√™ √© um especialista em an√°lise de satisfa√ß√£o do consumidor. Preciso encontrar informa√ß√µes sobre reclama√ß√µes para:\n        \n        Produto: ${t}\n        Marca: ${e}\n        Especifica√ß√µes: ${o}\n        \n        Por favor, analise:\n        1. Principais reclama√ß√µes dos usu√°rios\n        2. Problemas mais frequentes\n        3. Avalia√ß√µes e notas\n        4. Resolu√ß√µes de problemas\n        5. Tend√™ncias de satisfa√ß√£o\n        \n        Use fontes como Reclame Aqui, Procon e f√≥runs especializados.\n      `,recalls:`\n        Voc√™ √© um especialista em seguran√ßa de produtos. Preciso encontrar informa√ß√µes sobre recalls para:\n        \n        Produto: ${t}\n        Marca: ${e}\n        Especifica√ß√µes: ${o}\n        \n        Por favor, pesquise:\n        1. Recalls oficiais\n        2. Alertas de seguran√ßa\n        3. Defeitos identificados\n        4. Medidas corretivas\n        5. Cronograma de corre√ß√µes\n        \n        Priorize informa√ß√µes do Portal do Consumidor e INMETRO.\n      `,certificacoes:`\n        Voc√™ √© um especialista em certifica√ß√µes de qualidade. Preciso encontrar informa√ß√µes sobre certifica√ß√µes para:\n        \n        Produto: ${t}\n        Marca: ${e}\n        Especifica√ß√µes: ${o}\n        \n        Por favor, identifique:\n        1. Certifica√ß√µes de qualidade\n        2. Selos de conformidade\n        3. Organismos certificadores\n        4. Validade das certifica√ß√µes\n        5. Processos de certifica√ß√£o\n        \n        Foque em certifica√ß√µes oficiais e reconhecidas.\n      `};return i[a]||i.manuais}async buscarInformacoesTecnicas(a,t,e,o=""){try{console.log(`üîç PesquisaService: Iniciando busca para categoria ${a}`);const i=this.gerarPromptEspecializado(a,t,e,o);console.log(`üìù PesquisaService: Prompt gerado para ${a}:`,i.substring(0,200)+"..."),console.log("ü§ñ PesquisaService: Enviando para Gemini API...");const s=await this.model.generateContent(i),r=await s.response,n=r.text();return console.log(`‚úÖ PesquisaService: Resposta recebida para ${a}:`,n.substring(0,200)+"..."),{success:!0,categoria:a,produto:t,marca:e,resultado:n,timestamp:(new Date).toISOString()}}catch(i){return console.error(`‚ùå PesquisaService: Erro na busca t√©cnica para ${a}:`,i),{success:!1,error:i.message,categoria:a,produto:t,marca:e}}}async buscarMultiplasCategorias(a,t,e,o=""){const i=a.map((a=>this.buscarInformacoesTecnicas(a,t,e,o)));try{const a=await Promise.all(i);return{success:!0,produto:t,marca:e,resultados:a.filter((a=>a.success)),erros:a.filter((a=>!a.success))}}catch(s){return console.error("Erro na busca m√∫ltipla:",s),{success:!1,error:s.message,produto:t,marca:e}}}async gerarRelatorioConsolidado(a,t,e=""){const o=this.getCategoriasBusca().map((a=>a.id)),i=await this.buscarMultiplasCategorias(o,a,t,e);if(i.success){const e=`\n        Voc√™ √© um especialista em an√°lise t√©cnica de produtos. Com base nas informa√ß√µes coletadas sobre o produto "${a}" da marca "${t}", gere um relat√≥rio consolidado que inclua:\n        \n        1. RESUMO EXECUTIVO\n        2. ESPECIFICA√á√ïES T√âCNICAS\n        3. CONFORMIDADE REGULAT√ìRIA\n        4. QUALIDADE E CERTIFICA√á√ïES\n        5. HIST√ìRICO DE PROBLEMAS\n        6. RECOMENDA√á√ïES\n        \n        Informa√ß√µes coletadas:\n        ${i.resultados.map((a=>`\n=== ${a.categoria.toUpperCase()} ===\n${a.resultado}`)).join("\n")}\n        \n        Organize as informa√ß√µes de forma clara e profissional, destacando pontos importantes para a pr√©-qualifica√ß√£o de bens.\n      `;try{const o=await this.model.generateContent(e),s=await o.response,r=s.text();return{success:!0,produto:a,marca:t,relatorio:r,detalhes:i.resultados,timestamp:(new Date).toISOString()}}catch(s){return{success:!0,produto:a,marca:t,relatorio:"Erro ao gerar relat√≥rio consolidado",detalhes:i.resultados,timestamp:(new Date).toISOString()}}}return i}}const Q=new W,X={name:"PesquisaBot",data(){return{formData:{produto:"",marca:"",especificacoes:""},categorias:[],categoriasEscolhidas:[],resultados:[],relatorioConsolidado:null,historico:[],carregando:!1,gerandoRelatorio:!1,statusAtual:"",progresso:0}},computed:{podeRealizar(){return this.formData.produto.trim()&&this.formData.marca.trim()&&this.categoriasEscolhidas.length>0}},mounted(){this.carregarCategorias(),this.carregarHistorico()},methods:{carregarCategorias(){this.categorias=Q.getCategoriasBusca(),this.categoriasEscolhidas=["manuais","laudos","normas"]},carregarHistorico(){const a=localStorage.getItem("pesquisa-historico");a&&(this.historico=JSON.parse(a))},salvarHistorico(){localStorage.setItem("pesquisa-historico",JSON.stringify(this.historico))},selecionarTodas(){this.categoriasEscolhidas=this.categorias.map((a=>a.id))},limparSelecao(){this.categoriasEscolhidas=[]},async buscarInformacoes(){if(this.podeRealizar){this.carregando=!0,this.resultados=[],this.relatorioConsolidado=null,this.progresso=0,console.log("üîç Iniciando pesquisa:",{produto:this.formData.produto,marca:this.formData.marca,categorias:this.categoriasEscolhidas});try{const a=this.categoriasEscolhidas.length;let t=0;this.statusAtual="Iniciando pesquisa...";const e=this.categoriasEscolhidas.map((async e=>{this.statusAtual=`Pesquisando ${this.getCategoriaInfo(e).nome}...`,console.log(`üîç Pesquisando categoria: ${e}`);const o=await Q.buscarInformacoesTecnicas(e,this.formData.produto,this.formData.marca,this.formData.especificacoes);return console.log(`üìä Resultado da categoria ${e}:`,o),t++,this.progresso=t/a*100,o})),o=await Promise.all(e);console.log("üìã Todos os resultados:",o),this.resultados=o.filter((a=>a.success)),console.log("‚úÖ Resultados filtrados (success):",this.resultados),this.historico.unshift({produto:this.formData.produto,marca:this.formData.marca,especificacoes:this.formData.especificacoes,categorias:this.categoriasEscolhidas,timestamp:(new Date).toISOString(),resultados:this.resultados.length}),this.historico=this.historico.slice(0,10),this.salvarHistorico(),this.statusAtual="Pesquisa conclu√≠da!",0===this.resultados.length&&(console.warn("‚ö†Ô∏è Nenhum resultado encontrado"),this.$swal({title:"‚ö†Ô∏è Aviso",text:"Nenhum resultado encontrado. Verifique sua conex√£o com a internet ou tente novamente.",icon:"warning"}))}catch(a){console.error("‚ùå Erro na pesquisa:",a),this.statusAtual="Erro na pesquisa. Tente novamente.",this.$swal({title:"‚ùå Erro",text:"Erro na pesquisa: "+a.message,icon:"error"})}finally{this.carregando=!1,setTimeout((()=>{this.statusAtual="",this.progresso=0}),2e3)}}},async gerarRelatorioConsolidado(){if(0!==this.resultados.length){this.gerandoRelatorio=!0;try{const a=await Q.gerarRelatorioConsolidado(this.formData.produto,this.formData.marca,this.formData.especificacoes);a.success&&(this.relatorioConsolidado=a)}catch(a){console.error("Erro ao gerar relat√≥rio:",a)}finally{this.gerandoRelatorio=!1}}},getCategoriaInfo(a){return this.categorias.find((t=>t.id===a))||{}},formatarTexto(a){return a?a.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/(\d+\.)/g,"<br><strong>$1</strong>"):""},formatarData(a){return new Date(a).toLocaleString("pt-BR")},carregarPesquisa(a){this.formData.produto=a.produto,this.formData.marca=a.marca,this.formData.especificacoes=a.especificacoes,this.categoriasEscolhidas=[...a.categorias]},limparFormulario(){this.formData={produto:"",marca:"",especificacoes:""},this.categoriasEscolhidas=["manuais","laudos","normas"],this.resultados=[],this.relatorioConsolidado=null}}},Z=X;var aa=(0,C.A)(Z,G,H,!1,null,"0a824c4e",null);const ta=aa.exports,ea={name:"DashboardCPM",components:{PesquisaBot:ta},data(){return{activeTab:"dashboard",activeSubTab:"pesquisa-tecnica",cotacoes:[],produtos:[],produtosComDiligencia:[],pendentes:0,aprovados:0,reprovados:0,currentTenantId:null,loading:!1,editais:[],editaisFiltrados:[],loadingEditais:!1,modalNovoEdital:!1,modalVisualizarEdital:!1,modalParticipantes:!1,modalNovoParticipante:!1,modoEdicaoEdital:!1,salvandoEdital:!1,modalAddMinuta:!1,minutasDisponiveis:[],minutaSelecionada:null,criandoEdital:!1,novaMinuta:{nome:"",categoria:"geral",descricao:"",arquivo:null},salvandoMinuta:!1,editalAtual:{id:null,numero:"",descricao:"",conteudo:"",status:"RASCUNHO",data_publicacao:"",data_limite_impugnacao:"",url_documento:"",nome_arquivo:""},editalSelecionado:{},filtroEditais:{busca:"",status:""},participantes:[],participantesFiltrados:[],loadingParticipantes:!1,participanteAtual:{id:null,razao_social:"",cnpj:"",representante_legal:"",email:"",telefone:"",endereco:"",status:"INTERESSADO",observacoes:"",produtos_submetidos:[]},filtroParticipantes:{busca:"",status:""},impugnacoes:[],certificados:[],activeTabDCB:"emitir",produtosProntosDCB:[],produtosProntosDCBFiltrados:[],dcbsEmitidos:[],dcbsHistoricoFiltrados:[],dcbsVencendo:[],dcbsVencidos:[],emitindoDCB:null,modalProdutoDetalhes:!1,modalVisualizarDCB:!1,produtoSelecionado:null,dcbSelecionado:null,filtrosDCB:{busca:"",categoria:"",dataAprovacao:""},filtrosHistorico:{numeroDCB:"",status:"",dataInicio:"",dataFim:""},itensPorPagina:5,paginaAtual:1,totalPaginas:1,paginasVisiveis:[],filtros:{nome:"",marca:"",status:"",data:""},produtosPaginados:[],produtosFiltrados:[],itensPorPaginaDiligencia:5,paginaAtualDiligencia:1,totalPaginasDiligencia:1,paginasVisiveisDiligencia:[],filtrosDiligencia:{busca:"",marca:"",data:""},diligenciasFiltradas:[],diligenciasPaginadas:[],usuarios:[],usuariosFiltrados:[],modalNovoUsuario:!1,usuarioAtual:{id:null,nome_usuario:"",unidade_setor:"",nome_coordenador:"",telefone:"",email:"",materiais:[],criar_login:!1,user_id:null,senha_temporaria:null,convite_enviado:!1,convite_aceito:!1},filtroUsuarios:{busca:"",unidade:""},statusConvites:{},notificacoes:[],produtosDisponiveis:[],loadingProdutos:!1,avaliacoes:[],avaliacoesFiltradas:[],filtroAvaliacoes:{busca:"",rating:"",usuario:""}}},created(){this.obterTenantId().then((()=>{this.carregarDados()}))},async mounted(){await this.carregarDados(),this.inicializarFiltros(),await this.carregarProdutos(),"lembretes"===this.activeTab&&(await this.carregarEstatisticasLembretes(),await this.carregarRdmsPendentes())},watch:{activeTab(a){"lembretes"===a?this.$nextTick((()=>{this.carregarEstatisticasLembretes&&this.carregarEstatisticasLembretes(),this.carregarRdmsPendentes&&this.carregarRdmsPendentes()})):"reclamacoes"===a&&this.$nextTick((()=>{this.carregarAvaliacoes()}))}},computed:{marcasUnicas(){const a=[...new Set(this.produtosComDiligencia.map((a=>a.marca)))];return a.filter((a=>a)).sort()},temFiltrosAplicados(){return this.filtros.nome||this.filtros.marca||this.filtros.status||this.filtros.data},temFiltrosDiligenciaAplicados(){return this.filtrosDiligencia.busca||this.filtrosDiligencia.marca||this.filtrosDiligencia.data},editaisAtivos(){return this.editais.filter((a=>"PUBLICADO"===a.status))},editaisRascunho(){return this.editais.filter((a=>"RASCUNHO"===a.status))},editaisFinalizados(){return this.editais.filter((a=>"CANCELADO"===a.status))},totalParticipantes(){return this.editais.reduce(((a,t)=>a+(t.participantes_count||0)),0)},unidadesUnicas(){const a=[...new Set(this.usuarios.map((a=>a.unidade_setor)))];return a.filter((a=>a)).sort()}},methods:{async obterTenantId(){try{const{data:a}=await M.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usu√°rio n√£o est√° autenticado");if(t.user_metadata?.tenant_id)return this.currentTenantId=t.user_metadata.tenant_id,void console.log("Tenant ID obtido dos metadados:",this.currentTenantId);const{data:e,error:o}=await M.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id?(this.currentTenantId=e.tenant_id,console.log("Tenant ID obtido da tabela usuarios:",this.currentTenantId)):console.error("Tenant ID n√£o encontrado para o usu√°rio")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarDados(){try{if(this.loading=!0,!this.currentTenantId&&(console.error("Tenant ID n√£o dispon√≠vel. Tentando recarregar..."),await this.obterTenantId(),!this.currentTenantId))return void console.error("N√£o foi poss√≠vel obter o tenant_id, imposs√≠vel carregar dados");console.log("Carregando produtos para tenant_id:",this.currentTenantId);const{data:a,error:t}=await M.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1});if(t)throw t;const e=a||[];this.produtos=e.filter((a=>["pendente","aprovado","reprovado","em_analise"].includes(a.status))),console.log(`${this.produtos.length} requerimentos recentes carregados (sem dilig√™ncias)`),this.produtosComDiligencia=e.filter((a=>"diligencia"===a.status)),console.log(`${this.produtosComDiligencia.length} produtos com dilig√™ncia carregados`),await this.carregarImpugnacoes(),await this.carregarDadosDCB(),await this.carregarEditais(),await this.carregarMinutasDisponiveis(),await this.carregarUsuarios(),await this.carregarAvaliacoes();const o=await Promise.all([this.contarPorStatus("pendente"),this.contarPorStatus("aprovado"),this.contarPorStatus("reprovado")]);this.pendentes=o[0],this.aprovados=o[1],this.reprovados=o[2]}catch(a){console.error("Erro ao carregar dados:",a)}finally{this.loading=!1,this.$nextTick((()=>{this.inicializarFiltros()}))}},async contarPorStatus(a){if(!this.currentTenantId)return 0;const{count:t,error:e}=await M.ND.from("produtos").select("id",{count:"exact"}).eq("status",a).eq("tenant_id",this.currentTenantId);return e?(console.error(`Erro ao contar produtos ${a}:`,e),0):t||0},formatDate(a){if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")},formatarStatus(a){return"pendente"===a?"em avalia√ß√£o":a},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},verProduto(a){this.$router.push(`/analise/${a}`)},async visualizarEdital(a){console.log(`Visualizando edital com ID: ${a}`)},getImpugnacaoStatusClass(a){switch(a){case"EM AN√ÅLISE":return"status-pendente";case"DEFERIDA":return"status-aprovado";case"INDEFERIDA":return"status-reprovado";default:return""}},async analisarImpugnacao(a){try{const{data:t,error:e}=await M.ND.from("impugnacoes").select("\n            *,\n            editais (\n              numero,\n              descricao\n            )\n          ").eq("id",a).single();if(e)throw e;const{value:o}=await this.$swal({title:"An√°lise de Impugna√ß√£o",html:`\n            <div style="text-align: left;">\n              <h4>Impugna√ß√£o de: ${t.impugnante}</h4>\n              <p><strong>Edital:</strong> ${t.editais?.numero} - ${t.editais?.descricao}</p>\n              <p><strong>Data:</strong> ${this.formatDate(t.data_impugnacao)}</p>\n              <p><strong>Prazo Final:</strong> ${this.formatDate(t.prazo_final)}</p>\n              <p><strong>Motivo:</strong> ${t.motivo}</p>\n              <p><strong>Status Atual:</strong> ${t.status}</p>\n            </div>\n            <hr>\n            <label for="decisao"><strong>Decis√£o:</strong></label>\n            <select id="decisao" class="swal2-input">\n              <option value="">Selecione uma decis√£o</option>\n              <option value="DEFERIDA">DEFERIDA (Procedente)</option>\n              <option value="INDEFERIDA">INDEFERIDA (Improcedente)</option>\n              <option value="PARCIALMENTE_DEFERIDA">PARCIALMENTE DEFERIDA</option>\n            </select>\n            <label for="justificativa"><strong>Justificativa da Decis√£o:</strong></label>\n            <textarea id="justificativa" class="swal2-textarea" placeholder="Fundamente a decis√£o tomada..."></textarea>\n          `,focusConfirm:!1,preConfirm:()=>{const a=document.getElementById("decisao").value,t=document.getElementById("justificativa").value;return a?!t||t.trim().length<10?(this.$swal.showValidationMessage("A justificativa deve ter pelo menos 10 caracteres"),!1):{decisao:a,justificativa:t}:(this.$swal.showValidationMessage("Selecione uma decis√£o"),!1)}});o&&await this.salvarDecisaoImpugnacao(a,o.decisao,o.justificativa)}catch(t){console.error("Erro ao analisar impugna√ß√£o:",t),this.$swal({title:"Erro",text:"Erro ao carregar dados da impugna√ß√£o",icon:"error"})}},async carregarImpugnacoes(){try{const{data:a,error:t}=await M.ND.from("impugnacoes").select("\n            *,\n            editais (\n              numero,\n              descricao\n            )\n          ").eq("tenant_id",this.currentTenantId).order("data_impugnacao",{ascending:!1}).limit(10);if(t)throw t;this.impugnacoes=a?.map((a=>({...a,produto_nome:`Edital ${a.editais?.numero||"N/A"}`})))||[],console.log(`${this.impugnacoes.length} impugna√ß√µes carregadas`)}catch(a){console.error("Erro ao carregar impugna√ß√µes:",a),this.impugnacoes=[]}},async salvarDecisaoImpugnacao(a,t,e){try{const{error:o}=await M.ND.from("impugnacoes").update({status:t,justificativa_decisao:e,data_decisao:(new Date).toISOString(),analisado_por:"CPM"}).eq("id",a);if(o)throw o;this.$swal({title:"Sucesso!",text:"Decis√£o da impugna√ß√£o salva com sucesso",icon:"success"}),await this.carregarImpugnacoes()}catch(o){console.error("Erro ao salvar decis√£o:",o),this.$swal({title:"Erro",text:"Erro ao salvar decis√£o da impugna√ß√£o",icon:"error"})}},async solicitarDiligencia(a){try{const{value:t}=await this.$swal({title:"Solicitar Dilig√™ncia",html:'\n             <label for="tipo_diligencia"><strong>Tipo de Dilig√™ncia:</strong></label>\n             <select id="tipo_diligencia" class="swal2-input">\n               <option value="">Selecione o tipo</option>\n               <option value="DOCUMENTACAO_FALTANTE">Documenta√ß√£o Faltante</option>\n               <option value="AMOSTRA_INADEQUADA">Amostra Inadequada</option>\n               <option value="ESPECIFICACAO_INCOMPLETA">Especifica√ß√£o Incompleta</option>\n               <option value="CERTIFICACAO_PENDENTE">Certifica√ß√£o Pendente</option>\n               <option value="ESCLARECIMENTO_TECNICO">Esclarecimento T√©cnico</option>\n             </select>\n             <label for="descricao_diligencia"><strong>Descri√ß√£o da Dilig√™ncia:</strong></label>\n             <textarea id="descricao_diligencia" class="swal2-textarea" placeholder="Descreva detalhadamente o que precisa ser providenciado..."></textarea>\n             <label for="prazo_dias"><strong>Prazo (dias √∫teis):</strong></label>\n             <input type="number" id="prazo_dias" class="swal2-input" value="5" min="1" max="30">\n           ',focusConfirm:!1,preConfirm:()=>{const a=document.getElementById("tipo_diligencia").value,t=document.getElementById("descricao_diligencia").value,e=parseInt(document.getElementById("prazo_dias").value);return a?!t||t.trim().length<10?(this.$swal.showValidationMessage("A descri√ß√£o deve ter pelo menos 10 caracteres"),!1):!e||e<1||e>30?(this.$swal.showValidationMessage("O prazo deve ser entre 1 e 30 dias"),!1):{tipo:a,descricao:t,prazo:e}:(this.$swal.showValidationMessage("Selecione o tipo de dilig√™ncia"),!1)}});t&&await this.salvarDiligencia(a,t)}catch(t){console.error("Erro ao solicitar dilig√™ncia:",t)}},async salvarDiligencia(a,t){try{const e=this.calcularDataUtil(new Date,t.prazo),{error:o}=await M.ND.from("diligencias").insert({produto_id:a,tenant_id:this.currentTenantId,tipo:t.tipo,descricao:t.descricao,prazo_dias:t.prazo,data_limite:e.toISOString(),status:"PENDENTE",solicitado_por:"CPM"});if(o)throw o;const{error:i}=await M.ND.from("produtos").update({status:"diligencia"}).eq("id",a);if(i)throw i;this.$swal({title:"Sucesso!",text:"Dilig√™ncia solicitada com sucesso",icon:"success"}),await this.carregarDados()}catch(e){console.error("Erro ao salvar dilig√™ncia:",e),this.$swal({title:"Erro",text:"Erro ao solicitar dilig√™ncia",icon:"error"})}},async visualizarDiligencias(a){try{const{data:t,error:e}=await M.ND.from("diligencias").select("*").eq("produto_id",a).order("criado_em",{ascending:!1});if(e)throw e;let o='<div style="text-align: left;">';t&&t.length>0?(o+="<h4>Dilig√™ncias do Produto:</h4>",t.forEach(((a,t)=>{const e="PENDENTE"===a.status?"color: #f39c12":"color: #27ae60";o+=`\n               <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px;">\n                 <strong>Dilig√™ncia ${t+1}</strong><br>\n                 <strong>Tipo:</strong> ${a.tipo.replace(/_/g," ")}<br>\n                 <strong>Status:</strong> <span style="${e}">${a.status}</span><br>\n                 <strong>Descri√ß√£o:</strong> ${a.descricao}<br>\n                 <strong>Prazo:</strong> ${this.formatDate(a.data_limite)}<br>\n                 <strong>Solicitado em:</strong> ${this.formatDate(a.criado_em)}\n               </div>\n             `}))):o+="<p>Nenhuma dilig√™ncia encontrada para este produto.</p>",o+="</div>",this.$swal({title:"Dilig√™ncias",html:o,width:"600px"})}catch(t){console.error("Erro ao carregar dilig√™ncias:",t),this.$swal({title:"Erro",text:"Erro ao carregar dilig√™ncias do produto",icon:"error"})}},calcularDataUtil(a,t){const e=new Date(a);let o=0;while(o<t)e.setDate(e.getDate()+1),0!==e.getDay()&&6!==e.getDay()&&o++;return e},inicializarFiltros(){this.produtosFiltrados=[...this.produtos],this.diligenciasFiltradas=[...this.produtosComDiligencia],this.aplicarFiltros(),this.aplicarFiltrosDiligencia()},aplicarFiltros(){this.produtosFiltrados=this.produtos.filter((a=>{const t=a.nome.toLowerCase().includes(this.filtros.nome.toLowerCase()),e=a.marca.toLowerCase().includes(this.filtros.marca.toLowerCase()),o=""===this.filtros.status||a.status===this.filtros.status;let i=!0;if(this.filtros.data){const t=new Date(a.criado_em).toDateString(),e=new Date(this.filtros.data).toDateString();i=t===e}return t&&e&&o&&i})),this.calcularPaginacao()},calcularPaginacao(){this.totalPaginas=Math.ceil(this.produtosFiltrados.length/this.itensPorPagina),this.paginaAtual>this.totalPaginas&&(this.paginaAtual=Math.max(1,this.totalPaginas)),this.paginasVisiveis=[];const a=5;if(this.totalPaginas<=a)for(let o=1;o<=this.totalPaginas;o++)this.paginasVisiveis.push(o);else{const t=Math.max(1,this.paginaAtual-2),e=Math.min(this.totalPaginas,t+a-1);for(let a=t;a<=e;a++)this.paginasVisiveis.push(a)}const t=(this.paginaAtual-1)*this.itensPorPagina,e=t+this.itensPorPagina;this.produtosPaginados=this.produtosFiltrados.slice(t,e)},aplicarPaginacao(){this.paginaAtual=1,this.calcularPaginacao()},irParaPagina(a){this.paginaAtual=a,this.calcularPaginacao()},limparFiltros(){this.filtros={nome:"",marca:"",status:"",data:""},this.paginaAtual=1,this.aplicarFiltros()},aplicarFiltrosDiligencia(){this.diligenciasFiltradas=this.produtosComDiligencia.filter((a=>{const t=!this.filtrosDiligencia.busca||a.nome.toLowerCase().includes(this.filtrosDiligencia.busca.toLowerCase())||a.marca.toLowerCase().includes(this.filtrosDiligencia.busca.toLowerCase())||a.fabricante&&a.fabricante.toLowerCase().includes(this.filtrosDiligencia.busca.toLowerCase()),e=!this.filtrosDiligencia.marca||a.marca===this.filtrosDiligencia.marca;let o=!0;if(this.filtrosDiligencia.data){const t=new Date(a.criado_em).toDateString(),e=new Date(this.filtrosDiligencia.data).toDateString();o=t===e}return t&&e&&o})),this.calcularPaginacaoDiligencia()},calcularPaginacaoDiligencia(){this.totalPaginasDiligencia=Math.ceil(this.diligenciasFiltradas.length/this.itensPorPaginaDiligencia),this.paginaAtualDiligencia>this.totalPaginasDiligencia&&(this.paginaAtualDiligencia=Math.max(1,this.totalPaginasDiligencia)),this.paginasVisiveisDiligencia=[];const a=5;if(this.totalPaginasDiligencia<=a)for(let o=1;o<=this.totalPaginasDiligencia;o++)this.paginasVisiveisDiligencia.push(o);else{const t=Math.max(1,this.paginaAtualDiligencia-2),e=Math.min(this.totalPaginasDiligencia,t+a-1);for(let a=t;a<=e;a++)this.paginasVisiveisDiligencia.push(a)}const t=(this.paginaAtualDiligencia-1)*this.itensPorPaginaDiligencia,e=t+this.itensPorPaginaDiligencia;this.diligenciasPaginadas=this.diligenciasFiltradas.slice(t,e)},aplicarPaginacaoDiligencia(){this.paginaAtualDiligencia=1,this.calcularPaginacaoDiligencia()},irParaPaginaDiligencia(a){this.paginaAtualDiligencia=a,this.calcularPaginacaoDiligencia()},limparFiltrosDiligencia(){this.filtrosDiligencia={busca:"",marca:"",data:""},this.paginaAtualDiligencia=1,this.aplicarFiltrosDiligencia()},formatarStatus(a){const t={pendente:"Em Avalia√ß√£o",aprovado:"Aprovado",reprovado:"Reprovado",diligencia:"Dilig√™ncia",em_analise:"Em An√°lise"};return t[a]||a},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";case"diligencia":return"status-diligencia";case"em_analise":return"status-em_analise";default:return`status-${a}`}},formatDate(a){if(!a)return"N√£o informado";try{const t=new Date(a);return isNaN(t.getTime())?"Data inv√°lida":t.toLocaleDateString("pt-BR")}catch(t){return"Data inv√°lida"}},async carregarDadosDCB(){try{if(!this.currentTenantId)return;console.log("Carregando dados DCB para tenant:",this.currentTenantId);const{data:a,error:t}=await M.ND.from("produtos").select("\n              *,\n              categorias(nome)\n            ").eq("tenant_id",this.currentTenantId).eq("status","aprovado").is("numero_dcb",null).order("data_aprovacao",{ascending:!1});if(t)throw t;this.produtosProntosDCB=a||[],this.produtosProntosDCBFiltrados=[...this.produtosProntosDCB];const{data:e,error:o}=await M.ND.from("dcb_certificados").select("\n              *,\n              produtos(nome, marca, modelo, fabricante)\n            ").eq("tenant_id",this.currentTenantId).order("data_emissao",{ascending:!1});if(o)throw o;const i=e||[];this.dcbsEmitidos=i.map((a=>({...a,produto_nome:a.produtos?.nome||"N/A",produto_marca:a.produtos?.marca||"N/A",produto_modelo:a.produtos?.modelo||"N/A",produto_fabricante:a.produtos?.fabricante||"N/A"}))),this.dcbsHistoricoFiltrados=[...this.dcbsEmitidos],this.calcularVencimentos(),console.log(`DCB dados carregados: ${this.produtosProntosDCB.length} prontos, ${this.dcbsEmitidos.length} emitidos`)}catch(a){console.error("Erro ao carregar dados DCB:",a),this.$swal.fire("Erro","Erro ao carregar dados DCB","error")}},calcularVencimentos(){const a=new Date,t=new Date;t.setDate(a.getDate()+30),this.dcbsVencendo=this.dcbsEmitidos.filter((e=>{if("ativo"!==e.status)return!1;const o=new Date(e.data_validade);return o>a&&o<=t})),this.dcbsVencidos=this.dcbsEmitidos.filter((t=>{if("ativo"!==t.status)return!1;const e=new Date(t.data_validade);return e<=a}))},aplicarFiltrosDCB(){let a=[...this.produtosProntosDCB];if(this.filtrosDCB.busca){const t=this.filtrosDCB.busca.toLowerCase();a=a.filter((a=>a.nome.toLowerCase().includes(t)||a.marca.toLowerCase().includes(t)||a.fabricante.toLowerCase().includes(t)))}if(this.filtrosDCB.categoria&&(a=a.filter((a=>a.categorias?.nome?.toLowerCase()===this.filtrosDCB.categoria))),this.filtrosDCB.dataAprovacao){const t=new Date(this.filtrosDCB.dataAprovacao);a=a.filter((a=>{if(!a.data_aprovacao)return!1;const e=new Date(a.data_aprovacao);return e.toDateString()===t.toDateString()}))}this.produtosProntosDCBFiltrados=a},limparFiltrosDCB(){this.filtrosDCB={busca:"",categoria:"",dataAprovacao:""},this.aplicarFiltrosDCB()},aplicarFiltrosHistorico(){let a=[...this.dcbsEmitidos];if(this.filtrosHistorico.numeroDCB){const t=this.filtrosHistorico.numeroDCB.toLowerCase();a=a.filter((a=>a.numero_dcb.toLowerCase().includes(t)))}if(this.filtrosHistorico.status&&(a=a.filter((a=>a.status===this.filtrosHistorico.status))),this.filtrosHistorico.dataInicio){const t=new Date(this.filtrosHistorico.dataInicio);a=a.filter((a=>{const e=new Date(a.data_emissao);return e>=t}))}if(this.filtrosHistorico.dataFim){const t=new Date(this.filtrosHistorico.dataFim);a=a.filter((a=>{const e=new Date(a.data_emissao);return e<=t}))}this.dcbsHistoricoFiltrados=a},async emitirDCB(a){try{this.emitindoDCB=a.id,console.log("Emitindo DCB para produto:",a.nome);const t=await this.gerarNumeroDCB(),e=new Date,o=new Date;o.setFullYear(o.getFullYear()+1);const i=o.toISOString().split("T")[0],{data:s,error:r}=await M.ND.from("dcb_certificados").insert({tenant_id:this.currentTenantId,produto_id:a.id,numero_dcb:t,data_emissao:e.toISOString(),data_validade:i,status:"ativo"}).select().single();if(r)throw r;const{error:n}=await M.ND.from("produtos").update({numero_dcb:t,validade_dcb:i}).eq("id",a.id);if(n)throw n;await this.registrarHistoricoDCB(a.id,"dcb_emitido",`DCB ${t} emitido`),await this.carregarDadosDCB(),await this.gerarPDFDCBAutomatico(s,a),this.$swal.fire({icon:"success",title:"üéâ DCB Emitido com Sucesso!",html:`\n              <div style="text-align: left; padding: 10px;">\n                <p><strong>üìú DCB:</strong> ${t}</p>\n                <p><strong>üì¶ Produto:</strong> ${a.nome}</p>\n                <p><strong>üè≠ Marca:</strong> ${a.marca}</p>\n                <p><strong>üìÖ Validade:</strong> ${this.formatDate(i)}</p>\n                <hr style="margin: 15px 0;">\n                <p style="color: #28a745; font-weight: bold;">\n                  ‚úÖ PDF oficial gerado automaticamente<br>\n                  üì• Use o bot√£o "PDF" para baixar\n                </p>\n              </div>\n            `,showConfirmButton:!0,confirmButtonText:"üì• Baixar PDF Agora",showCancelButton:!0,cancelButtonText:"Fechar",confirmButtonColor:"#dc3545"}).then((a=>{a.isConfirmed&&this.downloadDCB(s)})),console.log("DCB emitido com sucesso:",t)}catch(t){console.error("Erro ao emitir DCB:",t),this.$swal.fire("Erro","Erro ao emitir DCB: "+t.message,"error")}finally{this.emitindoDCB=null}},async gerarNumeroDCB(){try{const{data:a,error:t}=await M.ND.from("dcb_certificados").select("numero_dcb").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1}).limit(1);if(t)throw t;const e=(new Date).getFullYear();if(!a||0===a.length)return`001/${e}`;const o=a[0].numero_dcb,[i,s]=o.split("/");if(parseInt(s)===e){const a=parseInt(i)+1;return`${a.toString().padStart(3,"0")}/${e}`}return`001/${e}`}catch(a){throw console.error("Erro ao gerar n√∫mero DCB:",a),a}},async registrarHistoricoDCB(a,t,e){try{const{data:o}=await M.ND.auth.getSession(),i=o?.session?.user;await M.ND.from("workflow_historico").insert({tenant_id:this.currentTenantId,produto_id:a,usuario_id:i?.id,acao:t,observacoes:e})}catch(o){console.error("Erro ao registrar hist√≥rico:",o)}},visualizarProdutoDetalhes(a){this.produtoSelecionado=a,this.modalProdutoDetalhes=!0},fecharModalDetalhes(){this.modalProdutoDetalhes=!1,this.produtoSelecionado=null},visualizarDCB(a){this.dcbSelecionado=a,this.modalVisualizarDCB=!0},fecharModalDCB(){this.modalVisualizarDCB=!1,this.dcbSelecionado=null},async downloadDCB(a){try{console.log("Iniciando download DCB:",a.numero_dcb),this.$swal.fire({title:"Gerando PDF...",text:"Aguarde enquanto geramos seu DCB",allowOutsideClick:!1,didOpen:()=>{this.$swal.showLoading()}}),await this.gerarPDFDCB(a),this.$swal.close()}catch(t){console.error("Erro ao fazer download:",t),this.$swal.fire("Erro","Erro ao gerar PDF do DCB: "+t.message,"error")}},async gerarPDFDCB(a){try{const o=(await Promise.resolve().then(e.bind(e,1749))).default,i=(await e.e(420).then(e.t.bind(e,8420,19))).default,{data:s,error:r}=await M.ND.from("produtos").select("*").eq("id",a.produto_id).single();if(r)throw r;const n=new o("portrait","mm","a4"),l=n.internal.pageSize.getWidth(),c=n.internal.pageSize.getHeight(),d=20;let u=d;n.setFontSize(16),n.setFont("helvetica","bold"),n.text("REP√öBLICA FEDERATIVA DO BRASIL",l/2,u,{align:"center"}),u+=8,n.setFontSize(14),n.text("MINIST√âRIO DA SA√öDE",l/2,u,{align:"center"}),u+=6,n.setFontSize(12),n.setFont("helvetica","normal"),n.text("Comiss√£o de Padroniza√ß√£o de Materiais - CPM",l/2,u,{align:"center"}),u+=15,n.setDrawColor(0,0,0),n.setLineWidth(.5),n.line(d,u,l-d,u),u+=15,n.setFontSize(18),n.setFont("helvetica","bold"),n.text("DECLARA√á√ÉO DE CONFORMIDADE DE BEM",l/2,u,{align:"center"}),u+=8,n.setFontSize(16),n.setTextColor(0,100,200),n.text(`DCB N¬∫ ${a.numero_dcb}`,l/2,u,{align:"center"}),n.setTextColor(0,0,0),u+=20,n.setFontSize(14),n.setFont("helvetica","bold"),n.text("PRODUTO CERTIFICADO",d,u),u+=10,n.setFontSize(11),n.setFont("helvetica","normal");const m=50;n.setDrawColor(200,200,200),n.setFillColor(250,250,250),n.rect(d,u,l-2*d,m,"FD"),u+=10,n.setFont("helvetica","bold"),n.text("Nome do Produto:",d+5,u),n.setFont("helvetica","normal"),n.text(s.nome||"N/A",d+45,u),u+=7,n.setFont("helvetica","bold"),n.text("Marca:",d+5,u),n.setFont("helvetica","normal"),n.text(s.marca||"N/A",d+20,u),u+=7,n.setFont("helvetica","bold"),n.text("Modelo:",d+5,u),n.setFont("helvetica","normal"),n.text(s.modelo||"N/A",d+22,u),u+=7,n.setFont("helvetica","bold"),n.text("Fabricante:",d+5,u),n.setFont("helvetica","normal"),n.text(s.fabricante||"N/A",d+30,u),u+=7,n.setFont("helvetica","bold"),n.text("CNPJ:",d+5,u),n.setFont("helvetica","normal"),n.text(s.cnpj_fabricante||s.cnpj||"N/A",d+20,u),u+=25,n.setFontSize(14),n.setFont("helvetica","bold"),n.text("DADOS DO CERTIFICADO",d,u),u+=10,n.setFontSize(11),n.setFont("helvetica","normal"),n.setDrawColor(200,200,200),n.setFillColor(250,250,250),n.rect(d,u,l-2*d,40,"FD"),u+=10,n.setFont("helvetica","bold"),n.text("Data de Emiss√£o:",d+5,u),n.setFont("helvetica","normal"),n.text(this.formatDate(a.data_emissao),d+40,u),u+=8,n.setFont("helvetica","bold"),n.text("Data de Validade:",d+5,u),n.setFont("helvetica","normal"),n.text(this.formatDate(a.data_validade),d+40,u),u+=8,n.setFont("helvetica","bold"),n.text("Status:",d+5,u),n.setFont("helvetica","normal"),n.setTextColor(0,150,0),n.text(this.formatStatusDCB(a.status),d+20,u),n.setTextColor(0,0,0),u+=25,n.setFontSize(12),n.setFont("helvetica","bold"),n.text("DECLARA√á√ÉO",d,u),u+=10,n.setFontSize(10),n.setFont("helvetica","normal");const p=`Declaramos que o produto acima identificado foi submetido a an√°lise t√©cnica pela Comiss√£o de Padroniza√ß√£o de Materiais (CPM) deste √≥rg√£o, tendo sido APROVADO para utiliza√ß√£o em processos licitat√≥rios, conforme previsto na Lei Federal n¬∫ 14.133/2021 (Lei de Licita√ß√µes e Contratos).\n\nO presente Documento de Comprova√ß√£o de Bem (DCB) atesta que o produto atende aos requisitos t√©cnicos m√≠nimos exigidos e est√° apto para fornecimento no √¢mbito da Administra√ß√£o P√∫blica.\n\nEsta declara√ß√£o possui validade at√© ${this.formatDate(a.data_validade)}, podendo ser renovada mediante nova an√°lise t√©cnica.`,v=n.splitTextToSize(p,l-2*d),g=4*v.length+80;u+g>c-30&&(n.addPage(),u=d),n.text(v,d,u),u+=4*v.length+25;try{const t=window.location.origin,e=t.includes("github.io"),o=e?`${t}/ComprarBem/#/validar-dcb/${a.numero_dcb}`:`${t}/validar-dcb/${a.numero_dcb}`,s=await i.toDataURL(o,{width:80,margin:1,color:{dark:"#000000",light:"#FFFFFF"}}),r=Math.max(u,c-120);n.addImage(s,"PNG",l-d-30,r,25,25),n.setFontSize(8),n.text("Validar DCB:",l-d-30,r+30),n.text(a.numero_dcb,l-d-30,r+33)}catch(t){console.warn("Erro ao gerar QR Code:",t)}u=c-90,n.setFontSize(10),n.setFont("helvetica","normal");const h=new Date;n.text(`Bras√≠lia, ${h.getDate().toString().padStart(2,"0")} de ${h.toLocaleDateString("pt-BR",{month:"long"})} de ${h.getFullYear()}`,d,u),u+=20,u=Math.max(u,c-85),n.setDrawColor(0,0,0),n.setLineWidth(.5),n.line(d,u,l/2-10,u),u+=8,n.setFontSize(9),n.setTextColor(0,0,0),n.text("Presidente da Comiss√£o de Padroniza√ß√£o de Materiais",d,u),u+=4,n.text("CPM - Minist√©rio da Sa√∫de",d,u),n.setFontSize(8),n.setTextColor(100,100,100);const f=`Este documento foi gerado eletronicamente pelo Sistema ComprarBem em ${h.toLocaleString("pt-BR")}`;n.text(f,l/2,c-10,{align:"center"});const _=`DCB_${a.numero_dcb.replace("/","_")}_${s.nome.replace(/[^a-zA-Z0-9]/g,"_")}.pdf`;n.save(_),console.log("PDF gerado com sucesso:",_),await this.salvarURLPDFNoBanco(a.id,_)}catch(o){throw console.error("Erro ao gerar PDF:",o),o}},async salvarURLPDFNoBanco(a,t){try{const{error:e}=await M.ND.from("dcb_certificados").update({arquivo_pdf_url:t}).eq("id",a);e&&console.warn("Erro ao salvar URL do PDF:",e)}catch(e){console.warn("Erro ao atualizar banco com PDF:",e)}},async gerarPDFDCBAutomatico(a,t){try{console.log("Gerando PDF automaticamente para DCB:",a.numero_dcb);const e={...a,produto_id:t.id};await this.gerarPDFDCB(e)}catch(e){console.warn("Erro ao gerar PDF automaticamente:",e)}},async revogarDCB(a){try{const t=await this.$swal.fire({title:"Revogar DCB?",text:`Tem certeza que deseja revogar o DCB ${a.numero_dcb}?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sim, revogar",cancelButtonText:"Cancelar",input:"textarea",inputPlaceholder:"Digite o motivo da revoga√ß√£o...",inputValidator:a=>{if(!a)return"Voc√™ precisa inserir um motivo!"}});if(t.isConfirmed){const e=t.value,{error:o}=await M.ND.from("dcb_certificados").update({status:"revogado",revogado_em:(new Date).toISOString(),motivo_revogacao:e}).eq("id",a.id);if(o)throw o;await this.carregarDadosDCB(),this.$swal.fire("Sucesso!","DCB revogado com sucesso.","success")}}catch(t){console.error("Erro ao revogar DCB:",t),this.$swal.fire("Erro","Erro ao revogar DCB","error")}},async iniciarRenovacao(a){this.$swal.fire({icon:"info",title:"Renova√ß√£o de DCB",text:`Processo de renova√ß√£o do DCB ${a.numero_dcb} ser√° implementado em breve.`,timer:2e3})},async renovarDCBVencido(a){this.$swal.fire({icon:"info",title:"Renova√ß√£o Urgente",text:`Renova√ß√£o urgente do DCB ${a.numero_dcb} ser√° implementada em breve.`,timer:2e3})},getStatusDCBClass(a){switch(a){case"ativo":return"status-ativo";case"vencido":return"status-vencido";case"revogado":return"status-revogado";default:return"status-indefinido"}},formatStatusDCB(a){switch(a){case"ativo":return"Ativo";case"vencido":return"Vencido";case"revogado":return"Revogado";default:return a}},calcularDiasRestantes(a){const t=new Date,e=new Date(a),o=e-t,i=Math.ceil(o/864e5);return Math.max(0,i)},calcularDiasVencidos(a){const t=new Date,e=new Date(a),o=t-e,i=Math.ceil(o/864e5);return Math.max(0,i)},formatarEspecificacoes(a){return"string"===typeof a?a:"object"===typeof a?JSON.stringify(a,null,2):"N/A"},async carregarEditais(){try{if(this.loadingEditais=!0,!this.currentTenantId)return void console.error("Tenant ID n√£o dispon√≠vel para carregar editais");const{data:a,error:t}=await M.ND.from("editais").select("\n              *,\n              participantes_count:participantes_editais(count)\n            ").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1});if(t)throw t;this.editais=(a||[]).map((a=>({...a,participantes_count:a.participantes_count?.[0]?.count||0}))),this.aplicarFiltrosEditais(),console.log(`${this.editais.length} editais carregados`),console.log("Editais com participantes:",this.editais.map((a=>({numero:a.numero,participantes:a.participantes_count}))))}catch(a){console.error("Erro ao carregar editais:",a),this.$swal.fire("Erro","Erro ao carregar editais","error")}finally{this.loadingEditais=!1}},aplicarFiltrosEditais(){let a=[...this.editais];if(this.filtroEditais.busca){const t=this.filtroEditais.busca.toLowerCase();a=a.filter((a=>a.numero.toLowerCase().includes(t)||a.descricao.toLowerCase().includes(t)))}this.filtroEditais.status&&(a=a.filter((a=>a.status===this.filtroEditais.status))),this.editaisFiltrados=a},async abrirModalNovoEdital(){await this.carregarMinutasDisponiveis(),this.minutaSelecionada=null,this.modalNovoEdital=!0},fecharModalNovoEdital(){this.modalNovoEdital=!1,this.minutaSelecionada=null},limparEstadoModal(){this.minutaSelecionada=null,this.criandoEdital=!1},async processarCriacaoEdital(){const a=this.minutaSelecionada;a?await this.criarEditalComMinuta(a):this.$swal.fire("Aten√ß√£o","Selecione uma minuta padr√£o para continuar","warning")},async carregarMinutasDisponiveis(){try{await this.verificarMinutaPadraoSistema();const{data:a,error:t}=await M.ND.from("minutas_padrao").select("*").eq("ativa",!0).order("eh_padrao_sistema",{ascending:!1}).order("nome",{ascending:!0});if(t)throw t;this.minutasDisponiveis=a||[]}catch(a){console.error("Erro ao carregar minutas:",a),this.$swal.fire("Erro","Erro ao carregar minutas padr√£o: "+a.message,"error")}},async verificarMinutaPadraoSistema(){try{const{data:a}=await M.ND.from("minutas_padrao").select("id, arquivo_url").eq("eh_padrao_sistema",!0).single();if(a){const{data:a}=await M.ND.storage.from("minutas-padrao").list("sistema/"),t=a?.some((a=>"MINUTA_PADRAO.docx"===a.name));t||await this.criarMinutaPadraoSistema()}else await this.criarMinutaPadraoSistema()}catch(a){console.warn("Aviso: N√£o foi poss√≠vel verificar minuta padr√£o do sistema:",a)}},async criarMinutaPadraoSistema(){try{const a=await fetch("/MINUTA_PADRAO.docx");if(!a.ok)return void console.warn("Arquivo MINUTA_PADRAO.docx n√£o encontrado localmente");const t=await a.blob(),e="MINUTA_PADRAO.docx",o=`sistema/${e}`,{data:i,error:s}=await M.ND.storage.from("minutas-padrao").upload(o,t,{cacheControl:"3600",upsert:!0});if(s)throw s;const{data:r}=M.ND.storage.from("minutas-padrao").getPublicUrl(o),{error:n}=await M.ND.from("minutas_padrao").upsert({nome:"Minuta Padr√£o do Sistema",descricao:"Minuta padr√£o oficial do sistema para cria√ß√£o de editais",arquivo_nome:e,arquivo_url:r.publicUrl,categoria:"SISTEMA",eh_padrao_sistema:!0,ativa:!0,criado_em:(new Date).toISOString(),atualizado_em:(new Date).toISOString()});if(n)throw n;console.log("Minuta padr√£o do sistema configurada com sucesso")}catch(a){console.error("Erro ao criar minuta padr√£o do sistema:",a)}},selecionarMinuta(a){this.minutaSelecionada=a.id},async criarEditalComMinuta(a=null){try{this.criandoEdital=!0;const t=a||this.minutaSelecionada;if(!t)return void this.$swal.fire("Aten√ß√£o","Selecione uma minuta padr√£o para continuar","warning");if(!this.currentTenantId)throw new Error("Tenant ID n√£o dispon√≠vel");this.fecharModalNovoEdital(),await new Promise((a=>setTimeout(a,100)));const{value:e}=await this.$swal.fire({title:"N√∫mero do Edital",html:`\n              <label for="numero-edital"><strong>N√∫mero do Edital:</strong></label>\n              <input \n                id="numero-edital" \n                class="swal2-input" \n                placeholder="Ex: 001/2024"\n                value="${await this.gerarProximoNumeroEdital()}"\n              >\n              <small style="color: #666; font-size: 12px;">\n                Formato sugerido: 001/2024, 002/2024...\n              </small>\n            `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Criar Edital",cancelButtonText:"Cancelar",customClass:{popup:"swal2-popup-edital"},preConfirm:()=>{const a=document.getElementById("numero-edital").value;return a&&""!==a.trim()?a.trim():(this.$swal.showValidationMessage("N√∫mero do edital √© obrigat√≥rio"),!1)}});if(!e)return void(this.modalNovoEdital=!0);const{data:o}=await M.ND.from("editais").select("id").eq("tenant_id",this.currentTenantId).eq("numero",e).single();if(o)return this.$swal.fire("Erro",`J√° existe um edital com o n√∫mero "${e}". Por favor, escolha outro n√∫mero.`,"error"),void(this.modalNovoEdital=!0);const i={tenant_id:this.currentTenantId,numero:e,descricao:"Edital em elabora√ß√£o",status:"RASCUNHO",minuta_usada_id:t,criado_em:(new Date).toISOString()},{data:s,error:r}=await M.ND.from("editais").insert(i).select().single();if(r)throw r;await M.ND.from("minuta_uso_historico").insert({minuta_id:t,edital_id:s.id,usuario_id:this.currentTenantId,observacoes:"Edital criado com minuta padr√£o"}),await this.carregarEditais(),this.$swal.fire({icon:"success",title:"Edital Criado!",text:`Edital ${e} criado com sucesso em elabora√ß√£o.`,timer:2e3})}catch(t){console.error("Erro ao criar edital:",t),this.$swal.fire("Erro","Erro ao criar edital: "+t.message,"error")}finally{this.criandoEdital=!1}},async gerarProximoNumeroEdital(){try{const a=(new Date).getFullYear(),{data:t,error:e}=await M.ND.from("editais").select("numero").eq("tenant_id",this.currentTenantId).like("numero",`%/${a}`).order("numero",{ascending:!1}).limit(1);if(e)throw e;let o=1;if(t&&t.length>0){const a=t[0].numero,e=parseInt(a.split("/")[0]);o=e+1}return String(o).padStart(3,"0")+"/"+a}catch(a){return console.error("Erro ao gerar n√∫mero:",a),"001/"+(new Date).getFullYear()}},abrirModalAddMinuta(){this.novaMinuta={nome:"",categoria:"geral",descricao:"",arquivo:null},this.modalAddMinuta=!0},fecharModalAddMinuta(){this.modalAddMinuta=!1,this.novaMinuta={nome:"",categoria:"geral",descricao:"",arquivo:null}},handleMinutaUpload(a){const t=a.target.files[0];if(t){const e=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"];if(!e.includes(t.type))return this.$swal.fire("Erro","Por favor, selecione um arquivo Word (.docx ou .doc)","error"),void(a.target.value="");if(t.size>10485760)return this.$swal.fire("Erro","O arquivo deve ter no m√°ximo 10MB","error"),void(a.target.value="");this.novaMinuta.arquivo=t}},async salvarNovaMinuta(){try{if(this.salvandoMinuta=!0,!this.novaMinuta.arquivo)return void this.$swal.fire("Aten√ß√£o","Selecione um arquivo Word para a minuta","warning");const a=`minutas/${Date.now()}-${this.novaMinuta.arquivo.name}`,{data:t,error:e}=await M.ND.storage.from("documentos").upload(a,this.novaMinuta.arquivo);if(e)throw e;const{data:o}=M.ND.storage.from("documentos").getPublicUrl(a),{data:i,error:s}=await M.ND.from("minutas_padrao").insert({nome:this.novaMinuta.nome,categoria:this.novaMinuta.categoria,descricao:this.novaMinuta.descricao,arquivo_nome:this.novaMinuta.arquivo.name,arquivo_url:o.publicUrl,tipo_arquivo:this.novaMinuta.arquivo.name.split(".").pop(),criado_por:this.currentTenantId,eh_padrao_sistema:!1});if(s)throw s;await this.carregarMinutasDisponiveis(),this.fecharModalAddMinuta(),this.$swal.fire({icon:"success",title:"Minuta Adicionada!",text:`Minuta "${this.novaMinuta.nome}" adicionada com sucesso.`,timer:2e3})}catch(a){console.error("Erro ao salvar minuta:",a),this.$swal.fire("Erro","Erro ao salvar minuta: "+a.message,"error")}finally{this.salvandoMinuta=!1}},async baixarMinutaPadrao(a){try{const{data:t,error:e}=await M.ND.from("minutas_padrao").select("*").eq("id",a.minuta_usada_id).single();if(e)throw e;if(t.arquivo_url){const a=await fetch(t.arquivo_url),e=await a.blob(),o=window.URL.createObjectURL(e),i=document.createElement("a");i.href=o,i.download=t.arquivo_nome||"minuta_padrao.docx",document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(o),document.body.removeChild(i)}else{const a=document.createElement("a");a.href="/DOCUMENTOS ESCRITOS/MINUTA PADRAO.docx",a.download="MINUTA PADRAO.docx",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}catch(t){console.error("Erro ao baixar minuta:",t),this.$swal.fire("Erro","Erro ao baixar minuta padr√£o","error")}},async handleMinutaPreenchidaUpload(a){try{const t=a.target.files[0];if(!t)return;const e=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"];if(!e.includes(t.type))return void this.$swal.fire("Erro","Por favor, selecione um arquivo Word (.docx ou .doc)","error");if(t.size>15728640)return void this.$swal.fire("Erro","O arquivo deve ter no m√°ximo 15MB","error");const o=`editais/preenchidas/${Date.now()}-${t.name}`,{data:i,error:s}=await M.ND.storage.from("documentos").upload(o,t);if(s)throw s;const{data:r}=M.ND.storage.from("documentos").getPublicUrl(o),{error:n}=await M.ND.from("editais").update({minuta_preenchida_url:r.publicUrl,minuta_preenchida_nome:t.name}).eq("id",this.editalSelecionado.id);if(n)throw n;this.editalSelecionado.minuta_preenchida_url=r.publicUrl,this.editalSelecionado.minuta_preenchida_nome=t.name,await this.carregarEditais(),this.$swal.fire({icon:"success",title:"Minuta Enviada!",text:"Minuta preenchida enviada com sucesso.",timer:2e3})}catch(t){console.error("Erro ao enviar minuta:",t),this.$swal.fire("Erro","Erro ao enviar minuta preenchida: "+t.message,"error")}},visualizarMinutaPreenchida(a){a.minuta_preenchida_url&&window.open(a.minuta_preenchida_url,"_blank")},async processarConversaoPDF(a){const t={...a};await this.converterParaPDF(t)},async gerarPDFEdital(a){try{console.log("üìÑ Gerando PDF do edital:",a.numero);const t=(await Promise.resolve().then(e.bind(e,1749))).jsPDF||(await Promise.resolve().then(e.bind(e,1749))).default,{data:o}=await M.ND.from("minutas_padrao").select("*").eq("id",a.minuta_usada_id).single(),i=new t("portrait","mm","a4"),s=i.internal.pageSize.getWidth(),r=i.internal.pageSize.getHeight(),n=20;let l=n;i.setFontSize(16),i.setFont("helvetica","bold"),i.text("REP√öBLICA FEDERATIVA DO BRASIL",s/2,l,{align:"center"}),l+=8,i.setFontSize(14),i.text("MINIST√âRIO DA SA√öDE",s/2,l,{align:"center"}),l+=6,i.setFontSize(12),i.setFont("helvetica","normal"),i.text("Comiss√£o de Padroniza√ß√£o de Materiais - CPM",s/2,l,{align:"center"}),l+=15,i.setDrawColor(0,0,0),i.setLineWidth(.5),i.line(n,l,s-n,l),l+=15,i.setFontSize(18),i.setFont("helvetica","bold");const c=`EDITAL DE PREG√ÉO ELETR√îNICO N¬∫ ${a.numero}`;i.text(c,s/2,l,{align:"center"}),l+=15,i.setFontSize(14),i.setFont("helvetica","normal"),i.text(a.descricao||"Edital de Pr√©-qualifica√ß√£o de Materiais",s/2,l,{align:"center"}),l+=25,i.setFontSize(12),i.setFont("helvetica","bold"),i.text("DADOS DO PROCEDIMENTO",n,l),l+=10,i.setDrawColor(200,200,200),i.setFillColor(250,250,250),i.rect(n,l,s-2*n,35,"FD"),l+=10,i.setFontSize(11),i.setFont("helvetica","normal"),i.text(`N√∫mero do Edital: ${a.numero}`,n+5,l),l+=6,i.text(`Status: ${a.status}`,n+5,l),l+=6,i.text(`Data de Publica√ß√£o: ${this.formatDate(a.data_publicacao||new Date)}`,n+5,l),l+=6,i.text(`Prazo para Impugna√ß√µes: ${this.formatDate(a.data_limite_impugnacao||new Date)}`,n+5,l),l+=25,i.setFontSize(12),i.setFont("helvetica","bold"),i.text("OBJETO",n,l),l+=10,i.setFontSize(11),i.setFont("helvetica","normal");const d="Processo de pr√©-qualifica√ß√£o de materiais para aquisi√ß√£o futura, conforme especifica√ß√µes t√©cnicas definidas pela Comiss√£o de Padroniza√ß√£o de Materiais - CPM.",u=i.splitTextToSize(d,s-2*n);if(i.text(u,n,l),l+=6*u.length+15,o){if(i.setFontSize(12),i.setFont("helvetica","bold"),i.text("MINUTA PADR√ÉO UTILIZADA",n,l),l+=10,i.setFontSize(11),i.setFont("helvetica","normal"),i.text(`Nome: ${o.nome}`,n,l),l+=6,i.text(`Categoria: ${o.categoria||"Geral"}`,n,l),l+=6,o.descricao){const a=i.splitTextToSize(`Descri√ß√£o: ${o.descricao}`,s-2*n);i.text(a,n,l),l+=6*a.length}l+=15}i.setFontSize(12),i.setFont("helvetica","bold"),i.text("CONDI√á√ïES GERAIS",n,l),l+=10,i.setFontSize(11),i.setFont("helvetica","normal");const m=["1. Este edital visa a pr√©-qualifica√ß√£o de materiais conforme normas vigentes.","2. Os fornecedores interessados dever√£o apresentar documenta√ß√£o completa.","3. A avalia√ß√£o ser√° realizada pela Comiss√£o de Padroniza√ß√£o de Materiais.","4. Os materiais aprovados receber√£o Declara√ß√£o de Conformidade de Bem (DCB).","5. O processo poder√° ser impugnado no prazo estabelecido.","6. Maiores informa√ß√µes no Sistema ComprarBem."];m.forEach((a=>{const t=i.splitTextToSize(a,s-2*n-5);i.text(t,n,l),l+=6*t.length+3})),l=Math.max(l+30,r-120);const p=new Date;i.text(`Bras√≠lia, ${p.getDate().toString().padStart(2,"0")} de ${p.toLocaleDateString("pt-BR",{month:"long"})} de ${p.getFullYear()}`,n,l),l+=20,i.setDrawColor(0,0,0),i.setLineWidth(.5),i.line(n,l,s/2-10,l),l+=8,i.setFontSize(10),i.text("Presidente da Comiss√£o de Padroniza√ß√£o de Materiais",n,l),l+=4,i.text("CPM - Minist√©rio da Sa√∫de",n,l),i.setFontSize(8),i.setTextColor(100,100,100);const v=`Este documento foi gerado eletronicamente pelo Sistema ComprarBem em ${p.toLocaleString("pt-BR")}`;i.text(v,s/2,r-10,{align:"center"});const g=`Edital_${a.numero.replace("/","_")}_${p.getFullYear()}.pdf`,h=i.output("blob");console.log("üì§ Fazendo upload do PDF para Supabase...");const f=`editais-pdf/${this.currentTenantId}/${g}`,{data:_,error:C}=await M.ND.storage.from("documentos").upload(f,h,{cacheControl:"3600",upsert:!0,contentType:"application/pdf"});if(C)throw C;const{data:b}=M.ND.storage.from("documentos").getPublicUrl(f);return console.log("‚úÖ PDF gerado e enviado com sucesso:",b.publicUrl),{url:b.publicUrl,nome:g,caminho:f}}catch(t){console.error("‚ùå Erro ao gerar PDF do edital:",t),this.$swal&&this.$swal.close&&this.$swal.close();let a="N√£o foi poss√≠vel gerar o PDF do edital.";throw t.message.includes("storage")?a="Erro no armazenamento do arquivo. Verifique as permiss√µes.":t.message.includes("network")||t.message.includes("fetch")?a="Erro de conex√£o. Verifique sua internet e tente novamente.":t.message.includes("jsPDF")&&(a="Erro na gera√ß√£o do PDF. Tente novamente."),new Error(a+" Detalhes: "+t.message)}},async converterWordParaPDF(a){try{console.log("üìÑ Convertendo minuta Word para PDF (MODO VISUAL):",a.minuta_preenchida_url);const{convertWordToPdf:t}=await e.e(130).then(e.bind(e,4130)),o=a.minuta_preenchida_nome?.replace(/\.(docx?|doc)$/i,"")||"Minuta";console.log("üîÑ Iniciando convers√£o visual...");const i=await t(a.minuta_preenchida_url,o);console.log("‚úÖ Convers√£o conclu√≠da:",i.fileName),console.log("üì§ Fazendo upload do PDF convertido para Supabase...");const s=`editais-pdf/${this.currentTenantId}/${i.fileName}`,{data:r,error:n}=await M.ND.storage.from("documentos").upload(s,i.blob,{cacheControl:"3600",upsert:!0,contentType:"application/pdf"});if(n)throw n;const{data:l}=M.ND.storage.from("documentos").getPublicUrl(s);return console.log("üéâ PDF CONVERTIDO COM SUCESSO (MODO VISUAL)!"),console.log("üìÑ URL:",l.publicUrl),{url:l.publicUrl,nome:i.fileName,caminho:s}}catch(t){throw console.error("‚ùå Erro ao converter Word para PDF:",t),t}},async converterParaPDF(a){try{this.fecharModalVisualizarEdital(),await new Promise((a=>setTimeout(a,100)));const t=a.minuta_preenchida_url&&""!==a.minuta_preenchida_url.trim(),e=await this.$swal.fire({title:"Confirmar Convers√£o",html:`\n              <div style="text-align: left;">\n                <p><strong>Aten√ß√£o:</strong> Esta a√ß√£o ir√°:</p>\n                <ul>\n                  ${t?`<li>Converter sua minuta Word preenchida para PDF</li>\n                       <li>Arquivo: ${a.minuta_preenchida_nome||"Minuta preenchida"}</li>`:"<li>Gerar PDF oficial com base nos dados do edital</li>"}\n                  <li>Marcar o edital como PUBLICADO</li>\n                  <li>Tornar o edital dispon√≠vel para consulta</li>\n                </ul>\n                <p><strong>${t?"Tem certeza que a minuta preenchida est√° pronta para publica√ß√£o?":"Tem certeza que o edital est√° pronto para publica√ß√£o?"}</strong></p>\n              </div>\n            `,icon:"warning",showCancelButton:!0,confirmButtonText:"Sim, Converter e Publicar",cancelButtonText:"Cancelar",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",customClass:{popup:"swal2-popup-converter-pdf"}});if(!e.isConfirmed)return void(this.modalVisualizarEdital=!0);let o;console.log("üîÑ Iniciando convers√£o real para PDF..."),this.$swal.fire({title:"Convertendo para PDF...",text:t?"Aguarde enquanto convertemos sua minuta Word para PDF":"Aguarde enquanto geramos o PDF do edital",allowOutsideClick:!1,didOpen:()=>{this.$swal.showLoading()}}),t?(console.log("üìÑ Convertendo minuta Word carregada pelo usu√°rio..."),o=await this.converterWordParaPDF(a)):(console.log("üìÑ Gerando PDF com dados do edital..."),o=await this.gerarPDFEdital(a));const i=new Date,s=i.toISOString(),r=new Date(i.getTime()+2592e6).toISOString(),{error:n}=await M.ND.from("editais").update({status:"PUBLICADO",data_publicacao:s,data_limite_impugnacao:r,pdf_convertido_url:o.url,pdf_convertido_nome:o.nome}).eq("id",a.id);if(n)throw n;this.$swal.close(),this.editalSelecionado.status="PUBLICADO",this.editalSelecionado.data_publicacao=s,this.editalSelecionado.data_limite_impugnacao=r,this.editalSelecionado.pdf_convertido_url=o.url,this.editalSelecionado.pdf_convertido_nome=o.nome,await this.carregarEditais(),this.$swal.fire({icon:"success",title:"Edital Publicado!",html:`\n              <div style="text-align: left; padding: 10px;">\n                <p><strong>üìã Edital:</strong> ${a.numero}</p>\n                <p><strong>üìÑ PDF:</strong> ${o.nome}</p>\n                <p><strong>üìÖ Publicado em:</strong> ${this.formatDate(s)}</p>\n                <hr style="margin: 15px 0;">\n                <p style="color: #28a745; font-weight: bold;">\n                  ${t?"‚úÖ Minuta Word convertida para PDF oficial<br>üìù Conte√∫do baseado na minuta preenchida enviada":"‚úÖ PDF oficial gerado automaticamente<br>üìÑ Conte√∫do baseado nos dados do edital"}<br>\n                  üì• Use o bot√£o "Abrir PDF" para visualizar\n                </p>\n              </div>\n            `,showConfirmButton:!0,confirmButtonText:"üì• Abrir PDF Agora",showCancelButton:!0,cancelButtonText:"Fechar",confirmButtonColor:"#28a745"}).then((a=>{a.isConfirmed&&window.open(o.url,"_blank")}))}catch(t){console.error("‚ùå Erro ao converter para PDF:",t),this.$swal&&this.$swal.close&&this.$swal.close(),this.$swal.fire({icon:"error",title:"Erro na Convers√£o para PDF",html:`\n              <div style="text-align: left;">\n                <p><strong>N√£o foi poss√≠vel converter o edital para PDF.</strong></p>\n                <p><strong>Erro:</strong> ${t.message}</p>\n                <hr>\n                <p><strong>O que fazer:</strong></p>\n                <ul>\n                  <li>Verifique sua conex√£o com a internet</li>\n                  <li>Tente novamente em alguns minutos</li>\n                  <li>Se o problema persistir, contate o suporte</li>\n                </ul>\n                <p style="color: #666; font-size: 12px; margin-top: 15px;">\n                  üí° <strong>Dica:</strong> O edital continuar√° como "RASCUNHO" at√© a convers√£o ser bem-sucedida.\n                </p>\n              </div>\n            `,confirmButtonText:"Entendi",confirmButtonColor:"#dc3545"}),setTimeout((()=>{this.modalVisualizarEdital=!0}),500)}},validarDatas(){if(!this.editalAtual.data_publicacao)return this.$swal.fire("Erro","Data de publica√ß√£o √© obrigat√≥ria","error"),!1;if(!this.editalAtual.data_limite_impugnacao)return this.$swal.fire("Erro","Prazo para impugna√ß√µes √© obrigat√≥rio","error"),!1;const a=new Date(this.editalAtual.data_publicacao),t=new Date(this.editalAtual.data_limite_impugnacao);if(t<=a)return this.$swal.fire({icon:"error",title:"Erro de Data",html:`\n              <p><strong>O prazo para impugna√ß√µes deve ser posterior √† data de publica√ß√£o!</strong></p>\n              <br>\n              <p><strong>Data de Publica√ß√£o:</strong> ${this.formatDate(a)}</p>\n              <p><strong>Prazo para Impugna√ß√µes:</strong> ${this.formatDate(t)}</p>\n              <br>\n              <p>Por favor, ajuste as datas e tente novamente.</p>\n            `,confirmButtonText:"Entendi"}),!1;const e=new Date(a);if(e.setFullYear(e.getFullYear()+1),t>e){const a=this.$swal.fire({icon:"warning",title:"Prazo muito distante",text:"O prazo para impugna√ß√µes est√° mais de 1 ano ap√≥s a publica√ß√£o. Tem certeza?",showCancelButton:!0,confirmButtonText:"Sim, continuar",cancelButtonText:"Cancelar"});if(!a.isConfirmed)return!1}return!0},validarDataLimite(){if(!this.editalAtual.data_publicacao||!this.editalAtual.data_limite_impugnacao)return;const a=new Date(this.editalAtual.data_publicacao),t=new Date(this.editalAtual.data_limite_impugnacao);t<=a&&(this.$swal.fire({icon:"warning",title:"Aten√ß√£o!",text:"O prazo para impugna√ß√µes deve ser posterior √† data de publica√ß√£o.",timer:3e3,toast:!0,position:"top-end",showConfirmButton:!1}),this.editalAtual.data_limite_impugnacao="")},async salvarEdital(){try{if(this.salvandoEdital=!0,!this.currentTenantId)throw new Error("Tenant ID n√£o dispon√≠vel");if(!this.validarDatas())return;const a={tenant_id:this.currentTenantId,numero:this.editalAtual.numero,descricao:this.editalAtual.descricao,conteudo:this.editalAtual.conteudo,status:this.editalAtual.status,data_publicacao:this.editalAtual.data_publicacao||(new Date).toISOString(),data_limite_impugnacao:this.editalAtual.data_limite_impugnacao,url_documento:this.editalAtual.url_documento,nome_arquivo:this.editalAtual.nome_arquivo};let t;if(this.modoEdicaoEdital){const{data:e,error:o}=await M.ND.from("editais").update(a).eq("id",this.editalAtual.id).select().single();t={data:e,error:o}}else{const{data:e,error:o}=await M.ND.from("editais").insert(a).select().single();t={data:e,error:o}}if(t.error)throw t.error;await this.carregarEditais(),this.fecharModalNovoEdital(),this.$swal.fire({icon:"success",title:this.modoEdicaoEdital?"Edital Atualizado!":"Edital Criado!",text:`Edital ${this.editalAtual.numero} ${this.modoEdicaoEdital?"atualizado":"criado"} com sucesso.`,timer:2e3})}catch(a){console.error("Erro ao salvar edital:",a),this.$swal.fire("Erro","Erro ao salvar edital: "+a.message,"error")}finally{this.salvandoEdital=!1}},visualizarEdital(a){this.editalSelecionado={...a},this.modalVisualizarEdital=!0},fecharModalVisualizarEdital(){this.modalVisualizarEdital=!1,this.editalSelecionado={}},editarEdital(a){this.modoEdicaoEdital=!0,this.editalAtual={id:a.id,numero:a.numero,descricao:a.descricao,conteudo:a.conteudo||"",status:a.status,data_publicacao:a.data_publicacao?new Date(a.data_publicacao).toISOString().slice(0,16):"",data_limite_impugnacao:a.data_limite_impugnacao?new Date(a.data_limite_impugnacao).toISOString().slice(0,16):"",url_documento:a.url_documento||"",nome_arquivo:a.nome_arquivo||""},this.modalNovoEdital=!0},editarEditalSelecionado(){this.fecharModalVisualizarEdital(),this.editarEdital(this.editalSelecionado)},async duplicarEdital(a){try{const t=await this.$swal.fire({title:"Duplicar Edital",text:"Digite o n√∫mero do novo edital:",input:"text",inputValue:"",inputPlaceholder:"Ex: 002/2024",showCancelButton:!0,confirmButtonText:"Duplicar",cancelButtonText:"Cancelar",inputValidator:a=>{if(!a)return"Voc√™ precisa inserir um n√∫mero!"}});if(t.isConfirmed){const e=t.value,o={tenant_id:this.currentTenantId,numero:e,descricao:a.descricao+" (C√≥pia)",conteudo:a.conteudo,status:"RASCUNHO",data_publicacao:(new Date).toISOString(),data_limite_impugnacao:a.data_limite_impugnacao},{error:i}=await M.ND.from("editais").insert(o);if(i)throw i;await this.carregarEditais(),this.$swal.fire("Sucesso!",`Edital ${e} criado com sucesso.`,"success")}}catch(t){console.error("Erro ao duplicar edital:",t),this.$swal.fire("Erro","Erro ao duplicar edital","error")}},async cancelarEdital(a){try{const t=await this.$swal.fire({title:"Cancelar Edital",text:`Tem certeza que deseja cancelar o edital ${a.numero}?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sim, cancelar",cancelButtonText:"N√£o",confirmButtonColor:"#d33"});if(t.isConfirmed){const{error:t}=await M.ND.from("editais").update({status:"CANCELADO"}).eq("id",a.id);if(t)throw t;await this.carregarEditais(),this.$swal.fire("Cancelado!",`Edital ${a.numero} foi cancelado.`,"success")}}catch(t){console.error("Erro ao cancelar edital:",t),this.$swal.fire("Erro","Erro ao cancelar edital","error")}},gerenciarParticipantes(a){console.log("Abrindo modal de participantes para:",a.numero),this.criarModalParticipantes(a)},async criarModalParticipantes(a){const{data:t,error:o}=await M.ND.from("participantes_editais").select("*").eq("tenant_id",this.currentTenantId).eq("edital_id",a.id).order("data_participacao",{ascending:!1});if(o)return console.error("Erro ao carregar participantes:",o),void this.$swal.fire("Erro","Erro ao carregar participantes","error");console.log("Participantes carregados:",t);const i=`\n          <div id="modal-participantes-custom" style="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100vw;\n            height: 100vh;\n            background: rgba(0,0,0,0.8);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 999999;\n          ">\n            <div style="\n              background: white;\n              border-radius: 12px;\n              width: 90%;\n              max-width: 1000px;\n              max-height: 80vh;\n              overflow-y: auto;\n              box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n            ">\n              <div style="\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 20px 25px;\n                border-bottom: 1px solid #eee;\n                background: #f8f9fa;\n                border-radius: 12px 12px 0 0;\n              ">\n                <h3 style="margin: 0; color: #2c3e50;">üë• Participantes - ${a.numero}</h3>\n                <button onclick="document.getElementById('modal-participantes-custom').remove()" style="\n                  background: none;\n                  border: none;\n                  font-size: 24px;\n                  cursor: pointer;\n                  color: #6c757d;\n                  width: 30px;\n                  height: 30px;\n                  border-radius: 50%;\n                ">&times;</button>\n              </div>\n              \n              <div style="padding: 25px;">\n                <div style="margin-bottom: 20px;">\n                  <h4>üìä Total de Participantes: ${t.length}</h4>\n                </div>\n                \n                ${t.length>0?`\n                  <div style="display: grid; gap: 15px;">\n                    ${t.map((a=>`\n                      <div style="\n                        border: 1px solid #ddd;\n                        border-radius: 8px;\n                        padding: 20px;\n                        background: #f9f9f9;\n                      ">\n                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">\n                          <h4 style="margin: 0; color: #2c3e50;">${a.razao_social}</h4>\n                          <span style="\n                            padding: 4px 12px;\n                            border-radius: 20px;\n                            font-size: 12px;\n                            font-weight: 600;\n                            background: ${this.getStatusColor(a.status)};\n                            color: white;\n                          ">${this.getStatusText(a.status)}</span>\n                        </div>\n                        \n                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin-bottom: 15px;">\n                          <p style="margin: 5px 0;"><strong>CNPJ:</strong> ${this.formatarCNPJSimples(a.cnpj)}</p>\n                          <p style="margin: 5px 0;"><strong>Representante:</strong> ${a.representante_legal}</p>\n                          <p style="margin: 5px 0;"><strong>Email:</strong> ${a.email}</p>\n                          <p style="margin: 5px 0;"><strong>Telefone:</strong> ${a.telefone||"N/A"}</p>\n                          <p style="margin: 5px 0;"><strong>Data Inscri√ß√£o:</strong> ${this.formatDateSimples(a.data_participacao)}</p>\n                          ${a.data_envio_documentacao?`<p style="margin: 5px 0;"><strong>Data Documenta√ß√£o:</strong> ${this.formatDateSimples(a.data_envio_documentacao)}</p>`:""}\n                        </div>\n                        \n                        ${a.endereco?`\n                          <div style="margin-bottom: 15px;">\n                            <p style="margin: 5px 0;"><strong>üìç Endere√ßo:</strong> ${a.endereco}</p>\n                          </div>\n                        `:""}\n                        \n                        ${a.observacoes?`\n                          <div style="\n                            margin-bottom: 15px;\n                            padding: 12px;\n                            background: #fff3cd;\n                            border: 1px solid #ffeaa7;\n                            border-radius: 6px;\n                          ">\n                            <p style="margin: 0; font-weight: 600; color: #856404;">üí¨ Observa√ß√µes da Empresa:</p>\n                            <p style="margin: 8px 0 0 0; color: #856404;">${a.observacoes}</p>\n                          </div>\n                        `:""}\n                        \n                        ${a.produtos_submetidos&&a.produtos_submetidos.length>0?`\n                          <div style="\n                            margin-bottom: 15px;\n                            padding: 12px;\n                            background: #d1ecf1;\n                            border: 1px solid #bee5eb;\n                            border-radius: 6px;\n                          ">\n                            <p style="margin: 0; font-weight: 600; color: #0c5460;">üì¶ Produtos Submetidos:</p>\n                            <ul style="margin: 8px 0 0 20px; color: #0c5460;">\n                              ${a.produtos_submetidos.map((a=>`<li>${a.nome||a}</li>`)).join("")}\n                            </ul>\n                          </div>\n                        `:""}\n                        \n                        <div style="margin-top: 15px;">\n                          <div style="display: flex; gap: 10px; margin-bottom: 10px;">\n                            <button onclick="window.alterarStatusParticipante('${a.id}', 'APROVADO')" style="\n                              padding: 8px 16px;\n                              background: #28a745;\n                              color: white;\n                              border: none;\n                              border-radius: 6px;\n                              cursor: pointer;\n                              font-size: 14px;\n                            ">‚úÖ Aprovar</button>\n                            \n                            <button onclick="window.alterarStatusParticipante('${a.id}', 'REPROVADO')" style="\n                              padding: 8px 16px;\n                              background: #dc3545;\n                              color: white;\n                              border: none;\n                              border-radius: 6px;\n                              cursor: pointer;\n                              font-size: 14px;\n                            ">‚ùå Reprovar</button>\n                            \n                            <button onclick="window.alterarStatusParticipante('${a.id}', 'EM_AVALIACAO')" style="\n                              padding: 8px 16px;\n                              background: #ffc107;\n                              color: #212529;\n                              border: none;\n                              border-radius: 6px;\n                              cursor: pointer;\n                              font-size: 14px;\n                            ">üîÑ Em Avalia√ß√£o</button>\n                            \n                            <button onclick="window.adicionarObservacaoInterna('${a.id}')" style="\n                              padding: 8px 16px;\n                              background: #6f42c1;\n                              color: white;\n                              border: none;\n                              border-radius: 6px;\n                              cursor: pointer;\n                              font-size: 14px;\n                            ">üìù Adicionar Observa√ß√£o</button>\n                          </div>\n                          \n                          ${a.observacoes_internas?`\n                            <div style="\n                              padding: 12px;\n                              background: #e9ecef;\n                              border: 1px solid #ced4da;\n                              border-radius: 6px;\n                              margin-top: 10px;\n                            ">\n                              <p style="margin: 0; font-weight: 600; color: #495057;">üîí Observa√ß√µes Internas da CPM:</p>\n                              <p style="margin: 8px 0 0 0; color: #495057; font-style: italic;">${a.observacoes_internas}</p>\n                            </div>\n                          `:""}\n                        </div>\n                      </div>\n                    `)).join("")}\n                  </div>\n                `:'\n                  <div style="text-align: center; padding: 40px; color: #6c757d;">\n                    <div style="font-size: 48px; margin-bottom: 20px;">üë•</div>\n                    <h3>Nenhum participante encontrado</h3>\n                    <p>Ainda n√£o h√° empresas inscritas neste edital.</p>\n                  </div>\n                '}\n              </div>\n              \n              <div style="\n                padding: 20px 25px;\n                border-top: 1px solid #eee;\n                display: flex;\n                justify-content: flex-end;\n              ">\n                <button onclick="document.getElementById('modal-participantes-custom').remove()" style="\n                  padding: 10px 20px;\n                  background: #6c757d;\n                  color: white;\n                  border: none;\n                  border-radius: 6px;\n                  cursor: pointer;\n                ">Fechar</button>\n              </div>\n            </div>\n          </div>\n        `;document.body.insertAdjacentHTML("beforeend",i),window.alterarStatusParticipante=async(t,i)=>{try{const{data:o,error:r}=await M.ND.from("participantes_editais").select("*").eq("id",t).single();if(r)throw r;const{error:n}=await M.ND.from("participantes_editais").update({status:i}).eq("id",t);if(n)throw n;let l=null;if("APROVADO"===i||"REPROVADO"===i)try{const{enviarEmailParticipanteStatus:t}=await Promise.resolve().then(e.bind(e,3405));if("REPROVADO"===i){document.getElementById("modal-participantes-custom").remove(),await new Promise((a=>setTimeout(a,100)));const a=await this.$swal.fire({title:"‚ùå Motivo da Reprova√ß√£o",text:"Informe o motivo da reprova√ß√£o (ser√° enviado por email):",input:"textarea",inputPlaceholder:"Ex: Documenta√ß√£o incompleta, dados inconsistentes, etc.",showCancelButton:!0,confirmButtonText:"Enviar Email",cancelButtonText:"Pular Email",inputValidator:a=>{if(!a)return"Por favor, informe o motivo da reprova√ß√£o!"},heightAuto:!1,backdrop:!0,allowOutsideClick:!1});a.isConfirmed?l=a.value:(console.log("üìß Usu√°rio cancelou envio de email de reprova√ß√£o"),l=null)}if("APROVADO"===i||"REPROVADO"===i&&l){const e="APROVADO"===i?"aprovado":"rejeitado";console.log(`üìß Enviando email de ${e} para:`,o.email),await t(o,a,e,l),console.log(`‚úÖ Email de ${e} enviado com sucesso!`)}else"REPROVADO"!==i||l||console.log("üìß Email de reprova√ß√£o n√£o enviado (usu√°rio cancelou)")}catch(s){console.warn(`‚ö†Ô∏è Erro ao enviar email de ${i.toLowerCase()}:`,s)}const c=document.getElementById("modal-participantes-custom");c&&c.remove();let d=`Status alterado para ${this.getStatusText(i)}`;if("APROVADO"===i)d+="\nüìß Email de aprova√ß√£o enviado automaticamente!";else if("REPROVADO"===i){const a=null!==l;d+=a?"\nüìß Email de reprova√ß√£o enviado automaticamente!":"\nüìß Email de reprova√ß√£o n√£o foi enviado"}this.$swal.fire({icon:"success",title:"Sucesso!",text:d,timer:"APROVADO"===i||"REPROVADO"===i?4e3:2e3}),await this.carregarEditais(),setTimeout((()=>{this.criarModalParticipantes(a)}),500)}catch(o){console.error("Erro ao alterar status:",o);const e=document.getElementById("modal-participantes-custom");e&&e.remove(),this.$swal.fire({icon:"error",title:"Erro",text:"Erro ao alterar status do participante"}),setTimeout((()=>{this.criarModalParticipantes(a)}),2e3)}},window.adicionarObservacaoInterna=async t=>{try{document.getElementById("modal-participantes-custom").remove(),await new Promise((a=>setTimeout(a,100)));const e=await this.$swal.fire({title:"Observa√ß√£o Interna da CPM",text:"Esta observa√ß√£o ser√° vis√≠vel apenas para a equipe da CPM",input:"textarea",inputPlaceholder:"Digite suas observa√ß√µes sobre a an√°lise deste participante...",showCancelButton:!0,confirmButtonText:"Salvar",cancelButtonText:"Cancelar",inputValidator:a=>{if(!a)return"Voc√™ precisa inserir uma observa√ß√£o!"}});if(e.isConfirmed){const o=e.value,{error:i}=await M.ND.from("participantes_editais").update({observacoes_internas:o}).eq("id",t);if(i)throw i;this.$swal.fire({icon:"success",title:"Sucesso!",text:"Observa√ß√£o interna adicionada com sucesso"}),setTimeout((()=>{this.criarModalParticipantes(a)}),500)}}catch(o){console.error("Erro ao adicionar observa√ß√£o:",o),this.$swal.fire({icon:"error",title:"Erro",text:"Erro ao adicionar observa√ß√£o interna"}),setTimeout((()=>{this.criarModalParticipantes(a)}),2e3)}}},getStatusColor(a){const t={INTERESSADO:"#17a2b8",DOCUMENTACAO_ENVIADA:"#ffc107",EM_AVALIACAO:"#fd7e14",APROVADO:"#28a745",REPROVADO:"#dc3545",DESISTENTE:"#6c757d"};return t[a]||"#6c757d"},getStatusText(a){const t={INTERESSADO:"Interessado",DOCUMENTACAO_ENVIADA:"Documenta√ß√£o Enviada",EM_AVALIACAO:"Em Avalia√ß√£o",APROVADO:"Aprovado",REPROVADO:"Reprovado",DESISTENTE:"Desistente"};return t[a]||a},formatarCNPJSimples(a){return a?a.includes(".")?a:a.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/,"$1.$2.$3/$4-$5"):""},formatDateSimples(a){return a?new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"},abrirDocumento(a){console.log("üìÑ Abrindo documento:",a),a&&"uploads/documento-exemplo.pdf"!==a?a.includes("editais-pdf/")||a.includes(".pdf")?window.open(a,"_blank"):this.$swal.fire({icon:"warning",title:"Documento ainda n√£o convertido",html:'\n                <p>Este edital ainda cont√©m a minuta Word original.</p>\n                <p><strong>Para obter o PDF oficial:</strong></p>\n                <ol style="text-align: left; margin: 15px 0;">\n                  <li>Clique em "Converter para PDF e Publicar"</li>\n                  <li>Confirme a convers√£o</li>\n                  <li>O sistema gerar√° o PDF oficial automaticamente</li>\n                </ol>\n                <p style="color: #28a745;">Ap√≥s a convers√£o, o bot√£o "Abrir PDF" mostrar√° o documento oficial.</p>\n              ',confirmButtonText:"Entendi",confirmButtonColor:"#3085d6"}):this.$swal.fire("Aviso","Documento n√£o dispon√≠vel","warning")},async baixarDocumento(a){if(a.url_documento&&"uploads/documento-exemplo.pdf"!==a.url_documento)try{this.$swal.fire({title:"Preparando download...",text:"Aguarde um momento",allowOutsideClick:!1,didOpen:()=>{this.$swal.showLoading()}});const t=document.createElement("a");t.href=a.url_documento,t.download=a.nome_arquivo||`edital_${a.numero}.pdf`,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),this.$swal.close()}catch(t){console.error("Erro no download:",t),this.$swal.fire({icon:"error",title:"Erro no download",text:"N√£o foi poss√≠vel baixar o arquivo. Tente novamente."})}else this.$swal.fire("Aviso","Documento n√£o dispon√≠vel para download","warning")},async handleFileUpload(a){const t=a.target.files[0];if(t){if("application/pdf"!==t.type)return this.$swal.fire("Erro","Apenas arquivos PDF s√£o permitidos","error"),void(a.target.value="");if(t.size>10485760)return this.$swal.fire("Erro","Arquivo muito grande. M√°ximo 10MB","error"),void(a.target.value="");try{this.$swal.fire({title:"Fazendo upload...",text:"Aguarde enquanto o arquivo √© enviado",allowOutsideClick:!1,didOpen:()=>{this.$swal.showLoading()}});const a=Date.now(),e=localStorage.getItem("tenant_id")||"default",o=`edital_${a}_${t.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,i=`${e}/editais/${o}`,{data:s,error:r}=await M.ND.storage.from("editais").upload(i,t,{cacheControl:"3600",upsert:!1});if(r)throw console.error("Erro no upload:",r),r;const{data:n}=M.ND.storage.from("editais").getPublicUrl(i);if(!n?.publicUrl)throw new Error("N√£o foi poss√≠vel obter URL do arquivo");this.editalAtual.url_documento=n.publicUrl,this.editalAtual.nome_arquivo=t.name,this.$swal.fire({icon:"success",title:"Upload realizado!",text:"Arquivo PDF enviado com sucesso",timer:2e3})}catch(e){if(console.error("Erro no upload:",e),e.message?.includes("Bucket not found")||404===e.statusCode)try{return await this.criarBucketEditais(),void await this.handleFileUpload(a)}catch(o){console.error("Erro ao criar bucket:",o)}this.$swal.fire({icon:"error",title:"Erro no upload",text:"N√£o foi poss√≠vel enviar o arquivo. Tente novamente.",footer:e.message||"Erro desconhecido"}),a.target.value=""}}},async criarBucketEditais(){try{const{data:a,error:t}=await M.ND.storage.createBucket("editais",{public:!0,fileSizeLimit:10485760,allowedMimeTypes:["application/pdf"]});if(t&&!t.message.includes("already exists"))throw t;console.log("Bucket editais criado/verificado com sucesso")}catch(a){throw console.error("Erro ao criar bucket editais:",a),a}},async carregarParticipantes(a){try{console.log("Carregando participantes para edital ID:",a),console.log("Tenant ID:",this.currentTenantId),this.loadingParticipantes=!0;const{data:t,error:e}=await M.ND.from("participantes_editais").select("*").eq("tenant_id",this.currentTenantId).eq("edital_id",a).order("data_participacao",{ascending:!1});if(e)throw e;console.log("Participantes carregados:",t),this.participantes=t||[],this.aplicarFiltrosParticipantes()}catch(t){console.error("Erro ao carregar participantes:",t),this.$swal.fire("Erro","Erro ao carregar participantes: "+t.message,"error")}finally{this.loadingParticipantes=!1}},aplicarFiltrosParticipantes(){let a=[...this.participantes];if(this.filtroParticipantes.busca){const t=this.filtroParticipantes.busca.toLowerCase();a=a.filter((a=>a.razao_social.toLowerCase().includes(t)||a.cnpj.includes(t)||a.representante_legal.toLowerCase().includes(t)||a.email.toLowerCase().includes(t)))}this.filtroParticipantes.status&&(a=a.filter((a=>a.status===this.filtroParticipantes.status))),this.participantesFiltrados=a},formatarCNPJ(a){return a?a.includes(".")?a:a.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/,"$1.$2.$3/$4-$5"):""},formatarStatus(a){const t={INTERESSADO:"Interessado",DOCUMENTACAO_ENVIADA:"Documenta√ß√£o Enviada",EM_AVALIACAO:"Em Avalia√ß√£o",APROVADO:"Aprovado",REPROVADO:"Reprovado",DESISTENTE:"Desistente"};return t[a]||a},getStatusClass(a){const t={INTERESSADO:"status-interessado",DOCUMENTACAO_ENVIADA:"status-documentacao",EM_AVALIACAO:"status-avaliacao",APROVADO:"status-aprovado",REPROVADO:"status-reprovado",DESISTENTE:"status-desistente"};return t[a]||"status-default"},abrirModalNovoParticipante(){this.participanteAtual={id:null,razao_social:"",cnpj:"",representante_legal:"",email:"",telefone:"",endereco:"",status:"INTERESSADO",observacoes:"",produtos_submetidos:[]},this.modalNovoParticipante=!0},fecharModalParticipantes(){this.modalParticipantes=!1,this.editalSelecionado={},this.participantes=[],this.participantesFiltrados=[],this.filtroParticipantes={busca:"",status:""}},fecharModalNovoParticipante(){this.modalNovoParticipante=!1,this.participanteAtual={id:null,razao_social:"",cnpj:"",representante_legal:"",email:"",telefone:"",endereco:"",status:"INTERESSADO",observacoes:"",produtos_submetidos:[]}},async salvarParticipante(){try{if(!this.participanteAtual.razao_social||!this.participanteAtual.cnpj||!this.participanteAtual.representante_legal||!this.participanteAtual.email)return void this.$swal.fire("Erro","Preencha todos os campos obrigat√≥rios","error");const a={tenant_id:this.currentTenantId,edital_id:this.editalSelecionado.id,razao_social:this.participanteAtual.razao_social,cnpj:this.participanteAtual.cnpj,representante_legal:this.participanteAtual.representante_legal,email:this.participanteAtual.email,telefone:this.participanteAtual.telefone,endereco:this.participanteAtual.endereco,status:this.participanteAtual.status,observacoes:this.participanteAtual.observacoes,produtos_submetidos:this.participanteAtual.produtos_submetidos};let t;if(this.participanteAtual.id){const{data:e,error:o}=await M.ND.from("participantes_editais").update(a).eq("id",this.participanteAtual.id).select().single();t={data:e,error:o}}else{const{data:e,error:o}=await M.ND.from("participantes_editais").insert(a).select().single();t={data:e,error:o}}if(t.error)throw t.error;await this.carregarParticipantes(this.editalSelecionado.id),this.fecharModalNovoParticipante(),this.$swal.fire({icon:"success",title:"Participante salvo!",text:`${this.participanteAtual.razao_social} foi ${this.participanteAtual.id?"atualizado":"adicionado"} com sucesso.`,timer:2e3})}catch(a){console.error("Erro ao salvar participante:",a),this.$swal.fire("Erro","Erro ao salvar participante: "+a.message,"error")}},editarParticipante(a){this.participanteAtual={...a},this.modalNovoParticipante=!0},async removerParticipante(a){try{const t=await this.$swal.fire({title:"Remover Participante",text:`Tem certeza que deseja remover ${a.razao_social}?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sim, remover",cancelButtonText:"Cancelar",confirmButtonColor:"#d33"});if(t.isConfirmed){const{error:t}=await M.ND.from("participantes_editais").delete().eq("id",a.id);if(t)throw t;await this.carregarParticipantes(this.editalSelecionado.id),await this.carregarEditais(),this.$swal.fire("Removido!","Participante removido com sucesso.","success")}}catch(t){console.error("Erro ao remover participante:",t),this.$swal.fire("Erro","Erro ao remover participante: "+t.message,"error")}},async carregarUsuarios(){try{const{data:a,error:t}=await M.ND.from("usuarios_rdm").select("*").eq("tenant_id",this.currentTenantId).order("nome_usuario",{ascending:!0});if(t)throw t;this.usuarios=a||[],this.aplicarFiltrosUsuarios()}catch(a){console.error("Erro ao carregar usu√°rios:",a)}},aplicarFiltrosUsuarios(){let a=[...this.usuarios];if(this.filtroUsuarios.busca){const t=this.filtroUsuarios.busca.toLowerCase();a=a.filter((a=>a.nome_usuario?.toLowerCase().includes(t)||a.unidade_setor?.toLowerCase().includes(t)||a.nome_coordenador?.toLowerCase().includes(t)||a.email?.toLowerCase().includes(t)))}this.filtroUsuarios.unidade&&(a=a.filter((a=>a.unidade_setor===this.filtroUsuarios.unidade))),this.usuariosFiltrados=a},async abrirModalNovoUsuario(){console.log("‚ûï Abrindo modal de novo usu√°rio..."),await this.carregarProdutos(),this.usuarioAtual={nome_usuario:"",unidade_setor:"",nome_coordenador:"",telefone:"",email:"",materiais:[{produto_id:"",nome:"",codigo:"",periodicidade_rdm:""}],criar_login:!1},console.log("‚úÖ Modal novo usu√°rio preparado"),console.log("üì¶ Produtos dispon√≠veis:",this.produtosDisponiveis.length),this.modalNovoUsuario=!0},fecharModalNovoUsuario(){this.modalNovoUsuario=!1,this.usuarioAtual={nome_usuario:"",unidade_setor:"",nome_coordenador:"",telefone:"",email:"",materiais:[],criar_login:!1}},adicionarMaterial(){this.usuarioAtual.materiais.push({produto_id:"",nome:"",codigo:"",periodicidade_rdm:""})},removerMaterial(a){this.usuarioAtual.materiais.splice(a,1)},async salvarUsuario(){console.log("üöÄ INICIANDO salvarUsuario..."),console.log("üìä Estado inicial:",{usuarioAtual:this.usuarioAtual,temCriarLogin:this.usuarioAtual?.criar_login,temId:!!this.usuarioAtual?.id});try{let e=null,o=null;if(console.log("‚úÖ Vari√°veis inicializadas com sucesso"),console.log("üîç Verificando necessidade de criar login..."),this.usuarioAtual.criar_login&&!this.usuarioAtual.id){console.log("üîê Criando login autom√°tico para:",this.usuarioAtual.email),console.log("üéØ Gerando senha tempor√°ria..."),e=this.gerarSenhaTemporaria(),console.log("‚úÖ Senha tempor√°ria gerada:",e?"SIM":"N√ÉO");try{console.log("üîê SIMULA√á√ÉO - Criando usu√°rio:",{email:this.usuarioAtual.email,senha:e,tipo:"rdm"});const a=crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){const t=16*Math.random()|0,e="x"==a?t:3&t|8;return e.toString(16)})),t={user:{id:a}},i=null;if(i)throw console.error("Erro ao criar usu√°rio no Supabase Auth:",i),new Error("N√£o foi poss√≠vel criar o login. Verifique se o email j√° est√° cadastrado.");o=t.user.id,console.log("‚úÖ Usu√°rio criado no Supabase Auth:",o)}catch(a){console.error("Erro na cria√ß√£o do login:",a),alert("Erro ao criar login do usu√°rio. Usu√°rio ser√° cadastrado sem acesso ao sistema.")}}console.log("üìù Preparando dados do usu√°rio..."),console.log("üîë Dados de entrada:",{currentTenantId:this.currentTenantId,usuarioSupabaseId:o,senhaTemporaria:e?"EXISTE":"NULL"});const i={...this.usuarioAtual,tenant_id:this.currentTenantId,user_id:o,senha_temporaria:e,convite_enviado:!1,convite_aceito:!1,ativo:!0,criado_em:(new Date).toISOString(),atualizado_em:(new Date).toISOString()};if(console.log("‚úÖ Dados do usu√°rio preparados com sucesso"),delete i.criar_login,this.usuarioAtual.id||(delete i.id,console.log("üÜî Campo ID removido para permitir gera√ß√£o autom√°tica de UUID")),console.log("üìù Dados preparados para inser√ß√£o:",{temId:!!i.id,tenant_id:i.tenant_id,nome_usuario:i.nome_usuario,email:i.email,materiais:i.materiais?.length||0}),console.log("üîç DIAGN√ìSTICO TENANT_ID:",{currentTenantId:this.currentTenantId,userDataTenantId:i.tenant_id,tenantIdType:typeof i.tenant_id,tenantIdLength:i.tenant_id?.length,isValidUUID:/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i.tenant_id)}),this.usuarioAtual.id){const a={...i};this.usuarioAtual.criar_login||(delete a.user_id,delete a.senha_temporaria,delete a.convite_enviado,delete a.convite_aceito,console.log("üîê Campos de login preservados (n√£o ser√£o sobrescritos)"));const{error:t}=await M.ND.from("usuarios_rdm").update(a).eq("id",this.usuarioAtual.id).eq("tenant_id",this.currentTenantId);if(t)throw t;console.log("‚úÖ Usu√°rio atualizado com sucesso")}else{const{data:a,error:t}=await M.ND.from("usuarios_rdm").insert([i]).select();if(t)throw t;i.id=a[0].id,console.log("‚úÖ Usu√°rio criado com sucesso:",i.id)}console.log("üìß Verificando envio de email...");let s=null;if(o&&e){console.log("üìß Condi√ß√µes atendidas, enviando email..."),console.log("üìß Dados para envio:",{usuarioSupabaseId:o?"EXISTE":"NULL",senhaTemporaria:e?"EXISTE":"NULL",email:i.email});try{s=await this.enviarEmailConvite(i,e),console.log("üìß Resultado do email:",s)}catch(t){console.error("‚ùå ERRO ESPEC√çFICO NO EMAIL:",t),s={success:!1,message:t.message}}}else console.log("‚è© Pulando envio de email (condi√ß√µes n√£o atendidas)");this.fecharModalNovoUsuario(),await this.carregarUsuarios(),o?s&&s.success?alert(`üéâ USU√ÅRIO CADASTRADO COM SUCESSO!\n\n‚úÖ Usu√°rio: ${this.usuarioAtual.nome_usuario}\n‚úÖ Login criado no sistema\n‚úÖ Email enviado para: ${this.usuarioAtual.email}\n\nüìß O usu√°rio receber√°:\n‚Ä¢ Link de acesso: ${window.location.origin.includes("localhost")?window.location.origin+"/rdm":window.location.origin+"/ComprarBem/#/rdm"}\n‚Ä¢ Senha tempor√°ria para primeiro acesso\n‚Ä¢ Instru√ß√µes completas de uso\n\nO usu√°rio j√° pode fazer login no sistema!`):alert(`‚ö†Ô∏è USU√ÅRIO CADASTRADO (Email com problema)\n\n‚úÖ Usu√°rio: ${this.usuarioAtual.nome_usuario}\n‚úÖ Login criado no sistema\n‚ö†Ô∏è Email N√ÉO foi enviado automaticamente\n\nüîß A√á√ÉO NECESS√ÅRIA:\nEnvie manualmente os dados de acesso:\nüìß Email: ${this.usuarioAtual.email}\nüîë Senha: ${e}\nüîó Link: ${window.location.origin.includes("localhost")?window.location.origin+"/rdm":window.location.origin+"/ComprarBem/#/rdm"}\n\nO sistema funciona normalmente, apenas o email autom√°tico falhou.`):alert("‚úÖ Usu√°rio cadastrado com sucesso!"),this.programarAlertasRDM(i)}catch(e){console.error("‚ùå ERRO PRINCIPAL em salvarUsuario:",e),console.error("üìä INFORMA√á√ïES DO ERRO PRINCIPAL:",{tipo:typeof e,nome:e?.name,mensagem:e?.message,stack:e?.stack});let a="Erro desconhecido. Tente novamente.";try{e&&e.message?a=e.message:e&&"function"===typeof e.toString&&(a=e.toString())}catch(o){console.error("Erro ao extrair mensagem:",o)}alert(`‚ùå Erro ao salvar usu√°rio: ${a}`)}},async editarUsuario(a){console.log("üîß Editando usu√°rio:",a.nome_usuario),console.log("üìã Materiais do usu√°rio:",a.materiais),await this.carregarProdutos(),this.usuarioAtual={...a},this.usuarioAtual.materiais&&Array.isArray(this.usuarioAtual.materiais)||(console.log("‚ö†Ô∏è Materiais n√£o encontrados, inicializando array vazio"),this.usuarioAtual.materiais=[]),this.usuarioAtual.materiais=this.usuarioAtual.materiais.map(((a,t)=>{console.log(`üì¶ Processando material ${t+1}:`,a);const e={produto_id:a.produto_id||"",nome:a.nome||"",codigo:a.codigo||"",periodicidade_rdm:a.periodicidade_rdm||"mensal",marca:a.marca||"",categoria:a.categoria||"",...a};return console.log(`‚úÖ Material ${t+1} processado:`,e),e})),console.log("‚úÖ Usu√°rio preparado para edi√ß√£o:",this.usuarioAtual),console.log("üì¶ Produtos dispon√≠veis:",this.produtosDisponiveis.length),this.modalNovoUsuario=!0},async removerUsuario(a){if(confirm(`Tem certeza que deseja remover o usu√°rio "${a.nome_usuario}"?`))try{const{error:t}=await M.ND.from("usuarios_rdm").delete().eq("id",a.id).eq("tenant_id",this.currentTenantId);if(t)throw t;await this.carregarUsuarios()}catch(t){console.error("Erro ao remover usu√°rio:",t),alert("Erro ao remover usu√°rio. Tente novamente.")}},verMateriaisUsuario(a){alert(`Materiais de ${a.nome_usuario}:\n\n${a.materiais?.map((a=>`‚Ä¢ ${a.nome} (${a.codigo}) - RDM ${a.periodicidade_rdm}`)).join("\n")||"Nenhum material cadastrado"}`)},calcularProximoRDM(a){if(!a.materiais||0===a.materiais.length)return"N/A";const t=new Date,e=new Date(t.getFullYear(),t.getMonth()+1,1);return e.toLocaleDateString("pt-BR")},programarAlertasRDM(a){console.log("Alertas RDM programados para:",a.nome_usuario)},async testarEmailJS(){if(confirm("üß™ Testar configura√ß√£o do EmailJS?\n\nIsso enviar√° um email de teste para comprarbemteste@gmail.com"))try{if(console.log("üß™ Iniciando teste do EmailJS..."),"undefined"===typeof J.Ay||!J.Ay)throw new Error("‚ùå EmailJS n√£o est√° carregado");if("function"!==typeof J.Ay.init||"function"!==typeof J.Ay.send)throw new Error("‚ùå M√©todos EmailJS n√£o est√£o dispon√≠veis");const t={serviceId:"service_7sv1naw",templateId:"template_nyiw2ua",publicKey:"DqGKMNJ87ch3qVxGv"};console.log("üß™ Configura√ß√£o:",t);try{console.log("üß™ Inicializando EmailJS para teste..."),J.Ay.init(t.publicKey),console.log("‚úÖ EmailJS inicializado com sucesso para teste")}catch(a){throw console.error("‚ùå Erro cr√≠tico na inicializa√ß√£o:",a),new Error("Falha na inicializa√ß√£o do EmailJS para teste: "+a.message)}const e={numero_edital:"TESTE-EMAILJS",email_empresa:"comprarbemteste@gmail.com",message:`\nüß™ TESTE DE CONFIGURA√á√ÉO EMAILJS\n\nEste √© um email de teste para verificar se o EmailJS est√° funcionando corretamente.\n\n=== INFORMA√á√ïES DO TESTE ===\nData do teste: ${(new Date).toLocaleString("pt-BR")}\nSistema: ${window.location.origin}\nTemplate: template_nyiw2ua\nService: service_7sv1naw\n\n=== RESULTADO ===\nSe voc√™ recebeu este email, a configura√ß√£o est√° funcionando perfeitamente!\n\n=== PR√ìXIMO PASSO ===\nAgora voc√™ pode cadastrar usu√°rios RDM com confian√ßa que os emails ser√£o enviados.\n\n---\nSistema Comprar Bem - Compras P√∫blicas Inteligentes\nTeste autom√°tico de configura√ß√£o EmailJS\n          `,name:"Teste do Sistema",email:"comprarbemteste@gmail.com",subject:"üß™ Teste de Configura√ß√£o EmailJS - Sistema Comprar Bem",status_participante:"aprovado",motivo_rejeicao:""};console.log("üß™ Enviando email de teste..."),console.log("üß™ Par√¢metros:",e);const o=await J.Ay.send(t.serviceId,t.templateId,e,t.publicKey);if(console.log("‚úÖ Teste bem-sucedido:",o),!o||200!==o.status)throw new Error(`Status de resposta inesperado: ${o?.status}`);alert("‚úÖ TESTE REALIZADO COM SUCESSO!\n\nüìß Email de teste enviado para comprarbemteste@gmail.com\n\n‚úÖ EmailJS est√° configurado corretamente")}catch(t){console.error("‚ùå Falha no teste:",t),alert(`‚ùå FALHA NO TESTE DO EMAILJS\n\nErro: ${t.message}\n\nPoss√≠veis causas:\n‚Ä¢ Configura√ß√£o incorreta do EmailJS\n‚Ä¢ Problemas de conectividade\n‚Ä¢ Service ID ou Template ID inv√°lidos\n‚Ä¢ Public Key incorreta\n\nVerifique:\n1. Configura√ß√£o no EmailJS Dashboard\n2. Conex√£o com a internet\n3. Console do navegador para mais detalhes`)}},async carregarAvaliacoes(){try{console.log("üîç [AVALIA√á√ïES CPM] === DEBUG COMPLETO ==="),console.log("üîç [AVALIA√á√ïES CPM] Tenant ID atual:",this.currentTenantId),console.log("üîç [AVALIA√á√ïES CPM] TESTE 1: TODAS as avalia√ß√µes (sem filtro)");const{data:a,error:t}=await M.ND.from("material_feedbacks").select("*").order("criado_em",{ascending:!1});console.log("üìä [AVALIA√á√ïES CPM] TESTE 1 - Total geral:",a?.length||0),a&&a.length>0&&(console.log("üìä [AVALIA√á√ïES CPM] TESTE 1 - Primeira avalia√ß√£o:",a[0]),console.log("üìä [AVALIA√á√ïES CPM] TESTE 1 - Tenant IDs encontrados:",[...new Set(a.map((a=>a.tenant_id)))])),console.log("üîç [AVALIA√á√ïES CPM] TESTE 2: Com filtro de tenant");const{data:e,error:o}=await M.ND.from("material_feedbacks").select("*").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1});if(console.log("üìä [AVALIA√á√ïES CPM] TESTE 2 - Com tenant:",e?.length||0),o)return console.error("‚ùå [AVALIA√á√ïES CPM] Erro ao carregar avalia√ß√µes b√°sicas:",o),this.avaliacoes=[],void this.aplicarFiltrosAvaliacoes();if(!e||0===e.length)return console.log("üì≠ [AVALIA√á√ïES CPM] Nenhuma avalia√ß√£o encontrada para este tenant"),console.log("üîç [AVALIA√á√ïES CPM] Vamos usar TODAS as avalia√ß√µes temporariamente para debug..."),a&&a.length>0?(this.avaliacoes=await this.enriquecerAvaliacoesComUsuarios(a),console.log("üîÑ [AVALIA√á√ïES CPM] Usando TODAS as avalia√ß√µes (sem filtro de tenant)")):this.avaliacoes=[],void this.aplicarFiltrosAvaliacoes();console.log("üîç [AVALIA√á√ïES CPM] TESTE 3: JOIN com usu√°rios");const{data:i,error:s}=await M.ND.from("material_feedbacks").select("\n            *,\n            usuario_rdm:usuarios_rdm(nome_usuario, unidade_setor, email, telefone)\n          ").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1});s?(console.error("‚ö†Ô∏è [AVALIA√á√ïES CPM] Erro no JOIN, usando dados b√°sicos:",s),this.avaliacoes=await this.enriquecerAvaliacoesComUsuarios(e)):(console.log("‚úÖ [AVALIA√á√ïES CPM] JOIN executado com sucesso:",i?.length||0),this.avaliacoes=i||[]),this.aplicarFiltrosAvaliacoes(),console.log("üéØ [AVALIA√á√ïES CPM] === FIM DEBUG - RESULTADO FINAL ==="),console.log("üéØ [AVALIA√á√ïES CPM] Avalia√ß√µes carregadas:",this.avaliacoes.length)}catch(a){console.error("‚ùå [AVALIA√á√ïES CPM] Erro geral ao carregar avalia√ß√µes:",a),this.avaliacoes=[],this.aplicarFiltrosAvaliacoes()}},async enriquecerAvaliacoesComUsuarios(a){try{const t=[];for(const e of a)if(e.usuario_rdm_id){const{data:a,error:o}=await M.ND.from("usuarios_rdm").select("nome_usuario, unidade_setor, email, telefone").eq("id",e.usuario_rdm_id).eq("tenant_id",this.currentTenantId).single();t.push({...e,usuario_rdm:a||null})}else t.push({...e,usuario_rdm:null});return t}catch(t){return console.error("‚ùå [AVALIA√á√ïES CPM] Erro ao enriquecer com usu√°rios:",t),a.map((a=>({...a,usuario_rdm:null})))}},aplicarFiltrosAvaliacoes(){let a=[...this.avaliacoes];if(this.filtroAvaliacoes.busca){const t=this.filtroAvaliacoes.busca.toLowerCase();a=a.filter((a=>a.material_nome?.toLowerCase().includes(t)||a.material_codigo?.toLowerCase().includes(t)||a.usuario_rdm?.nome_usuario?.toLowerCase().includes(t)||a.usuario_rdm?.unidade_setor?.toLowerCase().includes(t)||a.comentario?.toLowerCase().includes(t)))}this.filtroAvaliacoes.rating&&(a=a.filter((a=>a.rating==this.filtroAvaliacoes.rating))),this.filtroAvaliacoes.usuario&&(a=a.filter((a=>a.usuario_rdm?.nome_usuario?.toLowerCase().includes(this.filtroAvaliacoes.usuario.toLowerCase())))),this.avaliacoesFiltradas=a},toggleLoginSystem(){this.usuarioAtual.criar_login||(this.usuarioAtual.senha_temporaria=null,this.usuarioAtual.user_id=null)},gerarSenhaTemporaria(){const a=(new Date).getFullYear(),t=Math.floor(1e4*Math.random()).toString().padStart(4,"0");return`CB${a}${t}`},async enviarEmailConvite(a,t){try{if(console.log("üìß Enviando email REAL de convite para:",a.email),"undefined"===typeof J.Ay||!J.Ay)throw new Error("EmailJS n√£o est√° carregado. Verifique a importa√ß√£o.");if("function"!==typeof J.Ay.init||"function"!==typeof J.Ay.send)throw new Error("M√©todos EmailJS n√£o est√£o dispon√≠veis. Verifique a vers√£o.");const o={serviceId:"service_7sv1naw",templateId:"template_nyiw2ua",publicKey:"DqGKMNJ87ch3qVxGv"};console.log("üìß EmailJS dispon√≠vel:",typeof J.Ay),console.log("üìß Configura√ß√£o:",o);const i={numero_edital:"RDM-CONVITE",email_empresa:a.email,message:`\nüîê BEM-VINDO AO SISTEMA COMPRAR BEM\n\nOl√° ${a.nome_usuario}!\n\nVoc√™ foi cadastrado(a) para acessar o Sistema Comprar Bem - Dashboard RDM Online.\n\n=== SEUS DADOS DE ACESSO ===\nEmail: ${a.email}\nSenha de Acesso: ${t}\nUnidade/Setor: ${a.unidade_setor}\nCoordenador: ${a.nome_coordenador}\n\n=== COMO ACESSAR ===\n1. Acesse: ${window.location.origin.includes("localhost")?window.location.origin+"/rdm":window.location.origin+"/ComprarBem/#/rdm"}\n2. Fa√ßa login com seu email e senha\n3. Comece a emitir suas RDMs online!\n\n=== FUNCIONALIDADES DISPON√çVEIS ===\n‚úÖ Emiss√£o de RDMs online\n‚úÖ Hist√≥rico de solicita√ß√µes\n‚úÖ Acompanhamento de status\n‚úÖ Notifica√ß√µes autom√°ticas\n\n=== IMPORTANTE ===\nüîë Use sempre a mesma senha para acessar o sistema\nüìù Guarde seus dados de acesso em local seguro\nüìû Em caso de d√∫vidas, entre em contato conosco\n\n=== SUPORTE ===\nEmail: comprarbemteste@gmail.com\nSistema: ${window.location.origin}\n\nData do cadastro: ${(new Date).toLocaleDateString("pt-BR")}\n\n---\nSistema Comprar Bem - Compras P√∫blicas Inteligentes\nEste √© um email autom√°tico. N√£o responda diretamente.\n          `,name:a.nome_usuario,email:"comprarbemteste@gmail.com",subject:"üîê Bem-vindo ao Sistema Comprar Bem - Acesso RDM Online",status_participante:"aprovado",motivo_rejeicao:""};console.log("üìß Enviando email REAL via EmailJS..."),console.log("üìß Para:",a.email),console.log("üìß Config EmailJS:",o),console.log("üìß Par√¢metros do email:",i);try{console.log("üìß Inicializando EmailJS com public key..."),J.Ay.init(o.publicKey),console.log("‚úÖ EmailJS inicializado com sucesso")}catch(e){throw console.error("‚ùå Erro na inicializa√ß√£o do EmailJS:",e),new Error("Falha na inicializa√ß√£o do EmailJS: "+e.message)}console.log("üìß Chamando emailjs.send...");const s=await J.Ay.send(o.serviceId,o.templateId,i,o.publicKey);if(console.log("üéâ EMAIL REAL ENVIADO COM SUCESSO!",s),!s||200!==s.status)throw new Error(`Falha no envio do email. Status: ${s?.status||"desconhecido"}`);return await M.ND.from("usuarios_rdm").update({convite_enviado:!0,data_convite:(new Date).toISOString()}).eq("id",a.id).eq("tenant_id",this.currentTenantId),console.log("‚úÖ Status do convite atualizado no banco"),await this.criarNotificacao(this.currentTenantId,this.currentTenantId,"SISTEMA","Convite RDM Enviado",`‚úÖ Email de convite enviado com SUCESSO!\n          \nüìß Destinat√°rio: ${a.nome_usuario} (${a.email})\nüîë Senha de acesso: ${t}\nüîó Link de acesso: ${window.location.origin.includes("localhost")?window.location.origin+"/rdm":window.location.origin+"/ComprarBem/#/rdm"}\nüìÖ Data: ${(new Date).toLocaleString("pt-BR")}\n\nO usu√°rio pode fazer login imediatamente no sistema RDM.`,null),console.log("üéâ PROCESSO COMPLETO - Email enviado e notifica√ß√£o criada!"),{success:!0,message:"Email enviado com sucesso!"}}catch(o){console.error("‚ùå ERRO DETALHADO ao enviar email de convite:",o),console.error("üìä INFORMA√á√ïES DO ERRO:",{tipo:typeof o,nome:o?.name||"SemNome",mensagem:o?.message||"SemMensagem",stack:o?.stack||"SemStack",usuario:a?.email||"SemEmail",emailjsDisponivel:typeof J.Ay,errorString:o?.toString()||"N√£oConvert√≠vel"});let t="Erro desconhecido";try{let a="Erro sem descri√ß√£o";o&&"object"===typeof o?"string"===typeof o.message?a=o.message:"function"===typeof o.toString&&(a=o.toString()):"string"===typeof o&&(a=o),console.log("üîç Mensagem de erro extra√≠da:",a),t="string"===typeof a&&a.length>0?-1!==a.indexOf("emailjs")?"EmailJS n√£o est√° carregado ou configurado corretamente":-1!==a.indexOf("network")||-1!==a.indexOf("fetch")?"Erro de conectividade. Verifique sua conex√£o com a internet":-1!==a.indexOf("service")||-1!==a.indexOf("template")?"Configura√ß√£o inv√°lida do EmailJS (service/template ID)":-1!==a.indexOf("422")?"Par√¢metros incorretos do template EmailJS (erro 422)":-1!==a.indexOf("includes")?"Erro interno do JavaScript (propriedade undefined)":a:"Erro sem mensagem v√°lida"}catch(i){console.error("‚ùå Erro na an√°lise do erro:",i),t="Erro complexo n√£o analis√°vel"}return{success:!1,message:t}}},async criarNotificacao(a,t,e,o,i,s=null){try{const{error:r}=await M.ND.from("notificacoes").insert([{tenant_id:a,usuario_destino:t,tipo:e,titulo:o,mensagem:i,link_acao:s,criado_em:(new Date).toISOString()}]);if(r)throw r}catch(r){console.error("Erro ao criar notifica√ß√£o:",r)}},async verificarStatusConvites(){try{const{data:a,error:t}=await M.ND.from("usuarios_rdm").select("id, nome_usuario, email, convite_enviado, convite_aceito, data_convite").eq("tenant_id",this.currentTenantId).eq("ativo",!0).not("user_id","is",null);if(t)throw t;this.statusConvites=a.reduce(((a,t)=>(a[t.id]={enviado:t.convite_enviado,aceito:t.convite_aceito,dataConvite:t.data_convite},a)),{})}catch(a){console.error("Erro ao verificar status dos convites:",a)}},async reenviarConvite(a){if(confirm(`Reenviar convite de acesso para ${a.nome_usuario}?`))try{const t=this.gerarSenhaTemporaria();await M.ND.from("usuarios_rdm").update({senha_temporaria:t,convite_enviado:!1}).eq("id",a.id).eq("tenant_id",this.currentTenantId),a.user_id&&console.log("üîê SIMULA√á√ÉO - Atualizando senha para:",a.email,t),await this.enviarEmailConvite({...a,senha_temporaria:t},t),alert("‚úÖ Convite reenviado com sucesso!"),await this.carregarUsuarios()}catch(t){console.error("Erro ao reenviar convite:",t),alert("‚ùå Erro ao reenviar convite. Tente novamente.")}},async carregarProdutos(){try{this.loadingProdutos=!0,console.log("üì¶ Carregando produtos dispon√≠veis..."),console.log("üîë Tenant ID atual:",this.currentTenantId);const{data:a,error:t}=await M.ND.from("produtos").select("id, nome, marca, modelo, codigo_material, categoria_id, status, tenant_id").order("nome");console.log("üìä Todos os produtos encontrados:",a?.length||0),console.log("üìã Primeiros 3 produtos:",a?.slice(0,3)),a?.length>0&&console.log("üîç Estrutura do primeiro produto:",{id:a[0].id,nome:a[0].nome,marca:a[0].marca,modelo:a[0].modelo,codigo_material:a[0].codigo_material,categoria_id:a[0].categoria_id,status:a[0].status,tenant_id:a[0].tenant_id});const{data:e,error:o}=await M.ND.from("produtos").select("id, nome, marca, modelo, codigo_material, categoria_id, status, tenant_id").eq("tenant_id",this.currentTenantId).order("nome");if(console.log("üéØ Produtos do tenant atual:",e?.length||0),console.log("üìã Status dos produtos:",e?.map((a=>a.status))),o)throw console.error("‚ùå Erro na query:",o),o;let i=e?.filter((a=>"aprovado"===a.status))||[];0===i.length&&(console.log('‚ö†Ô∏è Nenhum produto "aprovado" encontrado, carregando todos os produtos do tenant...'),i=e||[]),this.produtosDisponiveis=i,console.log(`‚úÖ ${this.produtosDisponiveis.length} produtos carregados para sele√ß√£o`),console.log("üì¶ Produtos dispon√≠veis:",this.produtosDisponiveis.map((a=>`${a.nome} (${a.status})`)))}catch(a){console.error("‚ùå Erro ao carregar produtos:",a),this.produtosDisponiveis=[],alert(`‚ùå Erro ao carregar produtos:\n${a.message}\n\nVerifique o console para mais detalhes.`)}finally{this.loadingProdutos=!1}},selecionarProduto(a,t){const e=t.target.value,o=this.usuarioAtual.materiais[a];if(console.log("üîç Selecionando produto:",e,"para material index:",a),"NOVO"===e)o.produto_id="NOVO",o.nome="",o.codigo="",console.log("üìù Modo novo material ativado");else if(e){const a=this.produtosDisponiveis.find((a=>a.id===e));console.log("üîç Produto encontrado:",a),a&&(o.produto_id=e,o.nome=a.nome,o.codigo=a.codigo_material||a.modelo||"",o.marca=a.marca||"",o.categoria=a.categoria_id||"",console.log("‚úÖ Dados do produto aplicados:",{nome:o.nome,codigo:o.codigo,marca:o.marca,categoria_id:o.categoria}))}else o.produto_id="",o.nome="",o.codigo="",console.log("üóëÔ∏è Sele√ß√£o limpa");console.log("üìã Material atualizado:",o)}},formatarData(a){if(!a)return"";const t=new Date(a);return t.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},formatCurrency(a){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a)}},oa=ea;var ia=(0,C.A)(oa,V,j,!1,null,"2541b162",null);const sa=ia.exports,ra={name:"Dashboard",components:{DashboardCPM:sa},data(){return{showDropdown:!1,usuarioNome:"Usu√°rio",usuarioEmail:"",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comiss√£o de Padroniza√ß√£o de Materiais"}},async created(){await this.carregarDadosUsuario(),this.carregarConfiguracoes()},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await M.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usu√°rio:",a)}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configura√ß√µes:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},closeDropdown(){this.showDropdown=!1},abrirConfiguracoes(){this.closeDropdown(),this.mostrarConfigEmail()},abrirConfiguracoesEmail(){this.closeDropdown(),this.mostrarConfigEmail()},async mostrarConfigEmail(){const{value:a}=await this.$swal({title:"üìß Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das dilig√™ncias</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comiss√£o de Padroniza√ß√£o de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"üíæ Salvar",cancelButtonText:"‚ùå Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"‚úÖ Sucesso!",text:"Configura√ß√µes de email salvas com sucesso!",icon:"success"})}},async logout(){try{await M.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()}}},na=ra;var la=(0,C.A)(na,L,U,!1,null,"b8d8320a",null);const ca=la.exports;var da=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cadastro-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Cat√°logo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classifica√ß√£o")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("‚ñº")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("üë§")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("‚öôÔ∏è")]),t("span",[a._v("Configura√ß√µes")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("üìß")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("üö™")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("CadastroProduto")],1)])},ua=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras P√∫blicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("üë§")])])}],ma=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cadastro-produto"},[t("h2",[a._v("Cadastro de Produto")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarProduto.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome do Produto*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.nome,expression:"produto.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.produto.nome},on:{input:function(t){t.target.composing||a.$set(a.produto,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"grupo"}},[a._v("Grupo*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produto.grupo_id,expression:"produto.grupo_id"}],attrs:{id:"grupo",required:""},on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.produto,"grupo_id",t.target.multiple?e:e[0])},a.onGrupoChange]}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.grupos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" ")])}))],2)])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"classe"}},[a._v("Classe*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produto.classe_id,expression:"produto.classe_id"}],attrs:{id:"classe",required:"",disabled:!a.produto.grupo_id||0===a.classes.length},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.produto,"classe_id",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.filteredClasses,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" ")])}))],2),a.produto.grupo_id&&0===a.filteredClasses.length?t("div",{staticClass:"info-text"},[a._v(" N√£o h√° classes dispon√≠veis para este grupo. Por favor, cadastre uma classe primeiro. ")]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"marca"}},[a._v("Marca*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.marca,expression:"produto.marca"}],attrs:{id:"marca",type:"text",required:""},domProps:{value:a.produto.marca},on:{input:function(t){t.target.composing||a.$set(a.produto,"marca",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"modelo"}},[a._v("Modelo*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.modelo,expression:"produto.modelo"}],attrs:{id:"modelo",type:"text",required:""},domProps:{value:a.produto.modelo},on:{input:function(t){t.target.composing||a.$set(a.produto,"modelo",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"fabricante"}},[a._v("Fabricante*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.fabricante,expression:"produto.fabricante"}],attrs:{id:"fabricante",type:"text",required:""},domProps:{value:a.produto.fabricante},on:{input:function(t){t.target.composing||a.$set(a.produto,"fabricante",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cnpj"}},[a._v("CNPJ do Requerente*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.cnpjFormatado,expression:"cnpjFormatado"}],class:{"input-error":a.cnpjInvalido,"input-success":a.cnpjValidado&&!a.cnpjInvalido},attrs:{id:"cnpj",type:"text",required:"",maxlength:"18",placeholder:"00.000.000/0000-00"},domProps:{value:a.cnpjFormatado},on:{input:[function(t){t.target.composing||(a.cnpjFormatado=t.target.value)},a.formatarCNPJ]}}),a.cnpjMensagem?t("div",{class:["mensagem",{"error-text":a.cnpjInvalido,"success-text":!a.cnpjInvalido}]},[a._v(" "+a._s(a.cnpjMensagem)+" ")]):a._e(),a.dadosEmpresa?t("div",{staticClass:"dados-empresa"},[t("p",[t("strong",[a._v("Raz√£o Social:")]),a._v(" "+a._s(a.dadosEmpresa.razaoSocial))]),a.dadosEmpresa.nomeFantasia?t("p",[t("strong",[a._v("Nome Fantasia:")]),a._v(" "+a._s(a.dadosEmpresa.nomeFantasia))]):a._e(),t("p",[t("strong",[a._v("Situa√ß√£o:")]),a._v(" "+a._s(a.dadosEmpresa.situacao))])]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email_fornecedor"}},[a._v("E-mail do Requerente*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.email_fornecedor,expression:"produto.email_fornecedor"}],attrs:{id:"email_fornecedor",type:"email",required:"",placeholder:"contato@empresa.com"},domProps:{value:a.produto.email_fornecedor},on:{input:function(t){t.target.composing||a.$set(a.produto,"email_fornecedor",t.target.value)}}}),t("small",{staticClass:"info-text"},[a._v("Email para comunica√ß√µes sobre dilig√™ncias")])])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"origem"}},[a._v("Origem")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.origem,expression:"produto.origem"}],attrs:{id:"origem",type:"text",placeholder:"Nacional ou Importado"},domProps:{value:a.produto.origem},on:{input:function(t){t.target.composing||a.$set(a.produto,"origem",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registro_anvisa"}},[a._v("Registro na Anvisa/MS")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.registro_anvisa,expression:"produto.registro_anvisa"}],attrs:{id:"registro_anvisa",type:"text",placeholder:"N√∫mero do registro"},domProps:{value:a.produto.registro_anvisa},on:{input:function(t){t.target.composing||a.$set(a.produto,"registro_anvisa",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cbpf"}},[a._v("CBPF")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.cbpf,expression:"produto.cbpf"}],attrs:{id:"cbpf",type:"text",placeholder:"Certificado de Boas Pr√°ticas de Fabrica√ß√£o"},domProps:{value:a.produto.cbpf},on:{input:function(t){t.target.composing||a.$set(a.produto,"cbpf",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"codigo_material"}},[a._v("C√≥digo do Material")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.codigo_material,expression:"produto.codigo_material"}],attrs:{id:"codigo_material",type:"text",placeholder:"C√≥digo interno do material"},domProps:{value:a.produto.codigo_material},on:{input:function(t){t.target.composing||a.$set(a.produto,"codigo_material",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"norma_abnt"}},[a._v("Norma ABNT")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.norma_abnt,expression:"produto.norma_abnt"}],attrs:{id:"norma_abnt",type:"text",placeholder:"N√∫mero da norma ABNT"},domProps:{value:a.produto.norma_abnt},on:{input:function(t){t.target.composing||a.$set(a.produto,"norma_abnt",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"norma_regulamentadora"}},[a._v("Norma Regulamentadora")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.norma_regulamentadora,expression:"produto.norma_regulamentadora"}],attrs:{id:"norma_regulamentadora",type:"text",placeholder:"N√∫mero da norma regulamentadora"},domProps:{value:a.produto.norma_regulamentadora},on:{input:function(t){t.target.composing||a.$set(a.produto,"norma_regulamentadora",t.target.value)}}})])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Especifica√ß√£o Detalhada")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.produto.descricao,expression:"produto.descricao"}],attrs:{id:"descricao",rows:"4"},domProps:{value:a.produto.descricao},on:{input:function(t){t.target.composing||a.$set(a.produto,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Documenta√ß√£o do Produto (apenas PDF)")]),t("div",{staticClass:"file-upload"},[t("input",{attrs:{type:"file",multiple:"",accept:".pdf"},on:{change:a.onFileSelect}})]),t("small",{staticClass:"info-text"},[a._v("Apenas arquivos PDF s√£o aceitos (m√°x. 10MB por arquivo)")]),a.selectedFiles.length>0?t("div",{staticClass:"selected-files"},[t("p",[a._v("Arquivos selecionados:")]),t("ul",a._l(a.selectedFiles,(function(e,o){return t("li",{key:o,class:{"arquivo-invalido":!a.validarArquivoPDF(e)}},[a._v(" "+a._s(e.name)+" "),a.validarArquivoPDF(e)?a._e():t("span",{staticClass:"error-text"},[a._v("(Formato inv√°lido - apenas PDF permitido)")])])})),0)]):a._e(),a.arquivosInvalidos.length>0?t("div",{staticClass:"error-text"},[t("p",[a._v("Os seguintes arquivos n√£o ser√£o enviados (apenas PDF permitido):")]),t("ul",a._l(a.arquivosInvalidos,(function(e,o){return t("li",{key:o},[a._v(" "+a._s(e.name)+" ")])})),0)]):a._e()]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.loading}},[a._v(" "+a._s(a.loading?"Salvando...":"Salvar")+" ")])])])])},pa=[];const va="https://publica.cnpj.ws/cnpj";async function ga(a){try{const t=a.replace(/[^\d]/g,"");if(14!==t.length)return{valido:!1,mensagem:"CNPJ deve ter 14 d√≠gitos"};const e=await fetch(`${va}/${t}`);if(!e.ok){if(404===e.status)return{valido:!1,mensagem:"CNPJ n√£o encontrado na base de dados"};throw new Error("Erro ao consultar CNPJ")}const o=await e.json();return{valido:!0,mensagem:"CNPJ v√°lido",dados:{razaoSocial:o.razao_social,nomeFantasia:o.estabelecimento?.nome_fantasia||"",situacao:o.estabelecimento?.situacao_cadastral||""}}}catch(t){return console.error("Erro ao validar CNPJ:",t),{valido:!1,mensagem:"Erro ao validar CNPJ. Tente novamente mais tarde."}}}const ha={name:"CadastroProduto",data(){return{produto:{nome:"",grupo_id:"",classe_id:"",marca:"",modelo:"",fabricante:"",cnpj:"",email_fornecedor:"",origem:"",registro_anvisa:"",cbpf:"",codigo_material:"",norma_abnt:"",norma_regulamentadora:"",descricao:""},cnpjFormatado:"",cnpjInvalido:!1,cnpjMensagem:"",cnpjValidado:!1,dadosEmpresa:null,loading:!1,grupos:[],classes:[],selectedFiles:[],arquivosInvalidos:[],currentTenantId:null}},computed:{filteredClasses(){return this.produto.grupo_id?this.classes.filter((a=>a.grupo_id===this.produto.grupo_id)):[]}},async created(){this.carregarGrupos(),await this.obterTenantId()},methods:{async obterTenantId(){try{const{data:a}=await M.ND.auth.getSession(),t=a?.session?.user;if(!t)throw new Error("Usu√°rio n√£o autenticado");if(t?.user_metadata?.tenant_id)return console.log("Obteve tenant_id dos metadados:",t.user_metadata.tenant_id),void(this.currentTenantId=t.user_metadata.tenant_id);const{data:e,error:o}=await M.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(console.log("Busca de tenant_id na tabela usuarios:",{userData:e,userError:o}),e&&e.tenant_id){console.log("Obteve tenant_id da tabela usuarios:",e.tenant_id),this.currentTenantId=e.tenant_id;const{error:a}=await M.ND.auth.updateUser({data:{tenant_id:e.tenant_id}});return void(a?console.error("Erro ao atualizar metadados do usu√°rio:",a):console.log("Metadados do usu√°rio atualizados com sucesso"))}const i=(0,$.A)();console.log("Gerando novo tenant_id:",i);const{error:s}=await M.ND.from("usuarios").insert({id:(0,$.A)(),email:t.email,tenant_id:i,ativo:!0});s&&console.error("Erro ao inserir novo tenant_id na tabela usuarios:",s);const{error:r}=await M.ND.auth.updateUser({data:{tenant_id:i}});r?console.error("Erro ao atualizar metadados do usu√°rio:",r):console.log("Metadados do usu√°rio atualizados com novo tenant_id"),this.currentTenantId=i}catch(a){console.error("Erro ao obter tenant_id:",a),alert("Erro ao obter identifica√ß√£o do tenant. Por favor, fa√ßa login novamente."),this.$router.push("/")}},async carregarGrupos(){try{const{data:a,error:t}=await M.ND.from("grupos").select("*").order("nome");if(t)throw t;a&&a.length>0?this.grupos=a:this.grupos=[{id:1,nome:"Equipamentos M√©dicos"},{id:2,nome:"Equipamentos Odontol√≥gicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escrit√≥rio"},{id:5,nome:"Equipamentos de Inform√°tica"},{id:6,nome:"Mobili√°rio"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laborat√≥rio"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}catch(a){console.error("Erro ao carregar grupos:",a),this.grupos=[{id:1,nome:"Equipamentos M√©dicos"},{id:2,nome:"Equipamentos Odontol√≥gicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escrit√≥rio"},{id:5,nome:"Equipamentos de Inform√°tica"},{id:6,nome:"Mobili√°rio"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laborat√≥rio"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}},onGrupoChange(){this.carregarClasses()},async carregarClasses(){try{const{data:a,error:t}=await M.ND.from("classes").select("*").eq("grupo_id",this.produto.grupo_id).order("nome");if(t)throw t;a&&a.length>0?this.classes=a:this.classes=[{id:1,nome:"Equipamentos M√©dicos"},{id:2,nome:"Equipamentos Odontol√≥gicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escrit√≥rio"},{id:5,nome:"Equipamentos de Inform√°tica"},{id:6,nome:"Mobili√°rio"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laborat√≥rio"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}catch(a){console.error("Erro ao carregar classes:",a),this.classes=[{id:1,nome:"Equipamentos M√©dicos"},{id:2,nome:"Equipamentos Odontol√≥gicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escrit√≥rio"},{id:5,nome:"Equipamentos de Inform√°tica"},{id:6,nome:"Mobili√°rio"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laborat√≥rio"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}},async formatarCNPJ(a){let t=a.target.value.replace(/\D/g,"");t.length<=14&&(t=t.replace(/^(\d{2})(\d)/,"$1.$2"),t=t.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3"),t=t.replace(/\.(\d{3})(\d)/,".$1/$2"),t=t.replace(/(\d{4})(\d)/,"$1-$2"),this.cnpjFormatado=t,this.produto.cnpj=t,this.cnpjValidado&&(this.cnpjValidado=!1,this.cnpjInvalido=!1,this.cnpjMensagem="",this.dadosEmpresa=null),14===t.replace(/\D/g,"").length&&await this.validarCNPJOnline())},async validarCNPJOnline(){try{const a=await ga(this.cnpjFormatado);this.cnpjValidado=!0,this.cnpjInvalido=!a.valido,this.cnpjMensagem=a.mensagem,a.valido?this.dadosEmpresa=a.dados:this.dadosEmpresa=null}catch(a){console.error("Erro ao validar CNPJ:",a),this.cnpjInvalido=!0,this.cnpjMensagem="Erro ao validar CNPJ. Tente novamente mais tarde."}},onFileSelect(a){const t=Array.from(a.target.files);this.arquivosInvalidos=[],this.selectedFiles=t.filter((a=>{const t=this.validarArquivoPDF(a);return t||this.arquivosInvalidos.push(a),t}))},validarArquivoPDF(a){const t=a.name.split(".").pop().toLowerCase(),e=a.type.toLowerCase();return"pdf"===t&&"application/pdf"===e},sanitizarNomeArquivo(a){let t=a.normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(t=t.replace(/[^a-zA-Z0-9_.]/g,"_"),t.length>100){const a=t.split(".").pop();t=t.substring(0,90)+"."+a}return t},async salvarProduto(){if(this.validarFormulario())try{if(this.loading=!0,this.currentTenantId||await this.obterTenantId(),console.log("Salvando produto com tenant_id:",this.currentTenantId),!this.validarCNPJ())return this.$swal({icon:"error",title:"CNPJ Inv√°lido",text:"Por favor, informe um CNPJ v√°lido no formato 00.000.000/0000-00"}),void(this.loading=!1);const a={nome:this.produto.nome,descricao:this.produto.descricao,grupo_id:this.produto.grupo_id,classe_id:this.produto.classe_id,marca:this.produto.marca,modelo:this.produto.modelo,fabricante:this.produto.fabricante,cnpj:this.produto.cnpj,email_fornecedor:this.produto.email_fornecedor,origem:this.produto.origem,registro_anvisa:this.produto.registro_anvisa,cbpf:this.produto.cbpf,norma_abnt:this.produto.norma_abnt,norma_regulamentadora:this.produto.norma_regulamentadora,codigo_material:this.produto.codigo_material,status:"pendente",tenant_id:this.currentTenantId};console.log("Objeto produto a ser inserido:",a);const{data:t,error:e}=await M.ND.from("produtos").insert(a).select().single();if(e)throw console.error("Erro detalhado ao salvar produto:",e),new Error(`Erro ao salvar produto: ${e.message}`);console.log("Produto inserido com sucesso:",t);const o=this.selectedFiles.filter((a=>this.validarArquivoPDF(a)));if(o.length>0){const a=t.id;for(const t of o){const e=t.name,o=this.sanitizarNomeArquivo(t.name),i=`${Date.now()}-${o}`;console.log(`Upload de arquivo: Original "${e}" -> Sanitizado "${o}"`);const{data:s,error:r}=await M.ND.storage.from("documentos").upload(i,t);if(r){console.error("Erro ao fazer upload do arquivo:",r);continue}const{data:n}=M.ND.storage.from("documentos").getPublicUrl(i),l=n?.publicUrl||"",c={tenant_id:this.currentTenantId,produto_id:a,nome:e,tipo:t.type,arquivo_url:l},{error:d}=await M.ND.from("documentos").insert(c);d&&console.error("Erro ao registrar documento:",d)}}this.arquivosInvalidos.length>0?this.$swal({icon:"warning",title:"Produto salvo com ressalvas",text:`O produto foi salvo, mas ${this.arquivosInvalidos.length} arquivo(s) n√£o foi(ram) enviado(s) por n√£o serem PDFs v√°lidos.`}):this.$swal({icon:"success",title:"Produto salvo com sucesso!",text:"O produto foi cadastrado e est√° aguardando aprova√ß√£o."}),this.limparFormulario()}catch(a){console.error("Erro no processo de salvamento:",a),this.$swal({icon:"error",title:"Erro ao salvar produto",text:a.message||"Ocorreu um erro ao tentar salvar o produto."})}finally{this.loading=!1}},limparFormulario(){this.produto={nome:"",grupo_id:"",classe_id:"",marca:"",modelo:"",fabricante:"",cnpj:"",origem:"",registro_anvisa:"",cbpf:"",norma_abnt:"",norma_regulamentadora:"",codigo_material:"",descricao:"",status:"pendente"},this.cnpjFormatado="",this.cnpjInvalido=!1,this.selectedFiles=[],this.arquivosInvalidos=[]},validarFormulario(){return this.produto.nome&&""!==this.produto.nome.trim()?this.produto.grupo_id?this.produto.classe_id?this.produto.descricao&&""!==this.produto.descricao.trim()?this.validarCNPJ()?(this.arquivosInvalidos.length>0&&this.$swal({icon:"error",title:"Arquivos inv√°lidos",text:"Alguns arquivos selecionados n√£o s√£o PDFs v√°lidos e n√£o ser√£o enviados."}),!0):(this.$swal({icon:"error",title:"Erro de valida√ß√£o",text:"O CNPJ informado √© inv√°lido"}),!1):(this.$swal({icon:"error",title:"Erro de valida√ß√£o",text:"A descri√ß√£o do produto √© obrigat√≥ria"}),!1):(this.$swal({icon:"error",title:"Erro de valida√ß√£o",text:"Selecione uma classe para o produto"}),!1):(this.$swal({icon:"error",title:"Erro de valida√ß√£o",text:"Selecione um grupo para o produto"}),!1):(this.$swal({icon:"error",title:"Erro de valida√ß√£o",text:"O nome do produto √© obrigat√≥rio"}),!1)},convertToUUID(a){if(!a)return null;const t=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(t.test(a))return console.log("categoria_id j√° √© um UUID v√°lido:",a),a;const e=parseInt(a,10);if(isNaN(e))return console.warn("categoria_id n√£o √© um n√∫mero nem UUID v√°lido:",a),(0,$.A)();const o=`00000000-0000-0000-0000-${e.toString().padStart(12,"0")}`;return console.log(`Converteu categoria_id ${a} para UUID: ${o}`),o}}},fa=ha;var _a=(0,C.A)(fa,ma,pa,!1,null,"68eb370a",null);const Ca=_a.exports,ba={name:"Cadastro",components:{CadastroProduto:Ca},data(){return{showDropdown:!1,modalEmailAberto:!1,usuarioNome:"comprarBemTeste",usuarioEmail:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comiss√£o de Padroniza√ß√£o de Materiais"}},async created(){await this.carregarDadosUsuario(),this.carregarConfiguracoes()},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await M.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usu√°rio:",a)}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configura√ß√µes:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},closeDropdown(){this.showDropdown=!1},abrirConfiguracoes(){this.closeDropdown(),this.mostrarConfigEmail()},abrirConfiguracoesEmail(){this.closeDropdown(),this.mostrarConfigEmail()},async mostrarConfigEmail(){const{value:a}=await this.$swal({title:"üìß Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das dilig√™ncias</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comiss√£o de Padroniza√ß√£o de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"üíæ Salvar",cancelButtonText:"‚ùå Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"‚úÖ Sucesso!",text:"Configura√ß√µes de email salvas com sucesso!",icon:"success"})}},async logout(){try{await M.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()}}},Da=ba;var wa=(0,C.A)(Da,da,ua,!1,null,"7cb6a01b",null);const Ea=wa.exports;var Aa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"analise-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Cat√°logo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classifica√ß√£o")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("‚ñº")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("üë§")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("‚öôÔ∏è")]),t("span",[a._v("Configura√ß√µes")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("üìß")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("üö™")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("AnaliseProduto",{attrs:{id:a.produtoId}})],1)])},ya=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras P√∫blicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("üë§")])])}],xa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"analise-container"},[a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando...")])]):a.produto?t("div",{staticClass:"produto-analise"},[t("h2",[a._v("An√°lise de Produto")]),t("div",{staticClass:"produto-info"},[t("div",{staticClass:"produto-header"},[t("h3",[a._v(a._s(a.produto.nome))]),t("div",{staticClass:"produto-actions"},["pendente"===a.produto.status?t("button",{staticClass:"btn-diligencia",on:{click:function(t){return a.solicitarDiligencia(a.produto.id)}}},[a._v(" üîç Solicitar Dilig√™ncia ")]):a._e(),"diligencia"===a.produto.status?t("button",{staticClass:"btn-ver-diligencias",on:{click:function(t){return a.visualizarDiligencias(a.produto.id)}}},[a._v(" üìã Ver Dilig√™ncias ")]):a._e()])]),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item"},[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produto.marca)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produto.modelo)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produto.fabricante)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produto.cnpj)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Origem:")]),a._v(" "+a._s(a.produto.origem||"N√£o informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Registro na Anvisa/MS:")]),a._v(" "+a._s(a.produto.registro_anvisa||"N√£o informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CBPF:")]),a._v(" "+a._s(a.produto.cbpf||"N√£o informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("C√≥digo do Material:")]),a._v(" "+a._s(a.produto.codigo_material||"N√£o informado")+" ")]),t("div",{staticClass:"info-item full-width"},[t("strong",[a._v("Descri√ß√£o:")]),a._v(" "+a._s(a.produto.descricao||"N√£o informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Status Atual:")]),t("span",{staticClass:"status-pill",class:a.getStatusClass(a.produto.status)},[a._v(" "+a._s(a.produto.status)+" ")])]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Data de Cadastro:")]),a._v(" "+a._s(a.formatDate(a.produto.criado_em))+" ")])])]),a.documentos.length>0?t("div",{staticClass:"documentos-section"},[t("h3",[a._v("Documentos")]),t("div",{staticClass:"documentos-list"},a._l(a.documentos,(function(e){return t("div",{key:e.id,staticClass:"documento-item"},[t("div",{staticClass:"doc-icon"},[a._v("üìÑ")]),t("div",{staticClass:"doc-info"},[t("p",{staticClass:"doc-name"},[a._v(a._s(e.nome))]),t("p",{staticClass:"doc-type"},[a._v(a._s(e.tipo))])]),t("a",{staticClass:"doc-action",attrs:{href:e.arquivo_url,target:"_blank"}},[a._v("Visualizar")])])})),0)]):a._e(),t("div",{staticClass:"analise-form"},[t("h3",[a._v("Parecer T√©cnico")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarAnalise.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"parecer"}},[a._v("Observa√ß√µes / Parecer")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.analise.parecer,expression:"analise.parecer"}],attrs:{id:"parecer",rows:"4",required:""},domProps:{value:a.analise.parecer},on:{input:function(t){t.target.composing||a.$set(a.analise,"parecer",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Decis√£o")]),t("div",{staticClass:"radio-group"},[t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.analise.status,expression:"analise.status"}],attrs:{type:"radio",value:"aprovado",required:""},domProps:{checked:a._q(a.analise.status,"aprovado")},on:{change:function(t){return a.$set(a.analise,"status","aprovado")}}}),a._v(" Aprovar ")]),t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.analise.status,expression:"analise.status"}],attrs:{type:"radio",value:"reprovado",required:""},domProps:{checked:a._q(a.analise.status,"reprovado")},on:{change:function(t){return a.$set(a.analise,"status","reprovado")}}}),a._v(" Reprovar ")])])]),"reprovado"===a.analise.status?t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"motivacao"}},[a._v("Motiva√ß√£o da Reprova√ß√£o")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.analise.motivacao,expression:"analise.motivacao"}],attrs:{id:"motivacao",rows:"6",placeholder:"Descreva detalhadamente os motivos que levaram √† reprova√ß√£o deste produto",required:""},domProps:{value:a.analise.motivacao},on:{input:function(t){t.target.composing||a.$set(a.analise,"motivacao",t.target.value)}}}),t("small",{staticClass:"helper-text"},[a._v("Este campo ser√° exibido ao fornecedor para justificar a reprova√ß√£o do produto")])]):a._e(),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.submitting}},[a._v(" "+a._s(a.submitting?"Salvando...":"Salvar An√°lise")+" ")]),t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.voltar}},[a._v(" Voltar ")])])])]),a.analisesAnteriores.length>0?t("div",{staticClass:"analises-anteriores"},[t("h3",[a._v("An√°lises Anteriores")]),a._l(a.analisesAnteriores,(function(e){return t("div",{key:e.id,staticClass:"analise-historico"},[t("div",{staticClass:"analise-header"},[t("span",{staticClass:"status-pill",class:a.getStatusClass(e.status)},[a._v(a._s(e.status))]),t("span",{staticClass:"analise-data"},[a._v(a._s(a.formatDate(e.criado_em)))])]),t("div",{staticClass:"analise-conteudo"},[t("p",[a._v(a._s(e.parecer))]),"reprovado"===e.status&&e.motivacao?t("div",{staticClass:"motivacao-reprovacao"},[t("h4",[a._v("Motiva√ß√£o da Reprova√ß√£o:")]),t("p",[a._v(a._s(e.motivacao))])]):a._e()])])}))],2):a._e()]):t("div",{staticClass:"not-found"},[t("p",[a._v("Produto n√£o encontrado ou voc√™ n√£o tem permiss√£o para visualiz√°-lo.")]),t("button",{staticClass:"btn-secondary",on:{click:a.voltar}},[a._v("Voltar")])])])},Pa=[],Sa=e(3405);const Na={name:"AnaliseProduto",props:{id:{type:String,required:!0}},data(){return{produto:null,documentos:[],analisesAnteriores:[],analise:{parecer:"",status:"",motivacao:""},loading:!0,submitting:!1}},created(){this.carregarDados()},methods:{async carregarDados(){try{this.loading=!0;const{data:a,error:t}=await M.ND.from("produtos").select("*").eq("id",this.id).single();if(t)throw t;this.produto=a;const{data:e,error:o}=await M.ND.from("documentos").select("*").eq("produto_id",this.id);if(o)throw o;this.documentos=e||[];const{data:i,error:s}=await M.ND.from("analises").select("*").eq("produto_id",this.id).order("criado_em",{ascending:!1});if(s)throw s;this.analisesAnteriores=i||[]}catch(a){console.error("Erro ao carregar dados:",a),alert("Erro ao carregar dados do produto. Por favor, tente novamente.")}finally{this.loading=!1}},async salvarAnalise(){try{if(this.submitting=!0,"reprovado"===this.analise.status&&!this.analise.motivacao)return this.$swal({icon:"error",title:"Campo obrigat√≥rio",text:"√â necess√°rio preencher a motiva√ß√£o da reprova√ß√£o"}),void(this.submitting=!1);const{data:a}=await M.ND.auth.getSession(),t=a?.session?.user;let e;if(t){console.log("Usu√°rio autenticado:",t.email);const{data:a,error:o}=await M.ND.from("usuarios").select("id").eq("email",t.email).maybeSingle();if(o&&console.error("Erro ao buscar ID do usu√°rio:",o),a?.id)console.log("ID do usu√°rio encontrado na tabela usuarios:",a.id),e=a.id;else{console.warn("Usu√°rio n√£o encontrado na tabela, gerando UUID"),e=this.gerarUUID();const{error:a}=await M.ND.from("usuarios").insert({id:e,email:t.email,nome:t.email.split("@")[0],tenant_id:this.produto.tenant_id,tipo:"avaliador",ativo:!0});a&&console.error("Erro ao criar usu√°rio automaticamente:",a)}}else console.warn("Nenhum usu√°rio autenticado, gerando UUID"),e=this.gerarUUID();console.log("Salvando an√°lise com avaliador_id:",e);const o={produto_id:this.id,tenant_id:this.produto.tenant_id,avaliador_id:e,parecer:this.analise.parecer,status:this.analise.status};"reprovado"===this.analise.status&&(o.motivacao=this.analise.motivacao);const{error:i}=await M.ND.from("analises").insert(o);if(i)throw console.error("Erro detalhado ao salvar an√°lise:",i),new Error(`Erro ao salvar an√°lise: ${i.message}`);const{error:s}=await M.ND.from("produtos").update({status:this.analise.status}).eq("id",this.id);if(s)throw s;this.$swal({icon:"success",title:"An√°lise salva com sucesso!",showConfirmButton:!1,timer:1500}),await this.carregarDados(),this.analise={parecer:"",status:"",motivacao:""}}catch(a){console.error("Erro ao salvar an√°lise:",a);let t="Erro ao salvar an√°lise.";a.message&&a.message.includes("uuid")?t="Erro no formato de identifica√ß√£o. Este problema foi corrigido, tente novamente.":a.message&&(t=a.message),this.$swal({icon:"error",title:"Erro ao processar an√°lise",text:t})}finally{this.submitting=!1}},formatDate(a){if(!a)return"";const t=new Date(a);return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},voltar(){this.$router.push("/dashboard")},gerarUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){const t=16*Math.random()|0,e="x"==a?t:3&t|8;return e.toString(16)}))},async solicitarDiligencia(a){try{const{value:t}=await this.$swal({title:"üîç Solicitar Dilig√™ncia",html:'\n            <div style="text-align: left; padding: 10px;">\n              <div style="margin-bottom: 20px;">\n                <label for="tipo_diligencia" style="display: block; font-weight: bold; margin-bottom: 8px; color: #2c3e50;">\n                  üìã Tipo de Dilig√™ncia:\n                </label>\n                <select id="tipo_diligencia" class="swal2-input" style="width: 100%; font-size: 14px;">\n                  <option value="">Selecione o tipo</option>\n                  <option value="DOCUMENTACAO_FALTANTE">üìÑ Documenta√ß√£o Faltante</option>\n                  <option value="AMOSTRA_INADEQUADA">üî¨ Amostra Inadequada</option>\n                  <option value="ESPECIFICACAO_INCOMPLETA">üìù Especifica√ß√£o Incompleta</option>\n                  <option value="CERTIFICACAO_PENDENTE">‚úÖ Certifica√ß√£o Pendente</option>\n                  <option value="ESCLARECIMENTO_TECNICO">üîß Esclarecimento T√©cnico</option>\n                  <option value="OUTRO">‚úèÔ∏è Outro (especificar)</option>\n                </select>\n                <div id="tipo_outro_container" style="display: none; margin-top: 10px;">\n                  <input \n                    type="text" \n                    id="tipo_outro_texto" \n                    class="swal2-input" \n                    placeholder="Digite o tipo de dilig√™ncia..."\n                    style="width: 100%; font-size: 14px;"\n                  >\n                </div>\n              </div>\n              \n              <div style="margin-bottom: 20px;">\n                <label for="descricao_diligencia" style="display: block; font-weight: bold; margin-bottom: 8px; color: #2c3e50;">\n                  ‚úçÔ∏è Descri√ß√£o Detalhada:\n                </label>\n                <textarea \n                  id="descricao_diligencia" \n                  class="swal2-textarea" \n                  placeholder="Descreva detalhadamente o que precisa ser providenciado pelo fornecedor..."\n                  style="width: 100%; min-height: 120px; font-size: 14px; line-height: 1.5;"\n                ></textarea>\n              </div>\n              \n              <div style="margin-bottom: 20px; padding: 15px; background: #e8f4fd; border-left: 4px solid #3498db; border-radius: 4px;">\n                <div style="display: flex; align-items: center; margin-bottom: 8px;">\n                  <span style="font-size: 18px; margin-right: 8px;">‚è∞</span>\n                  <strong style="color: #2c3e50;">Prazo para Resposta:</strong>\n                </div>\n                <p style="margin: 0; color: #34495e; font-size: 14px;">\n                  <strong>30 dias √∫teis</strong> (padr√£o do sistema)\n                </p>\n                <small style="color: #6c757d; font-size: 12px; margin-top: 5px; display: block;">\n                  üìÖ A data limite ser√° calculada automaticamente excluindo fins de semana\n                </small>\n              </div>\n            </div>\n          ',width:"600px",focusConfirm:!1,showCancelButton:!0,confirmButtonText:"üì§ Enviar Dilig√™ncia",cancelButtonText:"‚ùå Cancelar",confirmButtonColor:"#f39c12",cancelButtonColor:"#6c757d",didOpen:()=>{const a=document.getElementById("tipo_diligencia"),t=document.getElementById("tipo_outro_container");a.addEventListener("change",(function(){"OUTRO"===this.value?(t.style.display="block",setTimeout((()=>{document.getElementById("tipo_outro_texto").focus()}),100)):t.style.display="none"}))},preConfirm:()=>{const a=document.getElementById("tipo_diligencia").value,t=document.getElementById("tipo_outro_texto").value,e=document.getElementById("descricao_diligencia").value,o=30;let i=a;if("OUTRO"===a){if(!t||t.trim().length<3)return this.$swal.showValidationMessage("‚ö†Ô∏è Por favor, especifique o tipo de dilig√™ncia (m√≠nimo 3 caracteres)"),!1;i=t.trim()}return a?!e||e.trim().length<20?(this.$swal.showValidationMessage("‚ö†Ô∏è A descri√ß√£o deve ter pelo menos 20 caracteres"),!1):{tipo:i,descricao:e,prazo:o}:(this.$swal.showValidationMessage("‚ö†Ô∏è Por favor, selecione o tipo de dilig√™ncia"),!1)}});t&&await this.salvarDiligencia(a,t)}catch(t){console.error("Erro ao solicitar dilig√™ncia:",t)}},async salvarDiligencia(a,t){try{if(!this.produto.email_fornecedor)return void this.$swal({title:"‚ö†Ô∏è Email do Fornecedor Necess√°rio",text:"Para enviar a dilig√™ncia, √© necess√°rio que o produto tenha o email do fornecedor cadastrado. Deseja continuar sem enviar email?",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar sem Email",cancelButtonText:"Cancelar",confirmButtonColor:"#f39c12"}).then((async e=>{e.isConfirmed&&await this.processarDiligencia(a,t,!1)}));await this.processarDiligencia(a,t,!0)}catch(e){console.error("Erro ao salvar dilig√™ncia:",e),this.$swal({title:"‚ùå Erro",text:"Erro ao solicitar dilig√™ncia",icon:"error"})}},async processarDiligencia(a,t,e=!0){try{const i=this.calcularDataUtil(new Date,t.prazo),{data:s,error:r}=await M.ND.from("diligencias").insert({produto_id:a,tenant_id:this.produto.tenant_id,tipo:t.tipo,descricao:t.descricao,prazo_dias:t.prazo,data_limite:i.toISOString(),status:"PENDENTE",solicitado_por:"CPM"}).select().single();if(r)throw r;const{error:n}=await M.ND.from("produtos").update({status:"diligencia"}).eq("id",a);if(n)throw n;let l=!1;if(e&&this.produto.email_fornecedor)try{const a=await(0,Sa.lY)({destinatario:this.produto.email_fornecedor,produto:this.produto,diligencia:{...s,data_limite:i}});l=a.success,a.success||console.error("Erro no envio do email:",a.message)}catch(o){console.error("Erro ao enviar email:",o)}const c=e&&l?" O fornecedor foi notificado por email.":e&&!l?" ‚ö†Ô∏è A dilig√™ncia foi salva, mas houve erro no envio do email.":" (Sem notifica√ß√£o por email)";this.$swal({title:"‚úÖ Sucesso!",text:`Dilig√™ncia solicitada com sucesso.${c}`,icon:l||!e?"success":"warning",confirmButtonColor:"#28a745"}),await this.carregarDados()}catch(i){console.error("Erro ao processar dilig√™ncia:",i),this.$swal({title:"‚ùå Erro",text:"Erro ao processar dilig√™ncia",icon:"error"})}},async visualizarDiligencias(a){try{const{data:t,error:e}=await M.ND.from("diligencias").select("*").eq("produto_id",a).order("criado_em",{ascending:!1});if(e)throw e;let o='<div style="text-align: left; padding: 10px;">';t&&t.length>0?(o+='<h4 style="color: #2c3e50; margin-bottom: 20px;">üìã Hist√≥rico de Dilig√™ncias:</h4>',t.forEach(((a,t)=>{const e="PENDENTE"===a.status?"#f39c12":"ATENDIDA"===a.status?"#28a745":"#dc3545",i="PENDENTE"===a.status?"‚è≥":"ATENDIDA"===a.status?"‚úÖ":"‚ùå";o+=`\n              <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin: 15px 0; background: ${"PENDENTE"===a.status?"#fff3cd":"ATENDIDA"===a.status?"#d4edda":"#f8d7da"};">\n                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">\n                  <strong style="color: #2c3e50;">Dilig√™ncia #${t+1}</strong>\n                  <span style="color: ${e}; font-weight: bold;">\n                    ${i} ${a.status}\n                  </span>\n                </div>\n                \n                <div style="margin-bottom: 8px;">\n                  <strong style="color: #495057;">Tipo:</strong> \n                  <span style="color: #6c757d;">${a.tipo.replace(/_/g," ")}</span>\n                </div>\n                \n                <div style="margin-bottom: 8px;">\n                  <strong style="color: #495057;">Descri√ß√£o:</strong>\n                  <div style="background: white; padding: 10px; border-radius: 4px; margin-top: 5px; border-left: 4px solid ${e};">\n                    ${a.descricao}\n                  </div>\n                </div>\n                \n                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; font-size: 12px; color: #6c757d;">\n                  <div>üìÖ <strong>Prazo:</strong> ${this.formatDate(a.data_limite)}</div>\n                  <div>üïê <strong>Solicitado:</strong> ${this.formatDate(a.criado_em)}</div>\n                </div>\n              </div>\n            `}))):o+='\n            <div style="text-align: center; padding: 40px; color: #6c757d;">\n              <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>\n              <p>Nenhuma dilig√™ncia encontrada para este produto.</p>\n            </div>\n          ',o+="</div>",this.$swal({title:"üìã Dilig√™ncias do Produto",html:o,width:"700px",confirmButtonColor:"#007bff"})}catch(t){console.error("Erro ao carregar dilig√™ncias:",t),this.$swal({title:"‚ùå Erro",text:"Erro ao carregar dilig√™ncias do produto",icon:"error"})}},calcularDataUtil(a,t){const e=new Date(a);let o=0;while(o<t)e.setDate(e.getDate()+1),0!==e.getDay()&&6!==e.getDay()&&o++;return e}}},Ra=Na;var Ma=(0,C.A)(Ra,xa,Pa,!1,null,"1eb6b586",null);const $a=Ma.exports,Ia={name:"Analise",components:{AnaliseProduto:$a},data(){return{showDropdown:!1,usuarioNome:"Usu√°rio",usuarioEmail:""}},computed:{produtoId(){return this.$route.params.id}},async created(){await this.carregarDadosUsuario()},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await M.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usu√°rio:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},closeDropdown(){this.showDropdown=!1},abrirConfiguracoes(){this.closeDropdown(),this.$swal({title:"‚öôÔ∏è Configura√ß√µes",text:"Configure o email no Dashboard principal para salvar as configura√ß√µes globais.",icon:"info"})},abrirConfiguracoesEmail(){this.closeDropdown(),this.$swal({title:"üìß Configurar Email",text:"Acesse o Dashboard principal para configurar o email do sistema.",icon:"info"})},async logout(){try{await M.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()}}},Ta=Ia;var Oa=(0,C.A)(Ta,Aa,ya,!1,null,"5d87272e",null);const ka=Oa.exports;var Fa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"catalogo-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Cat√°logo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classifica√ß√£o")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.dropdownOpen},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("‚ñº")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("üë§")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.nomeUsuario))]),t("small",[a._v(a._s(a.emailUsuario))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("‚öôÔ∏è")]),t("span",[a._v("Configura√ß√µes")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("üìß")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("üö™")]),t("span",[a._v("Sair")])])]):a._e()]),a.dropdownOpen?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("CatalogoEletronico")],1),a.modalEmailAberto?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalEmail}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[a._m(2),t("button",{staticClass:"btn-close",on:{click:a.fecharModalEmail}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeOrganizacao"}},[a._v("Nome da Organiza√ß√£o")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeOrganizacao,expression:"configEmail.nomeOrganizacao"}],attrs:{id:"nomeOrganizacao",type:"text",placeholder:"Ex: Prefeitura Municipal de..."},domProps:{value:a.configEmail.nomeOrganizacao},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeOrganizacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"emailRemetente"}},[a._v("Email Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.emailRemetente,expression:"configEmail.emailRemetente"}],attrs:{id:"emailRemetente",type:"email",placeholder:"Ex: licitacoes@prefeitura.gov.br"},domProps:{value:a.configEmail.emailRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"emailRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeRemetente"}},[a._v("Nome do Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeRemetente,expression:"configEmail.nomeRemetente"}],attrs:{id:"nomeRemetente",type:"text",placeholder:"Ex: CPM - Comiss√£o de Padroniza√ß√£o de Materiais"},domProps:{value:a.configEmail.nomeRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"assinatura"}},[a._v("Assinatura do Email")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.assinatura,expression:"configEmail.assinatura"}],attrs:{id:"assinatura",rows:"4",placeholder:"Ex: Atenciosamente,&#10;Comiss√£o de Padroniza√ß√£o de Materiais&#10;Prefeitura Municipal&#10;Telefone: (xx) xxxx-xxxx"},domProps:{value:a.configEmail.assinatura},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"assinatura",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:a.fecharModalEmail}},[a._v("Cancelar")]),t("button",{staticClass:"btn btn-primary",on:{click:a.salvarConfiguracaoEmail}},[t("i",{staticClass:"fas fa-save"}),a._v(" Salvar ")])])])]):a._e()])},Ba=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras P√∫blicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("üë§")])])},function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-envelope"}),a._v(" Configurar Email da Organiza√ß√£o")])}],qa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"catalogo-container"},[t("h2",[a._v("Cat√°logo Eletr√¥nico de Bens Padronizados")]),t("div",{staticClass:"search-filters"},[t("div",{staticClass:"search-box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.searchTerm,expression:"searchTerm"}],attrs:{type:"text",placeholder:"Buscar produto..."},domProps:{value:a.searchTerm},on:{input:[function(t){t.target.composing||(a.searchTerm=t.target.value)},a.filtrarProdutos]}})]),t("div",{staticClass:"filters"},[t("div",{staticClass:"categoria-filter"},[a._m(0),t("div",{staticClass:"dropdown"},[t("button",{staticClass:"dropdown-toggle",attrs:{type:"button"},on:{click:a.toggleCategoriaDropdown}},[a._v(" "+a._s(a.categoriaAtual)+" ")]),t("div",{staticClass:"dropdown-menu",class:{show:a.showCategoriaDropdown}},[a.carregandoCategorias?t("div",{staticClass:"dropdown-item loading"},[t("div",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status"}}),t("span",[a._v("Carregando...")])]):[t("a",{staticClass:"dropdown-item",on:{click:function(t){return a.selecionarCategoria(null)}}},[a._v("Todos os grupos")]),0===a.categorias.length?t("div",{staticClass:"dropdown-item empty"},[a._v(" Nenhum grupo dispon√≠vel ")]):a._l(a.categorias,(function(e){return t("a",{key:e.id,staticClass:"dropdown-item",class:{active:e.id===a.filtroCategoria},on:{click:function(t){return a.selecionarCategoria(e)}}},[a._v(" "+a._s(e.nome)+" ")])}))]],2)])])])]),a.produtosFiltrados.length>0?t("div",{staticClass:"produtos-grid"},a._l(a.produtosFiltrados,(function(e){return t("div",{key:e.id,staticClass:"produto-card",on:{click:function(t){return a.verDetalhesProduto(e.id)}}},[t("div",{staticClass:"produto-info"},[t("h3",[a._v(a._s(e.nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(e.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(e.modelo))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(e.fabricante))])])])})),0):t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhum produto encontrado.")])]),a.produtoSelecionado?t("div",{staticClass:"produto-modal",on:{click:function(t){return t.target!==t.currentTarget?null:a.fecharModal.apply(null,arguments)}}},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.produtoSelecionado.nome))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModal}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"produto-detalhes"},[t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoSelecionado.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoSelecionado.modelo))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoSelecionado.fabricante))]),t("p",[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produtoSelecionado.cnpj))]),t("p",[t("strong",[a._v("C√≥digo Material:")]),a._v(" "+a._s(a.produtoSelecionado.codigo_material))]),a.produtoSelecionado.descricao?t("p",[t("strong",[a._v("Descri√ß√£o:")]),a._v(" "+a._s(a.produtoSelecionado.descricao))]):a._e(),t("div",{staticClass:"avaliacoes-section"},[t("div",{staticClass:"avaliacoes-header",class:{active:a.showAvaliacoes},on:{click:a.toggleAvaliacoes}},[t("h4",[a._v("Avalia√ß√µes de Desempenho (RDM)")]),t("div",{staticClass:"avaliacao-summary"},[a.avaliacaoMedia>0?t("div",{staticClass:"stars-container"},[t("div",{staticClass:"stars"},a._l(5,(function(e){return t("span",{key:e,staticClass:"star",class:{filled:a.avaliacaoMedia>=e,half:a.avaliacaoMedia>=e-.5&&a.avaliacaoMedia<e}},[a._v("‚òÖ")])})),0),t("span",{staticClass:"rating-number"},[a._v(a._s(a.avaliacaoMedia))]),t("span",{staticClass:"rating-count"},[a._v("("+a._s(a.avaliacoes.length)+" avalia√ß√µes)")])]):t("div",{staticClass:"no-ratings"},[a._v(" Sem avalia√ß√µes ainda ")]),t("span",{staticClass:"toggle-icon"},[a._v(a._s(a.showAvaliacoes?"‚ñ≤":"‚ñº"))])])]),a.showAvaliacoes?t("div",{staticClass:"avaliacoes-content"},[0===a.avaliacoes.length?t("div",{staticClass:"no-avaliacoes"},[a._v(" Este produto ainda n√£o possui avalia√ß√µes de desempenho. ")]):t("div",{staticClass:"avaliacoes-list"},a._l(a.avaliacoes,(function(e,o){return t("div",{key:o,staticClass:"avaliacao-item"},[t("div",{staticClass:"avaliacao-header"},[t("span",{staticClass:"avaliacao-tipo",class:e.tipo.toLowerCase()},[a._v(" "+a._s(e.tipo)+" ")]),t("div",{staticClass:"avaliacao-stars"},a._l(5,(function(o){return t("span",{key:o,staticClass:"star",class:{filled:e.avaliacao>=o}},[a._v("‚òÖ")])})),0)]),e.comentario?t("div",{staticClass:"avaliacao-comentario"},[a._v(" "+a._s(e.comentario)+" ")]):a._e(),t("div",{staticClass:"avaliacao-footer"},[t("span",{staticClass:"avaliador"},[a._v(a._s(e.avaliador))]),t("span",{staticClass:"avaliacao-data"},[a._v(a._s(a.formatarData(e.data)))])])])})),0)]):a._e()]),t("div",{staticClass:"reclamacoes-section mt-4"},[t("div",{staticClass:"section-header",on:{click:a.toggleReclamacoes}},[t("div",{staticClass:"d-flex justify-content-between align-items-center"},[t("h5",{staticClass:"mb-0"},[a._v("Reclama√ß√µes e Sugest√µes")]),t("div",{staticClass:"d-flex align-items-center"},[a.reclamacoes.length>0?t("span",{staticClass:"badge badge-info me-2"},[a._v(a._s(a.reclamacoes.length)+" registros")]):a._e(),t("span",{staticClass:"toggle-icon"},[a._v(a._s(a.showReclamacoes?"‚ñ≤":"‚ñº"))])])])]),a.showReclamacoes?t("div",{staticClass:"reclamacoes-content"},[0===a.reclamacoes.length?t("div",{staticClass:"text-center text-muted py-3"},[a._v(" Nenhuma reclama√ß√£o registrada ")]):t("div",{staticClass:"reclamacoes-list"},a._l(a.reclamacoesSorted,(function(e){return t("div",{key:e.id,staticClass:"reclamacao-item"},[t("div",{staticClass:"reclamacao-header"},[t("div",{staticClass:"d-flex align-items-center"},[t("span",{staticClass:"badge",class:a.getStatusBadgeClass(e.status)},[a._v(a._s(e.status))]),t("span",{staticClass:"reclamante-nome"},[a._v(a._s(e.nome_reclamante))]),t("span",{staticClass:"reclamante-setor"},[a._v(a._s(e.unidade_setor))])]),t("span",{staticClass:"reclamacao-data"},[a._v(a._s(a.formatDate(e.data_reclamacao)))])]),t("div",{staticClass:"reclamacao-content"},[t("div",{staticClass:"problema-box"},[t("h6",{staticClass:"box-title"},[a._v("Problema Reportado:")]),t("p",{staticClass:"box-text"},[a._v(a._s(e.registro_reclamacao))])]),e.sugestoes?t("div",{staticClass:"sugestao-box"},[t("h6",{staticClass:"box-title"},[a._v("Sugest√µes de Melhoria:")]),t("p",{staticClass:"box-text"},[a._v(a._s(e.sugestoes))])]):a._e(),e.providencias_cpm?t("div",{staticClass:"providencias-box"},[t("h6",{staticClass:"box-title"},[a._v("Provid√™ncias Tomadas:")]),t("p",{staticClass:"box-text"},[a._v(a._s(e.providencias_cpm))])]):a._e()])])})),0)]):a._e()]),a.documentos.length>0?t("div",{staticClass:"documentos"},[t("h4",[a._v("Documentos")]),t("ul",a._l(a.documentos,(function(e){return t("li",{key:e.id},[t("a",{attrs:{href:e.arquivo_url,target:"_blank"}},[a._v(a._s(e.nome))])])})),0)]):a._e()])])])]):a._e()])},za=[function(){var a=this,t=a._self._c;return t("label",[t("strong",[a._v("Grupo:")])])}];const La={name:"CatalogoEletronico",data(){return{produtos:[],produtosFiltrados:[],categorias:[],searchTerm:"",filtroCategoria:"",categoriaAtual:"Todos os grupos",showCategoriaDropdown:!1,showAvaliacoes:!1,showReclamacoes:!1,produtoSelecionado:null,documentos:[],avaliacoes:[],avaliacaoMedia:0,carregandoCategorias:!0,categoriaSelecionada:null,currentTenantId:null,loading:!1,reclamacoes:(0,o.KR)([])}},created(){this.obterTenantId().then((()=>{this.carregarDados()})),document.addEventListener("click",this.closeDropdownOnClickOutside)},mounted(){this.carregarCategoriasDireto(),this.showCategoriaDropdown=!1},beforeUnmount(){document.removeEventListener("click",this.closeDropdownOnClickOutside)},methods:{async obterTenantId(){try{const{data:a}=await M.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usu√°rio n√£o est√° autenticado");if(t.user_metadata?.tenant_id)return this.currentTenantId=t.user_metadata.tenant_id,void console.log("Tenant ID obtido dos metadados:",this.currentTenantId);const{data:e,error:o}=await M.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id?(this.currentTenantId=e.tenant_id,console.log("Tenant ID obtido da tabela usuarios:",this.currentTenantId)):console.error("Tenant ID n√£o encontrado para o usu√°rio")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarDados(){console.log("Iniciando carregamento de dados"),this.carregandoCategorias=!0,this.loading=!0;try{if(!this.currentTenantId&&(console.error("Tenant ID n√£o dispon√≠vel. Tentando recarregar..."),await this.obterTenantId(),!this.currentTenantId))return console.error("N√£o foi poss√≠vel obter o tenant_id, imposs√≠vel carregar dados"),void this.$swal({icon:"error",title:"Erro ao carregar dados",text:"N√£o foi poss√≠vel identificar sua conta. Por favor, fa√ßa login novamente."});console.log("Buscando categorias do Supabase...");const{data:a,error:t}=await M.ND.from("categorias").select("*");t?console.error("Erro ao carregar categorias:",t):(this.categorias=a||[],console.log(`${this.categorias.length} categorias carregadas`)),console.log("Buscando produtos padronizados do Supabase...");let e=M.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).eq("status","aprovado");const{data:o,error:i}=await e;i?(console.error("Erro ao carregar produtos:",i),this.produtos=[]):(this.produtos=o||[],console.log(`${this.produtos.length} produtos padronizados carregados`)),this.filtrarProdutos()}catch(a){console.error("Erro no carregamento de dados:",a),this.$swal({icon:"error",title:"Erro ao carregar dados",text:"Ocorreu um erro ao carregar os dados. Tente novamente."})}finally{this.carregandoCategorias=!1,this.loading=!1}},async carregarCategoriasDireto(){try{console.log("Tentando carregar categorias diretamente...");const{data:a,error:t}=await M.ND.from("categorias").select("*");if(t)return void console.error("Erro ao carregar categorias direto:",t);console.log("Resposta direta de categorias:",a),a&&a.length>0&&0===this.categorias.length&&(console.log("Atualizando categorias com dados diretos"),this.categorias=a)}catch(a){console.error("Exce√ß√£o ao carregar categorias direto:",a)}},filtrarProdutos(){console.log("Filtrando produtos por:",this.filtroCategoria,"e texto:",this.searchTerm),this.produtosFiltrados=this.produtos.filter((a=>{const t=!this.filtroCategoria||a.categoria_id===this.filtroCategoria,e=!this.searchTerm||a.nome.toLowerCase().includes(this.searchTerm.toLowerCase())||a.descricao&&a.descricao.toLowerCase().includes(this.searchTerm.toLowerCase());return t&&e})),console.log("Produtos filtrados:",this.produtosFiltrados.length)},async verDetalhesProduto(a){try{if(!this.currentTenantId)return void console.error("N√£o foi poss√≠vel identificar o tenant_id");const{data:t,error:e}=await M.ND.from("produtos").select("*").eq("id",a).eq("tenant_id",this.currentTenantId).single();if(e)throw console.error("Erro ao carregar produto:",e),e;if(!t)return console.error("Produto n√£o encontrado ou n√£o pertence ao tenant atual"),void this.$swal({icon:"error",title:"Produto n√£o encontrado",text:"O produto solicitado n√£o existe ou voc√™ n√£o tem permiss√£o para visualiz√°-lo."});this.produtoSelecionado=t;const{data:o,error:i}=await M.ND.from("documentos").select("*").eq("produto_id",a).eq("tenant_id",this.currentTenantId);if(i)throw i;this.documentos=o||[];const[s,r,n]=await Promise.all([M.ND.from("rdm_avaliacoes").select("*").eq("produto_id",a),M.ND.from("material_feedbacks").select("*").eq("produto_id",a),M.ND.from("rdm_feedbacks").select("*").eq("rdm_id",a)]);s.error&&console.error("Erro ao carregar avalia√ß√µes RDM:",s.error),r.error&&console.error("Erro ao carregar feedbacks:",r.error),n.error&&console.error("Erro ao carregar feedbacks RDM:",n.error);const l=s.data||[],c=r.data||[],d=n.data||[];if(this.avaliacoes=[...l.map((a=>({id:a.id,avaliacao:a.rating||0,comentario:a.comentario,data:a.criado_em,tipo:"RDM",avaliador:"Avalia√ß√£o T√©cnica"}))),...c.map((a=>({id:a.id,avaliacao:a.rating||0,comentario:a.comentario,data:a.criado_em,tipo:"Feedback",avaliador:"Feedback de Usu√°rio"}))),...d.map((a=>({id:a.id,avaliacao:a.rating||0,comentario:a.comentario,data:a.criado_em,tipo:"RDM",avaliador:"Avalia√ß√£o do √ìrg√£o"})))],this.avaliacoes.sort(((a,t)=>new Date(t.data)-new Date(a.data))),this.avaliacoes.length>0){const a=this.avaliacoes.reduce(((a,t)=>a+t.avaliacao),0);this.avaliacaoMedia=parseFloat((a/this.avaliacoes.length).toFixed(1))}else this.avaliacaoMedia=0;await this.carregarReclamacoes()}catch(t){console.error("Erro ao carregar detalhes do produto:",t),this.$swal({icon:"error",title:"Erro ao carregar detalhes",text:"N√£o foi poss√≠vel carregar os detalhes do produto. Tente novamente."})}},fecharModal(){this.produtoSelecionado=null,this.documentos=[],this.avaliacoes=[],this.avaliacaoMedia=0,this.showAvaliacoes=!1},closeDropdownOnClickOutside(a){const t=this.$el.querySelector(".dropdown");t&&!t.contains(a.target)&&(this.showCategoriaDropdown=!1)},selecionarCategoria(a){console.log("Categoria selecionada:",a),this.categoriaSelecionada=a,this.categoriaAtual=a?a.nome:"Todos os grupos",this.filtroCategoria=a?a.id:"",this.showCategoriaDropdown=!1,this.filtrarProdutos()},toggleCategoriaDropdown(){this.showCategoriaDropdown=!this.showCategoriaDropdown},toggleAvaliacoes(){this.showAvaliacoes=!this.showAvaliacoes},toggleReclamacoes(){this.showReclamacoes=!this.showReclamacoes},formatarData(a){if(!a)return"Data n√£o dispon√≠vel";try{const t=new Date(a);return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Erro ao formatar data:",t),"Data inv√°lida"}},async carregarReclamacoes(){try{if(!this.produtoSelecionado?.codigo_material)return void console.log("C√≥digo do material n√£o encontrado no produto");console.log("Buscando reclama√ß√µes para o c√≥digo de material:",this.produtoSelecionado.codigo_material);const{data:a,error:t}=await M.ND.from("reclamacoes_usuarios").select("*").eq("codigo_material",this.produtoSelecionado.codigo_material).order("data_reclamacao",{ascending:!1});if(t)throw console.error("Erro ao carregar reclama√ß√µes:",t),t;console.log(`Reclama√ß√µes encontradas: ${a?.length||0}`,a),this.reclamacoes=a||[]}catch(a){console.error("Erro ao carregar reclama√ß√µes:",a),this.reclamacoes=[]}},formatDate(a){return a?new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""},getStatusBadgeClass(a){const t={ABERTA:"badge-warning",EM_ANALISE:"badge-info",RESOLVIDA:"badge-success",REJEITADA:"badge-danger"};return t[a]||"badge-secondary"},getTipoAvaliacao(a){return"RDM"===a.tipo?"RDM":"FEEDBACK"===a.tipo?"Feedback":"Avalia√ß√£o"},getDocumentName(a){if(!a)return"";const t=a.split("/");return t[t.length-1]}},computed:{avaliacoesSorted(){return[...this.avaliacoes].sort(((a,t)=>{const e=new Date(a.data),o=new Date(t.data);return o-e}))},reclamacoesSorted(){return[...this.reclamacoes].sort(((a,t)=>new Date(t.data_reclamacao)-new Date(a.data_reclamacao)))},averageRating(){if(!this.avaliacoes.length)return 0;const a=this.avaliacoes.reduce(((a,t)=>a+(t.avaliacao||0)),0);return(a/this.avaliacoes.length).toFixed(1)}}},Ua=La;var Va=(0,C.A)(Ua,qa,za,!1,null,"771300dd",null);const ja=Va.exports,Ja={name:"Catalogo",components:{CatalogoEletronico:ja},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comiss√£o de Padroniza√ß√£o de Materiais"}},mounted(){this.carregarConfiguracoes(),document.addEventListener("click",this.fecharDropdownFora)},beforeUnmount(){document.removeEventListener("click",this.fecharDropdownFora)},methods:{async logout(){try{await M.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},fecharDropdownFora(a){this.$el.querySelector(".profile-dropdown").contains(a.target)||(this.dropdownOpen=!1)},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"üìß Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das dilig√™ncias</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comiss√£o de Padroniza√ß√£o de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"üíæ Salvar",cancelButtonText:"‚ùå Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"‚úÖ Sucesso!",text:"Configura√ß√µes de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configura√ß√µes:",a)}},closeDropdown(){this.dropdownOpen=!1}}},Ga=Ja;var Ha=(0,C.A)(Ga,Fa,Ba,!1,null,"5f8dc8aa",null);const Ya=Ha.exports;var Ka=function(){var a=this,t=a._self._c;return t("div",{staticClass:"feedback-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Cat√°logo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classifica√ß√£o")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-btn",on:{click:a.toggleDropdown}},[t("div",{staticClass:"profile-avatar"},[a._v(" üë§ ")]),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("‚ñº")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" ‚öôÔ∏è Configura√ß√£o ")]),t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" üìß Configurar Email ")]),t("hr",{staticClass:"dropdown-divider"}),t("a",{staticClass:"dropdown-item logout",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.logout.apply(null,arguments)}}},[a._v(" üö™ Sair ")])]):a._e()])])]),t("main",{staticClass:"main-content"},[t("FormularioRDM")],1),a.modalEmailAberto?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalEmail}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[a._m(1),t("button",{staticClass:"btn-close",on:{click:a.fecharModalEmail}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeOrganizacao"}},[a._v("Nome da Organiza√ß√£o")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeOrganizacao,expression:"configEmail.nomeOrganizacao"}],attrs:{id:"nomeOrganizacao",type:"text",placeholder:"Ex: Prefeitura Municipal de..."},domProps:{value:a.configEmail.nomeOrganizacao},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeOrganizacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"emailRemetente"}},[a._v("Email Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.emailRemetente,expression:"configEmail.emailRemetente"}],attrs:{id:"emailRemetente",type:"email",placeholder:"Ex: licitacoes@prefeitura.gov.br"},domProps:{value:a.configEmail.emailRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"emailRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeRemetente"}},[a._v("Nome do Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeRemetente,expression:"configEmail.nomeRemetente"}],attrs:{id:"nomeRemetente",type:"text",placeholder:"Ex: CPM - Comiss√£o de Padroniza√ß√£o de Materiais"},domProps:{value:a.configEmail.nomeRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"assinatura"}},[a._v("Assinatura do Email")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.assinatura,expression:"configEmail.assinatura"}],attrs:{id:"assinatura",rows:"4",placeholder:"Ex: Atenciosamente,&#10;Comiss√£o de Padroniza√ß√£o de Materiais&#10;Prefeitura Municipal&#10;Telefone: (xx) xxxx-xxxx"},domProps:{value:a.configEmail.assinatura},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"assinatura",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:a.fecharModalEmail}},[a._v("Cancelar")]),t("button",{staticClass:"btn btn-primary",on:{click:a.salvarConfiguracaoEmail}},[t("i",{staticClass:"fas fa-save"}),a._v(" Salvar ")])])])]):a._e()])},Wa=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras P√∫blicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-envelope"}),a._v(" Configurar Email da Organiza√ß√£o")])}],Qa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"rdm-container"},[t("h2",[a._v("Relat√≥rio de Desempenho de Material (RDM)")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.enviarFeedback.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"produto"}},[a._v("Produto*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.feedback.rdm_id,expression:"feedback.rdm_id"}],attrs:{id:"produto",required:""},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.feedback,"rdm_id",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione o produto...")]),a._l(a.produtos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" - "+a._s(e.codigo||"Sem c√≥digo")+" ")])}))],2)]),t("div",{staticClass:"form-group"},[t("label",[a._v("Avalia√ß√£o*")]),t("div",{staticClass:"avaliacao"},a._l(5,(function(e){return t("div",{key:e,staticClass:"estrela",class:{ativa:a.feedback.rating>=e},on:{click:function(t){a.feedback.rating=e}}},[a._v(" ‚òÖ ")])})),0)]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"comentario"}},[a._v("Coment√°rio")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.feedback.comentario,expression:"feedback.comentario"}],attrs:{id:"comentario",rows:"4",placeholder:"Ex: Equipamento apresentou falha ap√≥s 3 meses de uso..."},domProps:{value:a.feedback.comentario},on:{input:function(t){t.target.composing||a.$set(a.feedback,"comentario",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.loading}},[a._v(" "+a._s(a.loading?"Salvando...":"Salvar")+" ")])])])])},Xa=[];const Za={name:"FormularioRDM",data(){return{feedback:{rdm_id:"",rating:0,comentario:"",material_nome:"",material_codigo:""},produtos:[],loading:!1,currentUser:null,currentTenantId:null,error:null}},created(){this.carregarProdutos(),this.obterUsuarioAtual()},methods:{async obterUsuarioAtual(){try{const{data:{session:a},error:t}=await M.ND.auth.getSession();if(t)throw t;if(!a?.user)throw new Error("Usu√°rio n√£o est√° autenticado");{this.currentUser=a.user;const{data:t,error:e}=await M.ND.from("usuarios").select("tenant_id").eq("email",a.user.email).single();if(e&&"PGRST116"!==e.code)throw e;this.currentTenantId=t?.tenant_id||a.user.user_metadata?.tenant_id||(0,$.A)()}}catch(a){console.error("Erro ao obter dados do usu√°rio:",a),this.$swal({icon:"error",title:"Erro de Autentica√ß√£o",text:"Por favor, fa√ßa login novamente para enviar um feedback."})}},async carregarProdutos(){try{if(this.currentTenantId||await this.obterUsuarioAtual(),!this.currentTenantId)throw new Error("N√£o foi poss√≠vel identificar o tenant_id");const{data:a,error:t}=await M.ND.from("produtos").select("*").eq("status","aprovado").eq("tenant_id",this.currentTenantId).order("nome");if(t)throw t;this.produtos=a||[]}catch(a){console.error("Erro ao carregar produtos:",a),this.$swal({icon:"error",title:"Erro ao carregar produtos",text:"N√£o foi poss√≠vel carregar a lista de produtos. Por favor, recarregue a p√°gina."})}},async enviarFeedback(){if(0!==this.feedback.rating)if(this.feedback.rdm_id)try{if(this.loading=!0,this.error=null,!this.currentUser?.email)throw new Error("Usu√°rio n√£o est√° autenticado");const{data:a,error:t}=await M.ND.from("usuarios").select("id, tenant_id").eq("email",this.currentUser.email).single();if(t&&"PGRST116"!==t.code)throw t;const e=this.produtos.find((a=>a.id===this.feedback.rdm_id));if(!e)throw new Error("Produto n√£o encontrado");const o={id:(0,$.A)(),tenant_id:this.currentTenantId,rdm_id:this.feedback.rdm_id,usuario_rdm_id:a.id,rating:this.feedback.rating,comentario:this.feedback.comentario||null,material_nome:e.nome,material_codigo:e.codigo||"N/A",criado_em:(new Date).toISOString()},{error:i}=await M.ND.from("rdm_feedbacks").insert(o);if(i)throw i;this.$swal({icon:"success",title:"Feedback enviado!",text:"Seu feedback foi enviado com sucesso."}),this.limparFormulario()}catch(a){console.error("Erro ao enviar feedback:",a);let t="Por favor, tente novamente.";"Usu√°rio n√£o est√° autenticado"===a.message?t="Por favor, fa√ßa login para enviar um feedback.":"23505"===a.code&&(t="Voc√™ j√° enviou um feedback para este produto."),this.$swal({icon:"error",title:"Erro ao enviar feedback",text:t}),this.error=a}finally{this.loading=!1}else this.$swal({icon:"warning",title:"Produto necess√°rio",text:"Por favor, selecione um produto para avaliar."});else this.$swal({icon:"warning",title:"Avalia√ß√£o necess√°ria",text:"Por favor, selecione uma avalia√ß√£o de 1 a 5 estrelas."})},limparFormulario(){this.feedback={rdm_id:"",rating:0,comentario:"",material_nome:"",material_codigo:""},this.error=null}}},at=Za;var tt=(0,C.A)(at,Qa,Xa,!1,null,"2811c5e7",null);const et=tt.exports,ot={name:"Feedback",components:{FormularioRDM:et},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comiss√£o de Padroniza√ß√£o de Materiais"}},mounted(){this.carregarConfiguracoes()},methods:{async logout(){try{await M.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"üìß Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das dilig√™ncias</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comiss√£o de Padroniza√ß√£o de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"üíæ Salvar",cancelButtonText:"‚ùå Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"‚úÖ Sucesso!",text:"Configura√ß√µes de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configura√ß√µes:",a)}}}},it=ot;var st=(0,C.A)(it,Ka,Wa,!1,null,"098da73d",null);const rt=st.exports;var nt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dcb-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Cat√°logo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classifica√ß√£o")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-btn",on:{click:a.toggleDropdown}},[t("div",{staticClass:"profile-avatar"},[a._v(" üë§ ")]),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("‚ñº")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" ‚öôÔ∏è Configura√ß√£o ")]),t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" üìß Configurar Email ")]),t("hr",{staticClass:"dropdown-divider"}),t("a",{staticClass:"dropdown-item logout",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.logout.apply(null,arguments)}}},[a._v(" üö™ Sair ")])]):a._e()])])]),t("main",{staticClass:"main-content"},[t("FormularioDCB")],1)])},lt=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras P√∫blicas Inteligentes")])])])}],ct=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dcb-container"},[t("h2",[a._v("Declara√ß√£o de Conformidade de Bem (DCB)")]),t("div",{staticClass:"search-container"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"produto"}},[a._v("Selecione o produto")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produtoSelecionado,expression:"produtoSelecionado"}],attrs:{id:"produto"},on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.produtoSelecionado=t.target.multiple?e:e[0]},a.carregarDetalhes]}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.produtos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" - "+a._s(e.marca)+" - "+a._s(e.modelo)+" ")])}))],2)])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando informa√ß√µes...")])]):a.produtoDetalhes?t("div",{staticClass:"produto-detalhes"},[t("div",{staticClass:"dcb-section"},[t("h3",[a._v("PRODUTO CERTIFICADO")]),t("div",{staticClass:"primeiro-quadro"},[a._m(0),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item full-width"},[t("strong",[a._v("1.1. Nome do Produto:")]),a._v(" "+a._s(a.produtoDetalhes.nome||"N√£o informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoDetalhes.marca||"N√£o informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoDetalhes.modelo||"N√£o informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoDetalhes.fabricante||"N√£o informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CNPJ do Fabricante:")]),a._v(" "+a._s(a.produtoDetalhes.cnpj||"N√£o informado")+" ")])])])]),t("div",{staticClass:"dcb-section"},[t("h3",[a._v("DADOS DA CERTIFICA√á√ÉO")]),t("div",{staticClass:"primeiro-quadro"},[a._m(1),t("div",{staticClass:"status-info"},[a._m(2),t("div",{staticClass:"info-item",staticStyle:{"margin-left":"40px"}},[t("strong",[a._v("Status:")]),t("span",{staticClass:"status-badge",class:a.getStatusDCBClass()},[a._v(" "+a._s(a.getStatusDCB())+" ")])]),t("div",{staticClass:"info-item",staticStyle:{"margin-left":"40px"}},[t("strong",[a._v("1.1.1. Origem:")]),a._v(" Edital de Pr√©-Qualifica√ß√£o de Bens n¬∫ "+a._s(a.produtoDetalhes.numero_edital||"XXX/YYYY")+" ")])]),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item"},[t("strong",[a._v("Data de Emiss√£o:")]),a._v(" "+a._s(a.formatarData(a.produtoDetalhes.data_emissao))+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Data de Validade:")]),a._v(" "+a._s(a.formatarData(a.produtoDetalhes.data_validade))+" ")])])])]),a.documentos.length>0?t("div",{staticClass:"documentos"},[t("h3",[a._v("Documentos Anexos")]),t("ul",{staticClass:"documentos-lista"},a._l(a.documentos,(function(e){return t("li",{key:e.id,staticClass:"documento-item"},[t("span",{staticClass:"doc-icon"},[a._v("üìÑ")]),t("span",{staticClass:"doc-nome"},[a._v(a._s(e.nome))]),t("a",{staticClass:"btn-download",attrs:{href:e.arquivo_url,target:"_blank"}},[a._v("Visualizar")])])})),0)]):a._e(),t("div",{staticClass:"dcb-actions"},[t("div",{staticClass:"button-group"},[t("button",{staticClass:"btn-primary",attrs:{disabled:!a.produtoAprovado},on:{click:a.visualizarDCB}},[a._v(" üëÅÔ∏è Visualizar DCB ")]),t("button",{staticClass:"btn-secondary",attrs:{disabled:!a.produtoAprovado},on:{click:a.baixarDCB}},[a._v(" üì• Baixar DCB (PDF) ")])]),a.produtoAprovado?a._e():t("p",{staticClass:"aviso"},[a._v(" ‚ö†Ô∏è Somente produtos aprovados possuem Declara√ß√£o de Conformidade dispon√≠vel. ")])])]):a._e()])},dt=[function(){var a=this,t=a._self._c;return t("p",[t("strong",[a._v("1. Primeiro quadro")])])},function(){var a=this,t=a._self._c;return t("p",[t("strong",[a._v("1. Primeiro quadro")])])},function(){var a=this,t=a._self._c;return t("p",{staticStyle:{"margin-left":"20px"}},[t("strong",[a._v("1.1.")]),a._v(' Incluir abaixo de "Status":')])}],ut=e(1749);const mt={name:"FormularioDCB",data(){return{produtoSelecionado:"",produtoDetalhes:null,documentos:[],produtos:[],loading:!1,currentTenantId:null}},computed:{produtoAprovado(){return this.produtoDetalhes&&"aprovado"===this.produtoDetalhes.status}},created(){this.obterTenantId().then((()=>{this.carregarProdutos()}))},methods:{async obterTenantId(){try{const{data:a}=await M.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usu√°rio n√£o est√° autenticado");if(t.user_metadata?.tenant_id)return void(this.currentTenantId=t.user_metadata.tenant_id);const{data:e,error:o}=await M.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id&&(this.currentTenantId=e.tenant_id)}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarProdutos(){try{if(!this.currentTenantId)return void console.error("Tenant ID n√£o dispon√≠vel");const{data:a,error:t}=await M.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).eq("status","aprovado").order("nome");if(t)throw t;this.produtos=a||[]}catch(a){console.error("Erro ao carregar produtos:",a),this.$swal({icon:"error",title:"Erro",text:"N√£o foi poss√≠vel carregar os produtos."})}},async carregarDetalhes(){if(!this.produtoSelecionado)return this.produtoDetalhes=null,void(this.documentos=[]);try{this.loading=!0;const{data:a,error:t}=await M.ND.from("produtos").select("*").eq("id",this.produtoSelecionado).single();if(t)throw t;if(console.log("Produto carregado:",a),a.data_emissao||(a.data_emissao=(new Date).toISOString().split("T")[0]),!a.data_validade){const t=new Date;t.setFullYear(t.getFullYear()+1),a.data_validade=t.toISOString().split("T")[0]}a.numero_edital||(a.numero_edital=`001/${(new Date).getFullYear()}`),this.produtoDetalhes=a,console.log("Detalhes do produto definidos:",this.produtoDetalhes);const{data:e,error:o}=await M.ND.from("documentos").select("*").eq("produto_id",this.produtoSelecionado);if(o)throw o;this.documentos=e||[]}catch(a){console.error("Erro ao carregar detalhes do produto:",a),this.$swal({icon:"error",title:"Erro",text:"N√£o foi poss√≠vel carregar os detalhes do produto."})}finally{this.loading=!1}},getStatusDCB(){if(!this.produtoDetalhes||!this.produtoDetalhes.data_validade)return"VENCIDA";const a=new Date,t=new Date(this.produtoDetalhes.data_validade);return t>a?"EM VIGOR":"VENCIDA"},getStatusDCBClass(){const a=this.getStatusDCB();return{"status-em-vigor":"EM VIGOR"===a,"status-vencida":"VENCIDA"===a}},formatarData(a){if(!a)return"N√£o informada";try{const t=new Date(a);return t.toLocaleDateString("pt-BR")}catch(t){return"Data inv√°lida"}},visualizarDCB(){if(!this.produtoDetalhes||!this.produtoAprovado)return void this.$swal({icon:"error",title:"N√£o dispon√≠vel",text:"Apenas produtos aprovados possuem Declara√ß√£o de Conformidade dispon√≠vel."});const a=this.criarConteudoDCB();this.$swal({title:"Declara√ß√£o de Conformidade de Bem",html:a,width:"800px",showConfirmButton:!0,confirmButtonText:"Fechar",showCancelButton:!0,cancelButtonText:"üì• Baixar PDF",cancelButtonColor:"#3498db"}).then((a=>{a.isDismissed&&"cancel"===a.dismiss&&this.baixarDCB()}))},baixarDCB(){if(this.produtoDetalhes&&this.produtoAprovado)try{const a=new ut.jsPDF("p","mm","a4"),t=this.produtoDetalhes,e=(new Date).getFullYear();a.setFont("helvetica"),a.setFontSize(9),a.text("(Logo do √≥rg√£o ou entidade)",20,15),a.text("(Nome do √≥rg√£o ou entidade)",130,15),a.text("Comiss√£o de Padroniza√ß√£o de Materiais - CPM",115,22),a.setFontSize(14),a.setFont("helvetica","bold");const o="DECLARA√á√ÉO DE CONFORMIDADE DE BEM",i=a.getTextWidth(o);a.text(o,(210-i)/2,35),a.setFontSize(12);const s=`DCB N¬∫ ${t.id}/${e}`,r=a.getTextWidth(s);a.text(s,(210-r)/2,42),a.line(20,47,190,47);let n=55;a.setFontSize(11),a.setFont("helvetica","bold"),a.text("PRODUTO CERTIFICADO",20,n),n+=6,a.setFont("helvetica","normal"),a.setFontSize(9),a.text("1. Primeiro quadro",20,n),n+=5,a.text(`1.1. Nome: ${t.nome||"N√£o informado"}`,25,n),n+=4,a.text(`Marca: ${t.marca||"N√£o informada"}`,25,n),n+=4,a.text(`Modelo: ${t.modelo||"N√£o informado"}`,25,n),n+=4,a.text(`Fabricante: ${t.fabricante||"N√£o informado"}`,25,n),n+=4,a.text(`CNPJ do Fabricante: ${t.cnpj||"N√£o informado"}`,25,n),n+=10,a.setFont("helvetica","bold"),a.setFontSize(11),a.text("DADOS DA CERTIFICA√á√ÉO",20,n),n+=6,a.setFont("helvetica","normal"),a.setFontSize(9),a.text("1. Primeiro quadro",20,n),n+=5,a.text('1.1. Incluir abaixo de "Status":',25,n),n+=4,a.text(`Status: ${this.getStatusDCB()}`,30,n),n+=4,a.text(`1.1.1. Origem: Edital de Pr√©-Qualifica√ß√£o de Bens n¬∫ ${t.numero_edital||"XXX/YYYY"}`,30,n),n+=10,a.setFont("helvetica","bold"),a.setFontSize(11),a.text("DECLARA√á√ÉO",20,n),n+=6,a.setFont("helvetica","normal"),a.setFontSize(8);const l=["A Comiss√£o de Padroniza√ß√£o de Materiais ‚Äì CPM do(a) _______ (nome do √≥rg√£o/entidade)","_______, constitu√≠da por meio do(a) __________ [informar o tipo de instrumento","(resolu√ß√£o/portaria), n√∫mero e ano de expedi√ß√£o], DECLARA que:","","1¬∫) o produto especificado nesta DCB foi submetido √† demonstra√ß√£o funcional e an√°lise","t√©cnica, devidamente monitoradas e documentadas por esta CPM em processo administrativo","pr√≥prio, com estrita observ√¢ncia √†s formalidades legais e regulamentares, tendo sido","considerado apto e, portanto, APROVADO para o uso e a finalidade a que se destina, uma","vez que atendeu aos requisitos t√©cnicos exigidos pelo Edital de Pr√©-Qualifica√ß√£o de Bens","em refer√™ncia, sendo a sua marca comercial e modelo lan√ßados no Cat√°logo Eletr√¥nico de","Bens Padronizados deste(a) √≥rg√£o/entidade, para fins de aquisi√ß√µes futuras e eventuais,","conforme previsto na Lei Federal n¬∫ 14.133/2021 (Lei de Licita√ß√µes e Contratos);","","2¬∫) expirada a sua vig√™ncia, esta DCB somente poder√° ser renovada mediante a realiza√ß√£o","de nova demonstra√ß√£o do produto nela especificado, para fins de rean√°lise t√©cnica e","funcional monitoradas e documentadas pela CPM."];l.forEach((t=>{a.text(t,20,n),n+=""===t?2:4})),n+=8,a.text("Local e data ___________",20,n),n+=12,a.text("(assinatura digital)",20,n),n+=5,a.setFont("helvetica","bold"),a.text("Comiss√£o de Padroniza√ß√£o de Materiais",20,n),n+=4,a.text("Presidente da CPM",20,n);const c=`DCB_${t.nome}_${t.id}_${e}.pdf`;a.save(c),this.$swal({icon:"success",title:"PDF Gerado!",text:`DCB baixada como: ${c}`,timer:3e3,showConfirmButton:!1})}catch(a){console.error("Erro ao gerar PDF:",a),this.$swal({icon:"error",title:"Erro ao gerar PDF",text:"Ocorreu um erro ao gerar o arquivo PDF."})}else this.$swal({icon:"error",title:"N√£o dispon√≠vel",text:"Apenas produtos aprovados possuem Declara√ß√£o de Conformidade dispon√≠vel."})},criarConteudoDCB(){const a=this.produtoDetalhes,t=((new Date).toLocaleDateString("pt-BR"),(new Date).getFullYear());return`\n        <div style="text-align: left; font-family: Arial, sans-serif; line-height: 1.6; padding: 20px;">\n          <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #2c3e50; padding-bottom: 20px;">\n            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">\n              <div style="text-align: left;">\n                <strong>(Logo do √≥rg√£o<br>ou entidade)</strong>\n              </div>\n              <div style="text-align: right;">\n                <strong>(Nome do √≥rg√£o ou entidade)<br>\n                Comiss√£o de Padroniza√ß√£o de Materiais - CPM</strong>\n              </div>\n            </div>\n            <h2 style="margin: 20px 0 10px 0; font-size: 18px; font-weight: bold;">DECLARA√á√ÉO DE CONFORMIDADE DE BEM</h2>\n            <h3 style="margin: 5px 0; font-size: 16px;">DCB N¬∫ ${a.id}/${t}</h3>\n          </div>\n          \n          <div style="margin-bottom: 25px;">\n            <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 16px; font-weight: bold;">PRODUTO CERTIFICADO</h4>\n            <p style="margin: 8px 0;"><strong>1. Primeiro quadro</strong></p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>1.1. Nome:</strong> ${a.nome||"N√£o informado"}</p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>Marca:</strong> ${a.marca||"N√£o informada"}</p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>Modelo:</strong> ${a.modelo||"N√£o informado"}</p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>Fabricante:</strong> ${a.fabricante||"N√£o informado"}</p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>CNPJ do Fabricante:</strong> ${a.cnpj||"N√£o informado"}</p>\n          </div>\n          \n          <div style="margin-bottom: 25px;">\n            <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 16px; font-weight: bold;">DADOS DA CERTIFICA√á√ÉO</h4>\n            <p style="margin: 8px 0;"><strong>1. Primeiro quadro</strong></p>\n            <p style="margin: 8px 0; margin-left: 20px;"><strong>1.1.</strong> Incluir abaixo de "Status":</p>\n            <p style="margin: 8px 0; margin-left: 40px;"><strong>Status:</strong> ${this.getStatusDCB()}</p>\n            <p style="margin: 8px 0; margin-left: 40px;"><strong>1.1.1. Origem:</strong> Edital de Pr√©-Qualifica√ß√£o de Bens n¬∫ ${a.numero_edital||"XXX/YYYY"}</p>\n          </div>\n          \n          <div style="margin-bottom: 25px;">\n            <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 16px; font-weight: bold;">DECLARA√á√ÉO</h4>\n            <p style="margin: 10px 0; text-align: justify;">\n              A Comiss√£o de Padroniza√ß√£o de Materiais ‚Äì CPM do(a) <strong>_______ (nome do √≥rg√£o/entidade) _______</strong>, constitu√≠da por meio do(a) <strong>__________ [informar o tipo de instrumento (resolu√ß√£o/portaria), n√∫mero e ano de expedi√ß√£o]</strong>, <strong>DECLARA</strong> que:\n            </p>\n            \n            <p style="margin: 15px 0; text-align: justify;">\n              <strong>1¬∫)</strong> o produto especificado nesta DCB foi submetido √† demonstra√ß√£o funcional e an√°lise t√©cnica, devidamente monitoradas e documentadas por esta CPM em processo administrativo pr√≥prio, com estrita observ√¢ncia √†s formalidades legais e regulamentares, tendo sido considerado apto e, portanto, <strong>APROVADO</strong> para o uso e a finalidade a que se destina, uma vez que atendeu aos requisitos t√©cnicos exigidos pelo Edital de Pr√©-Qualifica√ß√£o de Bens em refer√™ncia, sendo a sua marca comercial e modelo lan√ßados no <strong>Cat√°logo Eletr√¥nico de Bens Padronizados</strong> deste(a) √≥rg√£o/entidade, para fins de aquisi√ß√µes futuras e eventuais, conforme previsto na Lei Federal n¬∫ 14.133/2021 (Lei de Licita√ß√µes e Contratos);\n            </p>\n            \n            <p style="margin: 15px 0; text-align: justify;">\n              <strong>2¬∫)</strong> expirada a sua vig√™ncia, esta DCB somente poder√° ser renovada mediante a realiza√ß√£o de nova demonstra√ß√£o do produto nela especificado, para fins de rean√°lise t√©cnica e funcional monitoradas e documentadas pela CPM.\n            </p>\n          </div>\n          \n          <div style="margin-top: 50px; text-align: center;">\n            <p style="margin: 20px 0;">Local e data ___________</p>\n            <br><br>\n            <p style="margin: 10px 0;">(assinatura digital)</p>\n            <p style="margin: 5px 0; font-weight: bold;">Comiss√£o de Padroniza√ß√£o de Materiais</p>\n            <p style="margin: 5px 0; font-weight: bold;">Presidente da CPM</p>\n          </div>\n        </div>\n      `}}},pt=mt;var vt=(0,C.A)(pt,ct,dt,!1,null,"95e4a772",null);const gt=vt.exports,ht={name:"DCB",components:{FormularioDCB:gt},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comiss√£o de Padroniza√ß√£o de Materiais"}},mounted(){this.carregarConfiguracoes(),document.addEventListener("click",this.fecharDropdownFora)},beforeUnmount(){document.removeEventListener("click",this.fecharDropdownFora)},methods:{async logout(){try{await M.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},fecharDropdownFora(a){this.$el.querySelector(".profile-dropdown").contains(a.target)||(this.dropdownOpen=!1)},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"üìß Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das dilig√™ncias</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comiss√£o de Padroniza√ß√£o de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"üíæ Salvar",cancelButtonText:"‚ùå Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"‚úÖ Sucesso!",text:"Configura√ß√µes de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configura√ß√µes:",a)}}}},ft=ht;var _t=(0,C.A)(ft,nt,lt,!1,null,"bb85b182",null);const Ct=_t.exports;var bt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"ccl-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Cat√°logo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classifica√ß√£o")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("‚ñº")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("üë§")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("‚öôÔ∏è")]),t("span",[a._v("Configura√ß√µes")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("üìß")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("üö™")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("DashboardCCL")],1)])},Dt=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras P√∫blicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("üë§")])])}],wt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard"},[t("h2",[a._v("Painel Comiss√£o de Contrata√ß√£o ou Licita√ß√£o")]),t("div",{staticClass:"tabs"},[t("div",{staticClass:"tab",class:{active:"dashboard"===a.activeTab},on:{click:function(t){a.activeTab="dashboard"}}},[a._v(" Dashboard ")]),t("div",{staticClass:"tab",class:{active:"atas"===a.activeTab},on:{click:function(t){a.activeTab="atas"}}},[a._v(" Atas de Julgamento ")]),t("div",{staticClass:"tab",class:{active:"homologacoes"===a.activeTab},on:{click:function(t){a.activeTab="homologacoes"}}},[a._v(" Homologa√ß√µes ")])]),"dashboard"===a.activeTab?t("div",[t("div",{staticClass:"stats-container"},[t("div",{staticClass:"stat-card status-pendente-card"},[t("h3",[a._v("Processos em Julgamento")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.pendentes))])]),t("div",{staticClass:"stat-card status-aprovado-card"},[t("h3",[a._v("Homologa√ß√µes")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.aprovados))])]),t("div",{staticClass:"stat-card status-diligencia-card"},[t("h3",[a._v("Processos com Dilig√™ncias")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.diligencias))])])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Processos Pendentes de Julgamento")]),a.produtosPendentes.length>0?t("table",[a._m(0),t("tbody",a._l(a.produtosPendentes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.marca))]),t("td",[a._v(a._s(a.getCategoriaName(e.categoria_id)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(e.status)},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")])]),t("td",[a._v(a._s(a.formatDate(e.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.publicarDecisao(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("N√£o h√° processos pendentes de julgamento.")])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Atas de Julgamento")]),a.atasRecentes.length>0?t("table",[a._m(1),t("tbody",a._l(a.atasRecentes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.numero))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(e.decisao)},[a._v(" "+a._s(a.formatarStatus(e.decisao))+" ")])]),t("td",[a._v(a._s(a.formatDate(e.data_publicacao)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.visualizarAta(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("N√£o h√° atas de julgamento.")])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Recursos Apresentados")]),a.recursos.length>0?t("table",[a._m(2),t("tbody",a._l(a.recursos,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.recorrente))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[a._v(a._s(a.formatDate(e.data_recurso)))]),t("td",[a._v(a._s(a.formatDate(e.prazo_final)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getRecursoStatusClass(e.status)},[a._v(" "+a._s(e.status)+" ")])]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.julgarRecurso(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("N√£o h√° recursos apresentados.")])])]):a._e(),"atas"===a.activeTab?t("div",{staticClass:"atas-julgamento"},[a._m(3)]):a._e(),"homologacoes"===a.activeTab?t("div",{staticClass:"homologacoes"},[a._m(4)]):a._e()])},Et=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Categoria")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Documenta√ß√£o")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("N√∫mero da Ata")]),t("th",[a._v("Produto")]),t("th",[a._v("Decis√£o")]),t("th",[a._v("Data de Publica√ß√£o")]),t("th",[a._v("Documenta√ß√£o")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Recorrente")]),t("th",[a._v("Produto")]),t("th",[a._v("Data do Recurso")]),t("th",[a._v("Prazo Final")]),t("th",[a._v("Status")]),t("th",[a._v("Documenta√ß√£o")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Atas de Julgamento")]),t("p",[a._v("Este m√≥dulo permitir√° o gerenciamento completo das atas de julgamento emitidas pela Comiss√£o de Contrata√ß√£o ou Licita√ß√£o.")]),t("p",[a._v("Funcionalidades que ser√£o implementadas:")]),t("ul",[t("li",[a._v("Cadastro e edi√ß√£o de atas de julgamento")]),t("li",[a._v("Publica√ß√£o autom√°tica no Di√°rio Oficial")]),t("li",[a._v("Comunica√ß√£o com fornecedores interessados")]),t("li",[a._v("Hist√≥rico de altera√ß√µes e vers√µes")]),t("li",[a._v("Gera√ß√£o de relat√≥rios consolidados")]),t("li",[a._v("Integra√ß√£o com sistema de processo eletr√¥nico")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Homologa√ß√µes")]),t("p",[a._v("Este m√≥dulo permitir√° o acesso a todos os arquivos em PDF de atos de homologa√ß√£o assinados digitalmente pela autoridade competente do √≥rg√£o ou entidade.")]),t("p",[a._v("Funcionalidades que ser√£o implementadas:")]),t("ul",[t("li",[a._v("Acesso aos documentos de homologa√ß√£o de padroniza√ß√µes de marcas e modelos")]),t("li",[a._v("Acesso aos documentos de despadroniza√ß√µes")]),t("li",[a._v("Registro de decis√µes da autoridade competente")]),t("li",[a._v("Notifica√ß√£o autom√°tica de homologa√ß√µes e indeferimentos")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])}];const At={name:"DashboardCCL",data(){return{activeTab:"dashboard",produtosPendentes:[],atasRecentes:[],pendentes:0,aprovados:0,diligencias:0,categorias:[],currentTenantId:null,loading:!1,recursos:[]}},created(){this.obterTenantId().then((()=>{this.carregarDados(),this.carregarCategorias()}))},methods:{async obterTenantId(){try{const{data:a}=await M.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usu√°rio n√£o est√° autenticado");if(t.user_metadata?.tenant_id)return void(this.currentTenantId=t.user_metadata.tenant_id);const{data:e,error:o}=await M.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id?this.currentTenantId=e.tenant_id:console.error("Tenant ID n√£o encontrado para o usu√°rio")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarCategorias(){try{const{data:a,error:t}=await M.ND.from("categorias").select("*");if(t)throw t;this.categorias=a||[]}catch(a){console.error("Erro ao carregar categorias:",a)}},getCategoriaName(a){const t=this.categorias.find((t=>t.id===a));return t?t.nome:"Categoria n√£o encontrada"},async carregarDados(){try{if(this.loading=!0,!this.currentTenantId)return void console.error("Tenant ID n√£o dispon√≠vel");const{data:a,error:t}=await M.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).in("status",["aprovado","reprovado"]).order("criado_em",{ascending:!1}).limit(10);if(t)throw t;this.produtosPendentes=a||[],this.atasRecentes=[{id:"1",numero:"ATA-001/2023",produto_nome:"Monitor de Sinais Vitais",decisao:"aprovado",data_publicacao:"2023-05-15"},{id:"2",numero:"ATA-002/2023",produto_nome:"Desfibrilador",decisao:"diligencia",data_publicacao:"2023-05-20"},{id:"3",numero:"ATA-003/2023",produto_nome:"Autoclave Hospitalar",decisao:"aprovado",data_publicacao:"2023-06-01"}],this.recursos=[{id:"1",recorrente:"Hospital M√©dico LTDA",produto_nome:"Desfibrilador",data_recurso:"2023-05-22",status:"EM AN√ÅLISE",prazo_final:"2023-06-06"},{id:"2",recorrente:"Equipamentos Hospitalares S.A.",produto_nome:"Bomba de Infus√£o",data_recurso:"2023-06-05",status:"DEFERIDO",prazo_final:"2023-06-20"},{id:"3",recorrente:"Medical Suprimentos M√©dicos",produto_nome:"Ventilador Pulmonar",data_recurso:"2023-06-10",status:"INDEFERIDO",prazo_final:"2023-06-25"}];const e=await Promise.all([this.contarPorStatus("pendente"),this.contarPorStatus("aprovado"),this.contarPorStatus("diligencia")]);this.pendentes=e[0],this.aprovados=e[1],this.diligencias=e[2];const o=this.atasRecentes.filter((a=>"diligencia"===a.decisao)).length;o>0&&(this.diligencias=o);const i=this.atasRecentes.filter((a=>"aprovado"===a.decisao)).length;i>0&&0===this.aprovados&&(this.aprovados=i)}catch(a){console.error("Erro ao carregar dados:",a)}finally{this.loading=!1}},async contarPorStatus(a){if(!this.currentTenantId)return 0;const{count:t,error:e}=await M.ND.from("produtos").select("id",{count:"exact"}).eq("status",a).eq("tenant_id",this.currentTenantId);return e?(console.error(`Erro ao contar produtos ${a}:`,e),0):t||0},formatDate(a){if(!a)return"";if(a.includes("T")){const t=new Date(a);return t.toLocaleDateString("pt-BR")}const t=a.split("-");return 3===t.length?`${t[2]}/${t[1]}/${t[0]}`:a},formatarStatus(a){switch(a){case"pendente":return"Em avalia√ß√£o";case"aprovado":return"Em Dilig√™ncia";case"reprovado":return"Em An√°lise";case"diligencia":return"Em dilig√™ncia";default:return a}},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";case"diligencia":return"status-diligencia";default:return""}},publicarDecisao(a){this.$swal({title:"A√ß√£o Simulada",text:"Em uma implementa√ß√£o completa, abriria um formul√°rio para registrar a decis√£o da comiss√£o e publicar no Di√°rio Oficial.",icon:"info"})},visualizarAta(a){this.$swal({title:"A√ß√£o Simulada",text:"Em uma implementa√ß√£o completa, exibiria o documento da ata de julgamento e permitiria fazer download.",icon:"info"})},getRecursoStatusClass(a){switch(a){case"EM AN√ÅLISE":return"status-pendente";case"DEFERIDO":return"status-aprovado";case"INDEFERIDO":return"status-reprovado";default:return""}},julgarRecurso(a){this.$swal({title:"A√ß√£o Simulada",text:"Em uma implementa√ß√£o completa, abriria um formul√°rio para julgar o recurso e permitiria acesso ao documento PDF assinado digitalmente.",icon:"info"})}}},yt=At;var xt=(0,C.A)(yt,wt,Et,!1,null,"307ff78f",null);const Pt=xt.exports,St={name:"CCL",components:{DashboardCCL:Pt},data(){return{dropdownOpen:!1,modalEmailAberto:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",configEmail:{nomeOrganizacao:"",emailRemetente:"",nomeRemetente:"",assinatura:""},showDropdown:!1,usuarioNome:"comprarBemTeste",usuarioEmail:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comiss√£o de Padroniza√ß√£o de Materiais"}},async created(){await this.carregarDadosUsuario(),this.carregarConfiguracoes()},mounted(){},beforeUnmount(){},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await M.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usu√°rio:",a)}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configura√ß√µes:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},abrirConfiguracoesEmail(){this.closeDropdown(),this.mostrarConfigEmail()},async logout(){try{await M.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()},abrirConfiguracoes(){this.closeDropdown(),this.mostrarConfigEmail()},async mostrarConfigEmail(){const{value:a}=await this.$swal({title:"üìß Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das dilig√™ncias</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comiss√£o de Padroniza√ß√£o de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"üíæ Salvar",cancelButtonText:"‚ùå Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"‚úÖ Sucesso!",text:"Configura√ß√µes de email salvas com sucesso!",icon:"success"})}},closeDropdown(){this.showDropdown=!1}}},Nt=St;var Rt=(0,C.A)(Nt,bt,Dt,!1,null,"3bed4c5e",null);const Mt=Rt.exports;var $t=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classificacao-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Cat√°logo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classifica√ß√£o")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.dropdownOpen},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("‚ñº")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("üë§")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.nomeUsuario))]),t("small",[a._v(a._s(a.emailUsuario))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("‚öôÔ∏è")]),t("span",[a._v("Configura√ß√µes")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("üìß")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("üö™")]),t("span",[a._v("Sair")])])]):a._e()]),a.dropdownOpen?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("Classificacao")],1),a.modalEmailAberto?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalEmail}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[a._m(2),t("button",{staticClass:"btn-close",on:{click:a.fecharModalEmail}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeOrganizacao"}},[a._v("Nome da Organiza√ß√£o")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeOrganizacao,expression:"configEmail.nomeOrganizacao"}],attrs:{id:"nomeOrganizacao",type:"text",placeholder:"Ex: Prefeitura Municipal de..."},domProps:{value:a.configEmail.nomeOrganizacao},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeOrganizacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"emailRemetente"}},[a._v("Email Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.emailRemetente,expression:"configEmail.emailRemetente"}],attrs:{id:"emailRemetente",type:"email",placeholder:"Ex: licitacoes@prefeitura.gov.br"},domProps:{value:a.configEmail.emailRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"emailRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeRemetente"}},[a._v("Nome do Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeRemetente,expression:"configEmail.nomeRemetente"}],attrs:{id:"nomeRemetente",type:"text",placeholder:"Ex: CPM - Comiss√£o de Padroniza√ß√£o de Materiais"},domProps:{value:a.configEmail.nomeRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"assinatura"}},[a._v("Assinatura do Email")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.assinatura,expression:"configEmail.assinatura"}],attrs:{id:"assinatura",rows:"4",placeholder:"Ex: Atenciosamente,&#10;Comiss√£o de Padroniza√ß√£o de Materiais&#10;Prefeitura Municipal&#10;Telefone: (xx) xxxx-xxxx"},domProps:{value:a.configEmail.assinatura},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"assinatura",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:a.fecharModalEmail}},[a._v("Cancelar")]),t("button",{staticClass:"btn btn-primary",on:{click:a.salvarConfiguracaoEmail}},[t("i",{staticClass:"fas fa-save"}),a._v(" Salvar ")])])])]):a._e()])},It=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras P√∫blicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("üë§")])])},function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-envelope"}),a._v(" Configurar Email da Organiza√ß√£o")])}],Tt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classificacao-container"},[t("h2",[a._v("Classifica√ß√£o de Produtos")]),t("div",{staticClass:"tabs"},[t("button",{class:["tab-button",{active:"grupos"===a.activeTab}],on:{click:function(t){a.activeTab="grupos"}}},[a._v(" Grupos ")]),t("button",{class:["tab-button",{active:"classes"===a.activeTab}],on:{click:function(t){a.activeTab="classes"}}},[a._v(" Classes ")])]),t("div",{staticClass:"tab-content"},["grupos"===a.activeTab?t("GruposList"):a._e(),"classes"===a.activeTab?t("ClassesList"):a._e()],1)])},Ot=[],kt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"grupos-list"},[t("div",{staticClass:"header"},[t("h3",[a._v("Gerenciamento de Grupos")]),t("button",{staticClass:"btn-add",on:{click:function(t){a.mostrarFormulario=!0}}},[a._v(" Adicionar Grupo ")])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando grupos...")])]):0===a.grupos.length?t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhum grupo cadastrado.")])]):t("div",{staticClass:"grupos-table"},[t("table",[a._m(0),t("tbody",a._l(a.grupos,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.descricao||"-"))]),t("td",[a._v(a._s(a.formatarData(e.created_at)))]),t("td",{staticClass:"actions"},[t("button",{staticClass:"btn-edit",on:{click:function(t){return a.editarGrupo(e)}}},[a._v("Editar")]),t("button",{staticClass:"btn-delete",on:{click:function(t){return a.confirmarExclusao(e)}}},[a._v("Excluir")])])])})),0)])]),a.mostrarFormulario?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.modoEdicao?"Editar":"Adicionar")+" Grupo")]),t("button",{staticClass:"btn-close",on:{click:a.fecharFormulario}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarGrupo.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome do Grupo*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.grupoAtual.nome,expression:"grupoAtual.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.grupoAtual.nome},on:{input:function(t){t.target.composing||a.$set(a.grupoAtual,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descri√ß√£o")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.grupoAtual.descricao,expression:"grupoAtual.descricao"}],attrs:{id:"descricao",rows:"3"},domProps:{value:a.grupoAtual.descricao},on:{input:function(t){t.target.composing||a.$set(a.grupoAtual,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharFormulario}},[a._v("Cancelar")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.salvando}},[a._v(" "+a._s(a.salvando?"Salvando...":"Salvar")+" ")])])])])])]):a._e()])},Ft=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Descri√ß√£o")]),t("th",[a._v("Data de Cria√ß√£o")]),t("th",[a._v("A√ß√µes")])])])}];const Bt={name:"GruposList",setup(){const a=(0,o.KR)([]),t=(0,o.KR)(!0),e=(0,o.KR)(!1),i=(0,o.KR)(!1),s=(0,o.KR)(!1),r=(0,o.Kh)({id:null,nome:"",descricao:""});(0,o.sV)((async()=>{await n()}));const n=async()=>{try{t.value=!0;const{data:e,error:o}=await M.ND.from("grupos").select("*").order("nome");if(o)throw o;a.value=e||[]}catch(e){console.error("Erro ao carregar grupos:",e),alert("Erro ao carregar grupos. Por favor, tente novamente.")}finally{t.value=!1}},l=a=>{if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")},c=a=>{s.value=!0,r.id=a.id,r.nome=a.nome,r.descricao=a.descricao||"",i.value=!0},d=()=>{i.value=!1,s.value=!1,r.id=null,r.nome="",r.descricao=""},u=async()=>{try{if(e.value=!0,s.value){const{error:a}=await M.ND.from("grupos").update({nome:r.nome,descricao:r.descricao}).eq("id",r.id);if(a)throw a;alert("Grupo atualizado com sucesso!")}else{const{error:a}=await M.ND.from("grupos").insert({nome:r.nome,descricao:r.descricao});if(a)throw a;alert("Grupo adicionado com sucesso!")}await n(),d()}catch(a){console.error("Erro ao salvar grupo:",a),alert(`Erro ao ${s.value?"atualizar":"adicionar"} grupo: ${a.message}`)}finally{e.value=!1}},m=a=>{confirm(`Deseja realmente excluir o grupo "${a.nome}"?`)&&p(a.id)},p=async a=>{try{t.value=!0;const{data:e,error:o}=await M.ND.from("classes").select("id").eq("grupo_id",a);if(o)throw o;if(e&&e.length>0)return void alert(`N√£o √© poss√≠vel excluir este grupo porque existem ${e.length} classes associadas a ele.`);const{data:i,error:s}=await M.ND.from("produtos").select("id").eq("grupo_id",a);if(s)throw s;if(i&&i.length>0)return void alert(`N√£o √© poss√≠vel excluir este grupo porque existem ${i.length} produtos associados a ele.`);const{error:r}=await M.ND.from("grupos").delete().eq("id",a);if(r)throw r;alert("Grupo exclu√≠do com sucesso!"),await n()}catch(e){console.error("Erro ao excluir grupo:",e),alert(`Erro ao excluir grupo: ${e.message}`)}finally{t.value=!1}};return{grupos:a,loading:t,salvando:e,mostrarFormulario:i,modoEdicao:s,grupoAtual:r,carregarGrupos:n,formatarData:l,editarGrupo:c,fecharFormulario:d,salvarGrupo:u,confirmarExclusao:m}}},qt=Bt;var zt=(0,C.A)(qt,kt,Ft,!1,null,"3509bc35",null);const Lt=zt.exports;var Ut=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classes-list"},[t("div",{staticClass:"header"},[t("h3",[a._v("Gerenciamento de Classes")]),t("button",{staticClass:"btn-add",on:{click:function(t){a.mostrarFormulario=!0}}},[a._v(" Adicionar Classe ")])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando classes...")])]):0===a.classes.length?t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhuma classe cadastrada.")])]):t("div",{staticClass:"classes-table"},[t("table",[a._m(0),t("tbody",a._l(a.classes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(a.getNomeGrupo(e.grupo_id)))]),t("td",[a._v(a._s(e.descricao||"-"))]),t("td",[a._v(a._s(a.formatarData(e.created_at)))]),t("td",{staticClass:"actions"},[t("button",{staticClass:"btn-edit",on:{click:function(t){return a.editarClasse(e)}}},[a._v("Editar")]),t("button",{staticClass:"btn-delete",on:{click:function(t){return a.confirmarExclusao(e)}}},[a._v("Excluir")])])])})),0)])]),a.mostrarFormulario?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.modoEdicao?"Editar":"Adicionar")+" Classe")]),t("button",{staticClass:"btn-close",on:{click:a.fecharFormulario}},[a._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarClasse.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"grupo"}},[a._v("Grupo*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.grupo_id,expression:"classeAtual.grupo_id"}],attrs:{id:"grupo",required:""},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.classeAtual,"grupo_id",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.grupos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" ")])}))],2),0===a.grupos.length?t("div",{staticClass:"error-text"},[t("p",[a._v("√â necess√°rio cadastrar pelo menos um grupo antes de adicionar classes.")])]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome da Classe*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.nome,expression:"classeAtual.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.classeAtual.nome},on:{input:function(t){t.target.composing||a.$set(a.classeAtual,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descri√ß√£o")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.descricao,expression:"classeAtual.descricao"}],attrs:{id:"descricao",rows:"3"},domProps:{value:a.classeAtual.descricao},on:{input:function(t){t.target.composing||a.$set(a.classeAtual,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharFormulario}},[a._v("Cancelar")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.salvando||0===a.grupos.length}},[a._v(" "+a._s(a.salvando?"Salvando...":"Salvar")+" ")])])])])])]):a._e()])},Vt=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Grupo")]),t("th",[a._v("Descri√ß√£o")]),t("th",[a._v("Data de Cria√ß√£o")]),t("th",[a._v("A√ß√µes")])])])}];const jt={name:"ClassesList",setup(){const a=(0,o.KR)([]),t=(0,o.KR)([]),e=(0,o.KR)(!0),i=(0,o.KR)(!1),s=(0,o.KR)(!1),r=(0,o.KR)(!1),n=(0,o.Kh)({id:null,grupo_id:"",nome:"",descricao:""});(0,o.sV)((async()=>{await Promise.all([l(),c()])}));const l=async()=>{try{const{data:a,error:e}=await M.ND.from("grupos").select("*").order("nome");if(e)throw e;t.value=a||[]}catch(a){console.error("Erro ao carregar grupos:",a),alert("Erro ao carregar grupos. Por favor, tente novamente.")}},c=async()=>{try{e.value=!0;const{data:t,error:o}=await M.ND.from("classes").select("*").order("nome");if(o)throw o;a.value=t||[]}catch(t){console.error("Erro ao carregar classes:",t),alert("Erro ao carregar classes. Por favor, tente novamente.")}finally{e.value=!1}},d=a=>{const e=t.value.find((t=>t.id===a));return e?e.nome:"Grupo n√£o encontrado"},u=a=>{if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")},m=a=>{r.value=!0,n.id=a.id,n.grupo_id=a.grupo_id,n.nome=a.nome,n.descricao=a.descricao||"",s.value=!0},p=()=>{s.value=!1,r.value=!1,n.id=null,n.grupo_id="",n.nome="",n.descricao=""},v=async()=>{try{if(i.value=!0,r.value){const{error:a}=await M.ND.from("classes").update({grupo_id:n.grupo_id,nome:n.nome,descricao:n.descricao}).eq("id",n.id);if(a)throw a;alert("Classe atualizada com sucesso!")}else{const{error:a}=await M.ND.from("classes").insert({grupo_id:n.grupo_id,nome:n.nome,descricao:n.descricao});if(a)throw a;alert("Classe adicionada com sucesso!")}await c(),p()}catch(a){console.error("Erro ao salvar classe:",a),alert(`Erro ao ${r.value?"atualizar":"adicionar"} classe: ${a.message}`)}finally{i.value=!1}},g=a=>{confirm(`Deseja realmente excluir a classe "${a.nome}"?`)&&h(a.id)},h=async a=>{try{e.value=!0;const{data:t,error:o}=await M.ND.from("produtos").select("id").eq("classe_id",a);if(o)throw o;if(t&&t.length>0)return void alert(`N√£o √© poss√≠vel excluir esta classe porque existem ${t.length} produtos associados a ela.`);const{error:i}=await M.ND.from("classes").delete().eq("id",a);if(i)throw i;alert("Classe exclu√≠da com sucesso!"),await c()}catch(t){console.error("Erro ao excluir classe:",t),alert(`Erro ao excluir classe: ${t.message}`)}finally{e.value=!1}};return{classes:a,grupos:t,loading:e,salvando:i,mostrarFormulario:s,modoEdicao:r,classeAtual:n,carregarClasses:c,carregarGrupos:l,getNomeGrupo:d,formatarData:u,editarClasse:m,fecharFormulario:p,salvarClasse:v,confirmarExclusao:g}}},Jt=jt;var Gt=(0,C.A)(Jt,Ut,Vt,!1,null,"7574422a",null);const Ht=Gt.exports,Yt={name:"Classificacao",components:{GruposList:Lt,ClassesList:Ht},setup(){const a=(0,o.KR)("grupos");return{activeTab:a}}},Kt=Yt;var Wt=(0,C.A)(Kt,Tt,Ot,!1,null,"35477b05",null);const Qt=Wt.exports,Xt={name:"ClassificacaoView",components:{Classificacao:Qt},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comiss√£o de Padroniza√ß√£o de Materiais"}},mounted(){this.carregarConfiguracoes(),document.addEventListener("click",this.fecharDropdownFora)},beforeUnmount(){document.removeEventListener("click",this.fecharDropdownFora)},methods:{async logout(){try{await M.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},fecharDropdownFora(a){this.$el.querySelector(".profile-dropdown").contains(a.target)||(this.dropdownOpen=!1)},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"üìß Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das dilig√™ncias</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comiss√£o de Padroniza√ß√£o de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"üíæ Salvar",cancelButtonText:"‚ùå Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"‚úÖ Sucesso!",text:"Configura√ß√µes de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configura√ß√µes:",a)}},closeDropdown(){this.dropdownOpen=!1}}},Zt=Xt;var ae=(0,C.A)(Zt,$t,It,!1,null,"7461ecae",null);const te=ae.exports;var ee=function(){var a=this,t=a._self._c;return t("div",{staticClass:"login-rdm-container"},[a._m(0),t("main",{staticClass:"login-main"},[t("div",{staticClass:"container"},[t("div",{staticClass:"login-card"},[a._m(1),t("form",{staticClass:"login-form",on:{submit:function(t){return t.preventDefault(),a.fazerLogin.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[a._v("üìß Email:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.loginData.email,expression:"loginData.email"}],attrs:{type:"email",id:"email",placeholder:"Digite seu email",required:"",disabled:a.carregando},domProps:{value:a.loginData.email},on:{input:function(t){t.target.composing||a.$set(a.loginData,"email",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"senha"}},[a._v("üîí Senha:")]),t("div",{staticClass:"password-input"},["checkbox"===(a.mostrarSenha?"text":"password")?t("input",{directives:[{name:"model",rawName:"v-model",value:a.loginData.senha,expression:"loginData.senha"}],attrs:{id:"senha",placeholder:"Digite sua senha",required:"",disabled:a.carregando,type:"checkbox"},domProps:{checked:Array.isArray(a.loginData.senha)?a._i(a.loginData.senha,null)>-1:a.loginData.senha},on:{change:function(t){var e=a.loginData.senha,o=t.target,i=!!o.checked;if(Array.isArray(e)){var s=null,r=a._i(e,s);o.checked?r<0&&a.$set(a.loginData,"senha",e.concat([s])):r>-1&&a.$set(a.loginData,"senha",e.slice(0,r).concat(e.slice(r+1)))}else a.$set(a.loginData,"senha",i)}}}):"radio"===(a.mostrarSenha?"text":"password")?t("input",{directives:[{name:"model",rawName:"v-model",value:a.loginData.senha,expression:"loginData.senha"}],attrs:{id:"senha",placeholder:"Digite sua senha",required:"",disabled:a.carregando,type:"radio"},domProps:{checked:a._q(a.loginData.senha,null)},on:{change:function(t){return a.$set(a.loginData,"senha",null)}}}):t("input",{directives:[{name:"model",rawName:"v-model",value:a.loginData.senha,expression:"loginData.senha"}],attrs:{id:"senha",placeholder:"Digite sua senha",required:"",disabled:a.carregando,type:a.mostrarSenha?"text":"password"},domProps:{value:a.loginData.senha},on:{input:function(t){t.target.composing||a.$set(a.loginData,"senha",t.target.value)}}}),t("button",{staticClass:"toggle-password",attrs:{type:"button",disabled:a.carregando},on:{click:function(t){a.mostrarSenha=!a.mostrarSenha}}},[a._v(" "+a._s(a.mostrarSenha?"üôà":"üëÅÔ∏è")+" ")])]),a.primeiroAcesso?t("small",{staticClass:"password-hint"},[a._v(" üí° Use a senha tempor√°ria enviada por email ")]):a._e()]),a.mensagem?t("div",{staticClass:"alert",class:a.tipoMensagem},[a._v(" "+a._s(a.mensagem)+" ")]):a._e(),t("button",{staticClass:"btn-login",attrs:{type:"submit",disabled:a.carregando||!a.loginData.email||!a.loginData.senha}},[a.carregando?t("span",[a._v("‚è≥ Entrando...")]):t("span",[a._v("üöÄ Entrar no Sistema")])])]),t("div",{staticClass:"login-footer"},[t("div",{staticClass:"links"},[t("a",{attrs:{href:"#"},on:{click:function(t){t.preventDefault(),a.mostrarModalAjuda=!0}}},[a._v("‚ùì Esqueci minha senha")]),t("a",{attrs:{href:"#"},on:{click:function(t){t.preventDefault(),a.mostrarModalContato=!0}}},[a._v("üìû Suporte")])]),a._m(2)])]),a._m(3)])]),a.mostrarModalAjuda?t("div",{staticClass:"modal-overlay",on:{click:function(t){a.mostrarModalAjuda=!1}}},[t("div",{staticClass:"modal",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("‚ùì Esqueci minha senha")]),t("button",{staticClass:"btn-close",on:{click:function(t){a.mostrarModalAjuda=!1}}},[a._v("‚úï")])]),a._m(4)])]):a._e(),a.mostrarModalContato?t("div",{staticClass:"modal-overlay",on:{click:function(t){a.mostrarModalContato=!1}}},[t("div",{staticClass:"modal",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("üìû Suporte T√©cnico")]),t("button",{staticClass:"btn-close",on:{click:function(t){a.mostrarModalContato=!1}}},[a._v("‚úï")])]),a._m(5)])]):a._e()])},oe=[function(){var a=this,t=a._self._c;return t("header",{staticClass:"login-header"},[t("div",{staticClass:"container"},[t("div",{staticClass:"logo-section"},[t("h1",[a._v("üè• Sistema Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Dashboard RDM Online")])])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"card-header"},[t("h2",[a._v("üîê Acesso RDM")]),t("p",[a._v("Fa√ßa login para emitir suas Requisi√ß√µes de Materiais")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info"},[t("small",[a._v("üîí Acesso seguro e criptografado")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-cards"},[t("div",{staticClass:"info-card"},[t("h3",[a._v("üìù O que voc√™ pode fazer")]),t("ul",[t("li",[a._v("‚úÖ Emitir RDMs online")]),t("li",[a._v("üìä Acompanhar status das solicita√ß√µes")]),t("li",[a._v("üìã Consultar hist√≥rico")]),t("li",[a._v("üîî Receber notifica√ß√µes autom√°ticas")])])]),t("div",{staticClass:"info-card"},[t("h3",[a._v("‚ö° Primeiro Acesso?")]),t("ol",[t("li",[a._v("Use o email e senha enviados por email")]),t("li",[a._v("Altere sua senha no primeiro login")]),t("li",[a._v("Configure suas prefer√™ncias")]),t("li",[a._v("Comece a usar o sistema!")])])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"modal-body"},[t("p",[a._v("Entre em contato com o CPM para redefinir sua senha:")]),t("div",{staticClass:"contact-info"},[t("p",[a._v("üìß "),t("strong",[a._v("Email:")]),a._v(" comprarbemteste@gmail.com")]),t("p",[a._v("üìû "),t("strong",[a._v("Telefone:")]),a._v(" (61) 3315-2425")])]),t("p",[t("small",[a._v("üí° Informe seu nome completo e unidade/setor")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"modal-body"},[t("div",{staticClass:"contact-info"},[t("h4",[a._v("üí¨ Canais de Atendimento:")]),t("p",[a._v("üìß "),t("strong",[a._v("Email:")]),a._v(" comprarbemteste@gmail.com")]),t("p",[a._v("üìû "),t("strong",[a._v("Telefone:")]),a._v(" (61) 3315-2425")]),t("p",[a._v("üïê "),t("strong",[a._v("Hor√°rio:")]),a._v(" Segunda a Sexta, 8h √†s 17h")])]),t("div",{staticClass:"faq"},[t("h4",[a._v("‚ùì Problemas Comuns:")]),t("ul",[t("li",[t("strong",[a._v("N√£o recebi o email:")]),a._v(" Verifique spam/lixeira")]),t("li",[t("strong",[a._v("Senha n√£o funciona:")]),a._v(" Certifique-se de usar a senha tempor√°ria")]),t("li",[t("strong",[a._v("Conta bloqueada:")]),a._v(" Contate o CPM")])])])])}];const ie={name:"LoginRDM",data(){return{loginData:{email:"",senha:""},carregando:!1,mostrarSenha:!1,mensagem:"",tipoMensagem:"",primeiroAcesso:!1,mostrarModalAjuda:!1,mostrarModalContato:!1}},async mounted(){await this.verificarSessaoExistente()},methods:{async verificarSessaoExistente(){try{const{data:a}=await M.ND.auth.getSession();if(a?.session?.user){const{data:t,error:e}=await M.ND.from("usuarios_rdm").select("*").eq("email",a.session.user.email).single();!e&&t&&(console.log("Usu√°rio RDM j√° logado, redirecionando..."),this.$router.push("/dashboard-rdm"))}}catch(a){console.log("Nenhuma sess√£o ativa encontrada")}},async fazerLogin(){if(!this.carregando){this.carregando=!0,this.mensagem="";try{console.log("üîê Tentativa de login RDM:",this.loginData.email);const{data:a,error:t}=await M.ND.from("usuarios_rdm").select("*").eq("email",this.loginData.email).eq("ativo",!0).single();if(t||!a)throw new Error("Email n√£o encontrado ou usu√°rio inativo. Verifique seus dados ou contate o CPM.");if(console.log("‚úÖ Usu√°rio RDM encontrado:",a.nome_usuario),a.senha_temporaria!==this.loginData.senha)throw new Error("Senha incorreta. Verifique sua senha cadastrada.");console.log("‚úÖ Login realizado com sucesso - senha validada"),localStorage.setItem("usuarioRDM",JSON.stringify({id:a.id,user_id:a.user_id,nome_usuario:a.nome_usuario,email:a.email,unidade_setor:a.unidade_setor,nome_coordenador:a.nome_coordenador,materiais:a.materiais,tenant_id:a.tenant_id})),await M.ND.from("usuarios_rdm").update({atualizado_em:(new Date).toISOString(),convite_aceito:!0}).eq("id",a.id),this.mensagem=`üéâ Bem-vindo(a), ${a.nome_usuario}!`,this.tipoMensagem="success",console.log("‚úÖ Login RDM realizado com sucesso!"),setTimeout((()=>{this.$router.push("/dashboard-rdm")}),1500)}catch(a){console.error("‚ùå Erro no login RDM:",a),this.mensagem=a.message,this.tipoMensagem="error"}finally{this.carregando=!1}}}}},se=ie;var re=(0,C.A)(se,ee,oe,!1,null,"3d6c719e",null);const ne=re.exports;var le=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard-rdm"},[t("header",{staticClass:"dashboard-header"},[t("div",{staticClass:"container"},[t("div",{staticClass:"header-content"},[a._m(0),t("div",{staticClass:"user-section"},[t("div",{staticClass:"user-info"},[t("span",{staticClass:"user-name"},[a._v("üë§ "+a._s(a.usuarioAtual.nome_usuario))]),t("span",{staticClass:"user-sector"},[a._v("üè¢ "+a._s(a.usuarioAtual.unidade_setor))])]),t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("üö™ Sair")])])])])]),t("nav",{staticClass:"nav-tabs"},[t("div",{staticClass:"container"},[t("div",{staticClass:"tabs"},[t("button",{staticClass:"tab-btn",class:{active:"avaliacao"===a.activeTab},on:{click:function(t){a.activeTab="avaliacao"}}},[a._v(" ‚≠ê Avalia√ß√£o de Materiais ")]),t("button",{staticClass:"tab-btn",class:{active:"historico"===a.activeTab},on:{click:function(t){a.activeTab="historico"}}},[a._v(" üìã Hist√≥rico ")]),t("button",{staticClass:"tab-btn",class:{active:"materiais"===a.activeTab},on:{click:function(t){a.activeTab="materiais"}}},[a._v(" üì¶ Meus Materiais ")]),t("button",{staticClass:"tab-btn",class:{active:"perfil"===a.activeTab},on:{click:function(t){a.activeTab="perfil"}}},[a._v(" ‚öôÔ∏è Perfil ")])])])]),t("main",{staticClass:"main-content"},[t("div",{staticClass:"container"},["avaliacao"===a.activeTab?t("div",{staticClass:"tab-content"},[a._m(1),t("div",{staticClass:"reclamacao-form-card"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.enviarReclamacao.apply(null,arguments)}}},[t("div",{staticClass:"form-section"},[t("h3",[a._v("üë§ Dados do Reclamante")]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",[a._v("Nome do Reclamante:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.nome_reclamante,expression:"novaReclamacao.nome_reclamante"}],attrs:{type:"text",required:""},domProps:{value:a.novaReclamacao.nome_reclamante},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"nome_reclamante",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Telefone:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.telefone,expression:"novaReclamacao.telefone"}],attrs:{type:"tel",placeholder:"(00) 00000-0000",required:""},domProps:{value:a.novaReclamacao.telefone},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"telefone",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",[a._v("Email:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.email,expression:"novaReclamacao.email"}],attrs:{type:"email",required:""},domProps:{value:a.novaReclamacao.email},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"email",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Unidade/Setor:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.unidade_setor,expression:"novaReclamacao.unidade_setor"}],attrs:{type:"text",required:""},domProps:{value:a.novaReclamacao.unidade_setor},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"unidade_setor",t.target.value)}}})])])]),t("div",{staticClass:"form-section"},[t("h3",[a._v("üì¶ Dados do Material")]),t("div",{staticClass:"form-group"},[t("label",[a._v("Selecionar Material:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.materialSelecionadoReclamacao,expression:"materialSelecionadoReclamacao"}],attrs:{required:""},on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.materialSelecionadoReclamacao=t.target.multiple?e:e[0]},a.preencherDadosMaterial]}},[t("option",{attrs:{value:""}},[a._v("Selecione um material sob sua responsabilidade")]),a._l(a.usuarioAtual.materiais,(function(e){return t("option",{key:e.produto_id,domProps:{value:e}},[a._v(" "+a._s(e.nome)+" - "+a._s(e.codigo)+" ")])}))],2),0===a.usuarioAtual.materiais?.length?t("small",{staticClass:"error-text"},[a._v(" ‚ö†Ô∏è Voc√™ n√£o possui materiais cadastrados. Entre em contato com a CPM. ")]):a._e()]),a.materialSelecionadoReclamacao?t("div",{staticClass:"material-info-reclamacao"},[t("h4",[a._v("üìã Dados do Material Selecionado:")]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",[a._v("Nome do Material:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.nome_material,expression:"novaReclamacao.nome_material"}],staticClass:"readonly-input",attrs:{type:"text",readonly:""},domProps:{value:a.novaReclamacao.nome_material},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"nome_material",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("C√≥digo do Material:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.codigo_material,expression:"novaReclamacao.codigo_material"}],staticClass:"readonly-input",attrs:{type:"text",readonly:""},domProps:{value:a.novaReclamacao.codigo_material},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"codigo_material",t.target.value)}}})])]),t("div",{staticClass:"form-group"},[t("label",[a._v("Marca e Modelo:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.marca_modelo,expression:"novaReclamacao.marca_modelo"}],attrs:{type:"text",placeholder:"Informe a marca e modelo espec√≠ficos (se necess√°rio)"},domProps:{value:a.novaReclamacao.marca_modelo},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"marca_modelo",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("‚≠ê Avalia√ß√£o da Qualidade (obrigat√≥rio):")]),t("div",{staticClass:"star-rating"},a._l(5,(function(e){return t("span",{key:e,staticClass:"star",class:{active:(a.novaReclamacao.rating||0)>=e},attrs:{title:`${e} estrela${e>1?"s":""}`},on:{click:function(t){a.novaReclamacao.rating=e}}},[a._v(" ‚≠ê ")])})),0),a.novaReclamacao.rating?t("small",{staticClass:"rating-info"},[a._v(" Avalia√ß√£o: "+a._s(a.novaReclamacao.rating)+"/5 estrelas ")]):t("small",{staticClass:"error-text"},[a._v(" ‚ö†Ô∏è Por favor, d√™ uma avalia√ß√£o de 1 a 5 estrelas ")])])]):a._e()]),t("div",{staticClass:"form-section"},[t("h3",[a._v("üí¨ Coment√°rios e Observa√ß√µes")]),t("div",{staticClass:"form-group"},[t("label",[a._v("Observa√ß√µes sobre o Material:")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.comentario,expression:"novaReclamacao.comentario"}],attrs:{rows:"3",placeholder:"Como est√° sendo a experi√™ncia com este material? Qualidade, durabilidade, efic√°cia..."},domProps:{value:a.novaReclamacao.comentario},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"comentario",t.target.value)}}})])]),t("div",{staticClass:"form-section"},[t("h3",[a._v("üö® Problemas e Reclama√ß√µes (opcional)")]),t("div",{staticClass:"form-group"},[t("label",[a._v("Descri√ß√£o de Problemas:")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.registro_reclamacao,expression:"novaReclamacao.registro_reclamacao"}],attrs:{rows:"4",placeholder:"Se houver problemas, defeitos ou situa√ß√µes negativas, descreva detalhadamente aqui... (opcional)"},domProps:{value:a.novaReclamacao.registro_reclamacao},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"registro_reclamacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Sugest√µes de Melhoria:")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.novaReclamacao.sugestoes,expression:"novaReclamacao.sugestoes"}],attrs:{rows:"3",placeholder:"Sugest√µes para melhorias ou solu√ß√µes... (opcional)"},domProps:{value:a.novaReclamacao.sugestoes},on:{input:function(t){t.target.composing||a.$set(a.novaReclamacao,"sugestoes",t.target.value)}}})])]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.limparAvaliacao}},[a._v(" üóëÔ∏è Limpar ")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.enviandoReclamacao||!a.novaReclamacao.rating}},[a.enviandoReclamacao?t("span",[a._v("‚è≥ Enviando...")]):t("span",[a._v("‚≠ê Enviar Avalia√ß√£o")])])])])])]):a._e(),"historico"===a.activeTab?t("div",{staticClass:"tab-content"},[a._m(2),t("div",{staticClass:"historico-container"},[t("div",{staticClass:"filters-card"},[t("div",{staticClass:"filters-row"},[t("div",{staticClass:"filter-group"},[t("label",[a._v("üîç Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.busca,expression:"filtros.busca"}],attrs:{type:"text",placeholder:"Material, c√≥digo..."},domProps:{value:a.filtros.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtros,"busca",t.target.value)},a.aplicarFiltros]}})]),t("div",{staticClass:"filter-group"},[t("label",[a._v("‚≠ê Avalia√ß√£o:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtros.rating,expression:"filtros.rating"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtros,"rating",t.target.multiple?e:e[0])},a.aplicarFiltros]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),t("option",{attrs:{value:"5"}},[a._v("‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 estrelas)")]),t("option",{attrs:{value:"4"}},[a._v("‚≠ê‚≠ê‚≠ê‚≠ê (4 estrelas)")]),t("option",{attrs:{value:"3"}},[a._v("‚≠ê‚≠ê‚≠ê (3 estrelas)")]),t("option",{attrs:{value:"2"}},[a._v("‚≠ê‚≠ê (2 estrelas)")]),t("option",{attrs:{value:"1"}},[a._v("‚≠ê (1 estrela)")])])]),t("div",{staticClass:"filter-group"},[t("label",[a._v("üìÖ Per√≠odo:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtros.periodo,expression:"filtros.periodo"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtros,"periodo",t.target.multiple?e:e[0])},a.aplicarFiltros]}},[t("option",{attrs:{value:""}},[a._v("Todos")]),t("option",{attrs:{value:"hoje"}},[a._v("Hoje")]),t("option",{attrs:{value:"semana"}},[a._v("Esta Semana")]),t("option",{attrs:{value:"mes"}},[a._v("Este M√™s")]),t("option",{attrs:{value:"trimestre"}},[a._v("√öltimo Trimestre")])])])])]),t("div",{staticClass:"feedbacks-list"},[a.carregandoHistorico?t("div",{staticClass:"loading-card"},[a._v(" ‚è≥ Carregando hist√≥rico... ")]):0===a.historicoFeedbacks.length?t("div",{staticClass:"empty-state-card"},[t("div",{staticClass:"empty-icon"},[a._v("üì≠")]),t("h3",[a._v("Nenhuma avalia√ß√£o encontrada")]),t("p",[a._v("Voc√™ ainda n√£o enviou nenhuma avalia√ß√£o de material.")]),t("button",{staticClass:"btn-primary",on:{click:function(t){a.activeTab="avaliacao"}}},[a._v(" ‚≠ê Fazer Primeira Avalia√ß√£o ")])]):t("div",{staticClass:"feedbacks-grid"},a._l(a.historicoFeedbacks,(function(e){return t("div",{key:e.id,staticClass:"feedback-card-history"},[t("div",{staticClass:"feedback-header"},[t("h4",[a._v(a._s(e.material_nome))]),t("div",{staticClass:"rating-display"},a._l(5,(function(o){return t("span",{key:o,staticClass:"star",class:{active:e.rating>=o}},[a._v("‚≠ê")])})),0)]),t("div",{staticClass:"feedback-content"},[t("p",{staticClass:"feedback-details"},[t("strong",[a._v("C√≥digo:")]),a._v(" "+a._s(e.material_codigo)),t("br"),t("strong",[a._v("Avalia√ß√£o:")]),a._v(" "+a._s(e.rating)+"/5 estrelas ")]),e.comentario?t("p",{staticClass:"feedback-comentario"},[t("strong",[a._v("Coment√°rio:")]),a._v(" "+a._s(e.comentario)+" ")]):a._e()]),t("div",{staticClass:"feedback-footer"},[t("span",{staticClass:"feedback-date"},[a._v("üìÖ "+a._s(a.formatDate(e.criado_em)))])])])})),0)])])]):a._e(),"materiais"===a.activeTab?t("div",{staticClass:"tab-content"},[a._m(3),t("div",{staticClass:"materiais-container"},[0===a.usuarioAtual.materiais?.length?t("div",{staticClass:"empty-state-card"},[t("div",{staticClass:"empty-icon"},[a._v("üì¶")]),t("h3",[a._v("Nenhum material cadastrado")]),t("p",[a._v("Voc√™ ainda n√£o possui materiais sob sua responsabilidade.")]),t("p",[a._v("Entre em contato com a CPM para solicitar acesso aos materiais do seu setor.")])]):t("div",{staticClass:"materiais-grid"},a._l(a.usuarioAtual.materiais,(function(e){return t("div",{key:e.produto_id,staticClass:"material-card"},[t("div",{staticClass:"material-header"},[t("h4",[a._v(a._s(e.nome))]),t("span",{staticClass:"material-code"},[a._v(a._s(e.codigo))])]),t("div",{staticClass:"material-info"},[t("p",[t("strong",[a._v("Periodicidade de Avalia√ß√£o:")]),a._v(" "+a._s(e.periodicidade_rdm))]),t("p",[t("strong",[a._v("Pr√≥xima Avalia√ß√£o:")]),a._v(" "+a._s(a.calcularProximaAvaliacao(e)))])]),t("div",{staticClass:"material-actions"},[t("button",{staticClass:"btn-avaliar",on:{click:function(t){a.activeTab="avaliacao"}}},[a._v(" ‚≠ê Avaliar Material ")])])])})),0)])]):a._e(),"perfil"===a.activeTab?t("div",{staticClass:"tab-content"},[a._m(4),t("div",{staticClass:"perfil-container"},[t("div",{staticClass:"perfil-cards"},[t("div",{staticClass:"perfil-card"},[t("h3",[a._v("üë§ Dados Pessoais")]),t("div",{staticClass:"perfil-info"},[t("p",[t("strong",[a._v("Nome:")]),a._v(" "+a._s(a.usuarioAtual.nome_usuario))]),t("p",[t("strong",[a._v("Email:")]),a._v(" "+a._s(a.usuarioAtual.email))]),t("p",[t("strong",[a._v("Unidade/Setor:")]),a._v(" "+a._s(a.usuarioAtual.unidade_setor))]),t("p",[t("strong",[a._v("Coordenador:")]),a._v(" "+a._s(a.usuarioAtual.nome_coordenador))])])]),t("div",{staticClass:"perfil-card"},[t("h3",[a._v("üìä Estat√≠sticas")]),t("div",{staticClass:"stats-grid"},[t("div",{staticClass:"stat-item"},[t("span",{staticClass:"stat-number"},[a._v(a._s(a.totalFeedbacks))]),t("span",{staticClass:"stat-label"},[a._v("Avalia√ß√µes Enviadas")])]),t("div",{staticClass:"stat-item"},[t("span",{staticClass:"stat-number"},[a._v(a._s(a.feedbacksRecentes))]),t("span",{staticClass:"stat-label"},[a._v("√öltimos 30 dias")])]),t("div",{staticClass:"stat-item"},[t("span",{staticClass:"stat-number"},[a._v(a._s(a.usuarioAtual.materiais?.length||0))]),t("span",{staticClass:"stat-label"},[a._v("Materiais Sob Responsabilidade")])])])]),t("div",{staticClass:"perfil-card"},[t("h3",[a._v("üîí Alterar Senha")]),t("form",{staticClass:"senha-form",on:{submit:function(t){return t.preventDefault(),a.alterarSenha.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",[a._v("Senha Atual:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.alteracaoSenha.senhaAtual,expression:"alteracaoSenha.senhaAtual"}],attrs:{type:"password",required:""},domProps:{value:a.alteracaoSenha.senhaAtual},on:{input:function(t){t.target.composing||a.$set(a.alteracaoSenha,"senhaAtual",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Nova Senha:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.alteracaoSenha.novaSenha,expression:"alteracaoSenha.novaSenha"}],attrs:{type:"password",required:""},domProps:{value:a.alteracaoSenha.novaSenha},on:{input:function(t){t.target.composing||a.$set(a.alteracaoSenha,"novaSenha",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Confirmar Nova Senha:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.alteracaoSenha.confirmaSenha,expression:"alteracaoSenha.confirmaSenha"}],attrs:{type:"password",required:""},domProps:{value:a.alteracaoSenha.confirmaSenha},on:{input:function(t){t.target.composing||a.$set(a.alteracaoSenha,"confirmaSenha",t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.alterandoSenha}},[a.alterandoSenha?t("span",[a._v("‚è≥ Alterando...")]):t("span",[a._v("üîí Alterar Senha")])])])])])])]):a._e()])])])},ce=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo-section"},[t("h1",[a._v("üè• Sistema Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Dashboard RDM")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"page-header"},[t("h2",[a._v("‚≠ê Avalia√ß√£o de Materiais")]),t("p",[a._v("Avalie a qualidade dos materiais e registre problemas ou sugest√µes")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"page-header"},[t("h2",[a._v("üìã Hist√≥rico de Avalia√ß√µes")]),t("p",[a._v("Veja suas avalia√ß√µes e feedbacks anteriores")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"page-header"},[t("h2",[a._v("üì¶ Meus Materiais")]),t("p",[a._v("Materiais sob sua responsabilidade para avalia√ß√£o")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"page-header"},[t("h2",[a._v("‚öôÔ∏è Meu Perfil")]),t("p",[a._v("Informa√ß√µes da sua conta e configura√ß√µes")])])}];const de={name:"DashboardRDM",data(){return{activeTab:"avaliacao",usuarioAtual:{},novaReclamacao:{nome_reclamante:"",telefone:"",email:"",unidade_setor:"",nome_material:"",codigo_material:"",marca_modelo:"",rating:0,comentario:"",registro_reclamacao:"",sugestoes:""},materialSelecionadoReclamacao:null,enviandoReclamacao:!1,historicoFeedbacks:[],carregandoHistorico:!1,filtros:{busca:"",rating:"",periodo:""},alteracaoSenha:{senhaAtual:"",novaSenha:"",confirmaSenha:""},alterandoSenha:!1}},computed:{totalFeedbacks(){return this.historicoFeedbacks.length},feedbacksRecentes(){return this.historicoFeedbacks.filter((a=>{const t=new Date;return t.setMonth(t.getMonth()-1),new Date(a.criado_em)>=t})).length}},async mounted(){await this.carregarDadosUsuario(),await this.carregarHistoricoFeedbacks(),this.inicializarReclamacao()},watch:{activeTab(a){"historico"===a&&this.carregarHistoricoFeedbacks()}},methods:{async carregarDadosUsuario(){try{const a=localStorage.getItem("usuarioRDM");if(!a)throw new Error("Dados do usu√°rio n√£o encontrados");if(this.usuarioAtual=JSON.parse(a),!this.usuarioAtual.id||!this.usuarioAtual.tenant_id)throw new Error("Dados do usu√°rio incompletos");console.log("‚úÖ Dados do usu√°rio carregados:",{nome:this.usuarioAtual.nome_usuario,id:this.usuarioAtual.id,tenant_id:this.usuarioAtual.tenant_id,materiais:this.usuarioAtual.materiais?.length||0})}catch(a){console.error("‚ùå Erro ao carregar dados do usu√°rio:",a),alert("Erro ao carregar dados do usu√°rio. Por favor, fa√ßa login novamente."),this.$router.push("/rdm")}},inicializarReclamacao(){this.novaReclamacao.nome_reclamante=this.usuarioAtual.nome_usuario||"",this.novaReclamacao.email=this.usuarioAtual.email||"",this.novaReclamacao.unidade_setor=this.usuarioAtual.unidade_setor||"",this.novaReclamacao.rating=0,this.novaReclamacao.comentario=""},async carregarHistoricoFeedbacks(){this.carregandoHistorico=!0;try{if(!this.usuarioAtual.id||!this.usuarioAtual.tenant_id)throw new Error("Dados do usu√°rio incompletos");const{data:a,error:t}=await M.ND.from("material_feedbacks").select("*").eq("usuario_rdm_id",this.usuarioAtual.id).eq("tenant_id",this.usuarioAtual.tenant_id).order("criado_em",{ascending:!1});if(t)throw t;this.historicoFeedbacks=a||[],this.aplicarFiltros()}catch(a){console.error("‚ùå [HIST√ìRICO] Erro:",a),this.historicoFeedbacks=[],alert("Erro ao carregar hist√≥rico: "+a.message)}finally{this.carregandoHistorico=!1}},aplicarFiltros(){if(!this.historicoFeedbacks)return;let a=[...this.historicoFeedbacks];if(this.filtros.busca){const t=this.filtros.busca.toLowerCase();a=a.filter((a=>a.material_nome?.toLowerCase().includes(t)||a.material_codigo?.toLowerCase().includes(t)))}if(this.filtros.rating&&(a=a.filter((a=>a.rating==this.filtros.rating))),this.filtros.periodo){const t=new Date;a=a.filter((a=>{const e=new Date(a.criado_em);switch(this.filtros.periodo){case"hoje":return e.toDateString()===t.toDateString();case"semana":const a=new Date(t.getTime()-6048e5);return e>=a;case"mes":return e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear();case"trimestre":const o=new Date(t.getTime()-7776e6);return e>=o;default:return!0}}))}},calcularProximaAvaliacao(a){const t=new Date,e=a.periodicidade_rdm||"MENSAL";switch(e.toUpperCase()){case"SEMANAL":t.setDate(t.getDate()+7);break;case"QUINZENAL":t.setDate(t.getDate()+15);break;case"MENSAL":t.setMonth(t.getMonth()+1);break;case"TRIMESTRAL":t.setMonth(t.getMonth()+3);break;case"SEMESTRAL":t.setMonth(t.getMonth()+6);break;case"ANUAL":t.setFullYear(t.getFullYear()+1);break;default:t.setMonth(t.getMonth()+1)}return t.toLocaleDateString("pt-BR")},async enviarReclamacao(){if(!this.enviandoReclamacao){this.enviandoReclamacao=!0;try{if(console.log("üì§ [RECLAMA√á√ÉO] Enviando reclama√ß√£o..."),!this.usuarioAtual.id||!this.usuarioAtual.tenant_id)throw new Error("Dados do usu√°rio incompletos");if(!this.materialSelecionadoReclamacao)throw new Error("Nenhum material selecionado");const a={id:crypto.randomUUID(),tenant_id:this.usuarioAtual.tenant_id,usuario_rdm_id:this.usuarioAtual.id,produto_id:this.materialSelecionadoReclamacao.produto_id,material_nome:this.novaReclamacao.nome_material,material_codigo:this.novaReclamacao.codigo_material,rating:this.novaReclamacao.rating,comentario:this.novaReclamacao.comentario||"",criado_em:(new Date).toISOString()};console.log("üíæ [AVALIA√á√ÉO] Dados preparados:",a);const{error:t}=await M.ND.from("material_feedbacks").insert([a]);if(t)throw console.error("‚ùå [AVALIA√á√ÉO] Erro ao salvar feedback:",t),new Error(t.message);if(console.log("‚úÖ [AVALIA√á√ÉO] Feedback salvo com sucesso!"),this.novaReclamacao.registro_reclamacao?.trim()){const a={id:crypto.randomUUID(),tenant_id:this.usuarioAtual.tenant_id,usuario_rdm_id:this.usuarioAtual.id,nome_reclamante:this.novaReclamacao.nome_reclamante,telefone:this.novaReclamacao.telefone,email:this.novaReclamacao.email,unidade_setor:this.novaReclamacao.unidade_setor,nome_material:this.novaReclamacao.nome_material,codigo_material:this.novaReclamacao.codigo_material,marca_modelo:this.novaReclamacao.marca_modelo,registro_reclamacao:this.novaReclamacao.registro_reclamacao,sugestoes:this.novaReclamacao.sugestoes||"",status:"ABERTA",data_reclamacao:(new Date).toISOString()},{error:t}=await M.ND.from("reclamacoes_usuarios").insert([a]);if(t)throw console.error("‚ùå [RECLAMA√á√ÉO] Erro ao salvar reclama√ß√£o:",t),new Error(t.message)}await this.carregarHistoricoFeedbacks(),alert("‚úÖ Avalia√ß√£o enviada com sucesso!"),this.limparAvaliacao()}catch(a){console.error("‚ùå [RECLAMA√á√ÉO] Erro ao enviar:",a),alert("Erro ao enviar: "+a.message)}finally{this.enviandoReclamacao=!1}}},preencherDadosMaterial(){this.materialSelecionadoReclamacao&&(this.novaReclamacao.nome_material=this.materialSelecionadoReclamacao.nome,this.novaReclamacao.codigo_material=this.materialSelecionadoReclamacao.codigo,this.novaReclamacao.marca_modelo="",console.log("üì¶ [RECLAMA√á√ÉO] Material selecionado:",this.materialSelecionadoReclamacao.nome))},limparAvaliacao(){this.novaReclamacao={nome_reclamante:this.usuarioAtual.nome_usuario||"",telefone:"",email:this.usuarioAtual.email||"",unidade_setor:this.usuarioAtual.unidade_setor||"",nome_material:"",codigo_material:"",marca_modelo:"",rating:0,comentario:"",registro_reclamacao:"",sugestoes:""},this.materialSelecionadoReclamacao=null},formatDate(a){return new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},async alterarSenha(){if(this.alteracaoSenha.novaSenha===this.alteracaoSenha.confirmaSenha){this.alterandoSenha=!0;try{alert("üéâ Senha alterada com sucesso!"),this.alteracaoSenha={senhaAtual:"",novaSenha:"",confirmaSenha:""}}catch(a){console.error("‚ùå Erro ao alterar senha:",a),alert("‚ùå Erro ao alterar senha: "+a.message)}finally{this.alterandoSenha=!1}}else alert("‚ùå As senhas n√£o coincidem!")},async logout(){confirm("Tem certeza que deseja sair?")&&(localStorage.removeItem("usuarioRDM"),this.$router.push("/rdm"))}}},ue=de;var me=(0,C.A)(ue,le,ce,!1,null,"c149abe6",null);const pe=me.exports;var ve=function(){var a=this,t=a._self._c;return t("div",{staticClass:"pesquisa-tecnica-view"},[t("PesquisaBot")],1)},ge=[];const he={name:"PesquisaTecnica",components:{PesquisaBot:ta}},fe=he;var _e=(0,C.A)(fe,ve,ge,!1,null,"923bc138",null);const Ce=_e.exports;o.Ay.use(x.Ay);const be=[{path:"/",name:"Home",component:z,meta:{requiresAuth:!1}},{path:"/dashboard",name:"Dashboard",component:ca,meta:{requiresAuth:!0}},{path:"/ccl",name:"CCL",component:Mt,meta:{requiresAuth:!0}},{path:"/cadastro",name:"Cadastro",component:Ea,meta:{requiresAuth:!0}},{path:"/analise/:id",name:"Analise",component:ka,meta:{requiresAuth:!0}},{path:"/catalogo",name:"Catalogo",component:Ya,meta:{requiresAuth:!0}},{path:"/feedback",name:"Feedback",component:rt,meta:{requiresAuth:!0}},{path:"/dcb",name:"DCB",component:Ct,meta:{requiresAuth:!0}},{path:"/classificacao",name:"Classificacao",component:te,meta:{requiresAuth:!0}},{path:"/produtos/:id",name:"DetalheProduto",component:()=>e.e(961).then(e.bind(e,9961)),props:!0,meta:{requiresAuth:!0}},{path:"/validar-dcb/:numero/:ano",name:"ValidarDCB",component:()=>e.e(796).then(e.bind(e,1796)),props:!0,meta:{requiresAuth:!1}},{path:"/rdm",name:"LoginRDM",component:ne,meta:{requiresAuth:!1}},{path:"/dashboard-rdm",name:"DashboardRDM",component:pe,meta:{requiresAuth:!1}},{path:"/pesquisa-tecnica",name:"PesquisaTecnica",component:Ce,meta:{requiresAuth:!0}}],De=new x.Ay({mode:"hash",base:"/ComprarBem/",routes:be});De.beforeEach((async(a,t,e)=>{const o=a.matched.some((a=>a.meta.requiresAuth));if(o)try{const{data:a}=await M.ND.auth.getSession(),t=a?.session?.user;o&&!t?e("/"):e()}catch(i){console.error("Erro na verifica√ß√£o de autentica√ß√£o:",i),o?e("/"):e()}else e()}));const we=De;var Ee=e(3518);o.Ay.use(Ee.Ay);const Ae=new Ee.Ay.Store({state:{user:null,tenant:null,isLoading:!1},mutations:{SET_USER(a,t){a.user=t},SET_TENANT(a,t){a.tenant=t},SET_LOADING(a,t){a.isLoading=t}},actions:{async fetchUser({commit:a}){const{data:t}=await M.ND.auth.getSession(),e=t?.session?.user;if(a("SET_USER",e),e){const{data:t,error:o}=await M.ND.from("tenants").select("*").eq("id",e.user_metadata?.tenant_id).single();!o&&t&&a("SET_TENANT",t)}},setLoading({commit:a},t){a("SET_LOADING",t)}},getters:{isAuthenticated:a=>!!a.user,currentUser:a=>a.user,currentTenant:a=>a.tenant,isLoading:a=>a.isLoading}});var ye=e(5329),xe=e(5170),Pe=e.n(xe);o.Ay.config.productionTip=!1,o.Ay.use(ye.A),o.Ay.use(Pe()),new o.Ay({router:we,store:Ae,render:a=>a(y)}).$mount("#app")}},t={};function e(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return a[o].call(s.exports,s,s.exports,e),s.exports}e.m=a,(()=>{var a=[];e.O=(t,o,i,s)=>{if(!o){var r=1/0;for(d=0;d<a.length;d++){for(var[o,i,s]=a[d],n=!0,l=0;l<o.length;l++)(!1&s||r>=s)&&Object.keys(e.O).every((a=>e.O[a](o[l])))?o.splice(l--,1):(n=!1,s<r&&(r=s));if(n){a.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=a.length;d>0&&a[d-1][2]>s;d--)a[d]=a[d-1];a[d]=[o,i,s]}})(),(()=>{e.n=a=>{var t=a&&a.__esModule?()=>a["default"]:()=>a;return e.d(t,{a:t}),t}})(),(()=>{var a,t=Object.getPrototypeOf?a=>Object.getPrototypeOf(a):a=>a.__proto__;e.t=function(o,i){if(1&i&&(o=this(o)),8&i)return o;if("object"===typeof o&&o){if(4&i&&o.__esModule)return o;if(16&i&&"function"===typeof o.then)return o}var s=Object.create(null);e.r(s);var r={};a=a||[null,t({}),t([]),t(t)];for(var n=2&i&&o;"object"==typeof n&&!~a.indexOf(n);n=t(n))Object.getOwnPropertyNames(n).forEach((a=>r[a]=()=>o[a]));return r["default"]=()=>o,e.d(s,r),s}})(),(()=>{e.d=(a,t)=>{for(var o in t)e.o(t,o)&&!e.o(a,o)&&Object.defineProperty(a,o,{enumerable:!0,get:t[o]})}})(),(()=>{e.f={},e.e=a=>Promise.all(Object.keys(e.f).reduce(((t,o)=>(e.f[o](a,t),t)),[]))})(),(()=>{e.u=a=>"js/"+a+"."+{125:"68e8c682",130:"c618e48a",208:"cf96592d",353:"7ac320c4",420:"79143310",796:"65b50ff6",828:"e23f50db",961:"15efbacc",967:"4f017123"}[a]+".js"})(),(()=>{e.miniCssF=a=>"css/"+a+"."+{796:"71a35ed3",961:"401b363e"}[a]+".css"})(),(()=>{e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"===typeof window)return window}}()})(),(()=>{e.o=(a,t)=>Object.prototype.hasOwnProperty.call(a,t)})(),(()=>{var a={},t="comprar-bem:";e.l=(o,i,s,r)=>{if(a[o])a[o].push(i);else{var n,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==o||u.getAttribute("data-webpack")==t+s){n=u;break}}n||(l=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,e.nc&&n.setAttribute("nonce",e.nc),n.setAttribute("data-webpack",t+s),n.src=o),a[o]=[i];var m=(t,e)=>{n.onerror=n.onload=null,clearTimeout(p);var i=a[o];if(delete a[o],n.parentNode&&n.parentNode.removeChild(n),i&&i.forEach((a=>a(e))),t)return t(e)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=m.bind(null,n.onerror),n.onload=m.bind(null,n.onload),l&&document.head.appendChild(n)}}})(),(()=>{e.r=a=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})}})(),(()=>{e.p="/ComprarBem/"})(),(()=>{if("undefined"!==typeof document){var a=(a,t,o,i,s)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",e.nc&&(r.nonce=e.nc);var n=e=>{if(r.onerror=r.onload=null,"load"===e.type)i();else{var o=e&&e.type,n=e&&e.target&&e.target.href||t,l=new Error("Loading CSS chunk "+a+" failed.\n("+o+": "+n+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=o,l.request=n,r.parentNode&&r.parentNode.removeChild(r),s(l)}};return r.onerror=r.onload=n,r.href=t,o?o.parentNode.insertBefore(r,o.nextSibling):document.head.appendChild(r),r},t=(a,t)=>{for(var e=document.getElementsByTagName("link"),o=0;o<e.length;o++){var i=e[o],s=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(s===a||s===t))return i}var r=document.getElementsByTagName("style");for(o=0;o<r.length;o++){i=r[o],s=i.getAttribute("data-href");if(s===a||s===t)return i}},o=o=>new Promise(((i,s)=>{var r=e.miniCssF(o),n=e.p+r;if(t(r,n))return i();a(o,n,null,i,s)})),i={524:0};e.f.miniCss=(a,t)=>{var e={796:1,961:1};i[a]?t.push(i[a]):0!==i[a]&&e[a]&&t.push(i[a]=o(a).then((()=>{i[a]=0}),(t=>{throw delete i[a],t})))}}})(),(()=>{var a={524:0};e.f.j=(t,o)=>{var i=e.o(a,t)?a[t]:void 0;if(0!==i)if(i)o.push(i[2]);else{var s=new Promise(((e,o)=>i=a[t]=[e,o]));o.push(i[2]=s);var r=e.p+e.u(t),n=new Error,l=o=>{if(e.o(a,t)&&(i=a[t],0!==i&&(a[t]=void 0),i)){var s=o&&("load"===o.type?"missing":o.type),r=o&&o.target&&o.target.src;n.message="Loading chunk "+t+" failed.\n("+s+": "+r+")",n.name="ChunkLoadError",n.type=s,n.request=r,i[1](n)}};e.l(r,l,"chunk-"+t,t)}},e.O.j=t=>0===a[t];var t=(t,o)=>{var i,s,[r,n,l]=o,c=0;if(r.some((t=>0!==a[t]))){for(i in n)e.o(n,i)&&(e.m[i]=n[i]);if(l)var d=l(e)}for(t&&t(o);c<r.length;c++)s=r[c],e.o(a,s)&&a[s]&&a[s][0](),a[s]=0;return e.O(d)},o=self["webpackChunkcomprar_bem"]=self["webpackChunkcomprar_bem"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=e.O(void 0,[504],(()=>e(6532)));o=e.O(o)})();
//# sourceMappingURL=app.560929f2.js.map