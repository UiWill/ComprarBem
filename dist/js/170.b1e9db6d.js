"use strict";(self["webpackChunkcomprar_bem"]=self["webpackChunkcomprar_bem"]||[]).push([[170],{6170:(a,o,s)=>{s.r(o),s.d(o,{default:()=>v});var e=function(){var a=this,o=a._self._c;return o("div",{staticClass:"registro-container"},[a._m(0),a.registroCompleto?a._e():o("div",{staticClass:"progress-indicator"},[o("div",{staticClass:"step",class:{active:1===a.etapaAtual}},[o("div",{staticClass:"step-number"},[a._v("1")]),o("div",{staticClass:"step-label"},[a._v("Dados do √ìrg√£o")])]),o("div",{staticClass:"step",class:{active:2===a.etapaAtual}},[o("div",{staticClass:"step-number"},[a._v("2")]),o("div",{staticClass:"step-label"},[a._v("Usu√°rios e Acessos")])]),o("div",{staticClass:"step",class:{active:3===a.etapaAtual}},[o("div",{staticClass:"step-number"},[a._v("3")]),o("div",{staticClass:"step-label"},[a._v("Confirma√ß√£o")])])]),1===a.etapaAtual?o("div",{staticClass:"etapa-container"},[o("div",{staticClass:"card"},[o("h2",[a._v("üìã Informa√ß√µes do √ìrg√£o")]),o("div",{staticClass:"form-group"},[o("label",[a._v("Nome do √ìrg√£o *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.nome_orgao,expression:"dadosOrgao.nome_orgao"}],attrs:{type:"text",placeholder:"Ex: Prefeitura Municipal de Nova Lima",required:""},domProps:{value:a.dadosOrgao.nome_orgao},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"nome_orgao",o.target.value)}}})]),o("div",{staticClass:"form-row"},[o("div",{staticClass:"form-group"},[o("label",[a._v("Tipo de √ìrg√£o *")]),o("select",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.tipo_orgao,expression:"dadosOrgao.tipo_orgao"}],attrs:{required:""},on:{change:function(o){var s=Array.prototype.filter.call(o.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));a.$set(a.dadosOrgao,"tipo_orgao",o.target.multiple?s:s[0])}}},[o("option",{attrs:{value:"municipal"}},[a._v("Municipal")]),o("option",{attrs:{value:"estadual"}},[a._v("Estadual")]),o("option",{attrs:{value:"federal"}},[a._v("Federal")]),o("option",{attrs:{value:"publico"}},[a._v("Outros √ìrg√£os P√∫blicos")])])]),o("div",{staticClass:"form-group"},[o("label",[a._v("CNPJ")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.cnpj,expression:"dadosOrgao.cnpj"}],attrs:{type:"text",placeholder:"00.000.000/0000-00"},domProps:{value:a.dadosOrgao.cnpj},on:{input:[function(o){o.target.composing||a.$set(a.dadosOrgao,"cnpj",o.target.value)},a.formatarCNPJ]}})])]),o("div",{staticClass:"form-group"},[o("label",[a._v("Endere√ßo")]),o("textarea",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.endereco,expression:"dadosOrgao.endereco"}],attrs:{rows:"2",placeholder:"Endere√ßo completo do √≥rg√£o..."},domProps:{value:a.dadosOrgao.endereco},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"endereco",o.target.value)}}})]),o("div",{staticClass:"form-row"},[o("div",{staticClass:"form-group"},[o("label",[a._v("Telefone")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.telefone,expression:"dadosOrgao.telefone"}],attrs:{type:"tel",placeholder:"(31) 9999-9999"},domProps:{value:a.dadosOrgao.telefone},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"telefone",o.target.value)}}})]),o("div",{staticClass:"form-group"},[o("label",[a._v("Email de Contato")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.email_contato,expression:"dadosOrgao.email_contato"}],attrs:{type:"email",placeholder:"contato@orgao.gov.br"},domProps:{value:a.dadosOrgao.email_contato},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"email_contato",o.target.value)}}})])]),o("div",{staticClass:"form-actions"},[o("button",{staticClass:"btn-primary",attrs:{disabled:!a.dadosOrgaoValidos},on:{click:a.proximaEtapa}},[a._v(" Pr√≥ximo: Configurar Usu√°rios ‚Üí ")])])])]):a._e(),2===a.etapaAtual?o("div",{staticClass:"etapa-container"},[a._m(1),o("div",{staticClass:"card usuario-card cpm"},[a._m(2),o("div",{staticClass:"form-row"},[o("div",{staticClass:"form-group"},[o("label",[a._v("Email CPM *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.email_cpm,expression:"dadosOrgao.email_cpm"}],attrs:{type:"email",placeholder:"cpm@orgao.gov.br",required:""},domProps:{value:a.dadosOrgao.email_cpm},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"email_cpm",o.target.value)}}})]),o("div",{staticClass:"form-group"},[o("label",[a._v("Senha CPM *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.senha_cpm,expression:"dadosOrgao.senha_cpm"}],attrs:{type:"password",placeholder:"M√≠nimo 6 caracteres",required:""},domProps:{value:a.dadosOrgao.senha_cpm},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"senha_cpm",o.target.value)}}})])]),o("div",{staticClass:"form-group"},[o("label",[a._v("Nome do Respons√°vel")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.nome_responsavel_cpm,expression:"dadosOrgao.nome_responsavel_cpm"}],attrs:{type:"text",placeholder:"Nome do Presidente da CPM"},domProps:{value:a.dadosOrgao.nome_responsavel_cpm},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"nome_responsavel_cpm",o.target.value)}}})])]),o("div",{staticClass:"card usuario-card ccl"},[a._m(3),o("div",{staticClass:"form-row"},[o("div",{staticClass:"form-group"},[o("label",[a._v("Email CCL *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.email_ccl,expression:"dadosOrgao.email_ccl"}],attrs:{type:"email",placeholder:"ccl@orgao.gov.br",required:""},domProps:{value:a.dadosOrgao.email_ccl},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"email_ccl",o.target.value)}}})]),o("div",{staticClass:"form-group"},[o("label",[a._v("Senha CCL *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.senha_ccl,expression:"dadosOrgao.senha_ccl"}],attrs:{type:"password",placeholder:"M√≠nimo 6 caracteres",required:""},domProps:{value:a.dadosOrgao.senha_ccl},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"senha_ccl",o.target.value)}}})])]),o("div",{staticClass:"form-group"},[o("label",[a._v("Nome do Respons√°vel")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.nome_responsavel_ccl,expression:"dadosOrgao.nome_responsavel_ccl"}],attrs:{type:"text",placeholder:"Nome do Presidente da CCL"},domProps:{value:a.dadosOrgao.nome_responsavel_ccl},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"nome_responsavel_ccl",o.target.value)}}})])]),o("div",{staticClass:"card usuario-card admin"},[a._m(4),o("div",{staticClass:"form-row"},[o("div",{staticClass:"form-group"},[o("label",[a._v("Email Autoridade *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.email_orgao_admin,expression:"dadosOrgao.email_orgao_admin"}],attrs:{type:"email",placeholder:"autoridade@orgao.gov.br",required:""},domProps:{value:a.dadosOrgao.email_orgao_admin},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"email_orgao_admin",o.target.value)}}})]),o("div",{staticClass:"form-group"},[o("label",[a._v("Senha *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.senha_orgao_admin,expression:"dadosOrgao.senha_orgao_admin"}],attrs:{type:"password",placeholder:"M√≠nimo 6 caracteres",required:""},domProps:{value:a.dadosOrgao.senha_orgao_admin},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"senha_orgao_admin",o.target.value)}}})])]),o("div",{staticClass:"form-group"},[o("label",[a._v("Nome da Autoridade")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.nome_responsavel_admin,expression:"dadosOrgao.nome_responsavel_admin"}],attrs:{type:"text",placeholder:"Nome da Autoridade Competente"},domProps:{value:a.dadosOrgao.nome_responsavel_admin},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"nome_responsavel_admin",o.target.value)}}})])]),o("div",{staticClass:"card usuario-card juridico"},[a._m(5),o("div",{staticClass:"form-row"},[o("div",{staticClass:"form-group"},[o("label",[a._v("Email Assessoria *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.email_assessoria,expression:"dadosOrgao.email_assessoria"}],attrs:{type:"email",placeholder:"juridico@orgao.gov.br",required:""},domProps:{value:a.dadosOrgao.email_assessoria},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"email_assessoria",o.target.value)}}})]),o("div",{staticClass:"form-group"},[o("label",[a._v("Senha *")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.senha_assessoria,expression:"dadosOrgao.senha_assessoria"}],attrs:{type:"password",placeholder:"M√≠nimo 6 caracteres",required:""},domProps:{value:a.dadosOrgao.senha_assessoria},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"senha_assessoria",o.target.value)}}})])]),o("div",{staticClass:"form-group"},[o("label",[a._v("Nome do Respons√°vel")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.dadosOrgao.nome_responsavel_assessoria,expression:"dadosOrgao.nome_responsavel_assessoria"}],attrs:{type:"text",placeholder:"Nome do Assessor Jur√≠dico"},domProps:{value:a.dadosOrgao.nome_responsavel_assessoria},on:{input:function(o){o.target.composing||a.$set(a.dadosOrgao,"nome_responsavel_assessoria",o.target.value)}}})])]),o("div",{staticClass:"form-actions"},[o("button",{staticClass:"btn-secondary",on:{click:a.voltarEtapa}},[a._v(" ‚Üê Voltar ")]),o("button",{staticClass:"btn-primary",attrs:{disabled:!a.usuariosValidos},on:{click:a.proximaEtapa}},[a._v(" Revisar e Confirmar ‚Üí ")])])]):a._e(),3!==a.etapaAtual||a.registroCompleto?a._e():o("div",{staticClass:"etapa-container"},[o("div",{staticClass:"card"},[o("h2",[a._v("‚úÖ Revis√£o e Confirma√ß√£o")]),o("div",{staticClass:"revisao-secao"},[o("h3",[a._v("üèõÔ∏è Dados do √ìrg√£o")]),o("div",{staticClass:"revisao-item"},[o("strong",[a._v("Nome:")]),a._v(" "+a._s(a.dadosOrgao.nome_orgao)+" ")]),o("div",{staticClass:"revisao-item"},[o("strong",[a._v("Tipo:")]),a._v(" "+a._s(a.dadosOrgao.tipo_orgao)+" ")]),a.dadosOrgao.cnpj?o("div",{staticClass:"revisao-item"},[o("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.dadosOrgao.cnpj)+" ")]):a._e()]),o("div",{staticClass:"revisao-secao"},[o("h3",[a._v("üë• Usu√°rios que ser√£o criados")]),o("div",{staticClass:"usuarios-resumo"},[o("div",{staticClass:"usuario-resumo cpm"},[a._m(6),o("div",[a._v(a._s(a.dadosOrgao.email_cpm))]),o("small",[a._v("Acesso completo (exceto CCL)")])]),o("div",{staticClass:"usuario-resumo ccl"},[a._m(7),o("div",[a._v(a._s(a.dadosOrgao.email_ccl))]),o("small",[a._v("Apenas Painel CCL")])]),o("div",{staticClass:"usuario-resumo admin"},[a._m(8),o("div",[a._v(a._s(a.dadosOrgao.email_orgao_admin))]),o("small",[a._v("Assinaturas e homologa√ß√µes")])]),o("div",{staticClass:"usuario-resumo juridico"},[a._m(9),o("div",[a._v(a._s(a.dadosOrgao.email_assessoria))]),o("small",[a._v("An√°lise jur√≠dica")])])])]),a._m(10),o("div",{staticClass:"form-actions"},[o("button",{staticClass:"btn-secondary",attrs:{disabled:a.processando||a.registroCompleto},on:{click:a.voltarEtapa}},[a._v(" ‚Üê Voltar ")]),o("button",{staticClass:"btn-success",class:{processando:a.processando},attrs:{disabled:a.processando||a.registroCompleto},on:{click:a.confirmarRegistro}},[a.processando?o("span",[a._v("‚è≥ Registrando √ìrg√£o...")]):a.registroCompleto?o("span",[a._v("‚úÖ √ìrg√£o Criado")]):o("span",[a._v("üéâ Confirmar e Criar √ìrg√£o")])])])])]),a.registroCompleto?o("div",{staticClass:"resultado-container"},[o("div",{staticClass:"card resultado-card"},[o("div",{staticClass:"resultado-header"},[o("div",{staticClass:"resultado-icon success"},[a._v("üéâ")]),o("h1",[a._v("√ìrg√£o Registrado com Sucesso!")]),o("p",[a._v(a._s(a.dadosOrgao.nome_orgao)+" foi cadastrado no sistema.")])]),o("div",{staticClass:"credenciais-acesso"},[o("h3",[a._v("üîë Credenciais de Acesso")]),o("div",{staticClass:"credenciais-lista"},[o("div",{staticClass:"credencial-item cpm"},[a._m(11),o("div",{staticClass:"credencial-info"},[o("div",[o("strong",[a._v("Email:")]),a._v(" "+a._s(a.dadosOrgao.email_cpm))]),o("div",[o("strong",[a._v("Senha:")]),a._v(" "+a._s(a.dadosOrgao.senha_cpm))]),a._m(12)])]),o("div",{staticClass:"credencial-item ccl"},[a._m(13),o("div",{staticClass:"credencial-info"},[o("div",[o("strong",[a._v("Email:")]),a._v(" "+a._s(a.dadosOrgao.email_ccl))]),o("div",[o("strong",[a._v("Senha:")]),a._v(" "+a._s(a.dadosOrgao.senha_ccl))]),a._m(14)])]),o("div",{staticClass:"credencial-item admin"},[a._m(15),o("div",{staticClass:"credencial-info"},[o("div",[o("strong",[a._v("Email:")]),a._v(" "+a._s(a.dadosOrgao.email_orgao_admin))]),o("div",[o("strong",[a._v("Senha:")]),a._v(" "+a._s(a.dadosOrgao.senha_orgao_admin))]),a._m(16)])]),o("div",{staticClass:"credencial-item juridico"},[a._m(17),o("div",{staticClass:"credencial-info"},[o("div",[o("strong",[a._v("Email:")]),a._v(" "+a._s(a.dadosOrgao.email_assessoria))]),o("div",[o("strong",[a._v("Senha:")]),a._v(" "+a._s(a.dadosOrgao.senha_assessoria))]),a._m(18)])])])]),a._m(19),o("div",{staticClass:"form-actions"},[o("button",{staticClass:"btn-secondary",on:{click:a.novoRegistro}},[a._v(" Registrar Outro √ìrg√£o ")]),o("router-link",{staticClass:"btn-primary",attrs:{to:"/"}},[a._v(" Ir para o Sistema ")])],1)])]):a._e(),a.erro?o("div",{staticClass:"erro-container"},[o("div",{staticClass:"card erro-card"},[o("div",{staticClass:"erro-header"},[o("div",{staticClass:"erro-icon"},[a._v("‚ùå")]),o("h2",[a._v("Erro no Registro")]),o("p",[a._v(a._s(a.erro))])]),o("div",{staticClass:"form-actions"},[o("button",{staticClass:"btn-primary",on:{click:function(o){a.erro=null}}},[a._v(" Tentar Novamente ")])])])]):a._e()])},r=[function(){var a=this,o=a._self._c;return o("div",{staticClass:"registro-header"},[o("h1",[a._v("üèõÔ∏è Cadastro de √ìrg√£o P√∫blico")]),o("p",{staticClass:"subtitle"},[a._v(" Cadastre o √≥rg√£o e crie os 4 perfis necess√°rios ao acesso pela Comiss√£o de Padroniza√ß√£o, Comiss√£o de Contrata√ß√£o, Assessoria Jur√≠dica e Autoridade Competente. ")])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"usuarios-info"},[o("h2",[a._v("üë• Configura√ß√£o de Usu√°rios")]),o("p",{staticClass:"info-text"},[a._v(" Ser√£o criados 4 usu√°rios com acessos espec√≠ficos para seu √≥rg√£o: ")])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"usuario-header"},[o("div",{staticClass:"usuario-icon"},[a._v("üîß")]),o("div",{staticClass:"usuario-info"},[o("h3",[a._v("CPM - Comiss√£o Permanente de Padroniza√ß√£o")]),o("p",[a._v("Acesso completo ao sistema (exceto Painel CCL)")])])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"usuario-header"},[o("div",{staticClass:"usuario-icon"},[a._v("‚öñÔ∏è")]),o("div",{staticClass:"usuario-info"},[o("h3",[a._v("CCL - Comiss√£o de Contrata√ß√£o e Licita√ß√£o")]),o("p",[a._v("Acesso exclusivo ao Painel CCL")])])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"usuario-header"},[o("div",{staticClass:"usuario-icon"},[a._v("üìã")]),o("div",{staticClass:"usuario-info"},[o("h3",[a._v("√ìrg√£o Administrativo")]),o("p",[a._v("Assinaturas digitais e homologa√ß√µes")])])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"usuario-header"},[o("div",{staticClass:"usuario-icon"},[a._v("‚öñÔ∏è")]),o("div",{staticClass:"usuario-info"},[o("h3",[a._v("Assessoria Jur√≠dica")]),o("p",[a._v("An√°lise de minutas e editais")])])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"usuario-resumo-header"},[o("span",{staticClass:"icon"},[a._v("üîß")]),o("strong",[a._v("CPM")])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"usuario-resumo-header"},[o("span",{staticClass:"icon"},[a._v("‚öñÔ∏è")]),o("strong",[a._v("CCL")])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"usuario-resumo-header"},[o("span",{staticClass:"icon"},[a._v("üìã")]),o("strong",[a._v("√ìrg√£o Administrativo")])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"usuario-resumo-header"},[o("span",{staticClass:"icon"},[a._v("‚öñÔ∏è")]),o("strong",[a._v("Assessoria Jur√≠dica")])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"alerta-importante"},[o("div",{staticClass:"alerta-icon"},[a._v("‚ö†Ô∏è")]),o("div",{staticClass:"alerta-conteudo"},[o("strong",[a._v("Importante:")]),o("ul",[o("li",[a._v("Todos os dados ser√£o salvos e n√£o poder√£o ser alterados")]),o("li",[a._v("Os emails de acesso ser√£o enviados para cada respons√°vel")]),o("li",[a._v("Cada usu√°rio ter√° acesso apenas √†s funcionalidades do seu perfil")]),o("li",[a._v("Anote as senhas em local seguro")])])])])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"credencial-header"},[o("span",{staticClass:"icon"},[a._v("üîß")]),o("strong",[a._v("CPM - Comiss√£o Permanente")])])},function(){var a=this,o=a._self._c;return o("div",[o("strong",[a._v("Acesso:")]),a._v(" Sistema completo (exceto CCL)")])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"credencial-header"},[o("span",{staticClass:"icon"},[a._v("‚öñÔ∏è")]),o("strong",[a._v("CCL - Comiss√£o de Contrata√ß√£o")])])},function(){var a=this,o=a._self._c;return o("div",[o("strong",[a._v("Acesso:")]),a._v(" Apenas Painel CCL")])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"credencial-header"},[o("span",{staticClass:"icon"},[a._v("üìã")]),o("strong",[a._v("√ìrg√£o Administrativo")])])},function(){var a=this,o=a._self._c;return o("div",[o("strong",[a._v("Acesso:")]),a._v(" Processos para assinatura")])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"credencial-header"},[o("span",{staticClass:"icon"},[a._v("‚öñÔ∏è")]),o("strong",[a._v("Assessoria Jur√≠dica")])])},function(){var a=this,o=a._self._c;return o("div",[o("strong",[a._v("Acesso:")]),a._v(" An√°lise jur√≠dica de processos")])},function(){var a=this,o=a._self._c;return o("div",{staticClass:"proximos-passos"},[o("h3",[a._v("üöÄ Pr√≥ximos Passos")]),o("ol",[o("li",[a._v("Distribua as credenciais para cada respons√°vel")]),o("li",[a._v("Oriente sobre o primeiro acesso ao sistema")]),o("li",[a._v("Configure os dados espec√≠ficos de cada m√≥dulo")]),o("li",[a._v("Inicie o cadastro de produtos e processos")])])])}],i=s(452),t=s(563);class n{static async registrarOrgaoCompleto(a){try{console.log("üöÄ INICIANDO REGISTRO DO √ìRG√ÉO:",a.nome_orgao),await this.limpezaPreventiva(a),await this.validarDadosOrgao(a);const o=await this.criarTenant(a);console.log("‚úÖ Tenant criado:",o.id);const s=await this.criarUsuariosOrgao(o.id,a);return console.log("‚úÖ Usu√°rios criados:",s.length),console.log("‚úÖ Perfis ser√£o configurados posteriormente (fun√ß√£o com erro de coluna)"),{sucesso:!0,tenant:o,usuarios:s,mensagem:`√ìrg√£o ${a.nome_orgao} registrado com sucesso!`}}catch(o){throw console.error("‚ùå ERRO NO REGISTRO DO √ìRG√ÉO:",o),new Error(`Falha no registro: ${o.message}`)}}static async limpezaPreventiva(a){try{console.log("üßπ LIMPEZA PREVENTIVA INICIADA");const s=[a.email_cpm,a.email_ccl,a.email_orgao_admin,a.email_assessoria];console.log("Emails para verificar/limpar:",s);for(const a of s)try{const{data:o}=await i.ND.from("usuarios").select("id, email, tenant_id").eq("email",a).maybeSingle();o&&(console.log(`üóëÔ∏è Removendo registro √≥rf√£o encontrado: ${a} (ID: ${o.id})`),await i.ND.from("usuarios").delete().eq("email",a),console.log(`‚úÖ Registro √≥rf√£o removido: ${a}`))}catch(o){console.warn(`Aviso na limpeza de ${a}:`,o.message)}console.log("‚úÖ LIMPEZA PREVENTIVA CONCLU√çDA")}catch(o){console.error("Erro na limpeza preventiva:",o)}}static async validarDadosOrgao(a){console.log("üîç INICIANDO VALIDA√á√ÉO DOS DADOS DO √ìRG√ÉO");const o=["nome_orgao","email_cpm","senha_cpm","email_ccl","senha_ccl","email_orgao_admin","senha_orgao_admin","email_assessoria","senha_assessoria"];console.log("Validando campos obrigat√≥rios...");for(const i of o)if(!a[i]||""===a[i].trim())throw new Error(`Campo obrigat√≥rio: ${i}`);const s=[a.email_cpm,a.email_ccl,a.email_orgao_admin,a.email_assessoria];console.log("Validando formato dos emails:",s);for(const i of s)if(!this.validarEmail(i))throw new Error(`Email inv√°lido: ${i}`);const e=new Set(s);if(e.size!==s.length)throw new Error("Todos os emails devem ser diferentes");console.log("‚úÖ Emails s√£o √∫nicos entre si"),console.log("üîç Verificando se emails j√° existem no sistema...");for(const i of s){console.log(`Verificando email: ${i}`);const a=await this.verificarEmailExiste(i);if(a)throw new Error(`‚ùå O email ${i} j√° est√° cadastrado no sistema. Use emails diferentes.`)}console.log("‚úÖ Nenhum email j√° existe no sistema"),console.log("Validando senhas...");const r=[a.senha_cpm,a.senha_ccl,a.senha_orgao_admin,a.senha_assessoria];for(const i of r)if(i.length<6)throw new Error("Todas as senhas devem ter pelo menos 6 caracteres");console.log("‚úÖ VALIDA√á√ÉO COMPLETA - Todos os dados est√£o corretos!")}static validarEmail(a){const o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return o.test(a)}static async criarTenant(a){try{const o={nome:a.nome_orgao,descricao:`${a.tipo_orgao||"√ìrg√£o p√∫blico"} - ${a.nome_orgao}`,ativo:!0},{data:s,error:e}=await i.ND.from("tenants").insert(o).select().single();if(e)throw console.error("Erro ao criar tenant:",e),e;return s}catch(o){throw console.error("Erro no servi√ßo de tenant:",o),o}}static async criarUsuariosOrgao(a,o){const s=[{email:o.email_cpm,senha:o.senha_cpm,nome_completo:o.nome_responsavel_cpm||"Respons√°vel CPM",perfil:t.A.PERFIS.CPM,cargo:"Presidente da CPM",descricao:"Comiss√£o Permanente de Padroniza√ß√£o de Materiais"},{email:o.email_ccl,senha:o.senha_ccl,nome_completo:o.nome_responsavel_ccl||"Respons√°vel CCL",perfil:t.A.PERFIS.CCL,cargo:"Presidente da CCL",descricao:"Comiss√£o de Contrata√ß√£o e Licita√ß√£o"},{email:o.email_orgao_admin,senha:o.senha_orgao_admin,nome_completo:o.nome_responsavel_admin||"Autoridade Competente",perfil:t.A.PERFIS.ORGAO_ADMINISTRATIVO,cargo:"Autoridade Competente",descricao:"√ìrg√£o Administrativo - Assinaturas e Homologa√ß√µes"},{email:o.email_assessoria,senha:o.senha_assessoria,nome_completo:o.nome_responsavel_assessoria||"Assessor Jur√≠dico",perfil:t.A.PERFIS.ASSESSORIA_JURIDICA,cargo:"Assessor Jur√≠dico",descricao:"Assessoria Jur√≠dica - An√°lise de Minutas e Editais"}],e=[];for(const i of s)try{const o=await this.criarUsuarioIndividual(i,a);e.push(o),console.log(`Usu√°rio ${i.perfil} criado:`,o.email)}catch(r){throw console.error(`Erro ao criar usu√°rio ${i.perfil}:`,r),new Error(`Falha ao criar usu√°rio ${i.perfil}: ${r.message}`)}return e}static async criarUsuarioIndividual(a,o){try{console.log(`üöÄ CRIANDO USU√ÅRIO: ${a.email} (Perfil: ${a.perfil})`),console.log("üîç Verifica√ß√£o final de seguran√ßa...");const s=await this.verificarEmailExiste(a.email);if(s)throw new Error(`Email ${a.email} foi encontrado no sistema mesmo ap√≥s limpeza`);const e={cpm:"cpm",ccl:"admin",orgao_administrativo:"admin",assessoria_juridica:"admin"},r=e[a.perfil]||"admin";console.log(`üìã Tipo mapeado para ${a.perfil}: ${r}`),console.log("üîê Criando usu√°rio no Auth...");const{data:t,error:n}=await i.ND.auth.signUp({email:a.email,password:a.senha,options:{emailRedirectTo:void 0,data:{full_name:a.nome_completo,cargo:a.cargo,perfil_usuario:a.perfil,tenant_id:o}}});if(n)throw console.error("‚ùå Erro no Auth:",n),n;if(!t.user)throw new Error("Usu√°rio n√£o foi criado no Auth - dados inv√°lidos");console.log("‚úÖ Usu√°rio criado no Auth:",t.user.id),await new Promise((a=>setTimeout(a,500))),console.log("üîç Verificando se usu√°rio j√° foi criado automaticamente por trigger...");const{data:l}=await i.ND.from("usuarios").select("*").eq("id",t.user.id).maybeSingle();let c=null;if(l){console.log("‚úÖ Usu√°rio j√° criado automaticamente por trigger:",l.id),console.log("üìù Atualizando dados do usu√°rio criado automaticamente...");const{data:s,error:e}=await i.ND.from("usuarios").update({nome:a.nome_completo,perfil_usuario:a.perfil,tenant_id:o,ativo:!0,tipo:r}).eq("id",t.user.id).select().single();if(e)throw console.error("‚ùå Erro ao atualizar usu√°rio autom√°tico:",e),e;c=s,console.log("‚úÖ Usu√°rio atualizado com nossos dados")}else{const s={id:t.user.id,email:a.email,nome:a.nome_completo,perfil_usuario:a.perfil,tenant_id:o,ativo:!0,tipo:r};console.log("üìù Inserindo na tabela usuarios (cria√ß√£o manual):",s);let{data:e,error:n}=await i.ND.rpc("inserir_usuario_sistema",{p_id:s.id,p_email:s.email,p_nome:s.nome,p_tipo:s.tipo,p_perfil_usuario:s.perfil_usuario,p_tenant_id:s.tenant_id,p_ativo:s.ativo});if(n&&"42883"===n.code){console.log("‚ö†Ô∏è Fun√ß√£o RPC n√£o existe, tentando inser√ß√£o normal...");const a=await i.ND.from("usuarios").insert(s).select().single();e=a.data,n=a.error}if(n)throw console.error("‚ùå Erro ao inserir na tabela usuarios:",n),"23505"===n.code&&(console.log("üßπ Erro de chave duplicada detectado!"),console.log("üîç Problema identificado: Policies RLS est√£o interferindo na inser√ß√£o"),console.log("üìã Execute: CRIAR_FUNCAO_RPC_USUARIO.sql para resolver"),console.log(`‚ùå Email problem√°tico: ${a.email}`)),n;c=e,console.log("‚úÖ Usu√°rio inserido manualmente na tabela usuarios")}return console.log("‚úÖ Usu√°rio processado na tabela usuarios:",c.id),{id:t.user.id,email:a.email,nome_completo:a.nome_completo,perfil:a.perfil,cargo:a.cargo,tenant_id:o}}catch(s){throw console.error(`‚ùå ERRO CR√çTICO ao criar usu√°rio ${a.email}:`,s),s}}static async configurarPerfisUsuarios(a,o){try{for(const o of a)await this.atualizarPerfilUsuario(o.id,o.perfil),console.log(`Perfil ${o.perfil} configurado para ${o.email}`)}catch(s){throw console.error("Erro ao configurar perfis:",s),s}}static async atualizarPerfilUsuario(a,o){try{const{data:s,error:e}=await i.ND.rpc("atualizar_perfil_usuario",{p_user_id:a,p_novo_perfil:o});if(e)throw e;return s}catch(s){throw console.error("Erro ao atualizar perfil:",s),s}}static async verificarEmailExiste(a){try{console.log("üîç VERIFICA√á√ÉO ROBUSTA DE EMAIL:",a);const{data:o,error:s}=await i.ND.from("usuarios").select("email, id, ativo").eq("email",a).maybeSingle();if(console.log("Resultado tabela usuarios:",{email:a,usuario:o,errorUsuario:s}),s&&"PGRST116"!==s.code)throw console.error("Erro na verifica√ß√£o de email (usuarios):",s),s;if(o)return console.log(`‚ùå EMAIL ${a} J√Å EXISTE NA TABELA USUARIOS (ID: ${o.id}, Ativo: ${o.ativo})`),!0;const{data:e,error:r}=await i.ND.from("usuarios").select("email").ilike("email",a);return e&&e.length>0?(console.log("‚ö†Ô∏è Encontrados emails similares:",e.map((a=>a.email))),!0):(console.log(`‚úÖ EMAIL ${a} N√ÉO EXISTE NO SISTEMA - LIVRE PARA USO`),!1)}catch(o){throw console.error("‚ùå ERRO CR√çTICO na verifica√ß√£o de email:",o),o}}static async verificarOrgaoExiste(a){try{const{data:o,error:s}=await i.ND.from("tenants").select("nome").ilike("nome",a).maybeSingle();if(s&&"PGRST116"!==s.code)throw s;return!!o}catch(o){return console.error("Erro ao verificar √≥rg√£o:",o),!1}}static obterTemplateDados(){return{nome_orgao:"",tipo_orgao:"publico",endereco:"",telefone:"",email_contato:"",cnpj:"",email_cpm:"",senha_cpm:"",nome_responsavel_cpm:"",email_ccl:"",senha_ccl:"",nome_responsavel_ccl:"",email_orgao_admin:"",senha_orgao_admin:"",nome_responsavel_admin:"",email_assessoria:"",senha_assessoria:"",nome_responsavel_assessoria:""}}static gerarSenhaAutomatica(a=8){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let e=0;e<a;e++)s+=o.charAt(Math.floor(Math.random()*o.length));return s}static obterResumoRegistro(a){if(!a.sucesso)return"Falha no registro";const{tenant:o,usuarios:s}=a;return{orgao:{nome:o.nome,id:o.id},usuarios:s.map((a=>({perfil:a.perfil,email:a.email,nome:a.nome_completo,cargo:a.cargo}))),acessos:{cpm:`${s.find((a=>"cpm"===a.perfil))?.email} - Acesso completo exceto CCL`,ccl:`${s.find((a=>"ccl"===a.perfil))?.email} - Apenas Painel CCL`,admin:`${s.find((a=>"orgao_administrativo"===a.perfil))?.email} - Processos Administrativos`,juridico:`${s.find((a=>"assessoria_juridica"===a.perfil))?.email} - An√°lise Jur√≠dica`}}}}const l=n,c={name:"RegistroOrgao",data(){return{etapaAtual:1,processando:!1,registroCompleto:!1,erro:null,dadosOrgao:l.obterTemplateDados()}},computed:{dadosOrgaoValidos(){return this.dadosOrgao.nome_orgao&&this.dadosOrgao.nome_orgao.trim().length>0},usuariosValidos(){const a=[this.dadosOrgao.email_cpm,this.dadosOrgao.email_ccl,this.dadosOrgao.email_orgao_admin,this.dadosOrgao.email_assessoria],o=[this.dadosOrgao.senha_cpm,this.dadosOrgao.senha_ccl,this.dadosOrgao.senha_orgao_admin,this.dadosOrgao.senha_assessoria],s=a.every((a=>a&&a.trim().length>0)),e=o.every((a=>a&&a.length>=6)),r=new Set(a).size===a.length;return s&&e&&r}},methods:{proximaEtapa(){this.etapaAtual<3&&this.etapaAtual++},voltarEtapa(){this.etapaAtual>1&&this.etapaAtual--},async confirmarRegistro(){if(this.processando||this.registroCompleto)console.warn("Registro j√° em andamento ou conclu√≠do, ignorando clique");else try{this.processando=!0,this.erro=null,console.log("üöÄ Iniciando registro do √≥rg√£o...");const a=await l.registrarOrgaoCompleto(this.dadosOrgao);a.sucesso?(this.registroCompleto=!0,console.log("‚úÖ Registro conclu√≠do com sucesso"),this.$swal({icon:"success",title:"√ìrg√£o Registrado!",text:`${this.dadosOrgao.nome_orgao} foi cadastrado com sucesso.`,timer:3e3,showConfirmButton:!1})):(this.erro=a.mensagem||"Erro desconhecido no registro",console.error("‚ùå Erro no registro:",this.erro))}catch(a){console.error("‚ùå Erro no registro:",a),this.erro=a.message||"Erro inesperado durante o registro"}finally{this.processando=!1}},novoRegistro(){this.etapaAtual=1,this.registroCompleto=!1,this.erro=null,this.dadosOrgao=l.obterTemplateDados()},formatarCNPJ(){let a=this.dadosOrgao.cnpj.replace(/\D/g,"");a=a.replace(/^(\d{2})(\d)/,"$1.$2"),a=a.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3"),a=a.replace(/\.(\d{3})(\d)/,".$1/$2"),a=a.replace(/(\d{4})(\d)/,"$1-$2"),this.dadosOrgao.cnpj=a}}},d=c;var m=s(1656),u=(0,m.A)(d,e,r,!1,null,"96af02e2",null);const v=u.exports}}]);
//# sourceMappingURL=170.b1e9db6d.js.map