(()=>{"use strict";var a={452:(a,t,o)=>{o.d(t,{ND:()=>i});var e=o(17);const r="https://ruagsbbczuwgfflgcaol.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1YWdzYmJjenV3Z2ZmbGdjYW9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ0Njg5MDQsImV4cCI6MjA2MDA0NDkwNH0.S2KD6-9DpBYAOsodjibI7LGa04CspZZ5OdRQagNjoK8",i=(0,e.UU)(r,s)},472:(a,t,o)=>{var e=o(471),r=function(){var a=this,t=a._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},s=[],i=o(656),n={},d=(0,i.A)(n,r,s,!1,null,null,null);const l=d.exports;var c=o(173),u=function(){var a=this,t=a._self._c;return t("div",{staticClass:"home"},[t("Login")],1)},v=[],m=function(){var a=this,t=a._self._c;return t("div",{staticClass:"login-container"},[t("div",{staticClass:"login-card"},[t("h2",[a._v("Comprar Bem: Compras Inteligentes")]),t("p",[a._v("Saúde e Administração")]),t("div",{staticClass:"tabs"},[t("button",{class:{active:"login"===a.activeTab},on:{click:function(t){a.activeTab="login"}}},[a._v("Login")]),t("button",{class:{active:"register"===a.activeTab},on:{click:function(t){a.activeTab="register"}}},[a._v("Registrar")])]),"login"===a.activeTab?t("div",[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[a._v("E-mail")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.email,expression:"email"}],attrs:{id:"email",type:"email",placeholder:"Seu e-mail",required:""},domProps:{value:a.email},on:{input:function(t){t.target.composing||(a.email=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"password"}},[a._v("Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.password,expression:"password"}],attrs:{id:"password",type:"password",placeholder:"Sua senha",required:""},domProps:{value:a.password},on:{input:function(t){t.target.composing||(a.password=t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{disabled:a.loading},on:{click:a.login}},[a._v(" "+a._s(a.loading?"Entrando...":"Entrar")+" ")])]):a._e(),"register"===a.activeTab?t("div",[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registerEmail"}},[a._v("E-mail")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.registerEmail,expression:"registerEmail"}],attrs:{id:"registerEmail",type:"email",placeholder:"Seu e-mail",required:""},domProps:{value:a.registerEmail},on:{input:function(t){t.target.composing||(a.registerEmail=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registerPassword"}},[a._v("Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.registerPassword,expression:"registerPassword"}],attrs:{id:"registerPassword",type:"password",placeholder:"Sua senha",required:""},domProps:{value:a.registerPassword},on:{input:function(t){t.target.composing||(a.registerPassword=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"confirmPassword"}},[a._v("Confirmar Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.confirmPassword,expression:"confirmPassword"}],attrs:{id:"confirmPassword",type:"password",placeholder:"Confirme sua senha",required:""},domProps:{value:a.confirmPassword},on:{input:function(t){t.target.composing||(a.confirmPassword=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeInstitucional"}},[a._v("Nome da Instituição")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nomeInstitucional,expression:"nomeInstitucional"}],attrs:{id:"nomeInstitucional",type:"text",placeholder:"Nome da sua instituição",required:""},domProps:{value:a.nomeInstitucional},on:{input:function(t){t.target.composing||(a.nomeInstitucional=t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{type:"button"},on:{click:a.register}},[a._v(" "+a._s(a.loading?"Registrando...":"Registrar")+" ")]),t("button",{staticClass:"btn-test",staticStyle:{"margin-top":"10px"},on:{click:a.testeSimples}},[a._v(" Teste Simples ")]),a.validRegistration?a._e():t("div",{staticClass:"validation-info"},[t("p",[a._v("O formulário não está válido porque:")]),t("ul",[a.registerEmail?a._e():t("li",[a._v("Falta o e-mail")]),a.registerPassword?a._e():t("li",[a._v("Falta a senha")]),a.registerPassword&&a.registerPassword.length<6?t("li",[a._v("A senha precisa ter pelo menos 6 caracteres")]):a._e(),a.registerPassword!==a.confirmPassword?t("li",[a._v("As senhas não conferem")]):a._e(),a.nomeInstitucional?a._e():t("li",[a._v("Falta o nome da instituição")])])])]):a._e(),a.errorMsg?t("p",{staticClass:"error-message"},[a._v(a._s(a.errorMsg))]):a._e(),"register"===a.activeTab?t("div",{staticClass:"test-buttons"},[t("button",{staticClass:"btn-test",on:{click:a.testarSupabase}},[a._v("Testar Conexão Supabase")])]):a._e()])])},p=[],g=o(452),h=o(303);const f={name:"Login",data(){return{activeTab:"login",email:"",password:"",registerEmail:"",registerPassword:"",confirmPassword:"",nomeInstitucional:"",loading:!1,errorMsg:""}},computed:{validRegistration(){return this.registerEmail&&this.registerPassword&&this.registerPassword===this.confirmPassword&&this.nomeInstitucional&&this.registerPassword.length>=6}},mounted(){console.log("Componente Login montado",{activeTab:this.activeTab})},watch:{activeTab(a){console.log("Aba ativa alterada para:",a)},registerEmail(a){console.log("E-mail de registro alterado:",a)},registerPassword(a){console.log("Senha de registro alterada:",a?"****":"")}},methods:{async testarSupabase(){console.log("Testando conexão com Supabase...");try{const{data:a,error:t}=await g.ND.from("tenants").select("*").limit(1);console.log("Resultado do teste tabela tenants:",{data:a,error:t}),t?alert(`Erro ao acessar tabela: ${t.message}`):alert(`Conexão OK! ${a?a.length:0} registros encontrados.`);const o=(0,h.A)();console.log("Teste UUID gerado:",o)}catch(a){console.error("Erro no teste:",a),alert(`Erro na conexão: ${a.message}`)}},async login(){try{this.loading=!0,this.errorMsg="";const{error:a}=await g.ND.auth.signInWithPassword({email:this.email,password:this.password});if(a)throw a;this.$router.push("/dashboard")}catch(a){this.errorMsg=a.message||"Erro ao fazer login"}finally{this.loading=!1}},async register(){if(console.log("Método register chamado",{email:this.registerEmail,password:"****",nomeInstitucional:this.nomeInstitucional}),!this.validRegistration)return console.log("Formulário inválido"),void(this.errorMsg="Verifique os campos do formulário");try{this.loading=!0,this.errorMsg="",console.log("Iniciando registro de usuário no Supabase...");const{data:t,error:o}=await g.ND.auth.signUp({email:this.registerEmail,password:this.registerPassword});if(console.log("Resposta do registro de usuário:",{authData:t,authError:o}),o&&!o.message.includes("already registered"))throw o;const e=t?.user?.id;console.log("ID da autenticação:",e);const r=(0,h.A)(),s=(0,h.A)();try{const{error:a}=await g.ND.from("usuarios").delete().eq("email",this.registerEmail);a&&console.warn("Aviso ao tentar remover usuário existente:",a)}catch(a){console.warn("Erro ao tentar remover usuário:",a)}console.log("Criando tenant...");const{data:i,error:n}=await g.ND.from("tenants").insert({id:r,nome:this.nomeInstitucional,descricao:`Tenant para ${this.registerEmail}`,ativo:!0}).select();if(n)throw new Error(`Erro ao criar tenant: ${n.message}`);console.log("Criando usuário...");const{data:d,error:l}=await g.ND.from("usuarios").insert({id:s,email:this.registerEmail,nome:this.nomeInstitucional,tenant_id:r,tipo:"admin",ativo:!0}).select();if(l)throw l.message.includes("duplicate key")?(this.errorMsg="Este email já está registrado. Por favor, contate o suporte.",new Error(`Email já existe na base de dados: ${l.message}`)):new Error(`Erro ao criar usuário: ${l.message}`);console.log("Atualizando tenant com user_id...");const{error:c}=await g.ND.from("tenants").update({user_id:e}).eq("id",r);c&&console.warn("Aviso: Não foi possível atualizar o tenant com user_id:",c),console.log("Registro concluído com sucesso!"),alert("Registro realizado com sucesso! Verifique seu e-mail para confirmar a conta."),this.activeTab="login",this.email=this.registerEmail}catch(t){console.error("Erro detalhado no registro:",t),this.errorMsg=this.errorMsg||t.message||"Erro ao fazer registro"}finally{this.loading=!1}},testeSimples(){console.log("Botão de teste simples clicado"),alert("Teste de evento de clique funcionando!")}}},_=f;var b=(0,i.A)(_,m,p,!1,null,"0af2f7e3",null);const C=b.exports,w={name:"Home",components:{Login:C}},y=w;var D=(0,i.A)(y,u,v,!1,null,null,null);const E=D.exports;var P=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Dashboard")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("DashboardCPM")],1)])},I=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("h1",[a._v("Comprar Bem: Compras Inteligentes")])])}],N=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard"},[t("h2",[a._v("Dashboard CPM")]),t("div",{staticClass:"stats-container"},[t("div",{staticClass:"stat-card status-pendente-card"},[t("h3",[a._v("Produtos Pendentes")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.pendentes))])]),t("div",{staticClass:"stat-card status-aprovado-card"},[t("h3",[a._v("Produtos Aprovados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.aprovados))])]),t("div",{staticClass:"stat-card status-reprovado-card"},[t("h3",[a._v("Produtos Reprovados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.reprovados))])])]),t("div",{staticClass:"recent-products"},[t("h3",[a._v("Produtos Recentes")]),a.produtos.length>0?t("table",[a._m(0),t("tbody",a._l(a.produtos,(function(o){return t("tr",{key:o.id},[t("td",[a._v(a._s(o.nome))]),t("td",[a._v(a._s(o.marca))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(o.status)},[a._v(" "+a._s(o.status)+" ")])]),t("td",[a._v(a._s(a.formatDate(o.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.verProduto(o.id)}}},[a._v("Ver")])])])})),0)]):t("p",[a._v("Nenhum produto cadastrado.")])])])},A=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Ações")])])])}];const x={name:"DashboardCPM",data(){return{produtos:[],pendentes:0,aprovados:0,reprovados:0,currentTenantId:null,loading:!1}},created(){this.obterTenantId().then((()=>{this.carregarDados()}))},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return this.currentTenantId=t.user_metadata.tenant_id,void console.log("Tenant ID obtido dos metadados:",this.currentTenantId);const{data:o,error:e}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(e)return void console.error("Erro ao buscar tenant_id:",e);o?.tenant_id?(this.currentTenantId=o.tenant_id,console.log("Tenant ID obtido da tabela usuarios:",this.currentTenantId)):console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarDados(){try{if(this.loading=!0,!this.currentTenantId&&(console.error("Tenant ID não disponível. Tentando recarregar..."),await this.obterTenantId(),!this.currentTenantId))return void console.error("Não foi possível obter o tenant_id, impossível carregar dados");console.log("Carregando produtos para tenant_id:",this.currentTenantId);const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1}).limit(10);if(t)throw t;this.produtos=a||[],console.log(`${this.produtos.length} produtos carregados para o tenant atual`);const o=await Promise.all([this.contarPorStatus("pendente"),this.contarPorStatus("aprovado"),this.contarPorStatus("reprovado")]);this.pendentes=o[0],this.aprovados=o[1],this.reprovados=o[2]}catch(a){console.error("Erro ao carregar dados:",a)}finally{this.loading=!1}},async contarPorStatus(a){if(!this.currentTenantId)return 0;const{count:t,error:o}=await g.ND.from("produtos").select("id",{count:"exact"}).eq("status",a).eq("tenant_id",this.currentTenantId);return o?(console.error(`Erro ao contar produtos ${a}:`,o),0):t||0},formatDate(a){if(!a)return"";const t=new Date(a);return t.toLocaleDateString("pt-BR")},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},verProduto(a){this.$router.push(`/analise/${a}`)}}},k=x;var T=(0,i.A)(k,N,A,!1,null,"03f97801",null);const S=T.exports,q={name:"Dashboard",components:{DashboardCPM:S},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},$=q;var M=(0,i.A)($,P,I,!1,null,"1957db3a",null);const F=M.exports;var O=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cadastro-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Dashboard")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("CadastroProduto")],1)])},U=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("h1",[a._v("Comprar Bem: Compras Inteligentes")])])}],j=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cadastro-produto"},[t("h2",[a._v("Cadastro de Produto")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarProduto.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome do Produto*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.nome,expression:"produto.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.produto.nome},on:{input:function(t){t.target.composing||a.$set(a.produto,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"categoria"}},[a._v("Categoria*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produto.categoria_id,expression:"produto.categoria_id"}],attrs:{id:"categoria",required:""},on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.produto,"categoria_id",t.target.multiple?o:o[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.categorias,(function(o){return t("option",{key:o.id,domProps:{value:o.id}},[a._v(" "+a._s(o.nome)+" ")])}))],2)])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"marca"}},[a._v("Marca*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.marca,expression:"produto.marca"}],attrs:{id:"marca",type:"text",required:""},domProps:{value:a.produto.marca},on:{input:function(t){t.target.composing||a.$set(a.produto,"marca",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"modelo"}},[a._v("Modelo*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.modelo,expression:"produto.modelo"}],attrs:{id:"modelo",type:"text",required:""},domProps:{value:a.produto.modelo},on:{input:function(t){t.target.composing||a.$set(a.produto,"modelo",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"fabricante"}},[a._v("Fabricante*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.fabricante,expression:"produto.fabricante"}],attrs:{id:"fabricante",type:"text",required:""},domProps:{value:a.produto.fabricante},on:{input:function(t){t.target.composing||a.$set(a.produto,"fabricante",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cnpj"}},[a._v("CNPJ*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.cnpjFormatado,expression:"cnpjFormatado"}],attrs:{id:"cnpj",type:"text",required:"",maxlength:"18",placeholder:"00.000.000/0000-00"},domProps:{value:a.cnpjFormatado},on:{input:[function(t){t.target.composing||(a.cnpjFormatado=t.target.value)},a.formatarCNPJ]}}),a.cnpjInvalido?t("small",{staticClass:"error-text"},[a._v("CNPJ inválido. Formato: 00.000.000/0000-00")]):a._e()])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descrição")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.produto.descricao,expression:"produto.descricao"}],attrs:{id:"descricao",rows:"4"},domProps:{value:a.produto.descricao},on:{input:function(t){t.target.composing||a.$set(a.produto,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Documentos (apenas PDF)")]),t("div",{staticClass:"file-upload"},[t("input",{attrs:{type:"file",multiple:"",accept:".pdf"},on:{change:a.onFileSelect}})]),t("small",{staticClass:"info-text"},[a._v("Apenas arquivos PDF são aceitos (máx. 10MB por arquivo)")]),a.selectedFiles.length>0?t("div",{staticClass:"selected-files"},[t("p",[a._v("Arquivos selecionados:")]),t("ul",a._l(a.selectedFiles,(function(o,e){return t("li",{key:e,class:{"arquivo-invalido":!a.validarArquivoPDF(o)}},[a._v(" "+a._s(o.name)+" "),a.validarArquivoPDF(o)?a._e():t("span",{staticClass:"error-text"},[a._v("(Formato inválido - apenas PDF permitido)")])])})),0)]):a._e(),a.arquivosInvalidos.length>0?t("div",{staticClass:"error-text"},[t("p",[a._v("Os seguintes arquivos não serão enviados (apenas PDF permitido):")]),t("ul",a._l(a.arquivosInvalidos,(function(o,e){return t("li",{key:e},[a._v(" "+a._s(o.name)+" ")])})),0)]):a._e()]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.loading}},[a._v(" "+a._s(a.loading?"Salvando...":"Salvar Produto")+" ")])])])])},L=[];const R={name:"CadastroProduto",data(){return{produto:{nome:"",categoria_id:"",marca:"",modelo:"",fabricante:"",cnpj:"",descricao:"",status:"pendente"},cnpjFormatado:"",cnpjInvalido:!1,categorias:[],selectedFiles:[],arquivosInvalidos:[],loading:!1,currentTenantId:null}},async created(){this.carregarCategorias(),await this.obterTenantId()},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)throw new Error("Usuário não autenticado");if(t?.user_metadata?.tenant_id)return console.log("Obteve tenant_id dos metadados:",t.user_metadata.tenant_id),void(this.currentTenantId=t.user_metadata.tenant_id);const{data:o,error:e}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(console.log("Busca de tenant_id na tabela usuarios:",{userData:o,userError:e}),o&&o.tenant_id){console.log("Obteve tenant_id da tabela usuarios:",o.tenant_id),this.currentTenantId=o.tenant_id;const{error:a}=await g.ND.auth.updateUser({data:{tenant_id:o.tenant_id}});return void(a?console.error("Erro ao atualizar metadados do usuário:",a):console.log("Metadados do usuário atualizados com sucesso"))}const r=(0,h.A)();console.log("Gerando novo tenant_id:",r);const{error:s}=await g.ND.from("usuarios").insert({id:(0,h.A)(),email:t.email,tenant_id:r,ativo:!0});s&&console.error("Erro ao inserir novo tenant_id na tabela usuarios:",s);const{error:i}=await g.ND.auth.updateUser({data:{tenant_id:r}});i?console.error("Erro ao atualizar metadados do usuário:",i):console.log("Metadados do usuário atualizados com novo tenant_id"),this.currentTenantId=r}catch(a){console.error("Erro ao obter tenant_id:",a),alert("Erro ao obter identificação do tenant. Por favor, faça login novamente."),this.$router.push("/")}},async carregarCategorias(){try{const{data:a,error:t}=await g.ND.from("categorias").select("*").order("nome");if(t)throw t;a&&a.length>0?this.categorias=a:this.categorias=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}catch(a){console.error("Erro ao carregar categorias:",a),this.categorias=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}},formatarCNPJ(a){let t=a.target.value.replace(/\D/g,"");t=t.substring(0,14),t.length>0&&(t=t.replace(/^(\d{2})(\d)/,"$1.$2"),t=t.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3"),t=t.replace(/\.(\d{3})(\d)/,".$1/$2"),t=t.replace(/(\d{4})(\d)/,"$1-$2")),this.cnpjFormatado=t,this.produto.cnpj=this.cnpjFormatado.replace(/\D/g,""),this.validarCNPJ()},validarCNPJ(){const a=this.produto.cnpj;return 14!==a.length||/^(\d)\1+$/.test(a)?(this.cnpjInvalido=!0,!1):(this.cnpjInvalido=!1,!0)},onFileSelect(a){const t=Array.from(a.target.files);this.arquivosInvalidos=[],this.selectedFiles=t.filter((a=>{const t=this.validarArquivoPDF(a);return t||this.arquivosInvalidos.push(a),t}))},validarArquivoPDF(a){const t=a.name.split(".").pop().toLowerCase(),o=a.type.toLowerCase();return"pdf"===t&&"application/pdf"===o},sanitizarNomeArquivo(a){let t=a.normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(t=t.replace(/[^a-zA-Z0-9_.]/g,"_"),t.length>100){const a=t.split(".").pop();t=t.substring(0,90)+"."+a}return t},async salvarProduto(){if(this.validarFormulario())try{if(this.loading=!0,this.currentTenantId||await this.obterTenantId(),console.log("Salvando produto com tenant_id:",this.currentTenantId),!this.validarCNPJ())return this.$swal({icon:"error",title:"CNPJ Inválido",text:"Por favor, informe um CNPJ válido no formato 00.000.000/0000-00"}),void(this.loading=!1);const a={nome:this.produto.nome,descricao:this.produto.descricao,categoria_id:this.convertToUUID(this.produto.categoria_id),marca:this.produto.marca,modelo:this.produto.modelo,fabricante:this.produto.fabricante,cnpj:this.produto.cnpj,status:"pendente",tenant_id:this.currentTenantId};console.log("Objeto produto a ser inserido:",a);const{data:t,error:o}=await g.ND.from("produtos").insert(a).select().single();if(o)throw console.error("Erro detalhado ao salvar produto:",o),new Error(`Erro ao salvar produto: ${o.message}`);console.log("Produto inserido com sucesso:",t);const e=this.selectedFiles.filter((a=>this.validarArquivoPDF(a)));if(e.length>0){const a=t.id;for(const t of e){const o=t.name,e=this.sanitizarNomeArquivo(t.name),r=`${Date.now()}-${e}`;console.log(`Upload de arquivo: Original "${o}" -> Sanitizado "${e}"`);const{data:s,error:i}=await g.ND.storage.from("documentos").upload(r,t);if(i){console.error("Erro ao fazer upload do arquivo:",i);continue}const{data:n}=g.ND.storage.from("documentos").getPublicUrl(r),d=n?.publicUrl||"",l={tenant_id:this.currentTenantId,produto_id:a,nome:o,tipo:t.type,arquivo_url:d},{error:c}=await g.ND.from("documentos").insert(l);c&&console.error("Erro ao registrar documento:",c)}}this.arquivosInvalidos.length>0?this.$swal({icon:"warning",title:"Produto salvo com ressalvas",text:`O produto foi salvo, mas ${this.arquivosInvalidos.length} arquivo(s) não foi(ram) enviado(s) por não serem PDFs válidos.`}):this.$swal({icon:"success",title:"Produto salvo com sucesso!",text:"O produto foi cadastrado e está aguardando aprovação."}),this.limparFormulario()}catch(a){console.error("Erro no processo de salvamento:",a),this.$swal({icon:"error",title:"Erro ao salvar produto",text:a.message||"Ocorreu um erro ao tentar salvar o produto."})}finally{this.loading=!1}},limparFormulario(){this.produto={nome:"",categoria_id:"",marca:"",modelo:"",fabricante:"",cnpj:"",descricao:"",status:"pendente"},this.cnpjFormatado="",this.cnpjInvalido=!1,this.selectedFiles=[],this.arquivosInvalidos=[]},validarFormulario(){return this.produto.nome&&""!==this.produto.nome.trim()?this.produto.categoria_id?this.produto.descricao&&""!==this.produto.descricao.trim()?this.validarCNPJ()?(this.arquivosInvalidos.length>0&&this.$swal({icon:"error",title:"Arquivos inválidos",text:"Alguns arquivos selecionados não são PDFs válidos e não serão enviados."}),!0):(this.$swal({icon:"error",title:"Erro de validação",text:"O CNPJ informado é inválido"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"A descrição do produto é obrigatória"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"Selecione uma categoria para o produto"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"O nome do produto é obrigatório"}),!1)},convertToUUID(a){if(!a)return null;const t=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(t.test(a))return console.log("categoria_id já é um UUID válido:",a),a;const o=parseInt(a,10);if(isNaN(o))return console.warn("categoria_id não é um número nem UUID válido:",a),(0,h.A)();const e=`00000000-0000-0000-0000-${o.toString().padStart(12,"0")}`;return console.log(`Converteu categoria_id ${a} para UUID: ${e}`),e}}},z=R;var B=(0,i.A)(z,j,L,!1,null,"5716f09a",null);const J=B.exports,V={name:"Cadastro",components:{CadastroProduto:J},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},Z=V;var G=(0,i.A)(Z,O,U,!1,null,"66fbd8d6",null);const H=G.exports;var Y=function(){var a=this,t=a._self._c;return t("div",{staticClass:"analise-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Dashboard")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("AnaliseProduto",{attrs:{id:a.produtoId}})],1)])},K=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("h1",[a._v("Comprar Bem: Compras Inteligentes")])])}],Q=function(){var a=this,t=a._self._c;return t("div",{staticClass:"analise-container"},[a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando...")])]):a.produto?t("div",{staticClass:"produto-analise"},[t("h2",[a._v("Análise de Produto")]),t("div",{staticClass:"produto-info"},[t("h3",[a._v(a._s(a.produto.nome))]),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item"},[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produto.marca)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produto.modelo)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produto.fabricante)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produto.cnpj)+" ")]),t("div",{staticClass:"info-item full-width"},[t("strong",[a._v("Descrição:")]),a._v(" "+a._s(a.produto.descricao||"Não informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Status Atual:")]),t("span",{staticClass:"status-pill",class:a.getStatusClass(a.produto.status)},[a._v(" "+a._s(a.produto.status)+" ")])]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Data de Cadastro:")]),a._v(" "+a._s(a.formatDate(a.produto.criado_em))+" ")])])]),a.documentos.length>0?t("div",{staticClass:"documentos-section"},[t("h3",[a._v("Documentos")]),t("div",{staticClass:"documentos-list"},a._l(a.documentos,(function(o){return t("div",{key:o.id,staticClass:"documento-item"},[t("div",{staticClass:"doc-icon"},[a._v("📄")]),t("div",{staticClass:"doc-info"},[t("p",{staticClass:"doc-name"},[a._v(a._s(o.nome))]),t("p",{staticClass:"doc-type"},[a._v(a._s(o.tipo))])]),t("a",{staticClass:"doc-action",attrs:{href:o.arquivo_url,target:"_blank"}},[a._v("Visualizar")])])})),0)]):a._e(),t("div",{staticClass:"analise-form"},[t("h3",[a._v("Parecer Técnico")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarAnalise.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"parecer"}},[a._v("Observações / Parecer")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.analise.parecer,expression:"analise.parecer"}],attrs:{id:"parecer",rows:"4",required:""},domProps:{value:a.analise.parecer},on:{input:function(t){t.target.composing||a.$set(a.analise,"parecer",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Decisão")]),t("div",{staticClass:"radio-group"},[t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.analise.status,expression:"analise.status"}],attrs:{type:"radio",value:"aprovado",required:""},domProps:{checked:a._q(a.analise.status,"aprovado")},on:{change:function(t){return a.$set(a.analise,"status","aprovado")}}}),a._v(" Aprovar ")]),t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.analise.status,expression:"analise.status"}],attrs:{type:"radio",value:"reprovado",required:""},domProps:{checked:a._q(a.analise.status,"reprovado")},on:{change:function(t){return a.$set(a.analise,"status","reprovado")}}}),a._v(" Reprovar ")])])]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.submitting}},[a._v(" "+a._s(a.submitting?"Salvando...":"Salvar Análise")+" ")]),t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.voltar}},[a._v(" Voltar ")])])])]),a.analisesAnteriores.length>0?t("div",{staticClass:"analises-anteriores"},[t("h3",[a._v("Análises Anteriores")]),a._l(a.analisesAnteriores,(function(o){return t("div",{key:o.id,staticClass:"analise-historico"},[t("div",{staticClass:"analise-header"},[t("span",{staticClass:"status-pill",class:a.getStatusClass(o.status)},[a._v(a._s(o.status))]),t("span",{staticClass:"analise-data"},[a._v(a._s(a.formatDate(o.criado_em)))])]),t("div",{staticClass:"analise-conteudo"},[t("p",[a._v(a._s(o.parecer))])])])}))],2):a._e()]):t("div",{staticClass:"not-found"},[t("p",[a._v("Produto não encontrado ou você não tem permissão para visualizá-lo.")]),t("button",{staticClass:"btn-secondary",on:{click:a.voltar}},[a._v("Voltar")])])])},W=[];const X={name:"AnaliseProduto",props:{id:{type:String,required:!0}},data(){return{produto:null,documentos:[],analisesAnteriores:[],analise:{parecer:"",status:""},loading:!0,submitting:!1}},created(){this.carregarDados()},methods:{async carregarDados(){try{this.loading=!0;const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("id",this.id).single();if(t)throw t;this.produto=a;const{data:o,error:e}=await g.ND.from("documentos").select("*").eq("produto_id",this.id);if(e)throw e;this.documentos=o||[];const{data:r,error:s}=await g.ND.from("analises").select("*").eq("produto_id",this.id).order("criado_em",{ascending:!1});if(s)throw s;this.analisesAnteriores=r||[]}catch(a){console.error("Erro ao carregar dados:",a),alert("Erro ao carregar dados do produto. Por favor, tente novamente.")}finally{this.loading=!1}},async salvarAnalise(){try{this.submitting=!0;const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;let o;if(t){console.log("Usuário autenticado:",t.email);const{data:a,error:e}=await g.ND.from("usuarios").select("id").eq("email",t.email).maybeSingle();if(e&&console.error("Erro ao buscar ID do usuário:",e),a?.id)console.log("ID do usuário encontrado na tabela usuarios:",a.id),o=a.id;else{console.warn("Usuário não encontrado na tabela, gerando UUID"),o=this.gerarUUID();const{error:a}=await g.ND.from("usuarios").insert({id:o,email:t.email,nome:t.email.split("@")[0],tenant_id:this.produto.tenant_id,tipo:"avaliador",ativo:!0});a&&console.error("Erro ao criar usuário automaticamente:",a)}}else console.warn("Nenhum usuário autenticado, gerando UUID"),o=this.gerarUUID();console.log("Salvando análise com avaliador_id:",o);const{error:e}=await g.ND.from("analises").insert({produto_id:this.id,tenant_id:this.produto.tenant_id,avaliador_id:o,parecer:this.analise.parecer,status:this.analise.status});if(e)throw console.error("Erro detalhado ao salvar análise:",e),new Error(`Erro ao salvar análise: ${e.message}`);const{error:r}=await g.ND.from("produtos").update({status:this.analise.status}).eq("id",this.id);if(r)throw r;this.$swal({icon:"success",title:"Análise salva com sucesso!",showConfirmButton:!1,timer:1500}),await this.carregarDados(),this.analise={parecer:"",status:""}}catch(a){console.error("Erro ao salvar análise:",a);let t="Erro ao salvar análise.";a.message&&a.message.includes("uuid")?t="Erro no formato de identificação. Este problema foi corrigido, tente novamente.":a.message&&(t=a.message),this.$swal({icon:"error",title:"Erro ao processar análise",text:t})}finally{this.submitting=!1}},formatDate(a){if(!a)return"";const t=new Date(a);return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},voltar(){this.$router.push("/dashboard")},gerarUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){const t=16*Math.random()|0,o="x"==a?t:3&t|8;return o.toString(16)}))}}},aa=X;var ta=(0,i.A)(aa,Q,W,!1,null,"9ea6b294",null);const oa=ta.exports,ea={name:"Analise",components:{AnaliseProduto:oa},computed:{produtoId(){return this.$route.params.id}},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},ra=ea;var sa=(0,i.A)(ra,Y,K,!1,null,"db1b0652",null);const ia=sa.exports;var na=function(){var a=this,t=a._self._c;return t("div",{staticClass:"catalogo-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Dashboard")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("CatalogoEletronico")],1)])},da=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("h1",[a._v("Comprar Bem: Compras Inteligentes")])])}],la=function(){var a=this,t=a._self._c;return t("div",{staticClass:"catalogo-container"},[t("h2",[a._v("Catálogo Eletrônico de Bens Padronizados")]),t("div",{staticClass:"search-filters"},[t("div",{staticClass:"search-box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.searchTerm,expression:"searchTerm"}],attrs:{type:"text",placeholder:"Buscar produto..."},domProps:{value:a.searchTerm},on:{input:[function(t){t.target.composing||(a.searchTerm=t.target.value)},a.filtrarProdutos]}})]),t("div",{staticClass:"filters"},[t("div",{staticClass:"categoria-filter"},[a._m(0),t("div",{staticClass:"dropdown"},[t("button",{staticClass:"dropdown-toggle",attrs:{type:"button"},on:{click:a.toggleCategoriaDropdown}},[a._v(" "+a._s(a.categoriaAtual)+" ")]),t("div",{staticClass:"dropdown-menu",class:{show:a.showCategoriaDropdown}},[a.carregandoCategorias?t("div",{staticClass:"dropdown-item loading"},[t("div",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status"}}),t("span",[a._v("Carregando...")])]):[t("a",{staticClass:"dropdown-item",on:{click:function(t){return a.selecionarCategoria(null)}}},[a._v("Todas as categorias")]),0===a.categorias.length?t("div",{staticClass:"dropdown-item empty"},[a._v(" Nenhuma categoria disponível ")]):a._l(a.categorias,(function(o){return t("a",{key:o.id,staticClass:"dropdown-item",class:{active:o.id===a.filtroCategoria},on:{click:function(t){return a.selecionarCategoria(o)}}},[a._v(" "+a._s(o.nome)+" ")])}))]],2)])])])]),a.produtosFiltrados.length>0?t("div",{staticClass:"produtos-grid"},a._l(a.produtosFiltrados,(function(o){return t("div",{key:o.id,staticClass:"produto-card",on:{click:function(t){return a.verDetalhesProduto(o.id)}}},[t("div",{staticClass:"produto-info"},[t("h3",[a._v(a._s(o.nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(o.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(o.modelo))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(o.fabricante))])]),t("div",{staticClass:"produto-status",class:a.getStatusClass(o.status)},[a._v(" "+a._s(o.status)+" ")])])})),0):t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhum produto encontrado.")])]),a.produtoSelecionado?t("div",{staticClass:"produto-modal",on:{click:function(t){return t.target!==t.currentTarget?null:a.fecharModal.apply(null,arguments)}}},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.produtoSelecionado.nome))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModal}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"produto-detalhes"},[t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoSelecionado.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoSelecionado.modelo))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoSelecionado.fabricante))]),t("p",[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produtoSelecionado.cnpj))]),a.produtoSelecionado.descricao?t("p",[t("strong",[a._v("Descrição:")]),a._v(" "+a._s(a.produtoSelecionado.descricao))]):a._e(),t("p",[t("strong",[a._v("Status:")]),a._v(" "),t("span",{class:a.getStatusClass(a.produtoSelecionado.status)},[a._v(a._s(a.produtoSelecionado.status))])]),t("div",{staticClass:"avaliacoes-section"},[t("div",{staticClass:"avaliacoes-header",class:{active:a.showAvaliacoes},on:{click:a.toggleAvaliacoes}},[t("h4",[a._v("Avaliações de Desempenho (RDM)")]),t("div",{staticClass:"avaliacao-summary"},[a.avaliacaoMedia>0?t("div",{staticClass:"stars-container"},[t("div",{staticClass:"stars"},a._l(5,(function(o){return t("span",{key:o,staticClass:"star",class:{filled:a.avaliacaoMedia>=o,half:a.avaliacaoMedia>=o-.5&&a.avaliacaoMedia<o}},[a._v("★")])})),0),t("span",{staticClass:"rating-number"},[a._v(a._s(a.avaliacaoMedia))]),t("span",{staticClass:"rating-count"},[a._v("("+a._s(a.avaliacoes.length)+" avaliações)")])]):t("div",{staticClass:"no-ratings"},[a._v(" Sem avaliações ainda ")]),t("span",{staticClass:"toggle-icon"},[a._v(a._s(a.showAvaliacoes?"▲":"▼"))])])]),a.showAvaliacoes?t("div",{staticClass:"avaliacoes-content"},[0===a.avaliacoes.length?t("div",{staticClass:"no-avaliacoes"},[a._v(" Este produto ainda não possui avaliações de desempenho. ")]):t("div",{staticClass:"avaliacoes-list"},a._l(a.avaliacoes,(function(o,e){return t("div",{key:e,staticClass:"avaliacao-item"},[t("div",{staticClass:"avaliacao-stars"},a._l(5,(function(e){return t("span",{key:e,staticClass:"star",class:{filled:o.avaliacao>=e}},[a._v("★")])})),0),t("div",{staticClass:"avaliacao-comentario"},[a._v(" "+a._s(o.comentario)+" ")]),t("div",{staticClass:"avaliacao-data"},[a._v(" "+a._s(a.obterDataAvaliacao(o))+" ")])])})),0)]):a._e()]),a.documentos.length>0?t("div",{staticClass:"documentos"},[t("h4",[a._v("Documentos")]),t("ul",a._l(a.documentos,(function(o){return t("li",{key:o.id},[t("a",{attrs:{href:o.arquivo_url,target:"_blank"}},[a._v(a._s(o.nome))])])})),0)]):a._e()])])])]):a._e()])},ca=[function(){var a=this,t=a._self._c;return t("label",[t("strong",[a._v("Categoria:")])])}];const ua={name:"CatalogoEletronico",data(){return{produtos:[],produtosFiltrados:[],categorias:[],searchTerm:"",filtroCategoria:"",categoriaAtual:"Todas as categorias",showCategoriaDropdown:!1,showAvaliacoes:!1,produtoSelecionado:null,documentos:[],avaliacoes:[],avaliacaoMedia:0,carregandoCategorias:!0,categoriaSelecionada:null,currentTenantId:null,loading:!1}},created(){this.obterTenantId().then((()=>{this.carregarDados()})),document.addEventListener("click",this.closeDropdownOnClickOutside)},mounted(){this.carregarCategoriasDireto(),this.showCategoriaDropdown=!1},beforeUnmount(){document.removeEventListener("click",this.closeDropdownOnClickOutside)},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return this.currentTenantId=t.user_metadata.tenant_id,void console.log("Tenant ID obtido dos metadados:",this.currentTenantId);const{data:o,error:e}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(e)return void console.error("Erro ao buscar tenant_id:",e);o?.tenant_id?(this.currentTenantId=o.tenant_id,console.log("Tenant ID obtido da tabela usuarios:",this.currentTenantId)):console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarDados(){console.log("Iniciando carregamento de dados"),this.carregandoCategorias=!0,this.loading=!0;try{if(!this.currentTenantId&&(console.error("Tenant ID não disponível. Tentando recarregar..."),await this.obterTenantId(),!this.currentTenantId))return console.error("Não foi possível obter o tenant_id, impossível carregar dados"),void this.$swal({icon:"error",title:"Erro ao carregar dados",text:"Não foi possível identificar sua conta. Por favor, faça login novamente."});console.log("Buscando categorias do Supabase...");const{data:a,error:t}=await g.ND.from("categorias").select("*");t?(console.error("Erro ao carregar categorias:",t.message),this.$swal({icon:"error",title:"Erro ao carregar categorias",text:"Não foi possível carregar as categorias. Por favor, tente novamente."})):(console.log("Categorias carregadas:",a),this.categorias=a||[],0===this.categorias.length&&console.warn("Nenhuma categoria encontrada no banco de dados")),this.carregandoCategorias=!1,console.log("Buscando produtos do Supabase para tenant_id:",this.currentTenantId);const{data:o,error:e}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId);e?(console.error("Erro ao carregar produtos:",e.message),this.$swal({icon:"error",title:"Erro ao carregar produtos",text:"Não foi possível carregar os produtos. Por favor, tente novamente."})):(console.log("Produtos carregados:",o),this.produtos=o||[],console.log(`${this.produtos.length} produtos carregados para o tenant atual`),this.produtos=this.produtos.map((a=>{const t=this.categorias.find((t=>t.id===a.categoria_id));return{...a,categoria_nome:t?t.nome:"Categoria não encontrada"}})),this.produtosFiltrados=[...this.produtos])}catch(a){console.error("Erro ao carregar dados:",a),this.$swal({icon:"error",title:"Erro ao carregar dados",text:"Ocorreu um erro inesperado. Por favor, tente novamente."})}finally{this.loading=!1}},async carregarCategoriasDireto(){try{console.log("Tentando carregar categorias diretamente...");const{data:a,error:t}=await g.ND.from("categorias").select("*");if(t)return void console.error("Erro ao carregar categorias direto:",t);console.log("Resposta direta de categorias:",a),a&&a.length>0&&0===this.categorias.length&&(console.log("Atualizando categorias com dados diretos"),this.categorias=a)}catch(a){console.error("Exceção ao carregar categorias direto:",a)}},filtrarProdutos(){console.log("Filtrando produtos por:",this.filtroCategoria,"e texto:",this.searchTerm),this.produtosFiltrados=this.produtos.filter((a=>{const t=!this.filtroCategoria||a.categoria_id===this.filtroCategoria,o=!this.searchTerm||a.nome.toLowerCase().includes(this.searchTerm.toLowerCase())||a.descricao&&a.descricao.toLowerCase().includes(this.searchTerm.toLowerCase());return t&&o})),console.log("Produtos filtrados:",this.produtosFiltrados.length)},async verDetalhesProduto(a){try{if(!this.currentTenantId)return void console.error("Não foi possível identificar o tenant_id");const{data:t,error:o}=await g.ND.from("produtos").select("*").eq("id",a).eq("tenant_id",this.currentTenantId).single();if(o)throw console.error("Erro ao carregar produto:",o),o;if(!t)return console.error("Produto não encontrado ou não pertence ao tenant atual"),void this.$swal({icon:"error",title:"Produto não encontrado",text:"O produto solicitado não existe ou você não tem permissão para visualizá-lo."});this.produtoSelecionado=t;const{data:e,error:r}=await g.ND.from("documentos").select("*").eq("produto_id",a).eq("tenant_id",this.currentTenantId);if(r)throw r;this.documentos=e||[];const{data:s,error:i}=await g.ND.from("rdm_feedbacks").select("*").eq("produto_id",a).eq("tenant_id",this.currentTenantId);if(i)console.error("Erro ao carregar avaliações:",i),this.avaliacoes=[],this.avaliacaoMedia=0;else if(this.avaliacoes=s||[],this.avaliacoes.length>0&&(console.log("Campos disponíveis na avaliação:",Object.keys(this.avaliacoes[0])),console.log("Exemplo de avaliação:",this.avaliacoes[0])),this.avaliacoes.length>0){const a=this.avaliacoes.reduce(((a,t)=>a+t.avaliacao),0);this.avaliacaoMedia=parseFloat((a/this.avaliacoes.length).toFixed(1))}else this.avaliacaoMedia=0}catch(t){console.error("Erro ao carregar detalhes do produto:",t),this.$swal({icon:"error",title:"Erro ao carregar detalhes",text:"Não foi possível carregar os detalhes do produto. Tente novamente."})}},fecharModal(){this.produtoSelecionado=null,this.documentos=[],this.avaliacoes=[],this.avaliacaoMedia=0,this.showAvaliacoes=!1},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},closeDropdownOnClickOutside(a){const t=this.$el.querySelector(".dropdown");t&&!t.contains(a.target)&&(this.showCategoriaDropdown=!1)},selecionarCategoria(a){console.log("Categoria selecionada:",a),this.categoriaSelecionada=a,this.categoriaAtual=a?a.nome:"Todas as categorias",this.filtroCategoria=a?a.id:"",this.showCategoriaDropdown=!1,this.filtrarProdutos()},toggleCategoriaDropdown(){this.showCategoriaDropdown=!this.showCategoriaDropdown},toggleAvaliacoes(){this.showAvaliacoes=!this.showAvaliacoes},formatarData(a){if(!a)return"Data não disponível";try{const t=new Date(a);return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Erro ao formatar data:",t),"Data inválida"}},obterDataAvaliacao(a){const t=a.created_at||a.criado_em||a.data||null;return this.formatarData(t)}}},va=ua;var ma=(0,i.A)(va,la,ca,!1,null,"135987d0",null);const pa=ma.exports,ga={name:"Catalogo",components:{CatalogoEletronico:pa},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},ha=ga;var fa=(0,i.A)(ha,na,da,!1,null,"1cca51b2",null);const _a=fa.exports;var ba=function(){var a=this,t=a._self._c;return t("div",{staticClass:"feedback-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Dashboard")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("FormularioRDM")],1)])},Ca=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("h1",[a._v("Comprar Bem: Compras Inteligentes")])])}],wa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"rdm-container"},[t("h2",[a._v("Relatório de Desempenho de Material (RDM)")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.enviarFeedback.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"produto"}},[a._v("Produto*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.feedback.produto_id,expression:"feedback.produto_id"}],attrs:{id:"produto",required:""},on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.feedback,"produto_id",t.target.multiple?o:o[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione o produto...")]),a._l(a.produtos,(function(o){return t("option",{key:o.id,domProps:{value:o.id}},[a._v(" "+a._s(o.nome)+" - "+a._s(o.marca)+" - "+a._s(o.modelo)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[t("label",[a._v("Avaliação*")]),t("div",{staticClass:"avaliacao"},a._l(5,(function(o){return t("div",{key:o,staticClass:"estrela",class:{ativa:a.feedback.avaliacao>=o},on:{click:function(t){a.feedback.avaliacao=o}}},[a._v(" ★ ")])})),0)]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"comentario"}},[a._v("Descreva o problema ou feedback*")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.feedback.comentario,expression:"feedback.comentario"}],attrs:{id:"comentario",rows:"4",placeholder:"Ex: Equipamento apresentou falha após 3 meses de uso...",required:""},domProps:{value:a.feedback.comentario},on:{input:function(t){t.target.composing||a.$set(a.feedback,"comentario",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.loading}},[a._v(" "+a._s(a.loading?"Enviando...":"Enviar Feedback")+" ")])])])])},ya=[];const Da={name:"FormularioRDM",data(){return{feedback:{produto_id:"",avaliacao:0,comentario:""},produtos:[],loading:!1,currentUser:null,currentTenantId:null}},created(){this.carregarProdutos(),this.obterUsuarioAtual()},methods:{async obterUsuarioAtual(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;t?(this.currentUser=t,t.user_metadata?.tenant_id?this.currentTenantId=t.user_metadata.tenant_id:this.currentTenantId=(0,h.A)()):this.currentTenantId=(0,h.A)()}catch(a){console.error("Erro ao obter dados do usuário:",a),this.currentTenantId=(0,h.A)()}},async carregarProdutos(){try{if(await this.obterUsuarioAtual(),!this.currentTenantId)return console.error("Não foi possível identificar o tenant_id"),void(this.produtos=[]);console.log("Carregando produtos para o tenant:",this.currentTenantId);const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("status","aprovado").eq("tenant_id",this.currentTenantId).order("nome");if(t)throw t;console.log("Produtos carregados:",a?.length||0),this.produtos=a||[]}catch(a){console.error("Erro ao carregar produtos:",a),alert("Erro ao carregar produtos. Por favor, tente novamente.")}},async enviarFeedback(){if(0!==this.feedback.avaliacao)try{let t;if(this.loading=!0,this.currentTenantId||(this.currentTenantId=(0,h.A)()),this.currentUser?.email){console.log("Buscando ID do usuário na tabela usuarios pelo email:",this.currentUser.email);const{data:o,error:e}=await g.ND.from("usuarios").select("id").eq("email",this.currentUser.email).maybeSingle();if(e&&console.error("Erro ao buscar usuário:",e),o?.id)t=o.id,console.log("ID do usuário encontrado na tabela usuarios:",t);else{console.warn("Usuário não encontrado na tabela usuarios, gerando ID temporário"),t=(0,h.A)();try{const{error:a}=await g.ND.from("usuarios").insert({id:t,email:this.currentUser.email,nome:this.currentUser.email.split("@")[0],tenant_id:this.currentTenantId,tipo:"cliente",ativo:!0});a&&console.error("Erro ao criar usuário na tabela:",a)}catch(a){console.error("Exceção ao criar usuário:",a)}}}else console.warn("Usuário não está autenticado, gerando ID temporário"),t=(0,h.A)();console.log("Enviando feedback com:",{produto_id:this.feedback.produto_id,usuario_id:t,tenant_id:this.currentTenantId});const{error:o}=await g.ND.from("rdm_feedbacks").insert({produto_id:this.feedback.produto_id,usuario_id:t,tenant_id:this.currentTenantId,avaliacao:this.feedback.avaliacao,comentario:this.feedback.comentario});if(o)throw o;this.$swal({icon:"success",title:"Feedback enviado!",text:"Seu feedback foi enviado com sucesso."}),this.limparFormulario()}catch(t){console.error("Erro ao enviar feedback:",t),this.$swal({icon:"error",title:"Erro ao enviar feedback",text:"Por favor, tente novamente."})}finally{this.loading=!1}else alert("Por favor, selecione uma avaliação de 1 a 5 estrelas.")},limparFormulario(){this.feedback={produto_id:"",avaliacao:0,comentario:""}}}},Ea=Da;var Pa=(0,i.A)(Ea,wa,ya,!1,null,"54d896ba",null);const Ia=Pa.exports,Na={name:"Feedback",components:{FormularioRDM:Ia},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},Aa=Na;var xa=(0,i.A)(Aa,ba,Ca,!1,null,"874642e6",null);const ka=xa.exports;e.Ay.use(c.Ay);const Ta=[{path:"/",name:"Home",component:E,meta:{requiresAuth:!1}},{path:"/dashboard",name:"Dashboard",component:F,meta:{requiresAuth:!0}},{path:"/cadastro",name:"Cadastro",component:H,meta:{requiresAuth:!0}},{path:"/analise/:id",name:"Analise",component:ia,meta:{requiresAuth:!0}},{path:"/catalogo",name:"Catalogo",component:_a,meta:{requiresAuth:!0}},{path:"/feedback",name:"Feedback",component:ka,meta:{requiresAuth:!0}},{path:"/produtos/:id",name:"DetalheProduto",component:()=>o.e(961).then(o.bind(o,342)),props:!0,meta:{requiresAuth:!0}}],Sa=new c.Ay({mode:"history",base:"/ComprarBem/",routes:Ta});Sa.beforeEach((async(a,t,o)=>{const{data:e}=await g.ND.auth.getSession(),r=e?.session?.user,s=a.matched.some((a=>a.meta.requiresAuth));s&&!r?o("/"):o()}));const qa=Sa;var $a=o(353);e.Ay.use($a.Ay);const Ma=new $a.Ay.Store({state:{user:null,tenant:null,isLoading:!1},mutations:{SET_USER(a,t){a.user=t},SET_TENANT(a,t){a.tenant=t},SET_LOADING(a,t){a.isLoading=t}},actions:{async fetchUser({commit:a}){const{data:t}=await g.ND.auth.getSession(),o=t?.session?.user;if(a("SET_USER",o),o){const{data:t,error:e}=await g.ND.from("tenants").select("*").eq("id",o.user_metadata?.tenant_id).single();!e&&t&&a("SET_TENANT",t)}},setLoading({commit:a},t){a("SET_LOADING",t)}},getters:{isAuthenticated:a=>!!a.user,currentUser:a=>a.user,currentTenant:a=>a.tenant,isLoading:a=>a.isLoading}});var Fa=o(640),Oa=o(201),Ua=o.n(Oa);e.Ay.config.productionTip=!1,e.Ay.use(Fa.A),e.Ay.use(Ua()),new e.Ay({router:qa,store:Ma,render:a=>a(l)}).$mount("#app")}},t={};function o(e){var r=t[e];if(void 0!==r)return r.exports;var s=t[e]={exports:{}};return a[e].call(s.exports,s,s.exports,o),s.exports}o.m=a,(()=>{var a=[];o.O=(t,e,r,s)=>{if(!e){var i=1/0;for(c=0;c<a.length;c++){for(var[e,r,s]=a[c],n=!0,d=0;d<e.length;d++)(!1&s||i>=s)&&Object.keys(o.O).every((a=>o.O[a](e[d])))?e.splice(d--,1):(n=!1,s<i&&(i=s));if(n){a.splice(c--,1);var l=r();void 0!==l&&(t=l)}}return t}s=s||0;for(var c=a.length;c>0&&a[c-1][2]>s;c--)a[c]=a[c-1];a[c]=[e,r,s]}})(),(()=>{o.n=a=>{var t=a&&a.__esModule?()=>a["default"]:()=>a;return o.d(t,{a:t}),t}})(),(()=>{var a,t=Object.getPrototypeOf?a=>Object.getPrototypeOf(a):a=>a.__proto__;o.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"===typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"===typeof e.then)return e}var s=Object.create(null);o.r(s);var i={};a=a||[null,t({}),t([]),t(t)];for(var n=2&r&&e;"object"==typeof n&&!~a.indexOf(n);n=t(n))Object.getOwnPropertyNames(n).forEach((a=>i[a]=()=>e[a]));return i["default"]=()=>e,o.d(s,i),s}})(),(()=>{o.d=(a,t)=>{for(var e in t)o.o(t,e)&&!o.o(a,e)&&Object.defineProperty(a,e,{enumerable:!0,get:t[e]})}})(),(()=>{o.f={},o.e=a=>Promise.all(Object.keys(o.f).reduce(((t,e)=>(o.f[e](a,t),t)),[]))})(),(()=>{o.u=a=>"js/"+a+"."+{591:"fd9cb239",961:"8d790549"}[a]+".js"})(),(()=>{o.miniCssF=a=>"css/"+a+".401b363e.css"})(),(()=>{o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"===typeof window)return window}}()})(),(()=>{o.o=(a,t)=>Object.prototype.hasOwnProperty.call(a,t)})(),(()=>{var a={},t="comprar-bem:";o.l=(e,r,s,i)=>{if(a[e])a[e].push(r);else{var n,d;if(void 0!==s)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==t+s){n=u;break}}n||(d=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,o.nc&&n.setAttribute("nonce",o.nc),n.setAttribute("data-webpack",t+s),n.src=e),a[e]=[r];var v=(t,o)=>{n.onerror=n.onload=null,clearTimeout(m);var r=a[e];if(delete a[e],n.parentNode&&n.parentNode.removeChild(n),r&&r.forEach((a=>a(o))),t)return t(o)},m=setTimeout(v.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=v.bind(null,n.onerror),n.onload=v.bind(null,n.onload),d&&document.head.appendChild(n)}}})(),(()=>{o.r=a=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})}})(),(()=>{o.p="/ComprarBem/"})(),(()=>{if("undefined"!==typeof document){var a=(a,t,e,r,s)=>{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",o.nc&&(i.nonce=o.nc);var n=o=>{if(i.onerror=i.onload=null,"load"===o.type)r();else{var e=o&&o.type,n=o&&o.target&&o.target.href||t,d=new Error("Loading CSS chunk "+a+" failed.\n("+e+": "+n+")");d.name="ChunkLoadError",d.code="CSS_CHUNK_LOAD_FAILED",d.type=e,d.request=n,i.parentNode&&i.parentNode.removeChild(i),s(d)}};return i.onerror=i.onload=n,i.href=t,e?e.parentNode.insertBefore(i,e.nextSibling):document.head.appendChild(i),i},t=(a,t)=>{for(var o=document.getElementsByTagName("link"),e=0;e<o.length;e++){var r=o[e],s=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(s===a||s===t))return r}var i=document.getElementsByTagName("style");for(e=0;e<i.length;e++){r=i[e],s=r.getAttribute("data-href");if(s===a||s===t)return r}},e=e=>new Promise(((r,s)=>{var i=o.miniCssF(e),n=o.p+i;if(t(i,n))return r();a(e,n,null,r,s)})),r={524:0};o.f.miniCss=(a,t)=>{var o={961:1};r[a]?t.push(r[a]):0!==r[a]&&o[a]&&t.push(r[a]=e(a).then((()=>{r[a]=0}),(t=>{throw delete r[a],t})))}}})(),(()=>{var a={524:0};o.f.j=(t,e)=>{var r=o.o(a,t)?a[t]:void 0;if(0!==r)if(r)e.push(r[2]);else{var s=new Promise(((o,e)=>r=a[t]=[o,e]));e.push(r[2]=s);var i=o.p+o.u(t),n=new Error,d=e=>{if(o.o(a,t)&&(r=a[t],0!==r&&(a[t]=void 0),r)){var s=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;n.message="Loading chunk "+t+" failed.\n("+s+": "+i+")",n.name="ChunkLoadError",n.type=s,n.request=i,r[1](n)}};o.l(i,d,"chunk-"+t,t)}},o.O.j=t=>0===a[t];var t=(t,e)=>{var r,s,[i,n,d]=e,l=0;if(i.some((t=>0!==a[t]))){for(r in n)o.o(n,r)&&(o.m[r]=n[r]);if(d)var c=d(o)}for(t&&t(e);l<i.length;l++)s=i[l],o.o(a,s)&&a[s]&&a[s][0](),a[s]=0;return o.O(c)},e=self["webpackChunkcomprar_bem"]=self["webpackChunkcomprar_bem"]||[];e.forEach(t.bind(null,0)),e.push=t.bind(null,e.push.bind(e))})();var e=o.O(void 0,[504],(()=>o(472)));e=o.O(e)})();
//# sourceMappingURL=app.119ce187.js.map