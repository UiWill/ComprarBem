"use strict";(self["webpackChunkcomprar_bem"]=self["webpackChunkcomprar_bem"]||[]).push([[46],{2046:(a,s,e)=>{e.r(s),e.d(s,{default:()=>d});var t=function(){var a=this,s=a._self._c;return s("div",{staticClass:"debug-usuarios"},[s("div",{staticClass:"card"},[a._m(0),s("div",{staticClass:"card-body"},[s("div",{staticClass:"debug-actions"},[s("button",{staticClass:"btn btn-primary",attrs:{disabled:a.carregando},on:{click:a.verificarSistema}},[s("i",{staticClass:"fas fa-search"}),a._v(" Verificar Sistema ")]),s("button",{staticClass:"btn btn-warning",attrs:{disabled:a.carregando},on:{click:a.limparUsuariosOrfaos}},[s("i",{staticClass:"fas fa-broom"}),a._v(" Limpar Ã“rfÃ£os ")]),s("button",{staticClass:"btn btn-danger",attrs:{disabled:a.carregando},on:{click:a.limparTudo}},[s("i",{staticClass:"fas fa-trash"}),a._v(" Limpar Tudo ")])]),a.carregando?s("div",{staticClass:"loading"},[s("i",{staticClass:"fas fa-spinner fa-spin"}),a._v(" Carregando... ")]):a._e(),a.resultados?s("div",{staticClass:"resultados"},[s("h4",[a._v("ðŸ“Š DiagnÃ³stico do Sistema")]),s("div",{staticClass:"secao"},[s("h5",[a._v("ðŸ‘¥ UsuÃ¡rios na Tabela ("+a._s(a.usuariosTabela.length)+")")]),0===a.usuariosTabela.length?s("div",{staticClass:"alert alert-success"},[a._v(" âœ… Nenhum usuÃ¡rio encontrado - tabela limpa ")]):s("div",{staticClass:"usuarios-lista"},a._l(a.usuariosTabela,(function(e){return s("div",{key:e.id,staticClass:"usuario-item"},[s("strong",[a._v(a._s(e.email))]),a._v(" - "+a._s(e.nome)+" "),s("span",{staticClass:"badge",class:e.ativo?"badge-success":"badge-danger"},[a._v(" "+a._s(e.ativo?"Ativo":"Inativo")+" ")]),s("span",{staticClass:"badge badge-info"},[a._v(a._s(e.tipo))]),s("span",{staticClass:"badge badge-secondary"},[a._v(a._s(e.perfil_usuario))])])})),0)]),s("div",{staticClass:"secao"},[s("h5",[a._v("ðŸ¢ Tenants ("+a._s(a.tenants.length)+")")]),0===a.tenants.length?s("div",{staticClass:"alert alert-success"},[a._v(" âœ… Nenhum tenant encontrado - tabela limpa ")]):s("div",{staticClass:"tenants-lista"},a._l(a.tenants,(function(e){return s("div",{key:e.id,staticClass:"tenant-item"},[s("strong",[a._v(a._s(e.nome))]),a._v(" - ID: "+a._s(e.id)+" "),s("span",{staticClass:"badge",class:e.ativo?"badge-success":"badge-danger"},[a._v(" "+a._s(e.ativo?"Ativo":"Inativo")+" ")])])})),0)]),s("div",{staticClass:"secao"},[s("h5",[a._v("ðŸ“§ Teste de Emails")]),s("div",{staticClass:"email-teste"},[s("input",{directives:[{name:"model",rawName:"v-model",value:a.emailTeste,expression:"emailTeste"}],staticClass:"form-control",attrs:{type:"email",placeholder:"Digite um email para testar"},domProps:{value:a.emailTeste},on:{input:function(s){s.target.composing||(a.emailTeste=s.target.value)}}}),s("button",{staticClass:"btn btn-secondary",on:{click:a.testarEmail}},[s("i",{staticClass:"fas fa-check"}),a._v(" Testar ")])]),a.resultadoEmailTeste?s("div",{staticClass:"mt-2"},[a._v(" "+a._s(a.resultadoEmailTeste)+" ")]):a._e()])]):a._e(),a.mensagem?s("div",{staticClass:"alert",class:a.tipoMensagem},[a._v(" "+a._s(a.mensagem)+" ")]):a._e()])])])},r=[function(){var a=this,s=a._self._c;return s("div",{staticClass:"card-header"},[s("h3",[a._v("ðŸ” Debug - Sistema de UsuÃ¡rios")]),s("p",[a._v("Ferramenta para diagnosticar problemas de usuÃ¡rios Ã³rfÃ£os")])])}],i=e(452);class o{static async limparUsuariosPorEmails(a){console.log("ðŸ§¹ Iniciando limpeza de usuÃ¡rios Ã³rfÃ£os para emails:",a);const s=[];for(const t of a)try{console.log(`ðŸ” Verificando usuÃ¡rio: ${t}`);const{data:a}=await i.ND.from("usuarios").select("email").eq("email",t).maybeSingle();a?(console.log(`âœ… UsuÃ¡rio ${t} existe corretamente na tabela`),s.push({email:t,status:"ok",mensagem:"UsuÃ¡rio existe corretamente"})):(console.log(`âŒ UsuÃ¡rio ${t} nÃ£o encontrado na tabela usuarios - pode ser Ã³rfÃ£o no Auth`),s.push({email:t,status:"orfao_detectado",mensagem:"UsuÃ¡rio existe no Auth mas nÃ£o na tabela usuarios"}))}catch(e){console.error(`Erro ao verificar ${t}:`,e),s.push({email:t,status:"erro",mensagem:e.message})}return s}static async emailEstaLivre(a){try{const{data:s}=await i.ND.from("usuarios").select("email").eq("email",a).maybeSingle();return!s}catch(s){return console.error("Erro ao verificar email:",s),!1}}static async listarUsuariosTabela(){try{const{data:a,error:s}=await i.ND.from("usuarios").select("id, email, nome, tipo, perfil_usuario, tenant_id, ativo").order("criado_em",{ascending:!1});if(s)throw s;return a||[]}catch(a){throw console.error("Erro ao listar usuÃ¡rios:",a),a}}static async removerUsuarioTabela(a){try{console.log(`ðŸ—‘ï¸ Removendo usuÃ¡rio ${a} da tabela usuarios`);const{error:s}=await i.ND.from("usuarios").delete().eq("email",a);if(s)throw s;return console.log(`âœ… UsuÃ¡rio ${a} removido da tabela usuarios`),!0}catch(s){throw console.error(`Erro ao remover usuÃ¡rio ${a}:`,s),s}}static async removerTenant(a){try{console.log(`ðŸ—‘ï¸ Removendo tenant ${a}`),await i.ND.from("usuarios").delete().eq("tenant_id",a);const{error:s}=await i.ND.from("tenants").delete().eq("id",a);if(s)throw s;return console.log(`âœ… Tenant ${a} removido`),!0}catch(s){throw console.error(`Erro ao remover tenant ${a}:`,s),s}}static async limpezaCompleta(a){console.log("ðŸ§¹ LIMPEZA COMPLETA INICIADA"),console.log("Emails para limpar:",a);try{for(const t of a)try{await this.removerUsuarioTabela(t)}catch(s){console.warn(`Aviso: nÃ£o foi possÃ­vel remover ${t} da tabela usuarios`)}const{data:e}=await i.ND.from("tenants").select("id, nome").not("id","in",`(${(await i.ND.from("usuarios").select("tenant_id").neq("tenant_id",null)).data?.map((a=>`'${a.tenant_id}'`)).join(",")||"''"})`);if(e&&e.length>0){console.log("ðŸ—‘ï¸ Removendo tenants Ã³rfÃ£os:",e);for(const a of e)try{await this.removerTenant(a.id)}catch(s){console.warn(`Aviso: erro ao remover tenant Ã³rfÃ£o ${a.id}`)}}return console.log("âœ… LIMPEZA COMPLETA FINALIZADA"),!0}catch(s){throw console.error("Erro na limpeza completa:",s),s}}}const n=o,l={name:"DebugUsuarios",data(){return{carregando:!1,resultados:null,usuariosTabela:[],tenants:[],mensagem:"",tipoMensagem:"",emailTeste:"teste@exemplo.com",resultadoEmailTeste:""}},methods:{async verificarSistema(){try{this.carregando=!0,this.mensagem="",console.log("ðŸ” Iniciando verificaÃ§Ã£o do sistema..."),this.usuariosTabela=await n.listarUsuariosTabela();const{data:a}=await i.ND.from("tenants").select("*").order("criado_em",{ascending:!1});this.tenants=a||[],this.resultados=!0,this.mostrarMensagem("Sistema verificado com sucesso!","alert-success")}catch(a){console.error("Erro na verificaÃ§Ã£o:",a),this.mostrarMensagem(`Erro: ${a.message}`,"alert-danger")}finally{this.carregando=!1}},async limparUsuariosOrfaos(){try{this.carregando=!0;const a=this.usuariosTabela.map((a=>a.email));if(0===a.length)return void this.mostrarMensagem("Nenhum usuÃ¡rio para limpar","alert-info");const s=confirm(`Deseja limpar ${a.length} usuÃ¡rios Ã³rfÃ£os?`);if(!s)return;await n.limpezaCompleta(a),this.mostrarMensagem("Limpeza concluÃ­da!","alert-success"),await this.verificarSistema()}catch(a){console.error("Erro na limpeza:",a),this.mostrarMensagem(`Erro: ${a.message}`,"alert-danger")}finally{this.carregando=!1}},async limparTudo(){try{const a=confirm("âš ï¸ ATENÃ‡ÃƒO: Isso irÃ¡ deletar TODOS os usuÃ¡rios e tenants. Continuar?");if(!a)return;const s=confirm("Tem certeza? Esta aÃ§Ã£o nÃ£o pode ser desfeita!");if(!s)return;this.carregando=!0,await i.ND.from("usuarios").delete().neq("id","00000000-0000-0000-0000-000000000000"),await i.ND.from("tenants").delete().neq("id","00000000-0000-0000-0000-000000000000"),this.mostrarMensagem("Sistema completamente limpo!","alert-success"),await this.verificarSistema()}catch(a){console.error("Erro na limpeza completa:",a),this.mostrarMensagem(`Erro: ${a.message}`,"alert-danger")}finally{this.carregando=!1}},async testarEmail(){try{if(!this.emailTeste)return;const a=await n.emailEstaLivre(this.emailTeste);this.resultadoEmailTeste=a?`âœ… Email ${this.emailTeste} estÃ¡ LIVRE para uso`:`âŒ Email ${this.emailTeste} JÃ EXISTE no sistema`}catch(a){this.resultadoEmailTeste=`Erro: ${a.message}`}},mostrarMensagem(a,s){this.mensagem=a,this.tipoMensagem=s,setTimeout((()=>{this.mensagem=""}),5e3)}},mounted(){this.verificarSistema()}},c=l;var m=e(1656),u=(0,m.A)(c,t,r,!1,null,"335ff1eb",null);const d=u.exports}}]);
//# sourceMappingURL=46.3949ee61.js.map