(()=>{"use strict";var a={452:(a,t,o)=>{o.d(t,{ND:()=>i});var e=o(17);const r="https://ruagsbbczuwgfflgcaol.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1YWdzYmJjenV3Z2ZmbGdjYW9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ0Njg5MDQsImV4cCI6MjA2MDA0NDkwNH0.S2KD6-9DpBYAOsodjibI7LGa04CspZZ5OdRQagNjoK8",i=(0,e.UU)(r,s)},548:(a,t,o)=>{var e=o(471),r=function(){var a=this,t=a._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},s=[],i=o(656),n={},l=(0,i.A)(n,r,s,!1,null,null,null);const d=l.exports;var c=o(173),u=function(){var a=this,t=a._self._c;return t("div",{staticClass:"home"},[t("Login")],1)},v=[],m=function(){var a=this,t=a._self._c;return t("div",{staticClass:"login-container"},[t("div",{staticClass:"login-card"},[t("h2",[a._v("Comprar Bem: Compras Inteligentes")]),t("p",[a._v("Saúde e Administração")]),t("div",{staticClass:"tabs"},[t("button",{class:{active:"login"===a.activeTab},on:{click:function(t){a.activeTab="login"}}},[a._v("Login")]),t("button",{class:{active:"register"===a.activeTab},on:{click:function(t){a.activeTab="register"}}},[a._v("Registrar")])]),"login"===a.activeTab?t("div",[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[a._v("E-mail")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.email,expression:"email"}],attrs:{id:"email",type:"email",placeholder:"Seu e-mail",required:""},domProps:{value:a.email},on:{input:function(t){t.target.composing||(a.email=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"password"}},[a._v("Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.password,expression:"password"}],attrs:{id:"password",type:"password",placeholder:"Sua senha",required:""},domProps:{value:a.password},on:{input:function(t){t.target.composing||(a.password=t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{disabled:a.loading},on:{click:a.login}},[a._v(" "+a._s(a.loading?"Entrando...":"Entrar")+" ")])]):a._e(),"register"===a.activeTab?t("div",[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registerEmail"}},[a._v("E-mail")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.registerEmail,expression:"registerEmail"}],attrs:{id:"registerEmail",type:"email",placeholder:"Seu e-mail",required:""},domProps:{value:a.registerEmail},on:{input:function(t){t.target.composing||(a.registerEmail=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registerPassword"}},[a._v("Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.registerPassword,expression:"registerPassword"}],attrs:{id:"registerPassword",type:"password",placeholder:"Sua senha",required:""},domProps:{value:a.registerPassword},on:{input:function(t){t.target.composing||(a.registerPassword=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"confirmPassword"}},[a._v("Confirmar Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.confirmPassword,expression:"confirmPassword"}],attrs:{id:"confirmPassword",type:"password",placeholder:"Confirme sua senha",required:""},domProps:{value:a.confirmPassword},on:{input:function(t){t.target.composing||(a.confirmPassword=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeInstitucional"}},[a._v("Nome da Instituição")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nomeInstitucional,expression:"nomeInstitucional"}],attrs:{id:"nomeInstitucional",type:"text",placeholder:"Nome da sua instituição",required:""},domProps:{value:a.nomeInstitucional},on:{input:function(t){t.target.composing||(a.nomeInstitucional=t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{type:"button"},on:{click:a.register}},[a._v(" "+a._s(a.loading?"Registrando...":"Registrar")+" ")]),t("button",{staticClass:"btn-test",staticStyle:{"margin-top":"10px"},on:{click:a.testeSimples}},[a._v(" Teste Simples ")]),a.validRegistration?a._e():t("div",{staticClass:"validation-info"},[t("p",[a._v("O formulário não está válido porque:")]),t("ul",[a.registerEmail?a._e():t("li",[a._v("Falta o e-mail")]),a.registerPassword?a._e():t("li",[a._v("Falta a senha")]),a.registerPassword&&a.registerPassword.length<6?t("li",[a._v("A senha precisa ter pelo menos 6 caracteres")]):a._e(),a.registerPassword!==a.confirmPassword?t("li",[a._v("As senhas não conferem")]):a._e(),a.nomeInstitucional?a._e():t("li",[a._v("Falta o nome da instituição")])])])]):a._e(),a.errorMsg?t("p",{staticClass:"error-message"},[a._v(a._s(a.errorMsg))]):a._e(),"register"===a.activeTab?t("div",{staticClass:"test-buttons"},[t("button",{staticClass:"btn-test",on:{click:a.testarSupabase}},[a._v("Testar Conexão Supabase")])]):a._e()])])},p=[],g=o(452),h=o(303);const _={name:"Login",data(){return{activeTab:"login",email:"",password:"",registerEmail:"",registerPassword:"",confirmPassword:"",nomeInstitucional:"",loading:!1,errorMsg:""}},computed:{validRegistration(){return this.registerEmail&&this.registerPassword&&this.registerPassword===this.confirmPassword&&this.nomeInstitucional&&this.registerPassword.length>=6}},mounted(){console.log("Componente Login montado",{activeTab:this.activeTab})},watch:{activeTab(a){console.log("Aba ativa alterada para:",a)},registerEmail(a){console.log("E-mail de registro alterado:",a)},registerPassword(a){console.log("Senha de registro alterada:",a?"****":"")}},methods:{async testarSupabase(){console.log("Testando conexão com Supabase...");try{const{data:a,error:t}=await g.ND.from("tenants").select("*").limit(1);console.log("Resultado do teste tabela tenants:",{data:a,error:t}),t?alert(`Erro ao acessar tabela: ${t.message}`):alert(`Conexão OK! ${a?a.length:0} registros encontrados.`);const o=(0,h.A)();console.log("Teste UUID gerado:",o)}catch(a){console.error("Erro no teste:",a),alert(`Erro na conexão: ${a.message}`)}},async login(){try{this.loading=!0,this.errorMsg="";const{error:a}=await g.ND.auth.signInWithPassword({email:this.email,password:this.password});if(a)throw a;this.$router.push("/dashboard")}catch(a){this.errorMsg=a.message||"Erro ao fazer login"}finally{this.loading=!1}},async register(){if(console.log("Método register chamado",{email:this.registerEmail,password:"****",nomeInstitucional:this.nomeInstitucional}),!this.validRegistration)return console.log("Formulário inválido"),void(this.errorMsg="Verifique os campos do formulário");try{this.loading=!0,this.errorMsg="",console.log("Iniciando registro de usuário no Supabase...");const{data:t,error:o}=await g.ND.auth.signUp({email:this.registerEmail,password:this.registerPassword});if(console.log("Resposta do registro de usuário:",{authData:t,authError:o}),o&&!o.message.includes("already registered"))throw o;const e=t?.user?.id;console.log("ID da autenticação:",e);const r=(0,h.A)(),s=(0,h.A)();try{const{error:a}=await g.ND.from("usuarios").delete().eq("email",this.registerEmail);a&&console.warn("Aviso ao tentar remover usuário existente:",a)}catch(a){console.warn("Erro ao tentar remover usuário:",a)}console.log("Criando tenant...");const{data:i,error:n}=await g.ND.from("tenants").insert({id:r,nome:this.nomeInstitucional,descricao:`Tenant para ${this.registerEmail}`,ativo:!0}).select();if(n)throw new Error(`Erro ao criar tenant: ${n.message}`);console.log("Criando usuário...");const{data:l,error:d}=await g.ND.from("usuarios").insert({id:s,email:this.registerEmail,nome:this.nomeInstitucional,tenant_id:r,tipo:"admin",ativo:!0}).select();if(d)throw d.message.includes("duplicate key")?(this.errorMsg="Este email já está registrado. Por favor, contate o suporte.",new Error(`Email já existe na base de dados: ${d.message}`)):new Error(`Erro ao criar usuário: ${d.message}`);console.log("Atualizando tenant com user_id...");const{error:c}=await g.ND.from("tenants").update({user_id:e}).eq("id",r);c&&console.warn("Aviso: Não foi possível atualizar o tenant com user_id:",c),console.log("Registro concluído com sucesso!"),alert("Registro realizado com sucesso! Verifique seu e-mail para confirmar a conta."),this.activeTab="login",this.email=this.registerEmail}catch(t){console.error("Erro detalhado no registro:",t),this.errorMsg=this.errorMsg||t.message||"Erro ao fazer registro"}finally{this.loading=!1}},testeSimples(){console.log("Botão de teste simples clicado"),alert("Teste de evento de clique funcionando!")}}},f=_;var C=(0,i.A)(f,m,p,!1,null,"0af2f7e3",null);const b=C.exports,w={name:"Home",components:{Login:b}},D=w;var y=(0,i.A)(D,u,v,!1,null,null,null);const P=y.exports;var E=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/classificacao"}},[a._v("Classificação")]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("DashboardCPM")],1)])},N=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Inteligentes")])])])}],A=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard"},[t("h2",[a._v("Painel CPM")]),t("div",{staticClass:"tabs"},[t("div",{staticClass:"tab",class:{active:"dashboard"===a.activeTab},on:{click:function(t){a.activeTab="dashboard"}}},[a._v(" Dashboard ")]),t("div",{staticClass:"tab",class:{active:"pesquisa"===a.activeTab},on:{click:function(t){a.activeTab="pesquisa"}}},[a._v(" Pesquisa de Mercado ")]),t("div",{staticClass:"tab",class:{active:"despadronizadas"===a.activeTab},on:{click:function(t){a.activeTab="despadronizadas"}}},[a._v(" Marcas Despadronizadas ")])]),"dashboard"===a.activeTab?t("div",[t("div",{staticClass:"stats-container"},[t("div",{staticClass:"stat-card status-pendente-card"},[t("h3",[a._v("Produtos em Avaliação")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.pendentes))])]),t("div",{staticClass:"stat-card status-aprovado-card"},[t("h3",[a._v("Produtos Aprovados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.aprovados))])]),t("div",{staticClass:"stat-card status-reprovado-card"},[t("h3",[a._v("Produtos Reprovados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.reprovados))])])]),t("div",{staticClass:"recent-products"},[t("h3",[a._v("Requerimentos Recentes")]),a.produtos.length>0?t("table",[a._m(0),t("tbody",a._l(a.produtos,(function(o){return t("tr",{key:o.id},[t("td",[a._v(a._s(o.nome))]),t("td",[a._v(a._s(o.marca))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(o.status)},[a._v(" "+a._s(a.formatarStatus(o.status))+" ")])]),t("td",[a._v(a._s(a.formatDate(o.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.verProduto(o.id)}}},[a._v("Ver")])])])})),0)]):t("p",[a._v("Nenhum requerimento cadastrado.")])]),t("div",{staticClass:"diligencia-section"},[t("h3",[a._v("Requerimentos com Diligências")]),a.produtosComDiligencia.length>0?t("table",[a._m(1),t("tbody",a._l(a.produtosComDiligencia,(function(o){return t("tr",{key:o.id},[t("td",[a._v(a._s(o.nome))]),t("td",[a._v(a._s(o.marca))]),a._m(2,!0),t("td",[a._v(a._s(a.formatDate(o.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.verProduto(o.id)}}},[a._v("Ver")])])])})),0)]):t("p",[a._v("Nenhum requerimento com diligência encontrado.")])])]):a._e(),"pesquisa"===a.activeTab?t("div",{staticClass:"pesquisa-mercado"},[a._m(3)]):a._e(),"despadronizadas"===a.activeTab?t("div",{staticClass:"marcas-despadronizadas"},[a._m(4)]):a._e()])},k=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Ações")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Ações")])])])},function(){var a=this,t=a._self._c;return t("td",[t("span",{staticClass:"status-badge status-diligencia"},[a._v(" Diligência ")])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Pesquisa de Mercado")]),t("p",[a._v("Este módulo permitirá realizar pesquisas de preços e análises de mercado para produtos padronizados.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Registro de cotações de fornecedores")]),t("li",[a._v("Comparativo de preços e condições")]),t("li",[a._v("Análise de variação de preços")]),t("li",[a._v("Geração de relatórios para processos de compra")]),t("li",[a._v("Integração com bancos de preços públicos")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Marcas Despadronizadas")]),t("p",[a._v("Este módulo permitirá gerenciar marcas e produtos que foram despadronizados ou que não atendem mais aos requisitos de padronização.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Registro de marcas e produtos despadronizados")]),t("li",[a._v("Motivos e justificativas para despadronização")]),t("li",[a._v("Histórico de padronizações e revogações")]),t("li",[a._v("Restrições de uso para produtos despadronizados")]),t("li",[a._v("Notificação aos setores sobre despadronizações")]),t("li",[a._v("Relatórios de impacto por despadronização")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])}];const x={name:"DashboardCPM",data(){return{activeTab:"dashboard",produtos:[],produtosComDiligencia:[],pendentes:0,aprovados:0,reprovados:0,currentTenantId:null,loading:!1}},created(){this.obterTenantId().then((()=>{this.carregarDados()}))},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return this.currentTenantId=t.user_metadata.tenant_id,void console.log("Tenant ID obtido dos metadados:",this.currentTenantId);const{data:o,error:e}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(e)return void console.error("Erro ao buscar tenant_id:",e);o?.tenant_id?(this.currentTenantId=o.tenant_id,console.log("Tenant ID obtido da tabela usuarios:",this.currentTenantId)):console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarDados(){try{if(this.loading=!0,!this.currentTenantId&&(console.error("Tenant ID não disponível. Tentando recarregar..."),await this.obterTenantId(),!this.currentTenantId))return void console.error("Não foi possível obter o tenant_id, impossível carregar dados");console.log("Carregando produtos para tenant_id:",this.currentTenantId);const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1}).limit(10);if(t)throw t;this.produtos=a||[],console.log(`${this.produtos.length} produtos carregados para o tenant atual`);const{data:o,error:e}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).eq("status","diligencia").order("criado_em",{ascending:!1}).limit(10);if(e)throw e;this.produtosComDiligencia=o||[],console.log(`${this.produtosComDiligencia.length} produtos com diligência carregados`);const r=await Promise.all([this.contarPorStatus("pendente"),this.contarPorStatus("aprovado"),this.contarPorStatus("reprovado")]);this.pendentes=r[0],this.aprovados=r[1],this.reprovados=r[2]}catch(a){console.error("Erro ao carregar dados:",a)}finally{this.loading=!1}},async contarPorStatus(a){if(!this.currentTenantId)return 0;const{count:t,error:o}=await g.ND.from("produtos").select("id",{count:"exact"}).eq("status",a).eq("tenant_id",this.currentTenantId);return o?(console.error(`Erro ao contar produtos ${a}:`,o),0):t||0},formatDate(a){if(!a)return"";const t=new Date(a);return t.toLocaleDateString("pt-BR")},formatarStatus(a){return"pendente"===a?"em avaliação":a},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},verProduto(a){this.$router.push(`/analise/${a}`)}}},I=x;var T=(0,i.A)(I,A,k,!1,null,"6f67ad74",null);const S=T.exports,q={name:"Dashboard",components:{DashboardCPM:S},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},M=q;var $=(0,i.A)(M,E,N,!1,null,"c605a642",null);const F=$.exports;var O=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cadastro-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/classificacao"}},[a._v("Classificação")]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("CadastroProduto")],1)])},R=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Inteligentes")])])])}],j=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cadastro-produto"},[t("h2",[a._v("Cadastro de Produto")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarProduto.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome do Produto*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.nome,expression:"produto.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.produto.nome},on:{input:function(t){t.target.composing||a.$set(a.produto,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"grupo"}},[a._v("Grupo*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produto.grupo_id,expression:"produto.grupo_id"}],attrs:{id:"grupo",required:""},on:{change:[function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.produto,"grupo_id",t.target.multiple?o:o[0])},a.onGrupoChange]}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.grupos,(function(o){return t("option",{key:o.id,domProps:{value:o.id}},[a._v(" "+a._s(o.nome)+" ")])}))],2)])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"classe"}},[a._v("Classe*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produto.classe_id,expression:"produto.classe_id"}],attrs:{id:"classe",required:"",disabled:!a.produto.grupo_id||0===a.classes.length},on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.produto,"classe_id",t.target.multiple?o:o[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.filteredClasses,(function(o){return t("option",{key:o.id,domProps:{value:o.id}},[a._v(" "+a._s(o.nome)+" ")])}))],2),a.produto.grupo_id&&0===a.filteredClasses.length?t("div",{staticClass:"info-text"},[a._v(" Não há classes disponíveis para este grupo. Por favor, cadastre uma classe primeiro. ")]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"marca"}},[a._v("Marca*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.marca,expression:"produto.marca"}],attrs:{id:"marca",type:"text",required:""},domProps:{value:a.produto.marca},on:{input:function(t){t.target.composing||a.$set(a.produto,"marca",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"modelo"}},[a._v("Modelo*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.modelo,expression:"produto.modelo"}],attrs:{id:"modelo",type:"text",required:""},domProps:{value:a.produto.modelo},on:{input:function(t){t.target.composing||a.$set(a.produto,"modelo",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"fabricante"}},[a._v("Fabricante*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.fabricante,expression:"produto.fabricante"}],attrs:{id:"fabricante",type:"text",required:""},domProps:{value:a.produto.fabricante},on:{input:function(t){t.target.composing||a.$set(a.produto,"fabricante",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cnpj"}},[a._v("CNPJ*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.cnpjFormatado,expression:"cnpjFormatado"}],attrs:{id:"cnpj",type:"text",required:"",maxlength:"18",placeholder:"00.000.000/0000-00"},domProps:{value:a.cnpjFormatado},on:{input:[function(t){t.target.composing||(a.cnpjFormatado=t.target.value)},a.formatarCNPJ]}}),a.cnpjInvalido?t("small",{staticClass:"error-text"},[a._v("CNPJ inválido. Formato: 00.000.000/0000-00")]):a._e()])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"origem"}},[a._v("Origem")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.origem,expression:"produto.origem"}],attrs:{id:"origem",type:"text",placeholder:"Nacional ou Importado"},domProps:{value:a.produto.origem},on:{input:function(t){t.target.composing||a.$set(a.produto,"origem",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registro_anvisa"}},[a._v("Registro na Anvisa/MS")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.registro_anvisa,expression:"produto.registro_anvisa"}],attrs:{id:"registro_anvisa",type:"text",placeholder:"Número do registro"},domProps:{value:a.produto.registro_anvisa},on:{input:function(t){t.target.composing||a.$set(a.produto,"registro_anvisa",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cbpf"}},[a._v("CBPF")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.cbpf,expression:"produto.cbpf"}],attrs:{id:"cbpf",type:"text",placeholder:"Certificado de Boas Práticas de Fabricação"},domProps:{value:a.produto.cbpf},on:{input:function(t){t.target.composing||a.$set(a.produto,"cbpf",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"codigo_material"}},[a._v("Código do Material")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.codigo_material,expression:"produto.codigo_material"}],attrs:{id:"codigo_material",type:"text",placeholder:"Código interno do material"},domProps:{value:a.produto.codigo_material},on:{input:function(t){t.target.composing||a.$set(a.produto,"codigo_material",t.target.value)}}})])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descrição")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.produto.descricao,expression:"produto.descricao"}],attrs:{id:"descricao",rows:"4"},domProps:{value:a.produto.descricao},on:{input:function(t){t.target.composing||a.$set(a.produto,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Documentos (apenas PDF)")]),t("div",{staticClass:"file-upload"},[t("input",{attrs:{type:"file",multiple:"",accept:".pdf"},on:{change:a.onFileSelect}})]),t("small",{staticClass:"info-text"},[a._v("Apenas arquivos PDF são aceitos (máx. 10MB por arquivo)")]),a.selectedFiles.length>0?t("div",{staticClass:"selected-files"},[t("p",[a._v("Arquivos selecionados:")]),t("ul",a._l(a.selectedFiles,(function(o,e){return t("li",{key:e,class:{"arquivo-invalido":!a.validarArquivoPDF(o)}},[a._v(" "+a._s(o.name)+" "),a.validarArquivoPDF(o)?a._e():t("span",{staticClass:"error-text"},[a._v("(Formato inválido - apenas PDF permitido)")])])})),0)]):a._e(),a.arquivosInvalidos.length>0?t("div",{staticClass:"error-text"},[t("p",[a._v("Os seguintes arquivos não serão enviados (apenas PDF permitido):")]),t("ul",a._l(a.arquivosInvalidos,(function(o,e){return t("li",{key:e},[a._v(" "+a._s(o.name)+" ")])})),0)]):a._e()]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.loading}},[a._v(" "+a._s(a.loading?"Salvando...":"Salvar")+" ")])])])])},z=[];const L={name:"CadastroProduto",data(){return{produto:{nome:"",grupo_id:"",classe_id:"",marca:"",modelo:"",fabricante:"",cnpj:"",origem:"",registro_anvisa:"",cbpf:"",codigo_material:"",descricao:"",status:"pendente"},cnpjFormatado:"",cnpjInvalido:!1,grupos:[],classes:[],selectedFiles:[],arquivosInvalidos:[],loading:!1,currentTenantId:null}},computed:{filteredClasses(){return this.produto.grupo_id?this.classes.filter((a=>a.grupo_id===this.produto.grupo_id)):[]}},async created(){this.carregarGrupos(),await this.obterTenantId()},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)throw new Error("Usuário não autenticado");if(t?.user_metadata?.tenant_id)return console.log("Obteve tenant_id dos metadados:",t.user_metadata.tenant_id),void(this.currentTenantId=t.user_metadata.tenant_id);const{data:o,error:e}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(console.log("Busca de tenant_id na tabela usuarios:",{userData:o,userError:e}),o&&o.tenant_id){console.log("Obteve tenant_id da tabela usuarios:",o.tenant_id),this.currentTenantId=o.tenant_id;const{error:a}=await g.ND.auth.updateUser({data:{tenant_id:o.tenant_id}});return void(a?console.error("Erro ao atualizar metadados do usuário:",a):console.log("Metadados do usuário atualizados com sucesso"))}const r=(0,h.A)();console.log("Gerando novo tenant_id:",r);const{error:s}=await g.ND.from("usuarios").insert({id:(0,h.A)(),email:t.email,tenant_id:r,ativo:!0});s&&console.error("Erro ao inserir novo tenant_id na tabela usuarios:",s);const{error:i}=await g.ND.auth.updateUser({data:{tenant_id:r}});i?console.error("Erro ao atualizar metadados do usuário:",i):console.log("Metadados do usuário atualizados com novo tenant_id"),this.currentTenantId=r}catch(a){console.error("Erro ao obter tenant_id:",a),alert("Erro ao obter identificação do tenant. Por favor, faça login novamente."),this.$router.push("/")}},async carregarGrupos(){try{const{data:a,error:t}=await g.ND.from("grupos").select("*").order("nome");if(t)throw t;a&&a.length>0?this.grupos=a:this.grupos=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}catch(a){console.error("Erro ao carregar grupos:",a),this.grupos=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}},onGrupoChange(){this.carregarClasses()},async carregarClasses(){try{const{data:a,error:t}=await g.ND.from("classes").select("*").eq("grupo_id",this.produto.grupo_id).order("nome");if(t)throw t;a&&a.length>0?this.classes=a:this.classes=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}catch(a){console.error("Erro ao carregar classes:",a),this.classes=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}},formatarCNPJ(a){let t=a.target.value.replace(/\D/g,"");t=t.substring(0,14),t.length>0&&(t=t.replace(/^(\d{2})(\d)/,"$1.$2"),t=t.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3"),t=t.replace(/\.(\d{3})(\d)/,".$1/$2"),t=t.replace(/(\d{4})(\d)/,"$1-$2")),this.cnpjFormatado=t,this.produto.cnpj=this.cnpjFormatado.replace(/\D/g,""),this.validarCNPJ()},validarCNPJ(){const a=this.produto.cnpj;return 14!==a.length||/^(\d)\1+$/.test(a)?(this.cnpjInvalido=!0,!1):(this.cnpjInvalido=!1,!0)},onFileSelect(a){const t=Array.from(a.target.files);this.arquivosInvalidos=[],this.selectedFiles=t.filter((a=>{const t=this.validarArquivoPDF(a);return t||this.arquivosInvalidos.push(a),t}))},validarArquivoPDF(a){const t=a.name.split(".").pop().toLowerCase(),o=a.type.toLowerCase();return"pdf"===t&&"application/pdf"===o},sanitizarNomeArquivo(a){let t=a.normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(t=t.replace(/[^a-zA-Z0-9_.]/g,"_"),t.length>100){const a=t.split(".").pop();t=t.substring(0,90)+"."+a}return t},async salvarProduto(){if(this.validarFormulario())try{if(this.loading=!0,this.currentTenantId||await this.obterTenantId(),console.log("Salvando produto com tenant_id:",this.currentTenantId),!this.validarCNPJ())return this.$swal({icon:"error",title:"CNPJ Inválido",text:"Por favor, informe um CNPJ válido no formato 00.000.000/0000-00"}),void(this.loading=!1);const a={nome:this.produto.nome,descricao:this.produto.descricao,grupo_id:this.produto.grupo_id,classe_id:this.produto.classe_id,marca:this.produto.marca,modelo:this.produto.modelo,fabricante:this.produto.fabricante,cnpj:this.produto.cnpj,origem:this.produto.origem,registro_anvisa:this.produto.registro_anvisa,cbpf:this.produto.cbpf,codigo_material:this.produto.codigo_material,status:"pendente",tenant_id:this.currentTenantId};console.log("Objeto produto a ser inserido:",a);const{data:t,error:o}=await g.ND.from("produtos").insert(a).select().single();if(o)throw console.error("Erro detalhado ao salvar produto:",o),new Error(`Erro ao salvar produto: ${o.message}`);console.log("Produto inserido com sucesso:",t);const e=this.selectedFiles.filter((a=>this.validarArquivoPDF(a)));if(e.length>0){const a=t.id;for(const t of e){const o=t.name,e=this.sanitizarNomeArquivo(t.name),r=`${Date.now()}-${e}`;console.log(`Upload de arquivo: Original "${o}" -> Sanitizado "${e}"`);const{data:s,error:i}=await g.ND.storage.from("documentos").upload(r,t);if(i){console.error("Erro ao fazer upload do arquivo:",i);continue}const{data:n}=g.ND.storage.from("documentos").getPublicUrl(r),l=n?.publicUrl||"",d={tenant_id:this.currentTenantId,produto_id:a,nome:o,tipo:t.type,arquivo_url:l},{error:c}=await g.ND.from("documentos").insert(d);c&&console.error("Erro ao registrar documento:",c)}}this.arquivosInvalidos.length>0?this.$swal({icon:"warning",title:"Produto salvo com ressalvas",text:`O produto foi salvo, mas ${this.arquivosInvalidos.length} arquivo(s) não foi(ram) enviado(s) por não serem PDFs válidos.`}):this.$swal({icon:"success",title:"Produto salvo com sucesso!",text:"O produto foi cadastrado e está aguardando aprovação."}),this.limparFormulario()}catch(a){console.error("Erro no processo de salvamento:",a),this.$swal({icon:"error",title:"Erro ao salvar produto",text:a.message||"Ocorreu um erro ao tentar salvar o produto."})}finally{this.loading=!1}},limparFormulario(){this.produto={nome:"",grupo_id:"",classe_id:"",marca:"",modelo:"",fabricante:"",cnpj:"",origem:"",registro_anvisa:"",cbpf:"",codigo_material:"",descricao:"",status:"pendente"},this.cnpjFormatado="",this.cnpjInvalido=!1,this.selectedFiles=[],this.arquivosInvalidos=[]},validarFormulario(){return this.produto.nome&&""!==this.produto.nome.trim()?this.produto.grupo_id?this.produto.classe_id?this.produto.descricao&&""!==this.produto.descricao.trim()?this.validarCNPJ()?(this.arquivosInvalidos.length>0&&this.$swal({icon:"error",title:"Arquivos inválidos",text:"Alguns arquivos selecionados não são PDFs válidos e não serão enviados."}),!0):(this.$swal({icon:"error",title:"Erro de validação",text:"O CNPJ informado é inválido"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"A descrição do produto é obrigatória"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"Selecione uma classe para o produto"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"Selecione um grupo para o produto"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"O nome do produto é obrigatório"}),!1)},convertToUUID(a){if(!a)return null;const t=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(t.test(a))return console.log("categoria_id já é um UUID válido:",a),a;const o=parseInt(a,10);if(isNaN(o))return console.warn("categoria_id não é um número nem UUID válido:",a),(0,h.A)();const e=`00000000-0000-0000-0000-${o.toString().padStart(12,"0")}`;return console.log(`Converteu categoria_id ${a} para UUID: ${e}`),e}}},B=L;var U=(0,i.A)(B,j,z,!1,null,"3c6fae7a",null);const G=U.exports,J={name:"Cadastro",components:{CadastroProduto:G},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},K=J;var H=(0,i.A)(K,O,R,!1,null,"1a7a714d",null);const V=H.exports;var Z=function(){var a=this,t=a._self._c;return t("div",{staticClass:"analise-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("AnaliseProduto",{attrs:{id:a.produtoId}})],1)])},Y=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("h1",[a._v("Comprar Bem: Compras Inteligentes")])])}],Q=function(){var a=this,t=a._self._c;return t("div",{staticClass:"analise-container"},[a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando...")])]):a.produto?t("div",{staticClass:"produto-analise"},[t("h2",[a._v("Análise de Produto")]),t("div",{staticClass:"produto-info"},[t("h3",[a._v(a._s(a.produto.nome))]),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item"},[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produto.marca)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produto.modelo)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produto.fabricante)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produto.cnpj)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Origem:")]),a._v(" "+a._s(a.produto.origem||"Não informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Registro na Anvisa/MS:")]),a._v(" "+a._s(a.produto.registro_anvisa||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CBPF:")]),a._v(" "+a._s(a.produto.cbpf||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Código do Material:")]),a._v(" "+a._s(a.produto.codigo_material||"Não informado")+" ")]),t("div",{staticClass:"info-item full-width"},[t("strong",[a._v("Descrição:")]),a._v(" "+a._s(a.produto.descricao||"Não informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Status Atual:")]),t("span",{staticClass:"status-pill",class:a.getStatusClass(a.produto.status)},[a._v(" "+a._s(a.produto.status)+" ")])]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Data de Cadastro:")]),a._v(" "+a._s(a.formatDate(a.produto.criado_em))+" ")])])]),a.documentos.length>0?t("div",{staticClass:"documentos-section"},[t("h3",[a._v("Documentos")]),t("div",{staticClass:"documentos-list"},a._l(a.documentos,(function(o){return t("div",{key:o.id,staticClass:"documento-item"},[t("div",{staticClass:"doc-icon"},[a._v("📄")]),t("div",{staticClass:"doc-info"},[t("p",{staticClass:"doc-name"},[a._v(a._s(o.nome))]),t("p",{staticClass:"doc-type"},[a._v(a._s(o.tipo))])]),t("a",{staticClass:"doc-action",attrs:{href:o.arquivo_url,target:"_blank"}},[a._v("Visualizar")])])})),0)]):a._e(),t("div",{staticClass:"analise-form"},[t("h3",[a._v("Parecer Técnico")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarAnalise.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"parecer"}},[a._v("Observações / Parecer")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.analise.parecer,expression:"analise.parecer"}],attrs:{id:"parecer",rows:"4",required:""},domProps:{value:a.analise.parecer},on:{input:function(t){t.target.composing||a.$set(a.analise,"parecer",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Decisão")]),t("div",{staticClass:"radio-group"},[t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.analise.status,expression:"analise.status"}],attrs:{type:"radio",value:"aprovado",required:""},domProps:{checked:a._q(a.analise.status,"aprovado")},on:{change:function(t){return a.$set(a.analise,"status","aprovado")}}}),a._v(" Aprovar ")]),t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.analise.status,expression:"analise.status"}],attrs:{type:"radio",value:"reprovado",required:""},domProps:{checked:a._q(a.analise.status,"reprovado")},on:{change:function(t){return a.$set(a.analise,"status","reprovado")}}}),a._v(" Reprovar ")])])]),"reprovado"===a.analise.status?t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"motivacao"}},[a._v("Motivação da Reprovação")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.analise.motivacao,expression:"analise.motivacao"}],attrs:{id:"motivacao",rows:"6",placeholder:"Descreva detalhadamente os motivos que levaram à reprovação deste produto",required:""},domProps:{value:a.analise.motivacao},on:{input:function(t){t.target.composing||a.$set(a.analise,"motivacao",t.target.value)}}}),t("small",{staticClass:"helper-text"},[a._v("Este campo será exibido ao fornecedor para justificar a reprovação do produto")])]):a._e(),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.submitting}},[a._v(" "+a._s(a.submitting?"Salvando...":"Salvar Análise")+" ")]),t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.voltar}},[a._v(" Voltar ")])])])]),a.analisesAnteriores.length>0?t("div",{staticClass:"analises-anteriores"},[t("h3",[a._v("Análises Anteriores")]),a._l(a.analisesAnteriores,(function(o){return t("div",{key:o.id,staticClass:"analise-historico"},[t("div",{staticClass:"analise-header"},[t("span",{staticClass:"status-pill",class:a.getStatusClass(o.status)},[a._v(a._s(o.status))]),t("span",{staticClass:"analise-data"},[a._v(a._s(a.formatDate(o.criado_em)))])]),t("div",{staticClass:"analise-conteudo"},[t("p",[a._v(a._s(o.parecer))]),"reprovado"===o.status&&o.motivacao?t("div",{staticClass:"motivacao-reprovacao"},[t("h4",[a._v("Motivação da Reprovação:")]),t("p",[a._v(a._s(o.motivacao))])]):a._e()])])}))],2):a._e()]):t("div",{staticClass:"not-found"},[t("p",[a._v("Produto não encontrado ou você não tem permissão para visualizá-lo.")]),t("button",{staticClass:"btn-secondary",on:{click:a.voltar}},[a._v("Voltar")])])])},W=[];const X={name:"AnaliseProduto",props:{id:{type:String,required:!0}},data(){return{produto:null,documentos:[],analisesAnteriores:[],analise:{parecer:"",status:"",motivacao:""},loading:!0,submitting:!1}},created(){this.carregarDados()},methods:{async carregarDados(){try{this.loading=!0;const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("id",this.id).single();if(t)throw t;this.produto=a;const{data:o,error:e}=await g.ND.from("documentos").select("*").eq("produto_id",this.id);if(e)throw e;this.documentos=o||[];const{data:r,error:s}=await g.ND.from("analises").select("*").eq("produto_id",this.id).order("criado_em",{ascending:!1});if(s)throw s;this.analisesAnteriores=r||[]}catch(a){console.error("Erro ao carregar dados:",a),alert("Erro ao carregar dados do produto. Por favor, tente novamente.")}finally{this.loading=!1}},async salvarAnalise(){try{if(this.submitting=!0,"reprovado"===this.analise.status&&!this.analise.motivacao)return this.$swal({icon:"error",title:"Campo obrigatório",text:"É necessário preencher a motivação da reprovação"}),void(this.submitting=!1);const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;let o;if(t){console.log("Usuário autenticado:",t.email);const{data:a,error:e}=await g.ND.from("usuarios").select("id").eq("email",t.email).maybeSingle();if(e&&console.error("Erro ao buscar ID do usuário:",e),a?.id)console.log("ID do usuário encontrado na tabela usuarios:",a.id),o=a.id;else{console.warn("Usuário não encontrado na tabela, gerando UUID"),o=this.gerarUUID();const{error:a}=await g.ND.from("usuarios").insert({id:o,email:t.email,nome:t.email.split("@")[0],tenant_id:this.produto.tenant_id,tipo:"avaliador",ativo:!0});a&&console.error("Erro ao criar usuário automaticamente:",a)}}else console.warn("Nenhum usuário autenticado, gerando UUID"),o=this.gerarUUID();console.log("Salvando análise com avaliador_id:",o);const e={produto_id:this.id,tenant_id:this.produto.tenant_id,avaliador_id:o,parecer:this.analise.parecer,status:this.analise.status};"reprovado"===this.analise.status&&(e.motivacao=this.analise.motivacao);const{error:r}=await g.ND.from("analises").insert(e);if(r)throw console.error("Erro detalhado ao salvar análise:",r),new Error(`Erro ao salvar análise: ${r.message}`);const{error:s}=await g.ND.from("produtos").update({status:this.analise.status}).eq("id",this.id);if(s)throw s;this.$swal({icon:"success",title:"Análise salva com sucesso!",showConfirmButton:!1,timer:1500}),await this.carregarDados(),this.analise={parecer:"",status:"",motivacao:""}}catch(a){console.error("Erro ao salvar análise:",a);let t="Erro ao salvar análise.";a.message&&a.message.includes("uuid")?t="Erro no formato de identificação. Este problema foi corrigido, tente novamente.":a.message&&(t=a.message),this.$swal({icon:"error",title:"Erro ao processar análise",text:t})}finally{this.submitting=!1}},formatDate(a){if(!a)return"";const t=new Date(a);return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},voltar(){this.$router.push("/dashboard")},gerarUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){const t=16*Math.random()|0,o="x"==a?t:3&t|8;return o.toString(16)}))}}},aa=X;var ta=(0,i.A)(aa,Q,W,!1,null,"08bfce02",null);const oa=ta.exports,ea={name:"Analise",components:{AnaliseProduto:oa},computed:{produtoId(){return this.$route.params.id}},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},ra=ea;var sa=(0,i.A)(ra,Z,Y,!1,null,"c7aa3a7a",null);const ia=sa.exports;var na=function(){var a=this,t=a._self._c;return t("div",{staticClass:"catalogo-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/classificacao"}},[a._v("Classificação")]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("CatalogoEletronico")],1)])},la=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Inteligentes")])])])}],da=function(){var a=this,t=a._self._c;return t("div",{staticClass:"catalogo-container"},[t("h2",[a._v("Catálogo Eletrônico de Bens Padronizados")]),t("div",{staticClass:"search-filters"},[t("div",{staticClass:"search-box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.searchTerm,expression:"searchTerm"}],attrs:{type:"text",placeholder:"Buscar produto..."},domProps:{value:a.searchTerm},on:{input:[function(t){t.target.composing||(a.searchTerm=t.target.value)},a.filtrarProdutos]}})]),t("div",{staticClass:"filters"},[t("div",{staticClass:"categoria-filter"},[a._m(0),t("div",{staticClass:"dropdown"},[t("button",{staticClass:"dropdown-toggle",attrs:{type:"button"},on:{click:a.toggleCategoriaDropdown}},[a._v(" "+a._s(a.categoriaAtual)+" ")]),t("div",{staticClass:"dropdown-menu",class:{show:a.showCategoriaDropdown}},[a.carregandoCategorias?t("div",{staticClass:"dropdown-item loading"},[t("div",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status"}}),t("span",[a._v("Carregando...")])]):[t("a",{staticClass:"dropdown-item",on:{click:function(t){return a.selecionarCategoria(null)}}},[a._v("Todos os grupos")]),0===a.categorias.length?t("div",{staticClass:"dropdown-item empty"},[a._v(" Nenhum grupo disponível ")]):a._l(a.categorias,(function(o){return t("a",{key:o.id,staticClass:"dropdown-item",class:{active:o.id===a.filtroCategoria},on:{click:function(t){return a.selecionarCategoria(o)}}},[a._v(" "+a._s(o.nome)+" ")])}))]],2)])])])]),a.produtosFiltrados.length>0?t("div",{staticClass:"produtos-grid"},a._l(a.produtosFiltrados,(function(o){return t("div",{key:o.id,staticClass:"produto-card",on:{click:function(t){return a.verDetalhesProduto(o.id)}}},[t("div",{staticClass:"produto-info"},[t("h3",[a._v(a._s(o.nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(o.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(o.modelo))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(o.fabricante))])]),t("div",{staticClass:"produto-status",class:a.getStatusClass(o.status)},[a._v(" "+a._s(o.status)+" ")])])})),0):t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhum produto encontrado.")])]),a.produtoSelecionado?t("div",{staticClass:"produto-modal",on:{click:function(t){return t.target!==t.currentTarget?null:a.fecharModal.apply(null,arguments)}}},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.produtoSelecionado.nome))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModal}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"produto-detalhes"},[t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoSelecionado.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoSelecionado.modelo))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoSelecionado.fabricante))]),t("p",[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produtoSelecionado.cnpj))]),a.produtoSelecionado.descricao?t("p",[t("strong",[a._v("Descrição:")]),a._v(" "+a._s(a.produtoSelecionado.descricao))]):a._e(),t("p",[t("strong",[a._v("Status:")]),a._v(" "),t("span",{class:a.getStatusClass(a.produtoSelecionado.status)},[a._v(a._s(a.produtoSelecionado.status))])]),t("div",{staticClass:"avaliacoes-section"},[t("div",{staticClass:"avaliacoes-header",class:{active:a.showAvaliacoes},on:{click:a.toggleAvaliacoes}},[t("h4",[a._v("Avaliações de Desempenho (RDM)")]),t("div",{staticClass:"avaliacao-summary"},[a.avaliacaoMedia>0?t("div",{staticClass:"stars-container"},[t("div",{staticClass:"stars"},a._l(5,(function(o){return t("span",{key:o,staticClass:"star",class:{filled:a.avaliacaoMedia>=o,half:a.avaliacaoMedia>=o-.5&&a.avaliacaoMedia<o}},[a._v("★")])})),0),t("span",{staticClass:"rating-number"},[a._v(a._s(a.avaliacaoMedia))]),t("span",{staticClass:"rating-count"},[a._v("("+a._s(a.avaliacoes.length)+" avaliações)")])]):t("div",{staticClass:"no-ratings"},[a._v(" Sem avaliações ainda ")]),t("span",{staticClass:"toggle-icon"},[a._v(a._s(a.showAvaliacoes?"▲":"▼"))])])]),a.showAvaliacoes?t("div",{staticClass:"avaliacoes-content"},[0===a.avaliacoes.length?t("div",{staticClass:"no-avaliacoes"},[a._v(" Este produto ainda não possui avaliações de desempenho. ")]):t("div",{staticClass:"avaliacoes-list"},a._l(a.avaliacoes,(function(o,e){return t("div",{key:e,staticClass:"avaliacao-item"},[t("div",{staticClass:"avaliacao-stars"},a._l(5,(function(e){return t("span",{key:e,staticClass:"star",class:{filled:o.avaliacao>=e}},[a._v("★")])})),0),t("div",{staticClass:"avaliacao-comentario"},[a._v(" "+a._s(o.comentario)+" ")]),t("div",{staticClass:"avaliacao-data"},[a._v(" "+a._s(a.obterDataAvaliacao(o))+" ")])])})),0)]):a._e()]),a.documentos.length>0?t("div",{staticClass:"documentos"},[t("h4",[a._v("Documentos")]),t("ul",a._l(a.documentos,(function(o){return t("li",{key:o.id},[t("a",{attrs:{href:o.arquivo_url,target:"_blank"}},[a._v(a._s(o.nome))])])})),0)]):a._e()])])])]):a._e()])},ca=[function(){var a=this,t=a._self._c;return t("label",[t("strong",[a._v("Grupo:")])])}];const ua={name:"CatalogoEletronico",data(){return{produtos:[],produtosFiltrados:[],categorias:[],searchTerm:"",filtroCategoria:"",categoriaAtual:"Todos os grupos",showCategoriaDropdown:!1,showAvaliacoes:!1,produtoSelecionado:null,documentos:[],avaliacoes:[],avaliacaoMedia:0,carregandoCategorias:!0,categoriaSelecionada:null,currentTenantId:null,loading:!1}},created(){this.obterTenantId().then((()=>{this.carregarDados()})),document.addEventListener("click",this.closeDropdownOnClickOutside)},mounted(){this.carregarCategoriasDireto(),this.showCategoriaDropdown=!1},beforeUnmount(){document.removeEventListener("click",this.closeDropdownOnClickOutside)},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return this.currentTenantId=t.user_metadata.tenant_id,void console.log("Tenant ID obtido dos metadados:",this.currentTenantId);const{data:o,error:e}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(e)return void console.error("Erro ao buscar tenant_id:",e);o?.tenant_id?(this.currentTenantId=o.tenant_id,console.log("Tenant ID obtido da tabela usuarios:",this.currentTenantId)):console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarDados(){console.log("Iniciando carregamento de dados"),this.carregandoCategorias=!0,this.loading=!0;try{if(!this.currentTenantId&&(console.error("Tenant ID não disponível. Tentando recarregar..."),await this.obterTenantId(),!this.currentTenantId))return console.error("Não foi possível obter o tenant_id, impossível carregar dados"),void this.$swal({icon:"error",title:"Erro ao carregar dados",text:"Não foi possível identificar sua conta. Por favor, faça login novamente."});console.log("Buscando categorias do Supabase...");const{data:a,error:t}=await g.ND.from("categorias").select("*");t?(console.error("Erro ao carregar categorias:",t.message),this.$swal({icon:"error",title:"Erro ao carregar categorias",text:"Não foi possível carregar as categorias. Por favor, tente novamente."})):(console.log("Categorias carregadas:",a),this.categorias=a||[],0===this.categorias.length&&console.warn("Nenhuma categoria encontrada no banco de dados")),this.carregandoCategorias=!1,console.log("Buscando produtos do Supabase para tenant_id:",this.currentTenantId);const{data:o,error:e}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId);e?(console.error("Erro ao carregar produtos:",e.message),this.$swal({icon:"error",title:"Erro ao carregar produtos",text:"Não foi possível carregar os produtos. Por favor, tente novamente."})):(console.log("Produtos carregados:",o),this.produtos=o||[],console.log(`${this.produtos.length} produtos carregados para o tenant atual`),this.produtos=this.produtos.map((a=>{const t=this.categorias.find((t=>t.id===a.categoria_id));return{...a,categoria_nome:t?t.nome:"Categoria não encontrada"}})),this.produtosFiltrados=[...this.produtos])}catch(a){console.error("Erro ao carregar dados:",a),this.$swal({icon:"error",title:"Erro ao carregar dados",text:"Ocorreu um erro inesperado. Por favor, tente novamente."})}finally{this.loading=!1}},async carregarCategoriasDireto(){try{console.log("Tentando carregar categorias diretamente...");const{data:a,error:t}=await g.ND.from("categorias").select("*");if(t)return void console.error("Erro ao carregar categorias direto:",t);console.log("Resposta direta de categorias:",a),a&&a.length>0&&0===this.categorias.length&&(console.log("Atualizando categorias com dados diretos"),this.categorias=a)}catch(a){console.error("Exceção ao carregar categorias direto:",a)}},filtrarProdutos(){console.log("Filtrando produtos por:",this.filtroCategoria,"e texto:",this.searchTerm),this.produtosFiltrados=this.produtos.filter((a=>{const t=!this.filtroCategoria||a.categoria_id===this.filtroCategoria,o=!this.searchTerm||a.nome.toLowerCase().includes(this.searchTerm.toLowerCase())||a.descricao&&a.descricao.toLowerCase().includes(this.searchTerm.toLowerCase());return t&&o})),console.log("Produtos filtrados:",this.produtosFiltrados.length)},async verDetalhesProduto(a){try{if(!this.currentTenantId)return void console.error("Não foi possível identificar o tenant_id");const{data:t,error:o}=await g.ND.from("produtos").select("*").eq("id",a).eq("tenant_id",this.currentTenantId).single();if(o)throw console.error("Erro ao carregar produto:",o),o;if(!t)return console.error("Produto não encontrado ou não pertence ao tenant atual"),void this.$swal({icon:"error",title:"Produto não encontrado",text:"O produto solicitado não existe ou você não tem permissão para visualizá-lo."});this.produtoSelecionado=t;const{data:e,error:r}=await g.ND.from("documentos").select("*").eq("produto_id",a).eq("tenant_id",this.currentTenantId);if(r)throw r;this.documentos=e||[];const{data:s,error:i}=await g.ND.from("rdm_feedbacks").select("*").eq("produto_id",a).eq("tenant_id",this.currentTenantId);if(i)console.error("Erro ao carregar avaliações:",i),this.avaliacoes=[],this.avaliacaoMedia=0;else if(this.avaliacoes=s||[],this.avaliacoes.length>0&&(console.log("Campos disponíveis na avaliação:",Object.keys(this.avaliacoes[0])),console.log("Exemplo de avaliação:",this.avaliacoes[0])),this.avaliacoes.length>0){const a=this.avaliacoes.reduce(((a,t)=>a+t.avaliacao),0);this.avaliacaoMedia=parseFloat((a/this.avaliacoes.length).toFixed(1))}else this.avaliacaoMedia=0}catch(t){console.error("Erro ao carregar detalhes do produto:",t),this.$swal({icon:"error",title:"Erro ao carregar detalhes",text:"Não foi possível carregar os detalhes do produto. Tente novamente."})}},fecharModal(){this.produtoSelecionado=null,this.documentos=[],this.avaliacoes=[],this.avaliacaoMedia=0,this.showAvaliacoes=!1},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},closeDropdownOnClickOutside(a){const t=this.$el.querySelector(".dropdown");t&&!t.contains(a.target)&&(this.showCategoriaDropdown=!1)},selecionarCategoria(a){console.log("Categoria selecionada:",a),this.categoriaSelecionada=a,this.categoriaAtual=a?a.nome:"Todos os grupos",this.filtroCategoria=a?a.id:"",this.showCategoriaDropdown=!1,this.filtrarProdutos()},toggleCategoriaDropdown(){this.showCategoriaDropdown=!this.showCategoriaDropdown},toggleAvaliacoes(){this.showAvaliacoes=!this.showAvaliacoes},formatarData(a){if(!a)return"Data não disponível";try{const t=new Date(a);return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Erro ao formatar data:",t),"Data inválida"}},obterDataAvaliacao(a){const t=a.created_at||a.criado_em||a.data||null;return this.formatarData(t)}}},va=ua;var ma=(0,i.A)(va,da,ca,!1,null,"9a1e339e",null);const pa=ma.exports,ga={name:"Catalogo",components:{CatalogoEletronico:pa},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},ha=ga;var _a=(0,i.A)(ha,na,la,!1,null,"2c74d3f1",null);const fa=_a.exports;var Ca=function(){var a=this,t=a._self._c;return t("div",{staticClass:"feedback-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/classificacao"}},[a._v("Classificação")]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("FormularioRDM")],1)])},ba=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Inteligentes")])])])}],wa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"rdm-container"},[t("h2",[a._v("Relatório de Desempenho de Material (RDM)")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.enviarFeedback.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"produto"}},[a._v("Produto*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.feedback.produto_id,expression:"feedback.produto_id"}],attrs:{id:"produto",required:""},on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.feedback,"produto_id",t.target.multiple?o:o[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione o produto...")]),a._l(a.produtos,(function(o){return t("option",{key:o.id,domProps:{value:o.id}},[a._v(" "+a._s(o.nome)+" - "+a._s(o.marca)+" - "+a._s(o.modelo)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[t("label",[a._v("Avaliação*")]),t("div",{staticClass:"avaliacao"},a._l(5,(function(o){return t("div",{key:o,staticClass:"estrela",class:{ativa:a.feedback.avaliacao>=o},on:{click:function(t){a.feedback.avaliacao=o}}},[a._v(" ★ ")])})),0)]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"comentario"}},[a._v("Justificativa da Avaliação*")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.feedback.comentario,expression:"feedback.comentario"}],attrs:{id:"comentario",rows:"4",placeholder:"Ex: Equipamento apresentou falha após 3 meses de uso...",required:""},domProps:{value:a.feedback.comentario},on:{input:function(t){t.target.composing||a.$set(a.feedback,"comentario",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.loading}},[a._v(" "+a._s(a.loading?"Salvando...":"Salvar")+" ")])])])])},Da=[];const ya={name:"FormularioRDM",data(){return{feedback:{produto_id:"",avaliacao:0,comentario:""},produtos:[],loading:!1,currentUser:null,currentTenantId:null}},created(){this.carregarProdutos(),this.obterUsuarioAtual()},methods:{async obterUsuarioAtual(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;t?(this.currentUser=t,t.user_metadata?.tenant_id?this.currentTenantId=t.user_metadata.tenant_id:this.currentTenantId=(0,h.A)()):this.currentTenantId=(0,h.A)()}catch(a){console.error("Erro ao obter dados do usuário:",a),this.currentTenantId=(0,h.A)()}},async carregarProdutos(){try{if(await this.obterUsuarioAtual(),!this.currentTenantId)return console.error("Não foi possível identificar o tenant_id"),void(this.produtos=[]);console.log("Carregando produtos para o tenant:",this.currentTenantId);const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("status","aprovado").eq("tenant_id",this.currentTenantId).order("nome");if(t)throw t;console.log("Produtos carregados:",a?.length||0),this.produtos=a||[]}catch(a){console.error("Erro ao carregar produtos:",a),alert("Erro ao carregar produtos. Por favor, tente novamente.")}},async enviarFeedback(){if(0!==this.feedback.avaliacao)try{let t;if(this.loading=!0,this.currentTenantId||(this.currentTenantId=(0,h.A)()),this.currentUser?.email){console.log("Buscando ID do usuário na tabela usuarios pelo email:",this.currentUser.email);const{data:o,error:e}=await g.ND.from("usuarios").select("id").eq("email",this.currentUser.email).maybeSingle();if(e&&console.error("Erro ao buscar usuário:",e),o?.id)t=o.id,console.log("ID do usuário encontrado na tabela usuarios:",t);else{console.warn("Usuário não encontrado na tabela usuarios, gerando ID temporário"),t=(0,h.A)();try{const{error:a}=await g.ND.from("usuarios").insert({id:t,email:this.currentUser.email,nome:this.currentUser.email.split("@")[0],tenant_id:this.currentTenantId,tipo:"cliente",ativo:!0});a&&console.error("Erro ao criar usuário na tabela:",a)}catch(a){console.error("Exceção ao criar usuário:",a)}}}else console.warn("Usuário não está autenticado, gerando ID temporário"),t=(0,h.A)();console.log("Enviando feedback com:",{produto_id:this.feedback.produto_id,usuario_id:t,tenant_id:this.currentTenantId});const{error:o}=await g.ND.from("rdm_feedbacks").insert({produto_id:this.feedback.produto_id,usuario_id:t,tenant_id:this.currentTenantId,avaliacao:this.feedback.avaliacao,comentario:this.feedback.comentario});if(o)throw o;this.$swal({icon:"success",title:"Feedback enviado!",text:"Seu feedback foi enviado com sucesso."}),this.limparFormulario()}catch(t){console.error("Erro ao enviar feedback:",t),this.$swal({icon:"error",title:"Erro ao enviar feedback",text:"Por favor, tente novamente."})}finally{this.loading=!1}else alert("Por favor, selecione uma avaliação de 1 a 5 estrelas.")},limparFormulario(){this.feedback={produto_id:"",avaliacao:0,comentario:""}}}},Pa=ya;var Ea=(0,i.A)(Pa,wa,Da,!1,null,"f5b703e0",null);const Na=Ea.exports,Aa={name:"Feedback",components:{FormularioRDM:Na},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},ka=Aa;var xa=(0,i.A)(ka,Ca,ba,!1,null,"a58ba6a8",null);const Ia=xa.exports;var Ta=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dcb-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/classificacao"}},[a._v("Classificação")]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("FormularioDCB")],1)])},Sa=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Inteligentes")])])])}],qa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dcb-container"},[t("h2",[a._v("Declaração de Conformidade de Bem (DCB)")]),t("div",{staticClass:"search-container"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"produto"}},[a._v("Selecione o produto")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produtoSelecionado,expression:"produtoSelecionado"}],attrs:{id:"produto"},on:{change:[function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.produtoSelecionado=t.target.multiple?o:o[0]},a.carregarDetalhes]}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.produtos,(function(o){return t("option",{key:o.id,domProps:{value:o.id}},[a._v(" "+a._s(o.nome)+" - "+a._s(o.marca)+" - "+a._s(o.modelo)+" ")])}))],2)])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando informações...")])]):a.produtoDetalhes?t("div",{staticClass:"produto-detalhes"},[t("h3",[a._v(a._s(a.produtoDetalhes.nome))]),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item"},[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoDetalhes.marca)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoDetalhes.modelo)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoDetalhes.fabricante)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produtoDetalhes.cnpj)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Origem:")]),a._v(" "+a._s(a.produtoDetalhes.origem||"Não informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Registro na Anvisa/MS:")]),a._v(" "+a._s(a.produtoDetalhes.registro_anvisa||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CBPF:")]),a._v(" "+a._s(a.produtoDetalhes.cbpf||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Código do Material:")]),a._v(" "+a._s(a.produtoDetalhes.codigo_material||"Não informado")+" ")]),t("div",{staticClass:"info-item full-width"},[t("strong",[a._v("Status:")]),t("span",{staticClass:"status-badge",class:a.getStatusClass(a.produtoDetalhes.status)},[a._v(" "+a._s(a.formatarStatus(a.produtoDetalhes.status))+" ")])])]),a.documentos.length>0?t("div",{staticClass:"documentos"},[t("h3",[a._v("Documentos")]),t("ul",{staticClass:"documentos-lista"},a._l(a.documentos,(function(o){return t("li",{key:o.id,staticClass:"documento-item"},[t("span",{staticClass:"doc-icon"},[a._v("📄")]),t("span",{staticClass:"doc-nome"},[a._v(a._s(o.nome))]),t("a",{staticClass:"btn-download",attrs:{href:o.arquivo_url,target:"_blank"}},[a._v("Visualizar")])])})),0)]):a._e(),t("div",{staticClass:"dcb-actions"},[t("button",{staticClass:"btn-primary",attrs:{disabled:!a.produtoAprovado},on:{click:a.gerarDCB}},[a._v(" Baixar Declaração de Conformidade ")]),a.produtoAprovado?a._e():t("p",{staticClass:"aviso"},[a._v(" Somente produtos aprovados possuem Declaração de Conformidade disponível. ")])])]):a._e()])},Ma=[];const $a={name:"FormularioDCB",data(){return{produtoSelecionado:"",produtoDetalhes:null,documentos:[],produtos:[],loading:!1,currentTenantId:null}},computed:{produtoAprovado(){return this.produtoDetalhes&&"aprovado"===this.produtoDetalhes.status}},created(){this.obterTenantId().then((()=>{this.carregarProdutos()}))},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(t)if(t.user_metadata?.tenant_id)this.currentTenantId=t.user_metadata.tenant_id;else{const{data:a,error:o}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();!o&&a?.tenant_id&&(this.currentTenantId=a.tenant_id)}}catch(a){console.error("Erro ao obter dados do usuário:",a)}},async carregarProdutos(){try{if(this.loading=!0,!this.currentTenantId)return void console.error("Tenant ID não disponível");const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).order("nome");if(t)throw t;this.produtos=a||[]}catch(a){console.error("Erro ao carregar produtos:",a),this.$swal({icon:"error",title:"Erro",text:"Não foi possível carregar a lista de produtos."})}finally{this.loading=!1}},async carregarDetalhes(){if(!this.produtoSelecionado)return this.produtoDetalhes=null,void(this.documentos=[]);try{this.loading=!0;const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("id",this.produtoSelecionado).single();if(t)throw t;this.produtoDetalhes=a;const{data:o,error:e}=await g.ND.from("documentos").select("*").eq("produto_id",this.produtoSelecionado);if(e)throw e;this.documentos=o||[]}catch(a){console.error("Erro ao carregar detalhes do produto:",a),this.$swal({icon:"error",title:"Erro",text:"Não foi possível carregar os detalhes do produto."})}finally{this.loading=!1}},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";case"diligencia":return"status-diligencia";default:return""}},formatarStatus(a){switch(a){case"pendente":return"Em avaliação";case"diligencia":return"Diligência";default:return a.charAt(0).toUpperCase()+a.slice(1)}},gerarDCB(){this.produtoDetalhes&&this.produtoAprovado?this.$swal({icon:"info",title:"Funcionalidade em Desenvolvimento",text:"A geração de PDF da Declaração de Conformidade estará disponível em breve. Esta funcionalidade requer a instalação de bibliotecas adicionais no projeto."}):this.$swal({icon:"error",title:"Não disponível",text:"Apenas produtos aprovados possuem Declaração de Conformidade disponível."})}}},Fa=$a;var Oa=(0,i.A)(Fa,qa,Ma,!1,null,"9c76b404",null);const Ra=Oa.exports,ja={name:"DCB",components:{FormularioDCB:Ra},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},za=ja;var La=(0,i.A)(za,Ta,Sa,!1,null,"bf22f196",null);const Ba=La.exports;var Ua=function(){var a=this,t=a._self._c;return t("div",{staticClass:"ccl-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/classificacao"}},[a._v("Classificação")]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("DashboardCCL")],1)])},Ga=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Inteligentes")])])])}],Ja=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard"},[t("h2",[a._v("Painel da Comissão de Contratação ou Licitação")]),t("div",{staticClass:"tabs"},[t("div",{staticClass:"tab",class:{active:"dashboard"===a.activeTab},on:{click:function(t){a.activeTab="dashboard"}}},[a._v(" Dashboard ")]),t("div",{staticClass:"tab",class:{active:"atas"===a.activeTab},on:{click:function(t){a.activeTab="atas"}}},[a._v(" Atas de Julgamento ")]),t("div",{staticClass:"tab",class:{active:"homologacoes"===a.activeTab},on:{click:function(t){a.activeTab="homologacoes"}}},[a._v(" Homologações ")])]),"dashboard"===a.activeTab?t("div",[t("div",{staticClass:"stats-container"},[t("div",{staticClass:"stat-card status-pendente-card"},[t("h3",[a._v("Produtos Aguardando Análise")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.pendentes))])]),t("div",{staticClass:"stat-card status-aprovado-card"},[t("h3",[a._v("Produtos Homologados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.aprovados))])]),t("div",{staticClass:"stat-card status-reprovado-card"},[t("h3",[a._v("Produtos Não Homologados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.reprovados))])])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Processos Pendentes de Julgamento")]),a.produtosPendentes.length>0?t("table",[a._m(0),t("tbody",a._l(a.produtosPendentes,(function(o){return t("tr",{key:o.id},[t("td",[a._v(a._s(o.nome))]),t("td",[a._v(a._s(o.marca))]),t("td",[a._v(a._s(a.getCategoriaName(o.categoria_id)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(o.status)},[a._v(" "+a._s(a.formatarStatus(o.status))+" ")])]),t("td",[a._v(a._s(a.formatDate(o.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.publicarDecisao(o.id)}}},[a._v("Julgamento")])])])})),0)]):t("p",[a._v("Não há processos pendentes de julgamento.")])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Atas de Julgamento Recentes")]),a.atasRecentes.length>0?t("table",[a._m(1),t("tbody",a._l(a.atasRecentes,(function(o){return t("tr",{key:o.id},[t("td",[a._v(a._s(o.numero))]),t("td",[a._v(a._s(o.produto_nome))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(o.decisao)},[a._v(" "+a._s(a.formatarStatus(o.decisao))+" ")])]),t("td",[a._v(a._s(a.formatDate(o.data_publicacao)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.visualizarAta(o.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("Não há atas de julgamento recentes.")])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Recursos Apresentados")]),a.recursos.length>0?t("table",[a._m(2),t("tbody",a._l(a.recursos,(function(o){return t("tr",{key:o.id},[t("td",[a._v(a._s(o.produto_nome))]),t("td",[a._v(a._s(a.formatDate(o.data_recurso)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getRecursoStatusClass(o.status)},[a._v(" "+a._s(o.status)+" ")])]),t("td",[a._v(a._s(a.formatDate(o.prazo_final)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.analisarRecurso(o.id)}}},[a._v("Analisar")])])])})),0)]):t("p",[a._v("Não há recursos apresentados.")])])]):a._e(),"atas"===a.activeTab?t("div",{staticClass:"atas-julgamento"},[a._m(3)]):a._e(),"homologacoes"===a.activeTab?t("div",{staticClass:"homologacoes"},[a._m(4)]):a._e()])},Ka=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Categoria")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Ações")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Número da Ata")]),t("th",[a._v("Produto")]),t("th",[a._v("Decisão")]),t("th",[a._v("Data de Publicação")]),t("th",[a._v("Ações")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Produto")]),t("th",[a._v("Data do Recurso")]),t("th",[a._v("Status")]),t("th",[a._v("Prazo Final")]),t("th",[a._v("Ações")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Atas de Julgamento")]),t("p",[a._v("Este módulo permitirá o gerenciamento completo das atas de julgamento emitidas pela Comissão de Contratação ou Licitação.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Cadastro e edição de atas de julgamento")]),t("li",[a._v("Publicação automática no Diário Oficial")]),t("li",[a._v("Comunicação com fornecedores interessados")]),t("li",[a._v("Histórico de alterações e versões")]),t("li",[a._v("Geração de relatórios consolidados")]),t("li",[a._v("Integração com sistema de processo eletrônico")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Homologações")]),t("p",[a._v("Este módulo permitirá o gerenciamento dos processos de homologação de produtos após análise técnica.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Registro de decisões da autoridade competente")]),t("li",[a._v("Emissão de certificados de homologação")]),t("li",[a._v("Controle de prazos de validade")]),t("li",[a._v("Solicitação de renovação de homologação")]),t("li",[a._v("Integração com catálogo eletrônico de produtos")]),t("li",[a._v("Notificação automática de homologações e indeferimentos")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])}];const Ha={name:"DashboardCCL",data(){return{activeTab:"dashboard",produtosPendentes:[],atasRecentes:[],recursos:[],pendentes:0,aprovados:0,reprovados:0,categorias:[],currentTenantId:null,loading:!1}},created(){this.obterTenantId().then((()=>{this.carregarDados(),this.carregarCategorias()}))},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return void(this.currentTenantId=t.user_metadata.tenant_id);const{data:o,error:e}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(e)return void console.error("Erro ao buscar tenant_id:",e);o?.tenant_id?this.currentTenantId=o.tenant_id:console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarCategorias(){try{const{data:a,error:t}=await g.ND.from("categorias").select("*");if(t)throw t;this.categorias=a||[]}catch(a){console.error("Erro ao carregar categorias:",a)}},getCategoriaName(a){const t=this.categorias.find((t=>t.id===a));return t?t.nome:"Categoria não encontrada"},async carregarDados(){try{if(this.loading=!0,!this.currentTenantId)return void console.error("Tenant ID não disponível");const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).in("status",["aprovado","reprovado"]).order("criado_em",{ascending:!1}).limit(10);if(t)throw t;this.produtosPendentes=a||[],this.atasRecentes=[{id:"1",numero:"ATA-001/2023",produto_nome:"Monitor de Sinais Vitais",decisao:"aprovado",data_publicacao:"2023-05-15"},{id:"2",numero:"ATA-002/2023",produto_nome:"Desfibrilador",decisao:"reprovado",data_publicacao:"2023-05-20"},{id:"3",numero:"ATA-003/2023",produto_nome:"Autoclave Hospitalar",decisao:"aprovado",data_publicacao:"2023-06-01"}],this.recursos=[{id:"1",produto_nome:"Desfibrilador",data_recurso:"2023-05-22",status:"Em análise",prazo_final:"2023-06-06"},{id:"2",produto_nome:"Bomba de Infusão",data_recurso:"2023-06-05",status:"Pendente",prazo_final:"2023-06-20"}];const o=await Promise.all([this.contarPorStatus("pendente"),this.contarPorStatus("aprovado"),this.contarPorStatus("reprovado")]);this.pendentes=o[0],this.aprovados=o[1],this.reprovados=o[2]}catch(a){console.error("Erro ao carregar dados:",a)}finally{this.loading=!1}},async contarPorStatus(a){if(!this.currentTenantId)return 0;const{count:t,error:o}=await g.ND.from("produtos").select("id",{count:"exact"}).eq("status",a).eq("tenant_id",this.currentTenantId);return o?(console.error(`Erro ao contar produtos ${a}:`,o),0):t||0},formatDate(a){if(!a)return"";if(a.includes("T")){const t=new Date(a);return t.toLocaleDateString("pt-BR")}const t=a.split("-");return 3===t.length?`${t[2]}/${t[1]}/${t[0]}`:a},formatarStatus(a){switch(a){case"pendente":return"Em avaliação";case"aprovado":return"Homologado";case"reprovado":return"Não Homologado";default:return a}},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},getRecursoStatusClass(a){switch(a){case"Em análise":return"status-pendente";case"Pendente":return"status-pendente";case"Deferido":return"status-aprovado";case"Indeferido":return"status-reprovado";default:return""}},publicarDecisao(a){this.$swal({title:"Ação Simulada",text:"Em uma implementação completa, abriria um formulário para registrar a decisão da comissão e publicar no Diário Oficial.",icon:"info"})},visualizarAta(a){this.$swal({title:"Ação Simulada",text:"Em uma implementação completa, exibiria o documento da ata de julgamento e permitiria fazer download.",icon:"info"})},analisarRecurso(a){this.$swal({title:"Ação Simulada",text:"Em uma implementação completa, abriria um formulário para analisar e registrar a decisão sobre o recurso apresentado.",icon:"info"})}}},Va=Ha;var Za=(0,i.A)(Va,Ja,Ka,!1,null,"11eb4c8c",null);const Ya=Za.exports,Qa={name:"CCL",components:{DashboardCCL:Ya},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},Wa=Qa;var Xa=(0,i.A)(Wa,Ua,Ga,!1,null,"3a3b545e",null);const at=Xa.exports;var tt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classificacao-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{attrs:{to:"/catalogo"}},[a._v("Catálogo")]),t("router-link",{attrs:{to:"/classificacao"}},[a._v("Classificação")]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("button",{staticClass:"btn-logout",on:{click:a.logout}},[a._v("Sair")])])]),t("main",{staticClass:"main-content"},[t("Classificacao")],1)])},ot=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Inteligentes")])])])}],et=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classificacao-container"},[t("h2",[a._v("Classificação de Produtos")]),t("div",{staticClass:"tabs"},[t("button",{class:["tab-button",{active:"grupos"===a.activeTab}],on:{click:function(t){a.activeTab="grupos"}}},[a._v(" Grupos ")]),t("button",{class:["tab-button",{active:"classes"===a.activeTab}],on:{click:function(t){a.activeTab="classes"}}},[a._v(" Classes ")])]),t("div",{staticClass:"tab-content"},["grupos"===a.activeTab?t("GruposList"):a._e(),"classes"===a.activeTab?t("ClassesList"):a._e()],1)])},rt=[],st=function(){var a=this,t=a._self._c;return t("div",{staticClass:"grupos-list"},[t("div",{staticClass:"header"},[t("h3",[a._v("Gerenciamento de Grupos")]),t("button",{staticClass:"btn-add",on:{click:function(t){a.mostrarFormulario=!0}}},[a._v(" Adicionar Grupo ")])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando grupos...")])]):0===a.grupos.length?t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhum grupo cadastrado.")])]):t("div",{staticClass:"grupos-table"},[t("table",[a._m(0),t("tbody",a._l(a.grupos,(function(o){return t("tr",{key:o.id},[t("td",[a._v(a._s(o.nome))]),t("td",[a._v(a._s(o.descricao||"-"))]),t("td",[a._v(a._s(a.formatarData(o.created_at)))]),t("td",{staticClass:"actions"},[t("button",{staticClass:"btn-edit",on:{click:function(t){return a.editarGrupo(o)}}},[a._v("Editar")]),t("button",{staticClass:"btn-delete",on:{click:function(t){return a.confirmarExclusao(o)}}},[a._v("Excluir")])])])})),0)])]),a.mostrarFormulario?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.modoEdicao?"Editar":"Adicionar")+" Grupo")]),t("button",{staticClass:"btn-close",on:{click:a.fecharFormulario}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarGrupo.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome do Grupo*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.grupoAtual.nome,expression:"grupoAtual.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.grupoAtual.nome},on:{input:function(t){t.target.composing||a.$set(a.grupoAtual,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descrição")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.grupoAtual.descricao,expression:"grupoAtual.descricao"}],attrs:{id:"descricao",rows:"3"},domProps:{value:a.grupoAtual.descricao},on:{input:function(t){t.target.composing||a.$set(a.grupoAtual,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharFormulario}},[a._v("Cancelar")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.salvando}},[a._v(" "+a._s(a.salvando?"Salvando...":"Salvar")+" ")])])])])])]):a._e()])},it=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Descrição")]),t("th",[a._v("Data de Criação")]),t("th",[a._v("Ações")])])])}];const nt={name:"GruposList",setup(){const a=(0,e.KR)([]),t=(0,e.KR)(!0),o=(0,e.KR)(!1),r=(0,e.KR)(!1),s=(0,e.KR)(!1),i=(0,e.Kh)({id:null,nome:"",descricao:""});(0,e.sV)((async()=>{await n()}));const n=async()=>{try{t.value=!0;const{data:o,error:e}=await g.ND.from("grupos").select("*").order("nome");if(e)throw e;a.value=o||[]}catch(o){console.error("Erro ao carregar grupos:",o),alert("Erro ao carregar grupos. Por favor, tente novamente.")}finally{t.value=!1}},l=a=>{if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")},d=a=>{s.value=!0,i.id=a.id,i.nome=a.nome,i.descricao=a.descricao||"",r.value=!0},c=()=>{r.value=!1,s.value=!1,i.id=null,i.nome="",i.descricao=""},u=async()=>{try{if(o.value=!0,s.value){const{error:a}=await g.ND.from("grupos").update({nome:i.nome,descricao:i.descricao}).eq("id",i.id);if(a)throw a;alert("Grupo atualizado com sucesso!")}else{const{error:a}=await g.ND.from("grupos").insert({nome:i.nome,descricao:i.descricao});if(a)throw a;alert("Grupo adicionado com sucesso!")}await n(),c()}catch(a){console.error("Erro ao salvar grupo:",a),alert(`Erro ao ${s.value?"atualizar":"adicionar"} grupo: ${a.message}`)}finally{o.value=!1}},v=a=>{confirm(`Deseja realmente excluir o grupo "${a.nome}"?`)&&m(a.id)},m=async a=>{try{t.value=!0;const{data:o,error:e}=await g.ND.from("classes").select("id").eq("grupo_id",a);if(e)throw e;if(o&&o.length>0)return void alert(`Não é possível excluir este grupo porque existem ${o.length} classes associadas a ele.`);const{data:r,error:s}=await g.ND.from("produtos").select("id").eq("grupo_id",a);if(s)throw s;if(r&&r.length>0)return void alert(`Não é possível excluir este grupo porque existem ${r.length} produtos associados a ele.`);const{error:i}=await g.ND.from("grupos").delete().eq("id",a);if(i)throw i;alert("Grupo excluído com sucesso!"),await n()}catch(o){console.error("Erro ao excluir grupo:",o),alert(`Erro ao excluir grupo: ${o.message}`)}finally{t.value=!1}};return{grupos:a,loading:t,salvando:o,mostrarFormulario:r,modoEdicao:s,grupoAtual:i,carregarGrupos:n,formatarData:l,editarGrupo:d,fecharFormulario:c,salvarGrupo:u,confirmarExclusao:v}}},lt=nt;var dt=(0,i.A)(lt,st,it,!1,null,"3509bc35",null);const ct=dt.exports;var ut=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classes-list"},[t("div",{staticClass:"header"},[t("h3",[a._v("Gerenciamento de Classes")]),t("button",{staticClass:"btn-add",on:{click:function(t){a.mostrarFormulario=!0}}},[a._v(" Adicionar Classe ")])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando classes...")])]):0===a.classes.length?t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhuma classe cadastrada.")])]):t("div",{staticClass:"classes-table"},[t("table",[a._m(0),t("tbody",a._l(a.classes,(function(o){return t("tr",{key:o.id},[t("td",[a._v(a._s(o.nome))]),t("td",[a._v(a._s(a.getNomeGrupo(o.grupo_id)))]),t("td",[a._v(a._s(o.descricao||"-"))]),t("td",[a._v(a._s(a.formatarData(o.created_at)))]),t("td",{staticClass:"actions"},[t("button",{staticClass:"btn-edit",on:{click:function(t){return a.editarClasse(o)}}},[a._v("Editar")]),t("button",{staticClass:"btn-delete",on:{click:function(t){return a.confirmarExclusao(o)}}},[a._v("Excluir")])])])})),0)])]),a.mostrarFormulario?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.modoEdicao?"Editar":"Adicionar")+" Classe")]),t("button",{staticClass:"btn-close",on:{click:a.fecharFormulario}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarClasse.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"grupo"}},[a._v("Grupo*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.grupo_id,expression:"classeAtual.grupo_id"}],attrs:{id:"grupo",required:""},on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.classeAtual,"grupo_id",t.target.multiple?o:o[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.grupos,(function(o){return t("option",{key:o.id,domProps:{value:o.id}},[a._v(" "+a._s(o.nome)+" ")])}))],2),0===a.grupos.length?t("div",{staticClass:"error-text"},[t("p",[a._v("É necessário cadastrar pelo menos um grupo antes de adicionar classes.")])]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome da Classe*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.nome,expression:"classeAtual.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.classeAtual.nome},on:{input:function(t){t.target.composing||a.$set(a.classeAtual,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descrição")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.descricao,expression:"classeAtual.descricao"}],attrs:{id:"descricao",rows:"3"},domProps:{value:a.classeAtual.descricao},on:{input:function(t){t.target.composing||a.$set(a.classeAtual,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharFormulario}},[a._v("Cancelar")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.salvando||0===a.grupos.length}},[a._v(" "+a._s(a.salvando?"Salvando...":"Salvar")+" ")])])])])])]):a._e()])},vt=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Grupo")]),t("th",[a._v("Descrição")]),t("th",[a._v("Data de Criação")]),t("th",[a._v("Ações")])])])}];const mt={name:"ClassesList",setup(){const a=(0,e.KR)([]),t=(0,e.KR)([]),o=(0,e.KR)(!0),r=(0,e.KR)(!1),s=(0,e.KR)(!1),i=(0,e.KR)(!1),n=(0,e.Kh)({id:null,grupo_id:"",nome:"",descricao:""});(0,e.sV)((async()=>{await Promise.all([l(),d()])}));const l=async()=>{try{const{data:a,error:o}=await g.ND.from("grupos").select("*").order("nome");if(o)throw o;t.value=a||[]}catch(a){console.error("Erro ao carregar grupos:",a),alert("Erro ao carregar grupos. Por favor, tente novamente.")}},d=async()=>{try{o.value=!0;const{data:t,error:e}=await g.ND.from("classes").select("*").order("nome");if(e)throw e;a.value=t||[]}catch(t){console.error("Erro ao carregar classes:",t),alert("Erro ao carregar classes. Por favor, tente novamente.")}finally{o.value=!1}},c=a=>{const o=t.value.find((t=>t.id===a));return o?o.nome:"Grupo não encontrado"},u=a=>{if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")},v=a=>{i.value=!0,n.id=a.id,n.grupo_id=a.grupo_id,n.nome=a.nome,n.descricao=a.descricao||"",s.value=!0},m=()=>{s.value=!1,i.value=!1,n.id=null,n.grupo_id="",n.nome="",n.descricao=""},p=async()=>{try{if(r.value=!0,i.value){const{error:a}=await g.ND.from("classes").update({grupo_id:n.grupo_id,nome:n.nome,descricao:n.descricao}).eq("id",n.id);if(a)throw a;alert("Classe atualizada com sucesso!")}else{const{error:a}=await g.ND.from("classes").insert({grupo_id:n.grupo_id,nome:n.nome,descricao:n.descricao});if(a)throw a;alert("Classe adicionada com sucesso!")}await d(),m()}catch(a){console.error("Erro ao salvar classe:",a),alert(`Erro ao ${i.value?"atualizar":"adicionar"} classe: ${a.message}`)}finally{r.value=!1}},h=a=>{confirm(`Deseja realmente excluir a classe "${a.nome}"?`)&&_(a.id)},_=async a=>{try{o.value=!0;const{data:t,error:e}=await g.ND.from("produtos").select("id").eq("classe_id",a);if(e)throw e;if(t&&t.length>0)return void alert(`Não é possível excluir esta classe porque existem ${t.length} produtos associados a ela.`);const{error:r}=await g.ND.from("classes").delete().eq("id",a);if(r)throw r;alert("Classe excluída com sucesso!"),await d()}catch(t){console.error("Erro ao excluir classe:",t),alert(`Erro ao excluir classe: ${t.message}`)}finally{o.value=!1}};return{classes:a,grupos:t,loading:o,salvando:r,mostrarFormulario:s,modoEdicao:i,classeAtual:n,carregarClasses:d,carregarGrupos:l,getNomeGrupo:c,formatarData:u,editarClasse:v,fecharFormulario:m,salvarClasse:p,confirmarExclusao:h}}},pt=mt;var gt=(0,i.A)(pt,ut,vt,!1,null,"7574422a",null);const ht=gt.exports,_t={name:"Classificacao",components:{GruposList:ct,ClassesList:ht},setup(){const a=(0,e.KR)("grupos");return{activeTab:a}}},ft=_t;var Ct=(0,i.A)(ft,et,rt,!1,null,"35477b05",null);const bt=Ct.exports,wt={name:"ClassificacaoView",components:{Classificacao:bt},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}}}},Dt=wt;var yt=(0,i.A)(Dt,tt,ot,!1,null,"4316ab21",null);const Pt=yt.exports;e.Ay.use(c.Ay);const Et=[{path:"/",name:"Home",component:P,meta:{requiresAuth:!1}},{path:"/dashboard",name:"Dashboard",component:F,meta:{requiresAuth:!0}},{path:"/ccl",name:"CCL",component:at,meta:{requiresAuth:!0}},{path:"/cadastro",name:"Cadastro",component:V,meta:{requiresAuth:!0}},{path:"/analise/:id",name:"Analise",component:ia,meta:{requiresAuth:!0}},{path:"/catalogo",name:"Catalogo",component:fa,meta:{requiresAuth:!0}},{path:"/feedback",name:"Feedback",component:Ia,meta:{requiresAuth:!0}},{path:"/dcb",name:"DCB",component:Ba,meta:{requiresAuth:!0}},{path:"/classificacao",name:"Classificacao",component:Pt,meta:{requiresAuth:!0}},{path:"/produtos/:id",name:"DetalheProduto",component:()=>o.e(961).then(o.bind(o,342)),props:!0,meta:{requiresAuth:!0}}],Nt=new c.Ay({mode:"history",base:"/ComprarBem/",routes:Et});Nt.beforeEach((async(a,t,o)=>{const{data:e}=await g.ND.auth.getSession(),r=e?.session?.user,s=a.matched.some((a=>a.meta.requiresAuth));s&&!r?o("/"):o()}));const At=Nt;var kt=o(353);e.Ay.use(kt.Ay);const xt=new kt.Ay.Store({state:{user:null,tenant:null,isLoading:!1},mutations:{SET_USER(a,t){a.user=t},SET_TENANT(a,t){a.tenant=t},SET_LOADING(a,t){a.isLoading=t}},actions:{async fetchUser({commit:a}){const{data:t}=await g.ND.auth.getSession(),o=t?.session?.user;if(a("SET_USER",o),o){const{data:t,error:e}=await g.ND.from("tenants").select("*").eq("id",o.user_metadata?.tenant_id).single();!e&&t&&a("SET_TENANT",t)}},setLoading({commit:a},t){a("SET_LOADING",t)}},getters:{isAuthenticated:a=>!!a.user,currentUser:a=>a.user,currentTenant:a=>a.tenant,isLoading:a=>a.isLoading}});var It=o(640),Tt=o(201),St=o.n(Tt);e.Ay.config.productionTip=!1,e.Ay.use(It.A),e.Ay.use(St()),new e.Ay({router:At,store:xt,render:a=>a(d)}).$mount("#app")}},t={};function o(e){var r=t[e];if(void 0!==r)return r.exports;var s=t[e]={exports:{}};return a[e].call(s.exports,s,s.exports,o),s.exports}o.m=a,(()=>{var a=[];o.O=(t,e,r,s)=>{if(!e){var i=1/0;for(c=0;c<a.length;c++){for(var[e,r,s]=a[c],n=!0,l=0;l<e.length;l++)(!1&s||i>=s)&&Object.keys(o.O).every((a=>o.O[a](e[l])))?e.splice(l--,1):(n=!1,s<i&&(i=s));if(n){a.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}s=s||0;for(var c=a.length;c>0&&a[c-1][2]>s;c--)a[c]=a[c-1];a[c]=[e,r,s]}})(),(()=>{o.n=a=>{var t=a&&a.__esModule?()=>a["default"]:()=>a;return o.d(t,{a:t}),t}})(),(()=>{var a,t=Object.getPrototypeOf?a=>Object.getPrototypeOf(a):a=>a.__proto__;o.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"===typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"===typeof e.then)return e}var s=Object.create(null);o.r(s);var i={};a=a||[null,t({}),t([]),t(t)];for(var n=2&r&&e;"object"==typeof n&&!~a.indexOf(n);n=t(n))Object.getOwnPropertyNames(n).forEach((a=>i[a]=()=>e[a]));return i["default"]=()=>e,o.d(s,i),s}})(),(()=>{o.d=(a,t)=>{for(var e in t)o.o(t,e)&&!o.o(a,e)&&Object.defineProperty(a,e,{enumerable:!0,get:t[e]})}})(),(()=>{o.f={},o.e=a=>Promise.all(Object.keys(o.f).reduce(((t,e)=>(o.f[e](a,t),t)),[]))})(),(()=>{o.u=a=>"js/"+a+"."+{591:"fd9cb239",961:"8d790549"}[a]+".js"})(),(()=>{o.miniCssF=a=>"css/"+a+".401b363e.css"})(),(()=>{o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"===typeof window)return window}}()})(),(()=>{o.o=(a,t)=>Object.prototype.hasOwnProperty.call(a,t)})(),(()=>{var a={},t="comprar-bem:";o.l=(e,r,s,i)=>{if(a[e])a[e].push(r);else{var n,l;if(void 0!==s)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==t+s){n=u;break}}n||(l=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,o.nc&&n.setAttribute("nonce",o.nc),n.setAttribute("data-webpack",t+s),n.src=e),a[e]=[r];var v=(t,o)=>{n.onerror=n.onload=null,clearTimeout(m);var r=a[e];if(delete a[e],n.parentNode&&n.parentNode.removeChild(n),r&&r.forEach((a=>a(o))),t)return t(o)},m=setTimeout(v.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=v.bind(null,n.onerror),n.onload=v.bind(null,n.onload),l&&document.head.appendChild(n)}}})(),(()=>{o.r=a=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})}})(),(()=>{o.p="/ComprarBem/"})(),(()=>{if("undefined"!==typeof document){var a=(a,t,e,r,s)=>{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",o.nc&&(i.nonce=o.nc);var n=o=>{if(i.onerror=i.onload=null,"load"===o.type)r();else{var e=o&&o.type,n=o&&o.target&&o.target.href||t,l=new Error("Loading CSS chunk "+a+" failed.\n("+e+": "+n+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=e,l.request=n,i.parentNode&&i.parentNode.removeChild(i),s(l)}};return i.onerror=i.onload=n,i.href=t,e?e.parentNode.insertBefore(i,e.nextSibling):document.head.appendChild(i),i},t=(a,t)=>{for(var o=document.getElementsByTagName("link"),e=0;e<o.length;e++){var r=o[e],s=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(s===a||s===t))return r}var i=document.getElementsByTagName("style");for(e=0;e<i.length;e++){r=i[e],s=r.getAttribute("data-href");if(s===a||s===t)return r}},e=e=>new Promise(((r,s)=>{var i=o.miniCssF(e),n=o.p+i;if(t(i,n))return r();a(e,n,null,r,s)})),r={524:0};o.f.miniCss=(a,t)=>{var o={961:1};r[a]?t.push(r[a]):0!==r[a]&&o[a]&&t.push(r[a]=e(a).then((()=>{r[a]=0}),(t=>{throw delete r[a],t})))}}})(),(()=>{var a={524:0};o.f.j=(t,e)=>{var r=o.o(a,t)?a[t]:void 0;if(0!==r)if(r)e.push(r[2]);else{var s=new Promise(((o,e)=>r=a[t]=[o,e]));e.push(r[2]=s);var i=o.p+o.u(t),n=new Error,l=e=>{if(o.o(a,t)&&(r=a[t],0!==r&&(a[t]=void 0),r)){var s=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;n.message="Loading chunk "+t+" failed.\n("+s+": "+i+")",n.name="ChunkLoadError",n.type=s,n.request=i,r[1](n)}};o.l(i,l,"chunk-"+t,t)}},o.O.j=t=>0===a[t];var t=(t,e)=>{var r,s,[i,n,l]=e,d=0;if(i.some((t=>0!==a[t]))){for(r in n)o.o(n,r)&&(o.m[r]=n[r]);if(l)var c=l(o)}for(t&&t(e);d<i.length;d++)s=i[d],o.o(a,s)&&a[s]&&a[s][0](),a[s]=0;return o.O(c)},e=self["webpackChunkcomprar_bem"]=self["webpackChunkcomprar_bem"]||[];e.forEach(t.bind(null,0)),e.push=t.bind(null,e.push.bind(e))})();var e=o.O(void 0,[504],(()=>o(548)));e=o.O(e)})();
//# sourceMappingURL=app.b8b4e8cb.js.map