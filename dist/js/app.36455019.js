(()=>{"use strict";var a={452:(a,t,e)=>{e.d(t,{ND:()=>r});var o=e(17);const s="https://ruagsbbczuwgfflgcaol.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1YWdzYmJjenV3Z2ZmbGdjYW9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ0Njg5MDQsImV4cCI6MjA2MDA0NDkwNH0.S2KD6-9DpBYAOsodjibI7LGa04CspZZ5OdRQagNjoK8",r=(0,o.UU)(s,i)},773:(a,t,e)=>{var o=e(471),s=function(){var a=this,t=a._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},i=[],r=e(656),n={},l=(0,r.A)(n,s,i,!1,null,null,null);const c=l.exports;var d=e(173),u=function(){var a=this,t=a._self._c;return t("div",{staticClass:"home"},[t("Login")],1)},m=[],p=function(){var a=this,t=a._self._c;return t("div",{staticClass:"login-container"},[t("div",{staticClass:"login-card"},[t("h2",[a._v("Comprar Bem: Compras Inteligentes")]),t("p",[a._v("Saúde e Administração")]),t("div",{staticClass:"tabs"},[t("button",{class:{active:"login"===a.activeTab},on:{click:function(t){a.activeTab="login"}}},[a._v("Login")]),t("button",{class:{active:"register"===a.activeTab},on:{click:function(t){a.activeTab="register"}}},[a._v("Registrar")])]),"login"===a.activeTab?t("div",[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email"}},[a._v("E-mail")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.email,expression:"email"}],attrs:{id:"email",type:"email",placeholder:"Seu e-mail",required:""},domProps:{value:a.email},on:{input:function(t){t.target.composing||(a.email=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"password"}},[a._v("Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.password,expression:"password"}],attrs:{id:"password",type:"password",placeholder:"Sua senha",required:""},domProps:{value:a.password},on:{input:function(t){t.target.composing||(a.password=t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{disabled:a.loading},on:{click:a.login}},[a._v(" "+a._s(a.loading?"Entrando...":"Entrar")+" ")])]):a._e(),"register"===a.activeTab?t("div",[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registerEmail"}},[a._v("E-mail")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.registerEmail,expression:"registerEmail"}],attrs:{id:"registerEmail",type:"email",placeholder:"Seu e-mail",required:""},domProps:{value:a.registerEmail},on:{input:function(t){t.target.composing||(a.registerEmail=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registerPassword"}},[a._v("Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.registerPassword,expression:"registerPassword"}],attrs:{id:"registerPassword",type:"password",placeholder:"Sua senha",required:""},domProps:{value:a.registerPassword},on:{input:function(t){t.target.composing||(a.registerPassword=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"confirmPassword"}},[a._v("Confirmar Senha")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.confirmPassword,expression:"confirmPassword"}],attrs:{id:"confirmPassword",type:"password",placeholder:"Confirme sua senha",required:""},domProps:{value:a.confirmPassword},on:{input:function(t){t.target.composing||(a.confirmPassword=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeInstitucional"}},[a._v("Nome da Instituição")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nomeInstitucional,expression:"nomeInstitucional"}],attrs:{id:"nomeInstitucional",type:"text",placeholder:"Nome da sua instituição",required:""},domProps:{value:a.nomeInstitucional},on:{input:function(t){t.target.composing||(a.nomeInstitucional=t.target.value)}}})]),t("button",{staticClass:"btn-primary",attrs:{type:"button"},on:{click:a.register}},[a._v(" "+a._s(a.loading?"Registrando...":"Registrar")+" ")]),t("button",{staticClass:"btn-test",staticStyle:{"margin-top":"10px"},on:{click:a.testeSimples}},[a._v(" Teste Simples ")]),a.validRegistration?a._e():t("div",{staticClass:"validation-info"},[t("p",[a._v("O formulário não está válido porque:")]),t("ul",[a.registerEmail?a._e():t("li",[a._v("Falta o e-mail")]),a.registerPassword?a._e():t("li",[a._v("Falta a senha")]),a.registerPassword&&a.registerPassword.length<6?t("li",[a._v("A senha precisa ter pelo menos 6 caracteres")]):a._e(),a.registerPassword!==a.confirmPassword?t("li",[a._v("As senhas não conferem")]):a._e(),a.nomeInstitucional?a._e():t("li",[a._v("Falta o nome da instituição")])])])]):a._e(),a.errorMsg?t("p",{staticClass:"error-message"},[a._v(a._s(a.errorMsg))]):a._e(),"register"===a.activeTab?t("div",{staticClass:"test-buttons"},[t("button",{staticClass:"btn-test",on:{click:a.testarSupabase}},[a._v("Testar Conexão Supabase")])]):a._e()])])},v=[],g=e(452),f=e(303);const h={name:"Login",data(){return{activeTab:"login",email:"",password:"",registerEmail:"",registerPassword:"",confirmPassword:"",nomeInstitucional:"",loading:!1,errorMsg:""}},computed:{validRegistration(){return this.registerEmail&&this.registerPassword&&this.registerPassword===this.confirmPassword&&this.nomeInstitucional&&this.registerPassword.length>=6}},mounted(){console.log("Componente Login montado",{activeTab:this.activeTab})},watch:{activeTab(a){console.log("Aba ativa alterada para:",a)},registerEmail(a){console.log("E-mail de registro alterado:",a)},registerPassword(a){console.log("Senha de registro alterada:",a?"****":"")}},methods:{async testarSupabase(){console.log("Testando conexão com Supabase...");try{const{data:a,error:t}=await g.ND.from("tenants").select("*").limit(1);console.log("Resultado do teste tabela tenants:",{data:a,error:t}),t?alert(`Erro ao acessar tabela: ${t.message}`):alert(`Conexão OK! ${a?a.length:0} registros encontrados.`);const e=(0,f.A)();console.log("Teste UUID gerado:",e)}catch(a){console.error("Erro no teste:",a),alert(`Erro na conexão: ${a.message}`)}},async login(){try{this.loading=!0,this.errorMsg="";const{error:a}=await g.ND.auth.signInWithPassword({email:this.email,password:this.password});if(a)throw a;this.$router.push("/dashboard")}catch(a){this.errorMsg=a.message||"Erro ao fazer login"}finally{this.loading=!1}},async register(){if(console.log("Método register chamado",{email:this.registerEmail,password:"****",nomeInstitucional:this.nomeInstitucional}),!this.validRegistration)return console.log("Formulário inválido"),void(this.errorMsg="Verifique os campos do formulário");try{this.loading=!0,this.errorMsg="",console.log("Iniciando registro de usuário no Supabase...");const{data:t,error:e}=await g.ND.auth.signUp({email:this.registerEmail,password:this.registerPassword});if(console.log("Resposta do registro de usuário:",{authData:t,authError:e}),e&&!e.message.includes("already registered"))throw e;const o=t?.user?.id;console.log("ID da autenticação:",o);const s=(0,f.A)(),i=(0,f.A)();try{const{error:a}=await g.ND.from("usuarios").delete().eq("email",this.registerEmail);a&&console.warn("Aviso ao tentar remover usuário existente:",a)}catch(a){console.warn("Erro ao tentar remover usuário:",a)}console.log("Criando tenant...");const{data:r,error:n}=await g.ND.from("tenants").insert({id:s,nome:this.nomeInstitucional,descricao:`Tenant para ${this.registerEmail}`,ativo:!0}).select();if(n)throw new Error(`Erro ao criar tenant: ${n.message}`);console.log("Criando usuário...");const{data:l,error:c}=await g.ND.from("usuarios").insert({id:i,email:this.registerEmail,nome:this.nomeInstitucional,tenant_id:s,tipo:"admin",ativo:!0}).select();if(c)throw c.message.includes("duplicate key")?(this.errorMsg="Este email já está registrado. Por favor, contate o suporte.",new Error(`Email já existe na base de dados: ${c.message}`)):new Error(`Erro ao criar usuário: ${c.message}`);console.log("Atualizando tenant com user_id...");const{error:d}=await g.ND.from("tenants").update({user_id:o}).eq("id",s);d&&console.warn("Aviso: Não foi possível atualizar o tenant com user_id:",d),console.log("Registro concluído com sucesso!"),alert("Registro realizado com sucesso! Verifique seu e-mail para confirmar a conta."),this.activeTab="login",this.email=this.registerEmail}catch(t){console.error("Erro detalhado no registro:",t),this.errorMsg=this.errorMsg||t.message||"Erro ao fazer registro"}finally{this.loading=!1}},testeSimples(){console.log("Botão de teste simples clicado"),alert("Teste de evento de clique funcionando!")}}},_=h;var C=(0,r.A)(_,p,v,!1,null,"0af2f7e3",null);const b=C.exports,w={name:"Home",components:{Login:b}},D=w;var E=(0,r.A)(D,u,m,!1,null,null,null);const y=E.exports;var P=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("▼")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("DashboardCPM")],1)])},x=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])}],R=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard"},[t("h2",[a._v("Painel CPM")]),t("div",{staticClass:"tabs"},[t("div",{staticClass:"tab",class:{active:"dashboard"===a.activeTab},on:{click:function(t){a.activeTab="dashboard"}}},[a._v(" Dashboard ")]),t("div",{staticClass:"tab",class:{active:"editais"===a.activeTab},on:{click:function(t){a.activeTab="editais"}}},[a._v(" Editais de Pré-Qualificação ")]),t("div",{staticClass:"tab",class:{active:"pesquisa"===a.activeTab},on:{click:function(t){a.activeTab="pesquisa"}}},[a._v(" Pesquisa de Mercado ")]),t("div",{staticClass:"tab",class:{active:"despadronizadas"===a.activeTab},on:{click:function(t){a.activeTab="despadronizadas"}}},[a._v(" Marcas Despadronizadas ")]),t("div",{staticClass:"tab",class:{active:"certificados"===a.activeTab},on:{click:function(t){a.activeTab="certificados"}}},[a._v(" Emissão de Certificados (DCB) ")])]),"dashboard"===a.activeTab?t("div",[t("div",{staticClass:"stats-container"},[t("div",{staticClass:"stat-card status-pendente-card"},[t("h3",[a._v("Produtos em Avaliação")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.pendentes))])]),t("div",{staticClass:"stat-card status-aprovado-card"},[t("h3",[a._v("Produtos Aprovados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.aprovados))])]),t("div",{staticClass:"stat-card status-reprovado-card"},[t("h3",[a._v("Produtos Reprovados")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.reprovados))])])]),t("div",{staticClass:"recent-products"},[t("div",{staticClass:"section-header"},[t("h3",[a._v("📋 Requerimentos Recentes")]),t("div",{staticClass:"pagination-controls"},[t("label",[a._v("Itens por página:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.itensPorPagina,expression:"itensPorPagina"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.itensPorPagina=t.target.multiple?e:e[0]},a.aplicarPaginacao]}},[t("option",{attrs:{value:"5"}},[a._v("5")]),t("option",{attrs:{value:"10"}},[a._v("10")]),t("option",{attrs:{value:"20"}},[a._v("20")]),t("option",{attrs:{value:"50"}},[a._v("50")])])])]),t("div",{staticClass:"filtros-inline"},[t("div",{staticClass:"filtro-inline"},[t("label",[a._v("🔤 Nome:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.nome,expression:"filtros.nome"}],attrs:{type:"text",placeholder:"Filtrar por nome..."},domProps:{value:a.filtros.nome},on:{input:[function(t){t.target.composing||a.$set(a.filtros,"nome",t.target.value)},a.aplicarFiltros]}})]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("🏷️ Marca:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.marca,expression:"filtros.marca"}],attrs:{type:"text",placeholder:"Filtrar por marca..."},domProps:{value:a.filtros.marca},on:{input:[function(t){t.target.composing||a.$set(a.filtros,"marca",t.target.value)},a.aplicarFiltros]}})]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("📊 Status:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtros.status,expression:"filtros.status"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtros,"status",t.target.multiple?e:e[0])},a.aplicarFiltros]}},[t("option",{attrs:{value:""}},[a._v("Todos")]),t("option",{attrs:{value:"pendente"}},[a._v("Em Avaliação")]),t("option",{attrs:{value:"aprovado"}},[a._v("Aprovado")]),t("option",{attrs:{value:"reprovado"}},[a._v("Reprovado")]),t("option",{attrs:{value:"em_analise"}},[a._v("Em Análise")])])]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("📅 Data:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtros.data,expression:"filtros.data"}],attrs:{type:"date"},domProps:{value:a.filtros.data},on:{change:a.aplicarFiltros,input:function(t){t.target.composing||a.$set(a.filtros,"data",t.target.value)}}})]),t("button",{staticClass:"btn-limpar-filtros",on:{click:a.limparFiltros}},[a._v(" 🗑️ Limpar ")])]),a.produtosPaginados.length>0?t("table",[a._m(0),t("tbody",a._l(a.produtosPaginados,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.marca))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(e.status)},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")])]),t("td",[a._v(a._s(a.formatDate(e.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.verProduto(e.id)}}},[a._v("Visualizar")])])])})),0)]):a._e(),a.totalPaginas>1?t("div",{staticClass:"paginacao"},[t("div",{staticClass:"paginacao-info"},[a._v(" Página "+a._s(a.paginaAtual)+" de "+a._s(a.totalPaginas)+" ")]),t("div",{staticClass:"paginacao-botoes"},[t("button",{staticClass:"btn-paginacao",attrs:{disabled:1===a.paginaAtual},on:{click:function(t){return a.irParaPagina(a.paginaAtual-1)}}},[a._v(" ◀️ Anterior ")]),t("span",{staticClass:"numeros-pagina"},a._l(a.paginasVisiveis,(function(e){return t("button",{key:e,class:["btn-numero",{active:e===a.paginaAtual}],on:{click:function(t){return a.irParaPagina(e)}}},[a._v(" "+a._s(e)+" ")])})),0),t("button",{staticClass:"btn-paginacao",attrs:{disabled:a.paginaAtual===a.totalPaginas},on:{click:function(t){return a.irParaPagina(a.paginaAtual+1)}}},[a._v(" ▶️ Próxima ")])])]):0===a.produtos.length?t("p",[a._v("Nenhum requerimento cadastrado.")]):a.temFiltrosAplicados?t("p",[a._v("Nenhum produto encontrado com os filtros aplicados.")]):a._e()]),t("div",{staticClass:"diligencia-section"},[t("div",{staticClass:"section-header"},[t("h3",[a._v("🔍 Requerimentos com Diligências")]),t("div",{staticClass:"pagination-controls"},[t("label",[a._v("Itens por página:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.itensPorPaginaDiligencia,expression:"itensPorPaginaDiligencia"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.itensPorPaginaDiligencia=t.target.multiple?e:e[0]},a.aplicarPaginacaoDiligencia]}},[t("option",{attrs:{value:"5"}},[a._v("5")]),t("option",{attrs:{value:"10"}},[a._v("10")]),t("option",{attrs:{value:"20"}},[a._v("20")])])])]),t("div",{staticClass:"filtros-inline"},[t("div",{staticClass:"filtro-inline"},[t("label",[a._v("🔍 Buscar:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDiligencia.busca,expression:"filtrosDiligencia.busca"}],attrs:{type:"text",placeholder:"Nome, marca ou fabricante..."},domProps:{value:a.filtrosDiligencia.busca},on:{input:[function(t){t.target.composing||a.$set(a.filtrosDiligencia,"busca",t.target.value)},a.aplicarFiltrosDiligencia]}})]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("🏷️ Marca:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDiligencia.marca,expression:"filtrosDiligencia.marca"}],on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.filtrosDiligencia,"marca",t.target.multiple?e:e[0])},a.aplicarFiltrosDiligencia]}},[t("option",{attrs:{value:""}},[a._v("Todas")]),a._l(a.marcasUnicas,(function(e){return t("option",{key:e,domProps:{value:e}},[a._v(" "+a._s(e)+" ")])}))],2)]),t("div",{staticClass:"filtro-inline"},[t("label",[a._v("📅 Data:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtrosDiligencia.data,expression:"filtrosDiligencia.data"}],attrs:{type:"date"},domProps:{value:a.filtrosDiligencia.data},on:{change:a.aplicarFiltrosDiligencia,input:function(t){t.target.composing||a.$set(a.filtrosDiligencia,"data",t.target.value)}}})]),t("button",{staticClass:"btn-limpar-filtros",on:{click:a.limparFiltrosDiligencia}},[a._v(" 🗑️ Limpar ")])]),a.diligenciasPaginadas.length>0?t("table",[a._m(1),t("tbody",a._l(a.diligenciasPaginadas,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.marca))]),a._m(2,!0),t("td",[a._v(a._s(a.formatDate(e.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.verProduto(e.id)}}},[a._v("Visualizar")]),t("button",{staticClass:"btn-small btn-diligencia",on:{click:function(t){return a.visualizarDiligencias(e.id)}}},[a._v("Ver Diligências")])])])})),0)]):a._e(),a.totalPaginasDiligencia>1?t("div",{staticClass:"paginacao"},[t("div",{staticClass:"paginacao-info"},[a._v(" Página "+a._s(a.paginaAtualDiligencia)+" de "+a._s(a.totalPaginasDiligencia)+" ")]),t("div",{staticClass:"paginacao-botoes"},[t("button",{staticClass:"btn-paginacao",attrs:{disabled:1===a.paginaAtualDiligencia},on:{click:function(t){return a.irParaPaginaDiligencia(a.paginaAtualDiligencia-1)}}},[a._v(" ◀️ Anterior ")]),t("span",{staticClass:"numeros-pagina"},a._l(a.paginasVisiveisDiligencia,(function(e){return t("button",{key:e,class:["btn-numero",{active:e===a.paginaAtualDiligencia}],on:{click:function(t){return a.irParaPaginaDiligencia(e)}}},[a._v(" "+a._s(e)+" ")])})),0),t("button",{staticClass:"btn-paginacao",attrs:{disabled:a.paginaAtualDiligencia===a.totalPaginasDiligencia},on:{click:function(t){return a.irParaPaginaDiligencia(a.paginaAtualDiligencia+1)}}},[a._v(" ▶️ Próxima ")])])]):0===a.produtosComDiligencia.length?t("p",[a._v("Nenhum requerimento com diligência encontrado.")]):a.temFiltrosDiligenciaAplicados?t("p",[a._v("Nenhuma diligência encontrada com os filtros aplicados.")]):a._e()]),t("div",{staticClass:"impugnacoes-section"},[t("h3",[a._v("Impugnações ao Edital")]),a.impugnacoes.length>0?t("table",[a._m(3),t("tbody",a._l(a.impugnacoes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.impugnante))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[a._v(a._s(a.formatDate(e.data_impugnacao)))]),t("td",[a._v(a._s(a.formatDate(e.prazo_final)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getImpugnacaoStatusClass(e.status)},[a._v(" "+a._s(e.status)+" ")])]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.analisarImpugnacao(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("Não há impugnações apresentadas.")])])]):a._e(),"pesquisa"===a.activeTab?t("div",{staticClass:"pesquisa-mercado"},[a._m(4)]):a._e(),"editais"===a.activeTab?t("div",{staticClass:"editais"},[t("div",{staticClass:"info-card"},[t("h3",[a._v("Editais de Pré-Qualificação")]),t("p",[a._v("Este módulo permite acessar os arquivos em PDF dos editais publicados pela Comissão de Padronização de Materiais.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),a._m(5),t("div",{staticClass:"editais-list"},[t("h4",[a._v("Editais Disponíveis")]),a.editais&&a.editais.length>0?t("table",[a._m(6),t("tbody",a._l(a.editais,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.numero))]),t("td",[a._v(a._s(e.descricao))]),t("td",[a._v(a._s(a.formatDate(e.data_publicacao)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.visualizarEdital(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])])]):a._e(),"despadronizadas"===a.activeTab?t("div",{staticClass:"marcas-despadronizadas"},[a._m(7)]):a._e(),"certificados"===a.activeTab?t("div",{staticClass:"certificados"},[a._m(8)]):a._e()])},N=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Ações")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Ações")])])])},function(){var a=this,t=a._self._c;return t("td",[t("span",{staticClass:"status-badge status-diligencia"},[a._v(" Diligência ")])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Impugnante")]),t("th",[a._v("Produto")]),t("th",[a._v("Data da Impugnação")]),t("th",[a._v("Prazo Final")]),t("th",[a._v("Status")]),t("th",[a._v("Documentação")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Pesquisa de Mercado")]),t("p",[a._v("Este módulo permitirá registrar as pesquisas realizadas para conhecer e/ou avaliar as especificações técnicas e funcionalidades de produtos novos ou já existentes no mercado fornecedor, bem como os seus preços estimados, para fins de instrução dos processos destinados à padronização de marcas e modelos.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Registro de especificações técnicas de produtos e cotações de fornecedores")]),t("li",[a._v("Comparativo técnico de produtos, seus preços e condições gerais")]),t("li",[a._v("Análise de variação de preços")]),t("li",[a._v("Geração de relatórios para instrução de processos de compras")]),t("li",[a._v("Integração com bancos de preços públicos")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])},function(){var a=this,t=a._self._c;return t("ul",[t("li",[a._v("Upload de arquivos PDF dos editais")]),t("li",[a._v("Organização dos editais por data e categoria")]),t("li",[a._v("Pesquisa avançada nos editais")]),t("li",[a._v("Controle de versões dos documentos")]),t("li",[a._v("Histórico de publicações por período")])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Número")]),t("th",[a._v("Descrição")]),t("th",[a._v("Data de Publicação")]),t("th",[a._v("Documentação")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Marcas Despadronizadas")]),t("p",[a._v("Este módulo permitirá gerenciar marcas e modelos que foram despadronizados ou que não atendem mais aos requisitos de padronização.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Registro de marcas e modelos despadronizados")]),t("li",[a._v("Motivos e justificativas para despadronização")]),t("li",[a._v("Histórico de despadronizações")]),t("li",[a._v("Restrições de uso para modelos despadronizados")]),t("li",[a._v("Notificação aos setores sobre despadronizações")]),t("li",[a._v("Relatórios de impacto por despadronização")]),t("li",[a._v("Registro de comunicações aos órgãos de controle")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Emissão de Certificados (DCB)")]),t("p",[a._v("Este módulo permitirá o acesso e emissão de certificados DCB (Documento de Comprovação de Bem) para produtos aprovados.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Emissão de Certificados (DCB)")]),t("li",[a._v("Controle e gerenciamento de certificados emitidos")]),t("li",[a._v("Validação e verificação de autenticidade")]),t("li",[a._v("Histórico de certificações por produto")]),t("li",[a._v("Relatórios de produtos certificados")]),t("li",[a._v("Notificação automática de certificações realizadas")]),t("li",[a._v("Controle de prazos de validade de DCB")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])}];const A={name:"DashboardCPM",data(){return{activeTab:"dashboard",produtos:[],produtosComDiligencia:[],pendentes:0,aprovados:0,reprovados:0,currentTenantId:null,loading:!1,editais:[],impugnacoes:[],certificados:[],itensPorPagina:5,paginaAtual:1,totalPaginas:1,paginasVisiveis:[],filtros:{nome:"",marca:"",status:"",data:""},produtosPaginados:[],produtosFiltrados:[],itensPorPaginaDiligencia:5,paginaAtualDiligencia:1,totalPaginasDiligencia:1,paginasVisiveisDiligencia:[],filtrosDiligencia:{busca:"",marca:"",data:""},diligenciasFiltradas:[],diligenciasPaginadas:[]}},created(){this.obterTenantId().then((()=>{this.carregarDados()}))},async mounted(){await this.carregarDados(),this.inicializarFiltros()},computed:{marcasUnicas(){const a=[...new Set(this.produtosComDiligencia.map((a=>a.marca)))];return a.filter((a=>a)).sort()},temFiltrosAplicados(){return this.filtros.nome||this.filtros.marca||this.filtros.status||this.filtros.data},temFiltrosDiligenciaAplicados(){return this.filtrosDiligencia.busca||this.filtrosDiligencia.marca||this.filtrosDiligencia.data}},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return this.currentTenantId=t.user_metadata.tenant_id,void console.log("Tenant ID obtido dos metadados:",this.currentTenantId);const{data:e,error:o}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id?(this.currentTenantId=e.tenant_id,console.log("Tenant ID obtido da tabela usuarios:",this.currentTenantId)):console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarDados(){try{if(this.loading=!0,!this.currentTenantId&&(console.error("Tenant ID não disponível. Tentando recarregar..."),await this.obterTenantId(),!this.currentTenantId))return void console.error("Não foi possível obter o tenant_id, impossível carregar dados");console.log("Carregando produtos para tenant_id:",this.currentTenantId);const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).order("criado_em",{ascending:!1});if(t)throw t;const e=a||[];this.produtos=e.filter((a=>["pendente","aprovado","reprovado","em_analise"].includes(a.status))),console.log(`${this.produtos.length} requerimentos recentes carregados (sem diligências)`),this.produtosComDiligencia=e.filter((a=>"diligencia"===a.status)),console.log(`${this.produtosComDiligencia.length} produtos com diligência carregados`),await this.carregarImpugnacoes();const o=await Promise.all([this.contarPorStatus("pendente"),this.contarPorStatus("aprovado"),this.contarPorStatus("reprovado")]);this.pendentes=o[0],this.aprovados=o[1],this.reprovados=o[2]}catch(a){console.error("Erro ao carregar dados:",a)}finally{this.loading=!1,this.$nextTick((()=>{this.inicializarFiltros()}))}},async contarPorStatus(a){if(!this.currentTenantId)return 0;const{count:t,error:e}=await g.ND.from("produtos").select("id",{count:"exact"}).eq("status",a).eq("tenant_id",this.currentTenantId);return e?(console.error(`Erro ao contar produtos ${a}:`,e),0):t||0},formatDate(a){if(!a)return"";const t=new Date(a);return t.toLocaleDateString("pt-BR")},formatarStatus(a){return"pendente"===a?"em avaliação":a},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},verProduto(a){this.$router.push(`/analise/${a}`)},async visualizarEdital(a){console.log(`Visualizando edital com ID: ${a}`)},getImpugnacaoStatusClass(a){switch(a){case"EM ANÁLISE":return"status-pendente";case"DEFERIDA":return"status-aprovado";case"INDEFERIDA":return"status-reprovado";default:return""}},async analisarImpugnacao(a){try{const{data:t,error:e}=await g.ND.from("impugnacoes").select("\n            *,\n            editais (\n              numero,\n              descricao\n            )\n          ").eq("id",a).single();if(e)throw e;const{value:o}=await this.$swal({title:"Análise de Impugnação",html:`\n            <div style="text-align: left;">\n              <h4>Impugnação de: ${t.impugnante}</h4>\n              <p><strong>Edital:</strong> ${t.editais?.numero} - ${t.editais?.descricao}</p>\n              <p><strong>Data:</strong> ${this.formatDate(t.data_impugnacao)}</p>\n              <p><strong>Prazo Final:</strong> ${this.formatDate(t.prazo_final)}</p>\n              <p><strong>Motivo:</strong> ${t.motivo}</p>\n              <p><strong>Status Atual:</strong> ${t.status}</p>\n            </div>\n            <hr>\n            <label for="decisao"><strong>Decisão:</strong></label>\n            <select id="decisao" class="swal2-input">\n              <option value="">Selecione uma decisão</option>\n              <option value="DEFERIDA">DEFERIDA (Procedente)</option>\n              <option value="INDEFERIDA">INDEFERIDA (Improcedente)</option>\n              <option value="PARCIALMENTE_DEFERIDA">PARCIALMENTE DEFERIDA</option>\n            </select>\n            <label for="justificativa"><strong>Justificativa da Decisão:</strong></label>\n            <textarea id="justificativa" class="swal2-textarea" placeholder="Fundamente a decisão tomada..."></textarea>\n          `,focusConfirm:!1,preConfirm:()=>{const a=document.getElementById("decisao").value,t=document.getElementById("justificativa").value;return a?!t||t.trim().length<10?(this.$swal.showValidationMessage("A justificativa deve ter pelo menos 10 caracteres"),!1):{decisao:a,justificativa:t}:(this.$swal.showValidationMessage("Selecione uma decisão"),!1)}});o&&await this.salvarDecisaoImpugnacao(a,o.decisao,o.justificativa)}catch(t){console.error("Erro ao analisar impugnação:",t),this.$swal({title:"Erro",text:"Erro ao carregar dados da impugnação",icon:"error"})}},async carregarImpugnacoes(){try{const{data:a,error:t}=await g.ND.from("impugnacoes").select("\n            *,\n            editais (\n              numero,\n              descricao\n            )\n          ").eq("tenant_id",this.currentTenantId).order("data_impugnacao",{ascending:!1}).limit(10);if(t)throw t;this.impugnacoes=a?.map((a=>({...a,produto_nome:`Edital ${a.editais?.numero||"N/A"}`})))||[],console.log(`${this.impugnacoes.length} impugnações carregadas`)}catch(a){console.error("Erro ao carregar impugnações:",a),this.impugnacoes=[]}},async salvarDecisaoImpugnacao(a,t,e){try{const{error:o}=await g.ND.from("impugnacoes").update({status:t,justificativa_decisao:e,data_decisao:(new Date).toISOString(),analisado_por:"CPM"}).eq("id",a);if(o)throw o;this.$swal({title:"Sucesso!",text:"Decisão da impugnação salva com sucesso",icon:"success"}),await this.carregarImpugnacoes()}catch(o){console.error("Erro ao salvar decisão:",o),this.$swal({title:"Erro",text:"Erro ao salvar decisão da impugnação",icon:"error"})}},async solicitarDiligencia(a){try{const{value:t}=await this.$swal({title:"Solicitar Diligência",html:'\n             <label for="tipo_diligencia"><strong>Tipo de Diligência:</strong></label>\n             <select id="tipo_diligencia" class="swal2-input">\n               <option value="">Selecione o tipo</option>\n               <option value="DOCUMENTACAO_FALTANTE">Documentação Faltante</option>\n               <option value="AMOSTRA_INADEQUADA">Amostra Inadequada</option>\n               <option value="ESPECIFICACAO_INCOMPLETA">Especificação Incompleta</option>\n               <option value="CERTIFICACAO_PENDENTE">Certificação Pendente</option>\n               <option value="ESCLARECIMENTO_TECNICO">Esclarecimento Técnico</option>\n             </select>\n             <label for="descricao_diligencia"><strong>Descrição da Diligência:</strong></label>\n             <textarea id="descricao_diligencia" class="swal2-textarea" placeholder="Descreva detalhadamente o que precisa ser providenciado..."></textarea>\n             <label for="prazo_dias"><strong>Prazo (dias úteis):</strong></label>\n             <input type="number" id="prazo_dias" class="swal2-input" value="5" min="1" max="30">\n           ',focusConfirm:!1,preConfirm:()=>{const a=document.getElementById("tipo_diligencia").value,t=document.getElementById("descricao_diligencia").value,e=parseInt(document.getElementById("prazo_dias").value);return a?!t||t.trim().length<10?(this.$swal.showValidationMessage("A descrição deve ter pelo menos 10 caracteres"),!1):!e||e<1||e>30?(this.$swal.showValidationMessage("O prazo deve ser entre 1 e 30 dias"),!1):{tipo:a,descricao:t,prazo:e}:(this.$swal.showValidationMessage("Selecione o tipo de diligência"),!1)}});t&&await this.salvarDiligencia(a,t)}catch(t){console.error("Erro ao solicitar diligência:",t)}},async salvarDiligencia(a,t){try{const e=this.calcularDataUtil(new Date,t.prazo),{error:o}=await g.ND.from("diligencias").insert({produto_id:a,tenant_id:this.currentTenantId,tipo:t.tipo,descricao:t.descricao,prazo_dias:t.prazo,data_limite:e.toISOString(),status:"PENDENTE",solicitado_por:"CPM"});if(o)throw o;const{error:s}=await g.ND.from("produtos").update({status:"diligencia"}).eq("id",a);if(s)throw s;this.$swal({title:"Sucesso!",text:"Diligência solicitada com sucesso",icon:"success"}),await this.carregarDados()}catch(e){console.error("Erro ao salvar diligência:",e),this.$swal({title:"Erro",text:"Erro ao solicitar diligência",icon:"error"})}},async visualizarDiligencias(a){try{const{data:t,error:e}=await g.ND.from("diligencias").select("*").eq("produto_id",a).order("criado_em",{ascending:!1});if(e)throw e;let o='<div style="text-align: left;">';t&&t.length>0?(o+="<h4>Diligências do Produto:</h4>",t.forEach(((a,t)=>{const e="PENDENTE"===a.status?"color: #f39c12":"color: #27ae60";o+=`\n               <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px;">\n                 <strong>Diligência ${t+1}</strong><br>\n                 <strong>Tipo:</strong> ${a.tipo.replace(/_/g," ")}<br>\n                 <strong>Status:</strong> <span style="${e}">${a.status}</span><br>\n                 <strong>Descrição:</strong> ${a.descricao}<br>\n                 <strong>Prazo:</strong> ${this.formatDate(a.data_limite)}<br>\n                 <strong>Solicitado em:</strong> ${this.formatDate(a.criado_em)}\n               </div>\n             `}))):o+="<p>Nenhuma diligência encontrada para este produto.</p>",o+="</div>",this.$swal({title:"Diligências",html:o,width:"600px"})}catch(t){console.error("Erro ao carregar diligências:",t),this.$swal({title:"Erro",text:"Erro ao carregar diligências do produto",icon:"error"})}},calcularDataUtil(a,t){const e=new Date(a);let o=0;while(o<t)e.setDate(e.getDate()+1),0!==e.getDay()&&6!==e.getDay()&&o++;return e},inicializarFiltros(){this.produtosFiltrados=[...this.produtos],this.diligenciasFiltradas=[...this.produtosComDiligencia],this.aplicarFiltros(),this.aplicarFiltrosDiligencia()},aplicarFiltros(){this.produtosFiltrados=this.produtos.filter((a=>{const t=a.nome.toLowerCase().includes(this.filtros.nome.toLowerCase()),e=a.marca.toLowerCase().includes(this.filtros.marca.toLowerCase()),o=""===this.filtros.status||a.status===this.filtros.status;let s=!0;if(this.filtros.data){const t=new Date(a.criado_em).toDateString(),e=new Date(this.filtros.data).toDateString();s=t===e}return t&&e&&o&&s})),this.calcularPaginacao()},calcularPaginacao(){this.totalPaginas=Math.ceil(this.produtosFiltrados.length/this.itensPorPagina),this.paginaAtual>this.totalPaginas&&(this.paginaAtual=Math.max(1,this.totalPaginas)),this.paginasVisiveis=[];const a=5;if(this.totalPaginas<=a)for(let o=1;o<=this.totalPaginas;o++)this.paginasVisiveis.push(o);else{const t=Math.max(1,this.paginaAtual-2),e=Math.min(this.totalPaginas,t+a-1);for(let a=t;a<=e;a++)this.paginasVisiveis.push(a)}const t=(this.paginaAtual-1)*this.itensPorPagina,e=t+this.itensPorPagina;this.produtosPaginados=this.produtosFiltrados.slice(t,e)},aplicarPaginacao(){this.paginaAtual=1,this.calcularPaginacao()},irParaPagina(a){this.paginaAtual=a,this.calcularPaginacao()},limparFiltros(){this.filtros={nome:"",marca:"",status:"",data:""},this.paginaAtual=1,this.aplicarFiltros()},aplicarFiltrosDiligencia(){this.diligenciasFiltradas=this.produtosComDiligencia.filter((a=>{const t=!this.filtrosDiligencia.busca||a.nome.toLowerCase().includes(this.filtrosDiligencia.busca.toLowerCase())||a.marca.toLowerCase().includes(this.filtrosDiligencia.busca.toLowerCase())||a.fabricante&&a.fabricante.toLowerCase().includes(this.filtrosDiligencia.busca.toLowerCase()),e=!this.filtrosDiligencia.marca||a.marca===this.filtrosDiligencia.marca;let o=!0;if(this.filtrosDiligencia.data){const t=new Date(a.criado_em).toDateString(),e=new Date(this.filtrosDiligencia.data).toDateString();o=t===e}return t&&e&&o})),this.calcularPaginacaoDiligencia()},calcularPaginacaoDiligencia(){this.totalPaginasDiligencia=Math.ceil(this.diligenciasFiltradas.length/this.itensPorPaginaDiligencia),this.paginaAtualDiligencia>this.totalPaginasDiligencia&&(this.paginaAtualDiligencia=Math.max(1,this.totalPaginasDiligencia)),this.paginasVisiveisDiligencia=[];const a=5;if(this.totalPaginasDiligencia<=a)for(let o=1;o<=this.totalPaginasDiligencia;o++)this.paginasVisiveisDiligencia.push(o);else{const t=Math.max(1,this.paginaAtualDiligencia-2),e=Math.min(this.totalPaginasDiligencia,t+a-1);for(let a=t;a<=e;a++)this.paginasVisiveisDiligencia.push(a)}const t=(this.paginaAtualDiligencia-1)*this.itensPorPaginaDiligencia,e=t+this.itensPorPaginaDiligencia;this.diligenciasPaginadas=this.diligenciasFiltradas.slice(t,e)},aplicarPaginacaoDiligencia(){this.paginaAtualDiligencia=1,this.calcularPaginacaoDiligencia()},irParaPaginaDiligencia(a){this.paginaAtualDiligencia=a,this.calcularPaginacaoDiligencia()},limparFiltrosDiligencia(){this.filtrosDiligencia={busca:"",marca:"",data:""},this.paginaAtualDiligencia=1,this.aplicarFiltrosDiligencia()},formatarStatus(a){const t={pendente:"Em Avaliação",aprovado:"Aprovado",reprovado:"Reprovado",diligencia:"Diligência",em_analise:"Em Análise"};return t[a]||a},getStatusClass(a){return`status-${a}`},formatDate(a){if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")}}},S=A;var I=(0,r.A)(S,R,N,!1,null,"1856c740",null);const k=I.exports,T={name:"Dashboard",components:{DashboardCPM:k},data(){return{showDropdown:!1,usuarioNome:"Usuário",usuarioEmail:"",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},async created(){await this.carregarDadosUsuario(),this.carregarConfiguracoes()},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await g.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usuário:",a)}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},closeDropdown(){this.showDropdown=!1},abrirConfiguracoes(){this.closeDropdown(),this.mostrarConfigEmail()},abrirConfiguracoesEmail(){this.closeDropdown(),this.mostrarConfigEmail()},async mostrarConfigEmail(){const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()}}},M=T;var $=(0,r.A)(M,P,x,!1,null,"49a774eb",null);const O=$.exports;var z=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cadastro-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("▼")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("CadastroProduto")],1)])},q=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])}],F=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cadastro-produto"},[t("h2",[a._v("Cadastro de Produto")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarProduto.apply(null,arguments)}}},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome do Produto*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.nome,expression:"produto.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.produto.nome},on:{input:function(t){t.target.composing||a.$set(a.produto,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"grupo"}},[a._v("Grupo*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produto.grupo_id,expression:"produto.grupo_id"}],attrs:{id:"grupo",required:""},on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.produto,"grupo_id",t.target.multiple?e:e[0])},a.onGrupoChange]}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.grupos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" ")])}))],2)])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"classe"}},[a._v("Classe*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produto.classe_id,expression:"produto.classe_id"}],attrs:{id:"classe",required:"",disabled:!a.produto.grupo_id||0===a.classes.length},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.produto,"classe_id",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.filteredClasses,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" ")])}))],2),a.produto.grupo_id&&0===a.filteredClasses.length?t("div",{staticClass:"info-text"},[a._v(" Não há classes disponíveis para este grupo. Por favor, cadastre uma classe primeiro. ")]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"marca"}},[a._v("Marca*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.marca,expression:"produto.marca"}],attrs:{id:"marca",type:"text",required:""},domProps:{value:a.produto.marca},on:{input:function(t){t.target.composing||a.$set(a.produto,"marca",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"modelo"}},[a._v("Modelo*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.modelo,expression:"produto.modelo"}],attrs:{id:"modelo",type:"text",required:""},domProps:{value:a.produto.modelo},on:{input:function(t){t.target.composing||a.$set(a.produto,"modelo",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"fabricante"}},[a._v("Fabricante*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.fabricante,expression:"produto.fabricante"}],attrs:{id:"fabricante",type:"text",required:""},domProps:{value:a.produto.fabricante},on:{input:function(t){t.target.composing||a.$set(a.produto,"fabricante",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cnpj"}},[a._v("CNPJ*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.cnpjFormatado,expression:"cnpjFormatado"}],attrs:{id:"cnpj",type:"text",required:"",maxlength:"18",placeholder:"00.000.000/0000-00"},domProps:{value:a.cnpjFormatado},on:{input:[function(t){t.target.composing||(a.cnpjFormatado=t.target.value)},a.formatarCNPJ]}}),a.cnpjInvalido?t("small",{staticClass:"error-text"},[a._v("CNPJ inválido. Formato: 00.000.000/0000-00")]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"email_fornecedor"}},[a._v("Email do Fornecedor*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.email_fornecedor,expression:"produto.email_fornecedor"}],attrs:{id:"email_fornecedor",type:"email",required:"",placeholder:"contato@empresa.com"},domProps:{value:a.produto.email_fornecedor},on:{input:function(t){t.target.composing||a.$set(a.produto,"email_fornecedor",t.target.value)}}}),t("small",{staticClass:"info-text"},[a._v("Email para comunicações sobre diligências")])])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"origem"}},[a._v("Origem")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.origem,expression:"produto.origem"}],attrs:{id:"origem",type:"text",placeholder:"Nacional ou Importado"},domProps:{value:a.produto.origem},on:{input:function(t){t.target.composing||a.$set(a.produto,"origem",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"registro_anvisa"}},[a._v("Registro na Anvisa/MS")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.registro_anvisa,expression:"produto.registro_anvisa"}],attrs:{id:"registro_anvisa",type:"text",placeholder:"Número do registro"},domProps:{value:a.produto.registro_anvisa},on:{input:function(t){t.target.composing||a.$set(a.produto,"registro_anvisa",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cbpf"}},[a._v("CBPF")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.cbpf,expression:"produto.cbpf"}],attrs:{id:"cbpf",type:"text",placeholder:"Certificado de Boas Práticas de Fabricação"},domProps:{value:a.produto.cbpf},on:{input:function(t){t.target.composing||a.$set(a.produto,"cbpf",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"codigo_material"}},[a._v("Código do Material")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.produto.codigo_material,expression:"produto.codigo_material"}],attrs:{id:"codigo_material",type:"text",placeholder:"Código interno do material"},domProps:{value:a.produto.codigo_material},on:{input:function(t){t.target.composing||a.$set(a.produto,"codigo_material",t.target.value)}}})])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descrição")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.produto.descricao,expression:"produto.descricao"}],attrs:{id:"descricao",rows:"4"},domProps:{value:a.produto.descricao},on:{input:function(t){t.target.composing||a.$set(a.produto,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Documentos (apenas PDF)")]),t("div",{staticClass:"file-upload"},[t("input",{attrs:{type:"file",multiple:"",accept:".pdf"},on:{change:a.onFileSelect}})]),t("small",{staticClass:"info-text"},[a._v("Apenas arquivos PDF são aceitos (máx. 10MB por arquivo)")]),a.selectedFiles.length>0?t("div",{staticClass:"selected-files"},[t("p",[a._v("Arquivos selecionados:")]),t("ul",a._l(a.selectedFiles,(function(e,o){return t("li",{key:o,class:{"arquivo-invalido":!a.validarArquivoPDF(e)}},[a._v(" "+a._s(e.name)+" "),a.validarArquivoPDF(e)?a._e():t("span",{staticClass:"error-text"},[a._v("(Formato inválido - apenas PDF permitido)")])])})),0)]):a._e(),a.arquivosInvalidos.length>0?t("div",{staticClass:"error-text"},[t("p",[a._v("Os seguintes arquivos não serão enviados (apenas PDF permitido):")]),t("ul",a._l(a.arquivosInvalidos,(function(e,o){return t("li",{key:o},[a._v(" "+a._s(e.name)+" ")])})),0)]):a._e()]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.loading}},[a._v(" "+a._s(a.loading?"Salvando...":"Salvar")+" ")])])])])},B=[];const U={name:"CadastroProduto",data(){return{produto:{nome:"",grupo_id:"",classe_id:"",marca:"",modelo:"",fabricante:"",cnpj:"",email_fornecedor:"",origem:"",registro_anvisa:"",cbpf:"",codigo_material:"",descricao:"",status:"pendente"},cnpjFormatado:"",cnpjInvalido:!1,grupos:[],classes:[],selectedFiles:[],arquivosInvalidos:[],loading:!1,currentTenantId:null}},computed:{filteredClasses(){return this.produto.grupo_id?this.classes.filter((a=>a.grupo_id===this.produto.grupo_id)):[]}},async created(){this.carregarGrupos(),await this.obterTenantId()},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)throw new Error("Usuário não autenticado");if(t?.user_metadata?.tenant_id)return console.log("Obteve tenant_id dos metadados:",t.user_metadata.tenant_id),void(this.currentTenantId=t.user_metadata.tenant_id);const{data:e,error:o}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(console.log("Busca de tenant_id na tabela usuarios:",{userData:e,userError:o}),e&&e.tenant_id){console.log("Obteve tenant_id da tabela usuarios:",e.tenant_id),this.currentTenantId=e.tenant_id;const{error:a}=await g.ND.auth.updateUser({data:{tenant_id:e.tenant_id}});return void(a?console.error("Erro ao atualizar metadados do usuário:",a):console.log("Metadados do usuário atualizados com sucesso"))}const s=(0,f.A)();console.log("Gerando novo tenant_id:",s);const{error:i}=await g.ND.from("usuarios").insert({id:(0,f.A)(),email:t.email,tenant_id:s,ativo:!0});i&&console.error("Erro ao inserir novo tenant_id na tabela usuarios:",i);const{error:r}=await g.ND.auth.updateUser({data:{tenant_id:s}});r?console.error("Erro ao atualizar metadados do usuário:",r):console.log("Metadados do usuário atualizados com novo tenant_id"),this.currentTenantId=s}catch(a){console.error("Erro ao obter tenant_id:",a),alert("Erro ao obter identificação do tenant. Por favor, faça login novamente."),this.$router.push("/")}},async carregarGrupos(){try{const{data:a,error:t}=await g.ND.from("grupos").select("*").order("nome");if(t)throw t;a&&a.length>0?this.grupos=a:this.grupos=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}catch(a){console.error("Erro ao carregar grupos:",a),this.grupos=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}},onGrupoChange(){this.carregarClasses()},async carregarClasses(){try{const{data:a,error:t}=await g.ND.from("classes").select("*").eq("grupo_id",this.produto.grupo_id).order("nome");if(t)throw t;a&&a.length>0?this.classes=a:this.classes=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}catch(a){console.error("Erro ao carregar classes:",a),this.classes=[{id:1,nome:"Equipamentos Médicos"},{id:2,nome:"Equipamentos Odontológicos"},{id:3,nome:"Materiais Hospitalares"},{id:4,nome:"Materiais de Escritório"},{id:5,nome:"Equipamentos de Informática"},{id:6,nome:"Mobiliário"},{id:7,nome:"Medicamentos"},{id:8,nome:"Material de Laboratório"},{id:9,nome:"Equipamentos Administrativos"},{id:10,nome:"Outros"}]}},formatarCNPJ(a){let t=a.target.value.replace(/\D/g,"");t=t.substring(0,14),t.length>0&&(t=t.replace(/^(\d{2})(\d)/,"$1.$2"),t=t.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3"),t=t.replace(/\.(\d{3})(\d)/,".$1/$2"),t=t.replace(/(\d{4})(\d)/,"$1-$2")),this.cnpjFormatado=t,this.produto.cnpj=this.cnpjFormatado.replace(/\D/g,""),this.validarCNPJ()},validarCNPJ(){const a=this.produto.cnpj;return 14!==a.length||/^(\d)\1+$/.test(a)?(this.cnpjInvalido=!0,!1):(this.cnpjInvalido=!1,!0)},onFileSelect(a){const t=Array.from(a.target.files);this.arquivosInvalidos=[],this.selectedFiles=t.filter((a=>{const t=this.validarArquivoPDF(a);return t||this.arquivosInvalidos.push(a),t}))},validarArquivoPDF(a){const t=a.name.split(".").pop().toLowerCase(),e=a.type.toLowerCase();return"pdf"===t&&"application/pdf"===e},sanitizarNomeArquivo(a){let t=a.normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(t=t.replace(/[^a-zA-Z0-9_.]/g,"_"),t.length>100){const a=t.split(".").pop();t=t.substring(0,90)+"."+a}return t},async salvarProduto(){if(this.validarFormulario())try{if(this.loading=!0,this.currentTenantId||await this.obterTenantId(),console.log("Salvando produto com tenant_id:",this.currentTenantId),!this.validarCNPJ())return this.$swal({icon:"error",title:"CNPJ Inválido",text:"Por favor, informe um CNPJ válido no formato 00.000.000/0000-00"}),void(this.loading=!1);const a={nome:this.produto.nome,descricao:this.produto.descricao,grupo_id:this.produto.grupo_id,classe_id:this.produto.classe_id,marca:this.produto.marca,modelo:this.produto.modelo,fabricante:this.produto.fabricante,cnpj:this.produto.cnpj,email_fornecedor:this.produto.email_fornecedor,origem:this.produto.origem,registro_anvisa:this.produto.registro_anvisa,cbpf:this.produto.cbpf,codigo_material:this.produto.codigo_material,status:"pendente",tenant_id:this.currentTenantId};console.log("Objeto produto a ser inserido:",a);const{data:t,error:e}=await g.ND.from("produtos").insert(a).select().single();if(e)throw console.error("Erro detalhado ao salvar produto:",e),new Error(`Erro ao salvar produto: ${e.message}`);console.log("Produto inserido com sucesso:",t);const o=this.selectedFiles.filter((a=>this.validarArquivoPDF(a)));if(o.length>0){const a=t.id;for(const t of o){const e=t.name,o=this.sanitizarNomeArquivo(t.name),s=`${Date.now()}-${o}`;console.log(`Upload de arquivo: Original "${e}" -> Sanitizado "${o}"`);const{data:i,error:r}=await g.ND.storage.from("documentos").upload(s,t);if(r){console.error("Erro ao fazer upload do arquivo:",r);continue}const{data:n}=g.ND.storage.from("documentos").getPublicUrl(s),l=n?.publicUrl||"",c={tenant_id:this.currentTenantId,produto_id:a,nome:e,tipo:t.type,arquivo_url:l},{error:d}=await g.ND.from("documentos").insert(c);d&&console.error("Erro ao registrar documento:",d)}}this.arquivosInvalidos.length>0?this.$swal({icon:"warning",title:"Produto salvo com ressalvas",text:`O produto foi salvo, mas ${this.arquivosInvalidos.length} arquivo(s) não foi(ram) enviado(s) por não serem PDFs válidos.`}):this.$swal({icon:"success",title:"Produto salvo com sucesso!",text:"O produto foi cadastrado e está aguardando aprovação."}),this.limparFormulario()}catch(a){console.error("Erro no processo de salvamento:",a),this.$swal({icon:"error",title:"Erro ao salvar produto",text:a.message||"Ocorreu um erro ao tentar salvar o produto."})}finally{this.loading=!1}},limparFormulario(){this.produto={nome:"",grupo_id:"",classe_id:"",marca:"",modelo:"",fabricante:"",cnpj:"",origem:"",registro_anvisa:"",cbpf:"",codigo_material:"",descricao:"",status:"pendente"},this.cnpjFormatado="",this.cnpjInvalido=!1,this.selectedFiles=[],this.arquivosInvalidos=[]},validarFormulario(){return this.produto.nome&&""!==this.produto.nome.trim()?this.produto.grupo_id?this.produto.classe_id?this.produto.descricao&&""!==this.produto.descricao.trim()?this.validarCNPJ()?(this.arquivosInvalidos.length>0&&this.$swal({icon:"error",title:"Arquivos inválidos",text:"Alguns arquivos selecionados não são PDFs válidos e não serão enviados."}),!0):(this.$swal({icon:"error",title:"Erro de validação",text:"O CNPJ informado é inválido"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"A descrição do produto é obrigatória"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"Selecione uma classe para o produto"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"Selecione um grupo para o produto"}),!1):(this.$swal({icon:"error",title:"Erro de validação",text:"O nome do produto é obrigatório"}),!1)},convertToUUID(a){if(!a)return null;const t=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(t.test(a))return console.log("categoria_id já é um UUID válido:",a),a;const e=parseInt(a,10);if(isNaN(e))return console.warn("categoria_id não é um número nem UUID válido:",a),(0,f.A)();const o=`00000000-0000-0000-0000-${e.toString().padStart(12,"0")}`;return console.log(`Converteu categoria_id ${a} para UUID: ${o}`),o}}},L=U;var j=(0,r.A)(L,F,B,!1,null,"bed0857e",null);const V=j.exports,J={name:"Cadastro",components:{CadastroProduto:V},data(){return{showDropdown:!1,modalEmailAberto:!1,usuarioNome:"comprarBemTeste",usuarioEmail:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},async created(){await this.carregarDadosUsuario(),this.carregarConfiguracoes()},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await g.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usuário:",a)}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},closeDropdown(){this.showDropdown=!1},abrirConfiguracoes(){this.closeDropdown(),this.mostrarConfigEmail()},abrirConfiguracoesEmail(){this.closeDropdown(),this.mostrarConfigEmail()},async mostrarConfigEmail(){const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()}}},G=J;var K=(0,r.A)(G,z,q,!1,null,"7cb6a01b",null);const H=K.exports;var Z=function(){var a=this,t=a._self._c;return t("div",{staticClass:"analise-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("▼")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("AnaliseProduto",{attrs:{id:a.produtoId}})],1)])},Q=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])}],Y=function(){var a=this,t=a._self._c;return t("div",{staticClass:"analise-container"},[a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando...")])]):a.produto?t("div",{staticClass:"produto-analise"},[t("h2",[a._v("Análise de Produto")]),t("div",{staticClass:"produto-info"},[t("div",{staticClass:"produto-header"},[t("h3",[a._v(a._s(a.produto.nome))]),t("div",{staticClass:"produto-actions"},["pendente"===a.produto.status?t("button",{staticClass:"btn-diligencia",on:{click:function(t){return a.solicitarDiligencia(a.produto.id)}}},[a._v(" 🔍 Solicitar Diligência ")]):a._e(),"diligencia"===a.produto.status?t("button",{staticClass:"btn-ver-diligencias",on:{click:function(t){return a.visualizarDiligencias(a.produto.id)}}},[a._v(" 📋 Ver Diligências ")]):a._e()])]),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item"},[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produto.marca)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produto.modelo)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produto.fabricante)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produto.cnpj)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Origem:")]),a._v(" "+a._s(a.produto.origem||"Não informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Registro na Anvisa/MS:")]),a._v(" "+a._s(a.produto.registro_anvisa||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CBPF:")]),a._v(" "+a._s(a.produto.cbpf||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Código do Material:")]),a._v(" "+a._s(a.produto.codigo_material||"Não informado")+" ")]),t("div",{staticClass:"info-item full-width"},[t("strong",[a._v("Descrição:")]),a._v(" "+a._s(a.produto.descricao||"Não informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Status Atual:")]),t("span",{staticClass:"status-pill",class:a.getStatusClass(a.produto.status)},[a._v(" "+a._s(a.produto.status)+" ")])]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Data de Cadastro:")]),a._v(" "+a._s(a.formatDate(a.produto.criado_em))+" ")])])]),a.documentos.length>0?t("div",{staticClass:"documentos-section"},[t("h3",[a._v("Documentos")]),t("div",{staticClass:"documentos-list"},a._l(a.documentos,(function(e){return t("div",{key:e.id,staticClass:"documento-item"},[t("div",{staticClass:"doc-icon"},[a._v("📄")]),t("div",{staticClass:"doc-info"},[t("p",{staticClass:"doc-name"},[a._v(a._s(e.nome))]),t("p",{staticClass:"doc-type"},[a._v(a._s(e.tipo))])]),t("a",{staticClass:"doc-action",attrs:{href:e.arquivo_url,target:"_blank"}},[a._v("Visualizar")])])})),0)]):a._e(),t("div",{staticClass:"analise-form"},[t("h3",[a._v("Parecer Técnico")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarAnalise.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"parecer"}},[a._v("Observações / Parecer")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.analise.parecer,expression:"analise.parecer"}],attrs:{id:"parecer",rows:"4",required:""},domProps:{value:a.analise.parecer},on:{input:function(t){t.target.composing||a.$set(a.analise,"parecer",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Decisão")]),t("div",{staticClass:"radio-group"},[t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.analise.status,expression:"analise.status"}],attrs:{type:"radio",value:"aprovado",required:""},domProps:{checked:a._q(a.analise.status,"aprovado")},on:{change:function(t){return a.$set(a.analise,"status","aprovado")}}}),a._v(" Aprovar ")]),t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.analise.status,expression:"analise.status"}],attrs:{type:"radio",value:"reprovado",required:""},domProps:{checked:a._q(a.analise.status,"reprovado")},on:{change:function(t){return a.$set(a.analise,"status","reprovado")}}}),a._v(" Reprovar ")])])]),"reprovado"===a.analise.status?t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"motivacao"}},[a._v("Motivação da Reprovação")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.analise.motivacao,expression:"analise.motivacao"}],attrs:{id:"motivacao",rows:"6",placeholder:"Descreva detalhadamente os motivos que levaram à reprovação deste produto",required:""},domProps:{value:a.analise.motivacao},on:{input:function(t){t.target.composing||a.$set(a.analise,"motivacao",t.target.value)}}}),t("small",{staticClass:"helper-text"},[a._v("Este campo será exibido ao fornecedor para justificar a reprovação do produto")])]):a._e(),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.submitting}},[a._v(" "+a._s(a.submitting?"Salvando...":"Salvar Análise")+" ")]),t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.voltar}},[a._v(" Voltar ")])])])]),a.analisesAnteriores.length>0?t("div",{staticClass:"analises-anteriores"},[t("h3",[a._v("Análises Anteriores")]),a._l(a.analisesAnteriores,(function(e){return t("div",{key:e.id,staticClass:"analise-historico"},[t("div",{staticClass:"analise-header"},[t("span",{staticClass:"status-pill",class:a.getStatusClass(e.status)},[a._v(a._s(e.status))]),t("span",{staticClass:"analise-data"},[a._v(a._s(a.formatDate(e.criado_em)))])]),t("div",{staticClass:"analise-conteudo"},[t("p",[a._v(a._s(e.parecer))]),"reprovado"===e.status&&e.motivacao?t("div",{staticClass:"motivacao-reprovacao"},[t("h4",[a._v("Motivação da Reprovação:")]),t("p",[a._v(a._s(e.motivacao))])]):a._e()])])}))],2):a._e()]):t("div",{staticClass:"not-found"},[t("p",[a._v("Produto não encontrado ou você não tem permissão para visualizá-lo.")]),t("button",{staticClass:"btn-secondary",on:{click:a.voltar}},[a._v("Voltar")])])])},W=[],X=e(676);const aa={from:{email:"cpm@suaorganizacao.com.br",name:"CPM - Comissão de Padronização de Materiais"},provider:{apiKey:{NODE_ENV:"production",VUE_APP_EMAIL_PROVIDER:"sendgrid",VUE_APP_SENDGRID_API_KEY:"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",BASE_URL:"/ComprarBem/"}.VUE_APP_EMAIL_API_KEY,apiUrl:"https://api.sendgrid.v3/mail/send"}},ta={diligencia:{subject:"Diligência Solicitada - Produto em Análise",template:a=>`\n      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">\n        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center;">\n          <h1>📋 Diligência Solicitada</h1>\n          <p>Comissão de Padronização de Materiais</p>\n        </div>\n        \n        <div style="padding: 30px; background: #f8f9fa;">\n          <h2 style="color: #333;">Prezado(a) Fornecedor,</h2>\n          \n          <p>Foi solicitada uma <strong>diligência</strong> para o produto em análise:</p>\n          \n          <div style="background: white; padding: 20px; border-left: 4px solid #667eea; margin: 20px 0;">\n            <h3 style="color: #667eea; margin-top: 0;">📦 Dados do Produto:</h3>\n            <p><strong>Nome:</strong> ${a.produto.nome}</p>\n            <p><strong>Marca:</strong> ${a.produto.marca}</p>\n            <p><strong>Modelo:</strong> ${a.produto.modelo}</p>\n            <p><strong>Fabricante:</strong> ${a.produto.fabricante}</p>\n          </div>\n          \n          <div style="background: #fff3cd; padding: 20px; border-left: 4px solid #ffc107; margin: 20px 0;">\n            <h3 style="color: #856404; margin-top: 0;">⚠️ Tipo de Diligência:</h3>\n            <p><strong>${a.diligencia.tipo}</strong></p>\n            <p>${a.diligencia.descricao}</p>\n          </div>\n          \n          <div style="background: #f8d7da; padding: 20px; border-left: 4px solid #dc3545; margin: 20px 0;">\n            <h3 style="color: #721c24; margin-top: 0;">⏰ Prazo para Resposta:</h3>\n            <p><strong>${a.diligencia.prazo_dias} dias úteis</strong></p>\n            <p><strong>Data Limite:</strong> ${new Date(a.diligencia.data_limite).toLocaleDateString("pt-BR")}</p>\n          </div>\n          \n          <div style="background: #d4edda; padding: 20px; border-left: 4px solid #28a745; margin: 20px 0;">\n            <h3 style="color: #155724; margin-top: 0;">📝 Instruções:</h3>\n            <ul>\n              <li>Responda a esta diligência dentro do prazo estabelecido</li>\n              <li>Envie todos os documentos solicitados em formato PDF</li>\n              <li>Em caso de dúvidas, entre em contato conosco</li>\n              <li>O não atendimento da diligência pode resultar na reprovação do produto</li>\n            </ul>\n          </div>\n          \n          <div style="text-align: center; margin: 30px 0;">\n            <p style="color: #666;">Para responder esta diligência, entre em contato através do nosso sistema ou envie os documentos por email.</p>\n          </div>\n          \n          <hr style="border: none; border-top: 1px solid #ddd; margin: 30px 0;">\n          \n          <div style="color: #666; font-size: 12px;">\n            <p><strong>CPM - Comissão de Padronização de Materiais</strong></p>\n            <p>Este é um email automático. Não responda diretamente a este email.</p>\n            <p>Data de envio: ${(new Date).toLocaleDateString("pt-BR")} às ${(new Date).toLocaleTimeString("pt-BR")}</p>\n          </div>\n        </div>\n      </div>\n    `}};async function ea(a){try{console.log("📧 Iniciando envio de email de diligência...",a);try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);t.emailRemetente&&(aa.from.email=t.emailRemetente),t.nomeRemetente&&(aa.from.name=t.nomeRemetente)}}catch(t){console.error("Erro ao carregar configurações do usuário:",t)}if(!a.produto||!a.diligencia||!a.destinatario)throw new Error("Dados incompletos para envio do email");const s={personalizations:[{to:[{email:a.destinatario,name:a.produto.fabricante}]}],from:{email:aa.from.email,name:aa.from.name},subject:ta.diligencia.subject,content:[{type:"text/html",value:ta.diligencia.template(a)}]},{data:i,error:r}=await g.ND.from("emails_enviados").insert({tipo:"diligencia",destinatario:a.destinatario,assunto:ta.diligencia.subject,produto_id:a.produto.id,diligencia_id:a.diligencia.id,status:"enviando",tentativas:1}).select().single();r&&console.error("❌ Erro ao registrar log de email:",r),console.log("📧 Enviando email via EmailJS (usando SendGrid configurado)...");try{const t={to_email:a.destinatario,fabricante:a.produto.fabricante,produto_nome:a.produto.nome,produto_marca:a.produto.marca,produto_modelo:a.produto.modelo,cnpj:a.produto.cnpj||"Não informado",tipo_diligencia:a.diligencia.tipo,descricao_diligencia:a.diligencia.descricao,prazo_dias:"30",data_limite:new Date(a.diligencia.data_limite).toLocaleDateString("pt-BR"),data_envio:(new Date).toLocaleDateString("pt-BR")+" às "+(new Date).toLocaleTimeString("pt-BR"),nome_responsavel:"William Martins",cargo_responsavel:"Analista CPM",email_responsavel:"comprarbemteste@gmail.com"};console.log("📧 Enviando email via EmailJS..."),console.log("📧 Dados preparados:",t);const o={serviceId:"service_7sv1naw",templateId:"template_vbp986f",publicKey:"DqGKMNJ87ch3qVxGv"};try{console.log("📧 Enviando email REAL via EmailJS..."),console.log("📧 Configuração:",o),console.log("📧 Dados:",t);const a=await X.Ay.send(o.serviceId,o.templateId,t,o.publicKey);console.log("🎉 EMAIL ENVIADO COM SUCESSO!",a)}catch(e){throw console.error("❌ Erro no EmailJS:",e),e}return i&&await g.ND.from("emails_enviados").update({status:"enviado",data_envio:(new Date).toISOString(),corpo:t.message}).eq("id",i.id),console.log("✅ EMAIL PREPARADO COM SUCESSO!"),console.log("📧 Para:",t.to_email),console.log("📧 Assunto:",t.subject),{success:!0,message:"Email preparado com sucesso! (SendGrid configurado)",emailId:i?.id}}catch(o){return console.error("❌ Erro ao preparar email:",o),i&&await g.ND.from("emails_enviados").update({status:"desenvolvimento",data_envio:(new Date).toISOString(),erro_detalhes:"Erro na preparação do email"}).eq("id",i.id),{success:!0,message:"Diligência criada (modo desenvolvimento)",emailId:i?.id,development:!0}}return console.log("🔄 Modo desenvolvimento - Simulando envio de email"),console.log("📧 Email Data:",s),await new Promise((a=>setTimeout(a,1e3))),i&&await supabase.from("emails_enviados").update({status:"enviado",data_envio:(new Date).toISOString()}).eq("id",i.id),{success:!0,message:"Email enviado com sucesso (simulado)",emailId:i?.id}}catch(t){return console.error("❌ Erro ao enviar email de diligência:",t),{success:!1,message:t.message||"Erro interno no envio do email",error:t}}}const oa={name:"AnaliseProduto",props:{id:{type:String,required:!0}},data(){return{produto:null,documentos:[],analisesAnteriores:[],analise:{parecer:"",status:"",motivacao:""},loading:!0,submitting:!1}},created(){this.carregarDados()},methods:{async carregarDados(){try{this.loading=!0;const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("id",this.id).single();if(t)throw t;this.produto=a;const{data:e,error:o}=await g.ND.from("documentos").select("*").eq("produto_id",this.id);if(o)throw o;this.documentos=e||[];const{data:s,error:i}=await g.ND.from("analises").select("*").eq("produto_id",this.id).order("criado_em",{ascending:!1});if(i)throw i;this.analisesAnteriores=s||[]}catch(a){console.error("Erro ao carregar dados:",a),alert("Erro ao carregar dados do produto. Por favor, tente novamente.")}finally{this.loading=!1}},async salvarAnalise(){try{if(this.submitting=!0,"reprovado"===this.analise.status&&!this.analise.motivacao)return this.$swal({icon:"error",title:"Campo obrigatório",text:"É necessário preencher a motivação da reprovação"}),void(this.submitting=!1);const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;let e;if(t){console.log("Usuário autenticado:",t.email);const{data:a,error:o}=await g.ND.from("usuarios").select("id").eq("email",t.email).maybeSingle();if(o&&console.error("Erro ao buscar ID do usuário:",o),a?.id)console.log("ID do usuário encontrado na tabela usuarios:",a.id),e=a.id;else{console.warn("Usuário não encontrado na tabela, gerando UUID"),e=this.gerarUUID();const{error:a}=await g.ND.from("usuarios").insert({id:e,email:t.email,nome:t.email.split("@")[0],tenant_id:this.produto.tenant_id,tipo:"avaliador",ativo:!0});a&&console.error("Erro ao criar usuário automaticamente:",a)}}else console.warn("Nenhum usuário autenticado, gerando UUID"),e=this.gerarUUID();console.log("Salvando análise com avaliador_id:",e);const o={produto_id:this.id,tenant_id:this.produto.tenant_id,avaliador_id:e,parecer:this.analise.parecer,status:this.analise.status};"reprovado"===this.analise.status&&(o.motivacao=this.analise.motivacao);const{error:s}=await g.ND.from("analises").insert(o);if(s)throw console.error("Erro detalhado ao salvar análise:",s),new Error(`Erro ao salvar análise: ${s.message}`);const{error:i}=await g.ND.from("produtos").update({status:this.analise.status}).eq("id",this.id);if(i)throw i;this.$swal({icon:"success",title:"Análise salva com sucesso!",showConfirmButton:!1,timer:1500}),await this.carregarDados(),this.analise={parecer:"",status:"",motivacao:""}}catch(a){console.error("Erro ao salvar análise:",a);let t="Erro ao salvar análise.";a.message&&a.message.includes("uuid")?t="Erro no formato de identificação. Este problema foi corrigido, tente novamente.":a.message&&(t=a.message),this.$swal({icon:"error",title:"Erro ao processar análise",text:t})}finally{this.submitting=!1}},formatDate(a){if(!a)return"";const t=new Date(a);return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},voltar(){this.$router.push("/dashboard")},gerarUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){const t=16*Math.random()|0,e="x"==a?t:3&t|8;return e.toString(16)}))},async solicitarDiligencia(a){try{const{value:t}=await this.$swal({title:"🔍 Solicitar Diligência",html:'\n            <div style="text-align: left; padding: 10px;">\n              <div style="margin-bottom: 20px;">\n                <label for="tipo_diligencia" style="display: block; font-weight: bold; margin-bottom: 8px; color: #2c3e50;">\n                  📋 Tipo de Diligência:\n                </label>\n                <select id="tipo_diligencia" class="swal2-input" style="width: 100%; font-size: 14px;">\n                  <option value="">Selecione o tipo</option>\n                  <option value="DOCUMENTACAO_FALTANTE">📄 Documentação Faltante</option>\n                  <option value="AMOSTRA_INADEQUADA">🔬 Amostra Inadequada</option>\n                  <option value="ESPECIFICACAO_INCOMPLETA">📝 Especificação Incompleta</option>\n                  <option value="CERTIFICACAO_PENDENTE">✅ Certificação Pendente</option>\n                  <option value="ESCLARECIMENTO_TECNICO">🔧 Esclarecimento Técnico</option>\n                  <option value="OUTRO">✏️ Outro (especificar)</option>\n                </select>\n                <div id="tipo_outro_container" style="display: none; margin-top: 10px;">\n                  <input \n                    type="text" \n                    id="tipo_outro_texto" \n                    class="swal2-input" \n                    placeholder="Digite o tipo de diligência..."\n                    style="width: 100%; font-size: 14px;"\n                  >\n                </div>\n              </div>\n              \n              <div style="margin-bottom: 20px;">\n                <label for="descricao_diligencia" style="display: block; font-weight: bold; margin-bottom: 8px; color: #2c3e50;">\n                  ✍️ Descrição Detalhada:\n                </label>\n                <textarea \n                  id="descricao_diligencia" \n                  class="swal2-textarea" \n                  placeholder="Descreva detalhadamente o que precisa ser providenciado pelo fornecedor..."\n                  style="width: 100%; min-height: 120px; font-size: 14px; line-height: 1.5;"\n                ></textarea>\n              </div>\n              \n              <div style="margin-bottom: 20px; padding: 15px; background: #e8f4fd; border-left: 4px solid #3498db; border-radius: 4px;">\n                <div style="display: flex; align-items: center; margin-bottom: 8px;">\n                  <span style="font-size: 18px; margin-right: 8px;">⏰</span>\n                  <strong style="color: #2c3e50;">Prazo para Resposta:</strong>\n                </div>\n                <p style="margin: 0; color: #34495e; font-size: 14px;">\n                  <strong>30 dias úteis</strong> (padrão do sistema)\n                </p>\n                <small style="color: #6c757d; font-size: 12px; margin-top: 5px; display: block;">\n                  📅 A data limite será calculada automaticamente excluindo fins de semana\n                </small>\n              </div>\n            </div>\n          ',width:"600px",focusConfirm:!1,showCancelButton:!0,confirmButtonText:"📤 Enviar Diligência",cancelButtonText:"❌ Cancelar",confirmButtonColor:"#f39c12",cancelButtonColor:"#6c757d",didOpen:()=>{const a=document.getElementById("tipo_diligencia"),t=document.getElementById("tipo_outro_container");a.addEventListener("change",(function(){"OUTRO"===this.value?(t.style.display="block",setTimeout((()=>{document.getElementById("tipo_outro_texto").focus()}),100)):t.style.display="none"}))},preConfirm:()=>{const a=document.getElementById("tipo_diligencia").value,t=document.getElementById("tipo_outro_texto").value,e=document.getElementById("descricao_diligencia").value,o=30;let s=a;if("OUTRO"===a){if(!t||t.trim().length<3)return this.$swal.showValidationMessage("⚠️ Por favor, especifique o tipo de diligência (mínimo 3 caracteres)"),!1;s=t.trim()}return a?!e||e.trim().length<20?(this.$swal.showValidationMessage("⚠️ A descrição deve ter pelo menos 20 caracteres"),!1):{tipo:s,descricao:e,prazo:o}:(this.$swal.showValidationMessage("⚠️ Por favor, selecione o tipo de diligência"),!1)}});t&&await this.salvarDiligencia(a,t)}catch(t){console.error("Erro ao solicitar diligência:",t)}},async salvarDiligencia(a,t){try{if(!this.produto.email_fornecedor)return void this.$swal({title:"⚠️ Email do Fornecedor Necessário",text:"Para enviar a diligência, é necessário que o produto tenha o email do fornecedor cadastrado. Deseja continuar sem enviar email?",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar sem Email",cancelButtonText:"Cancelar",confirmButtonColor:"#f39c12"}).then((async e=>{e.isConfirmed&&await this.processarDiligencia(a,t,!1)}));await this.processarDiligencia(a,t,!0)}catch(e){console.error("Erro ao salvar diligência:",e),this.$swal({title:"❌ Erro",text:"Erro ao solicitar diligência",icon:"error"})}},async processarDiligencia(a,t,e=!0){try{const s=this.calcularDataUtil(new Date,t.prazo),{data:i,error:r}=await g.ND.from("diligencias").insert({produto_id:a,tenant_id:this.produto.tenant_id,tipo:t.tipo,descricao:t.descricao,prazo_dias:t.prazo,data_limite:s.toISOString(),status:"PENDENTE",solicitado_por:"CPM"}).select().single();if(r)throw r;const{error:n}=await g.ND.from("produtos").update({status:"diligencia"}).eq("id",a);if(n)throw n;let l=!1;if(e&&this.produto.email_fornecedor)try{const a=await ea({destinatario:this.produto.email_fornecedor,produto:this.produto,diligencia:{...i,data_limite:s}});l=a.success,a.success||console.error("Erro no envio do email:",a.message)}catch(o){console.error("Erro ao enviar email:",o)}const c=e&&l?" O fornecedor foi notificado por email.":e&&!l?" ⚠️ A diligência foi salva, mas houve erro no envio do email.":" (Sem notificação por email)";this.$swal({title:"✅ Sucesso!",text:`Diligência solicitada com sucesso.${c}`,icon:l||!e?"success":"warning",confirmButtonColor:"#28a745"}),await this.carregarDados()}catch(s){console.error("Erro ao processar diligência:",s),this.$swal({title:"❌ Erro",text:"Erro ao processar diligência",icon:"error"})}},async visualizarDiligencias(a){try{const{data:t,error:e}=await g.ND.from("diligencias").select("*").eq("produto_id",a).order("criado_em",{ascending:!1});if(e)throw e;let o='<div style="text-align: left; padding: 10px;">';t&&t.length>0?(o+='<h4 style="color: #2c3e50; margin-bottom: 20px;">📋 Histórico de Diligências:</h4>',t.forEach(((a,t)=>{const e="PENDENTE"===a.status?"#f39c12":"ATENDIDA"===a.status?"#28a745":"#dc3545",s="PENDENTE"===a.status?"⏳":"ATENDIDA"===a.status?"✅":"❌";o+=`\n              <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin: 15px 0; background: ${"PENDENTE"===a.status?"#fff3cd":"ATENDIDA"===a.status?"#d4edda":"#f8d7da"};">\n                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">\n                  <strong style="color: #2c3e50;">Diligência #${t+1}</strong>\n                  <span style="color: ${e}; font-weight: bold;">\n                    ${s} ${a.status}\n                  </span>\n                </div>\n                \n                <div style="margin-bottom: 8px;">\n                  <strong style="color: #495057;">Tipo:</strong> \n                  <span style="color: #6c757d;">${a.tipo.replace(/_/g," ")}</span>\n                </div>\n                \n                <div style="margin-bottom: 8px;">\n                  <strong style="color: #495057;">Descrição:</strong>\n                  <div style="background: white; padding: 10px; border-radius: 4px; margin-top: 5px; border-left: 4px solid ${e};">\n                    ${a.descricao}\n                  </div>\n                </div>\n                \n                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; font-size: 12px; color: #6c757d;">\n                  <div>📅 <strong>Prazo:</strong> ${this.formatDate(a.data_limite)}</div>\n                  <div>🕐 <strong>Solicitado:</strong> ${this.formatDate(a.criado_em)}</div>\n                </div>\n              </div>\n            `}))):o+='\n            <div style="text-align: center; padding: 40px; color: #6c757d;">\n              <div style="font-size: 48px; margin-bottom: 15px;">📭</div>\n              <p>Nenhuma diligência encontrada para este produto.</p>\n            </div>\n          ',o+="</div>",this.$swal({title:"📋 Diligências do Produto",html:o,width:"700px",confirmButtonColor:"#007bff"})}catch(t){console.error("Erro ao carregar diligências:",t),this.$swal({title:"❌ Erro",text:"Erro ao carregar diligências do produto",icon:"error"})}},calcularDataUtil(a,t){const e=new Date(a);let o=0;while(o<t)e.setDate(e.getDate()+1),0!==e.getDay()&&6!==e.getDay()&&o++;return e}}},sa=oa;var ia=(0,r.A)(sa,Y,W,!1,null,"1eb6b586",null);const ra=ia.exports,na={name:"Analise",components:{AnaliseProduto:ra},data(){return{showDropdown:!1,usuarioNome:"Usuário",usuarioEmail:""}},computed:{produtoId(){return this.$route.params.id}},async created(){await this.carregarDadosUsuario()},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await g.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usuário:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},closeDropdown(){this.showDropdown=!1},abrirConfiguracoes(){this.closeDropdown(),this.$swal({title:"⚙️ Configurações",text:"Configure o email no Dashboard principal para salvar as configurações globais.",icon:"info"})},abrirConfiguracoesEmail(){this.closeDropdown(),this.$swal({title:"📧 Configurar Email",text:"Acesse o Dashboard principal para configurar o email do sistema.",icon:"info"})},async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()}}},la=na;var ca=(0,r.A)(la,Z,Q,!1,null,"5d87272e",null);const da=ca.exports;var ua=function(){var a=this,t=a._self._c;return t("div",{staticClass:"catalogo-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.dropdownOpen},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("▼")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.nomeUsuario))]),t("small",[a._v(a._s(a.emailUsuario))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.dropdownOpen?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("CatalogoEletronico")],1),a.modalEmailAberto?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalEmail}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[a._m(2),t("button",{staticClass:"btn-close",on:{click:a.fecharModalEmail}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeOrganizacao"}},[a._v("Nome da Organização")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeOrganizacao,expression:"configEmail.nomeOrganizacao"}],attrs:{id:"nomeOrganizacao",type:"text",placeholder:"Ex: Prefeitura Municipal de..."},domProps:{value:a.configEmail.nomeOrganizacao},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeOrganizacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"emailRemetente"}},[a._v("Email Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.emailRemetente,expression:"configEmail.emailRemetente"}],attrs:{id:"emailRemetente",type:"email",placeholder:"Ex: licitacoes@prefeitura.gov.br"},domProps:{value:a.configEmail.emailRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"emailRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeRemetente"}},[a._v("Nome do Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeRemetente,expression:"configEmail.nomeRemetente"}],attrs:{id:"nomeRemetente",type:"text",placeholder:"Ex: CPM - Comissão de Padronização de Materiais"},domProps:{value:a.configEmail.nomeRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"assinatura"}},[a._v("Assinatura do Email")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.assinatura,expression:"configEmail.assinatura"}],attrs:{id:"assinatura",rows:"4",placeholder:"Ex: Atenciosamente,&#10;Comissão de Padronização de Materiais&#10;Prefeitura Municipal&#10;Telefone: (xx) xxxx-xxxx"},domProps:{value:a.configEmail.assinatura},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"assinatura",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:a.fecharModalEmail}},[a._v("Cancelar")]),t("button",{staticClass:"btn btn-primary",on:{click:a.salvarConfiguracaoEmail}},[t("i",{staticClass:"fas fa-save"}),a._v(" Salvar ")])])])]):a._e()])},ma=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])},function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-envelope"}),a._v(" Configurar Email da Organização")])}],pa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"catalogo-container"},[t("h2",[a._v("Catálogo Eletrônico de Bens Padronizados")]),t("div",{staticClass:"search-filters"},[t("div",{staticClass:"search-box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.searchTerm,expression:"searchTerm"}],attrs:{type:"text",placeholder:"Buscar produto..."},domProps:{value:a.searchTerm},on:{input:[function(t){t.target.composing||(a.searchTerm=t.target.value)},a.filtrarProdutos]}})]),t("div",{staticClass:"filters"},[t("div",{staticClass:"categoria-filter"},[a._m(0),t("div",{staticClass:"dropdown"},[t("button",{staticClass:"dropdown-toggle",attrs:{type:"button"},on:{click:a.toggleCategoriaDropdown}},[a._v(" "+a._s(a.categoriaAtual)+" ")]),t("div",{staticClass:"dropdown-menu",class:{show:a.showCategoriaDropdown}},[a.carregandoCategorias?t("div",{staticClass:"dropdown-item loading"},[t("div",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status"}}),t("span",[a._v("Carregando...")])]):[t("a",{staticClass:"dropdown-item",on:{click:function(t){return a.selecionarCategoria(null)}}},[a._v("Todos os grupos")]),0===a.categorias.length?t("div",{staticClass:"dropdown-item empty"},[a._v(" Nenhum grupo disponível ")]):a._l(a.categorias,(function(e){return t("a",{key:e.id,staticClass:"dropdown-item",class:{active:e.id===a.filtroCategoria},on:{click:function(t){return a.selecionarCategoria(e)}}},[a._v(" "+a._s(e.nome)+" ")])}))]],2)])])])]),a.produtosFiltrados.length>0?t("div",{staticClass:"produtos-grid"},a._l(a.produtosFiltrados,(function(e){return t("div",{key:e.id,staticClass:"produto-card",on:{click:function(t){return a.verDetalhesProduto(e.id)}}},[t("div",{staticClass:"produto-info"},[t("h3",[a._v(a._s(e.nome))]),t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(e.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(e.modelo))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(e.fabricante))])]),t("div",{staticClass:"produto-status",class:a.getStatusClass(e.status)},[a._v(" "+a._s(e.status)+" ")])])})),0):t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhum produto encontrado.")])]),a.produtoSelecionado?t("div",{staticClass:"produto-modal",on:{click:function(t){return t.target!==t.currentTarget?null:a.fecharModal.apply(null,arguments)}}},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.produtoSelecionado.nome))]),t("button",{staticClass:"btn-close",on:{click:a.fecharModal}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"produto-detalhes"},[t("p",[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoSelecionado.marca))]),t("p",[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoSelecionado.modelo))]),t("p",[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoSelecionado.fabricante))]),t("p",[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produtoSelecionado.cnpj))]),a.produtoSelecionado.descricao?t("p",[t("strong",[a._v("Descrição:")]),a._v(" "+a._s(a.produtoSelecionado.descricao))]):a._e(),t("p",[t("strong",[a._v("Status:")]),a._v(" "),t("span",{class:a.getStatusClass(a.produtoSelecionado.status)},[a._v(a._s(a.produtoSelecionado.status))])]),t("div",{staticClass:"avaliacoes-section"},[t("div",{staticClass:"avaliacoes-header",class:{active:a.showAvaliacoes},on:{click:a.toggleAvaliacoes}},[t("h4",[a._v("Avaliações de Desempenho (RDM)")]),t("div",{staticClass:"avaliacao-summary"},[a.avaliacaoMedia>0?t("div",{staticClass:"stars-container"},[t("div",{staticClass:"stars"},a._l(5,(function(e){return t("span",{key:e,staticClass:"star",class:{filled:a.avaliacaoMedia>=e,half:a.avaliacaoMedia>=e-.5&&a.avaliacaoMedia<e}},[a._v("★")])})),0),t("span",{staticClass:"rating-number"},[a._v(a._s(a.avaliacaoMedia))]),t("span",{staticClass:"rating-count"},[a._v("("+a._s(a.avaliacoes.length)+" avaliações)")])]):t("div",{staticClass:"no-ratings"},[a._v(" Sem avaliações ainda ")]),t("span",{staticClass:"toggle-icon"},[a._v(a._s(a.showAvaliacoes?"▲":"▼"))])])]),a.showAvaliacoes?t("div",{staticClass:"avaliacoes-content"},[0===a.avaliacoes.length?t("div",{staticClass:"no-avaliacoes"},[a._v(" Este produto ainda não possui avaliações de desempenho. ")]):t("div",{staticClass:"avaliacoes-list"},a._l(a.avaliacoes,(function(e,o){return t("div",{key:o,staticClass:"avaliacao-item"},[t("div",{staticClass:"avaliacao-stars"},a._l(5,(function(o){return t("span",{key:o,staticClass:"star",class:{filled:e.avaliacao>=o}},[a._v("★")])})),0),t("div",{staticClass:"avaliacao-comentario"},[a._v(" "+a._s(e.comentario)+" ")]),t("div",{staticClass:"avaliacao-data"},[a._v(" "+a._s(a.obterDataAvaliacao(e))+" ")])])})),0)]):a._e()]),a.documentos.length>0?t("div",{staticClass:"documentos"},[t("h4",[a._v("Documentos")]),t("ul",a._l(a.documentos,(function(e){return t("li",{key:e.id},[t("a",{attrs:{href:e.arquivo_url,target:"_blank"}},[a._v(a._s(e.nome))])])})),0)]):a._e()])])])]):a._e()])},va=[function(){var a=this,t=a._self._c;return t("label",[t("strong",[a._v("Grupo:")])])}];const ga={name:"CatalogoEletronico",data(){return{produtos:[],produtosFiltrados:[],categorias:[],searchTerm:"",filtroCategoria:"",categoriaAtual:"Todos os grupos",showCategoriaDropdown:!1,showAvaliacoes:!1,produtoSelecionado:null,documentos:[],avaliacoes:[],avaliacaoMedia:0,carregandoCategorias:!0,categoriaSelecionada:null,currentTenantId:null,loading:!1}},created(){this.obterTenantId().then((()=>{this.carregarDados()})),document.addEventListener("click",this.closeDropdownOnClickOutside)},mounted(){this.carregarCategoriasDireto(),this.showCategoriaDropdown=!1},beforeUnmount(){document.removeEventListener("click",this.closeDropdownOnClickOutside)},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return this.currentTenantId=t.user_metadata.tenant_id,void console.log("Tenant ID obtido dos metadados:",this.currentTenantId);const{data:e,error:o}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id?(this.currentTenantId=e.tenant_id,console.log("Tenant ID obtido da tabela usuarios:",this.currentTenantId)):console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarDados(){console.log("Iniciando carregamento de dados"),this.carregandoCategorias=!0,this.loading=!0;try{if(!this.currentTenantId&&(console.error("Tenant ID não disponível. Tentando recarregar..."),await this.obterTenantId(),!this.currentTenantId))return console.error("Não foi possível obter o tenant_id, impossível carregar dados"),void this.$swal({icon:"error",title:"Erro ao carregar dados",text:"Não foi possível identificar sua conta. Por favor, faça login novamente."});console.log("Buscando categorias do Supabase...");const{data:a,error:t}=await g.ND.from("categorias").select("*");t?(console.error("Erro ao carregar categorias:",t.message),this.$swal({icon:"error",title:"Erro ao carregar categorias",text:"Não foi possível carregar as categorias. Por favor, tente novamente."})):(console.log("Categorias carregadas:",a),this.categorias=a||[],0===this.categorias.length&&console.warn("Nenhuma categoria encontrada no banco de dados")),this.carregandoCategorias=!1,console.log("Buscando produtos do Supabase para tenant_id:",this.currentTenantId);const{data:e,error:o}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId);o?(console.error("Erro ao carregar produtos:",o.message),this.$swal({icon:"error",title:"Erro ao carregar produtos",text:"Não foi possível carregar os produtos. Por favor, tente novamente."})):(console.log("Produtos carregados:",e),this.produtos=e||[],console.log(`${this.produtos.length} produtos carregados para o tenant atual`),this.produtos=this.produtos.map((a=>{const t=this.categorias.find((t=>t.id===a.categoria_id));return{...a,categoria_nome:t?t.nome:"Categoria não encontrada"}})),this.produtosFiltrados=[...this.produtos])}catch(a){console.error("Erro ao carregar dados:",a),this.$swal({icon:"error",title:"Erro ao carregar dados",text:"Ocorreu um erro inesperado. Por favor, tente novamente."})}finally{this.loading=!1}},async carregarCategoriasDireto(){try{console.log("Tentando carregar categorias diretamente...");const{data:a,error:t}=await g.ND.from("categorias").select("*");if(t)return void console.error("Erro ao carregar categorias direto:",t);console.log("Resposta direta de categorias:",a),a&&a.length>0&&0===this.categorias.length&&(console.log("Atualizando categorias com dados diretos"),this.categorias=a)}catch(a){console.error("Exceção ao carregar categorias direto:",a)}},filtrarProdutos(){console.log("Filtrando produtos por:",this.filtroCategoria,"e texto:",this.searchTerm),this.produtosFiltrados=this.produtos.filter((a=>{const t=!this.filtroCategoria||a.categoria_id===this.filtroCategoria,e=!this.searchTerm||a.nome.toLowerCase().includes(this.searchTerm.toLowerCase())||a.descricao&&a.descricao.toLowerCase().includes(this.searchTerm.toLowerCase());return t&&e})),console.log("Produtos filtrados:",this.produtosFiltrados.length)},async verDetalhesProduto(a){try{if(!this.currentTenantId)return void console.error("Não foi possível identificar o tenant_id");const{data:t,error:e}=await g.ND.from("produtos").select("*").eq("id",a).eq("tenant_id",this.currentTenantId).single();if(e)throw console.error("Erro ao carregar produto:",e),e;if(!t)return console.error("Produto não encontrado ou não pertence ao tenant atual"),void this.$swal({icon:"error",title:"Produto não encontrado",text:"O produto solicitado não existe ou você não tem permissão para visualizá-lo."});this.produtoSelecionado=t;const{data:o,error:s}=await g.ND.from("documentos").select("*").eq("produto_id",a).eq("tenant_id",this.currentTenantId);if(s)throw s;this.documentos=o||[];const{data:i,error:r}=await g.ND.from("rdm_feedbacks").select("*").eq("produto_id",a).eq("tenant_id",this.currentTenantId);if(r)console.error("Erro ao carregar avaliações:",r),this.avaliacoes=[],this.avaliacaoMedia=0;else if(this.avaliacoes=i||[],this.avaliacoes.length>0&&(console.log("Campos disponíveis na avaliação:",Object.keys(this.avaliacoes[0])),console.log("Exemplo de avaliação:",this.avaliacoes[0])),this.avaliacoes.length>0){const a=this.avaliacoes.reduce(((a,t)=>a+t.avaliacao),0);this.avaliacaoMedia=parseFloat((a/this.avaliacoes.length).toFixed(1))}else this.avaliacaoMedia=0}catch(t){console.error("Erro ao carregar detalhes do produto:",t),this.$swal({icon:"error",title:"Erro ao carregar detalhes",text:"Não foi possível carregar os detalhes do produto. Tente novamente."})}},fecharModal(){this.produtoSelecionado=null,this.documentos=[],this.avaliacoes=[],this.avaliacaoMedia=0,this.showAvaliacoes=!1},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";default:return""}},closeDropdownOnClickOutside(a){const t=this.$el.querySelector(".dropdown");t&&!t.contains(a.target)&&(this.showCategoriaDropdown=!1)},selecionarCategoria(a){console.log("Categoria selecionada:",a),this.categoriaSelecionada=a,this.categoriaAtual=a?a.nome:"Todos os grupos",this.filtroCategoria=a?a.id:"",this.showCategoriaDropdown=!1,this.filtrarProdutos()},toggleCategoriaDropdown(){this.showCategoriaDropdown=!this.showCategoriaDropdown},toggleAvaliacoes(){this.showAvaliacoes=!this.showAvaliacoes},formatarData(a){if(!a)return"Data não disponível";try{const t=new Date(a);return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Erro ao formatar data:",t),"Data inválida"}},obterDataAvaliacao(a){const t=a.created_at||a.criado_em||a.data||null;return this.formatarData(t)}}},fa=ga;var ha=(0,r.A)(fa,pa,va,!1,null,"9a1e339e",null);const _a=ha.exports,Ca={name:"Catalogo",components:{CatalogoEletronico:_a},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},mounted(){this.carregarConfiguracoes(),document.addEventListener("click",this.fecharDropdownFora)},beforeUnmount(){document.removeEventListener("click",this.fecharDropdownFora)},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},fecharDropdownFora(a){this.$el.querySelector(".profile-dropdown").contains(a.target)||(this.dropdownOpen=!1)},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}},closeDropdown(){this.dropdownOpen=!1}}},ba=Ca;var wa=(0,r.A)(ba,ua,ma,!1,null,"5f8dc8aa",null);const Da=wa.exports;var Ea=function(){var a=this,t=a._self._c;return t("div",{staticClass:"feedback-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-btn",on:{click:a.toggleDropdown}},[t("div",{staticClass:"profile-avatar"},[a._v(" 👤 ")]),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("▼")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" ⚙️ Configuração ")]),t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" 📧 Configurar Email ")]),t("hr",{staticClass:"dropdown-divider"}),t("a",{staticClass:"dropdown-item logout",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.logout.apply(null,arguments)}}},[a._v(" 🚪 Sair ")])]):a._e()])])]),t("main",{staticClass:"main-content"},[t("FormularioRDM")],1),a.modalEmailAberto?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalEmail}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[a._m(1),t("button",{staticClass:"btn-close",on:{click:a.fecharModalEmail}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeOrganizacao"}},[a._v("Nome da Organização")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeOrganizacao,expression:"configEmail.nomeOrganizacao"}],attrs:{id:"nomeOrganizacao",type:"text",placeholder:"Ex: Prefeitura Municipal de..."},domProps:{value:a.configEmail.nomeOrganizacao},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeOrganizacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"emailRemetente"}},[a._v("Email Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.emailRemetente,expression:"configEmail.emailRemetente"}],attrs:{id:"emailRemetente",type:"email",placeholder:"Ex: licitacoes@prefeitura.gov.br"},domProps:{value:a.configEmail.emailRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"emailRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeRemetente"}},[a._v("Nome do Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeRemetente,expression:"configEmail.nomeRemetente"}],attrs:{id:"nomeRemetente",type:"text",placeholder:"Ex: CPM - Comissão de Padronização de Materiais"},domProps:{value:a.configEmail.nomeRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"assinatura"}},[a._v("Assinatura do Email")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.assinatura,expression:"configEmail.assinatura"}],attrs:{id:"assinatura",rows:"4",placeholder:"Ex: Atenciosamente,&#10;Comissão de Padronização de Materiais&#10;Prefeitura Municipal&#10;Telefone: (xx) xxxx-xxxx"},domProps:{value:a.configEmail.assinatura},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"assinatura",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:a.fecharModalEmail}},[a._v("Cancelar")]),t("button",{staticClass:"btn btn-primary",on:{click:a.salvarConfiguracaoEmail}},[t("i",{staticClass:"fas fa-save"}),a._v(" Salvar ")])])])]):a._e()])},ya=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-envelope"}),a._v(" Configurar Email da Organização")])}],Pa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"rdm-container"},[t("h2",[a._v("Relatório de Desempenho de Material (RDM)")]),t("form",{on:{submit:function(t){return t.preventDefault(),a.enviarFeedback.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"produto"}},[a._v("Produto*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.feedback.produto_id,expression:"feedback.produto_id"}],attrs:{id:"produto",required:""},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.feedback,"produto_id",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione o produto...")]),a._l(a.produtos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" - "+a._s(e.marca)+" - "+a._s(e.modelo)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[t("label",[a._v("Avaliação*")]),t("div",{staticClass:"avaliacao"},a._l(5,(function(e){return t("div",{key:e,staticClass:"estrela",class:{ativa:a.feedback.avaliacao>=e},on:{click:function(t){a.feedback.avaliacao=e}}},[a._v(" ★ ")])})),0)]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"comentario"}},[a._v("Justificativa da Avaliação*")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.feedback.comentario,expression:"feedback.comentario"}],attrs:{id:"comentario",rows:"4",placeholder:"Ex: Equipamento apresentou falha após 3 meses de uso...",required:""},domProps:{value:a.feedback.comentario},on:{input:function(t){t.target.composing||a.$set(a.feedback,"comentario",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.loading}},[a._v(" "+a._s(a.loading?"Salvando...":"Salvar")+" ")])])])])},xa=[];const Ra={name:"FormularioRDM",data(){return{feedback:{produto_id:"",avaliacao:0,comentario:""},produtos:[],loading:!1,currentUser:null,currentTenantId:null}},created(){this.carregarProdutos(),this.obterUsuarioAtual()},methods:{async obterUsuarioAtual(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;t?(this.currentUser=t,t.user_metadata?.tenant_id?this.currentTenantId=t.user_metadata.tenant_id:this.currentTenantId=(0,f.A)()):this.currentTenantId=(0,f.A)()}catch(a){console.error("Erro ao obter dados do usuário:",a),this.currentTenantId=(0,f.A)()}},async carregarProdutos(){try{if(await this.obterUsuarioAtual(),!this.currentTenantId)return console.error("Não foi possível identificar o tenant_id"),void(this.produtos=[]);console.log("Carregando produtos para o tenant:",this.currentTenantId);const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("status","aprovado").eq("tenant_id",this.currentTenantId).order("nome");if(t)throw t;console.log("Produtos carregados:",a?.length||0),this.produtos=a||[]}catch(a){console.error("Erro ao carregar produtos:",a),alert("Erro ao carregar produtos. Por favor, tente novamente.")}},async enviarFeedback(){if(0!==this.feedback.avaliacao)try{let t;if(this.loading=!0,this.currentTenantId||(this.currentTenantId=(0,f.A)()),this.currentUser?.email){console.log("Buscando ID do usuário na tabela usuarios pelo email:",this.currentUser.email);const{data:e,error:o}=await g.ND.from("usuarios").select("id").eq("email",this.currentUser.email).maybeSingle();if(o&&console.error("Erro ao buscar usuário:",o),e?.id)t=e.id,console.log("ID do usuário encontrado na tabela usuarios:",t);else{console.warn("Usuário não encontrado na tabela usuarios, gerando ID temporário"),t=(0,f.A)();try{const{error:a}=await g.ND.from("usuarios").insert({id:t,email:this.currentUser.email,nome:this.currentUser.email.split("@")[0],tenant_id:this.currentTenantId,tipo:"cliente",ativo:!0});a&&console.error("Erro ao criar usuário na tabela:",a)}catch(a){console.error("Exceção ao criar usuário:",a)}}}else console.warn("Usuário não está autenticado, gerando ID temporário"),t=(0,f.A)();console.log("Enviando feedback com:",{produto_id:this.feedback.produto_id,usuario_id:t,tenant_id:this.currentTenantId});const{error:e}=await g.ND.from("rdm_feedbacks").insert({produto_id:this.feedback.produto_id,usuario_id:t,tenant_id:this.currentTenantId,avaliacao:this.feedback.avaliacao,comentario:this.feedback.comentario});if(e)throw e;this.$swal({icon:"success",title:"Feedback enviado!",text:"Seu feedback foi enviado com sucesso."}),this.limparFormulario()}catch(t){console.error("Erro ao enviar feedback:",t),this.$swal({icon:"error",title:"Erro ao enviar feedback",text:"Por favor, tente novamente."})}finally{this.loading=!1}else alert("Por favor, selecione uma avaliação de 1 a 5 estrelas.")},limparFormulario(){this.feedback={produto_id:"",avaliacao:0,comentario:""}}}},Na=Ra;var Aa=(0,r.A)(Na,Pa,xa,!1,null,"f5b703e0",null);const Sa=Aa.exports,Ia={name:"Feedback",components:{FormularioRDM:Sa},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},mounted(){this.carregarConfiguracoes()},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}}}},ka=Ia;var Ta=(0,r.A)(ka,Ea,ya,!1,null,"098da73d",null);const Ma=Ta.exports;var $a=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dcb-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-btn",on:{click:a.toggleDropdown}},[t("div",{staticClass:"profile-avatar"},[a._v(" 👤 ")]),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("▼")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" ⚙️ Configuração ")]),t("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.abrirConfiguracaoEmail.apply(null,arguments)}}},[a._v(" 📧 Configurar Email ")]),t("hr",{staticClass:"dropdown-divider"}),t("a",{staticClass:"dropdown-item logout",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),a.logout.apply(null,arguments)}}},[a._v(" 🚪 Sair ")])]):a._e()])])]),t("main",{staticClass:"main-content"},[t("FormularioDCB")],1)])},Oa=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])}],za=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dcb-container"},[t("h2",[a._v("Declaração de Conformidade de Bem (DCB)")]),t("div",{staticClass:"search-container"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"produto"}},[a._v("Selecione o produto")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.produtoSelecionado,expression:"produtoSelecionado"}],attrs:{id:"produto"},on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.produtoSelecionado=t.target.multiple?e:e[0]},a.carregarDetalhes]}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.produtos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" - "+a._s(e.marca)+" - "+a._s(e.modelo)+" ")])}))],2)])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando informações...")])]):a.produtoDetalhes?t("div",{staticClass:"produto-detalhes"},[t("h3",[a._v(a._s(a.produtoDetalhes.nome))]),t("div",{staticClass:"info-grid"},[t("div",{staticClass:"info-item"},[t("strong",[a._v("Marca:")]),a._v(" "+a._s(a.produtoDetalhes.marca)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Modelo:")]),a._v(" "+a._s(a.produtoDetalhes.modelo)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Fabricante:")]),a._v(" "+a._s(a.produtoDetalhes.fabricante)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CNPJ:")]),a._v(" "+a._s(a.produtoDetalhes.cnpj)+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Origem:")]),a._v(" "+a._s(a.produtoDetalhes.origem||"Não informada")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Registro na Anvisa/MS:")]),a._v(" "+a._s(a.produtoDetalhes.registro_anvisa||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("CBPF:")]),a._v(" "+a._s(a.produtoDetalhes.cbpf||"Não informado")+" ")]),t("div",{staticClass:"info-item"},[t("strong",[a._v("Código do Material:")]),a._v(" "+a._s(a.produtoDetalhes.codigo_material||"Não informado")+" ")]),t("div",{staticClass:"info-item full-width"},[t("strong",[a._v("Status:")]),t("span",{staticClass:"status-badge",class:a.getStatusClass(a.produtoDetalhes.status)},[a._v(" "+a._s(a.formatarStatus(a.produtoDetalhes.status))+" ")])])]),a.documentos.length>0?t("div",{staticClass:"documentos"},[t("h3",[a._v("Documentos")]),t("ul",{staticClass:"documentos-lista"},a._l(a.documentos,(function(e){return t("li",{key:e.id,staticClass:"documento-item"},[t("span",{staticClass:"doc-icon"},[a._v("📄")]),t("span",{staticClass:"doc-nome"},[a._v(a._s(e.nome))]),t("a",{staticClass:"btn-download",attrs:{href:e.arquivo_url,target:"_blank"}},[a._v("Visualizar")])])})),0)]):a._e(),t("div",{staticClass:"dcb-actions"},[t("button",{staticClass:"btn-primary",attrs:{disabled:!a.produtoAprovado},on:{click:a.gerarDCB}},[a._v(" Baixar Declaração de Conformidade ")]),a.produtoAprovado?a._e():t("p",{staticClass:"aviso"},[a._v(" Somente produtos aprovados possuem Declaração de Conformidade disponível. ")])])]):a._e()])},qa=[];const Fa={name:"FormularioDCB",data(){return{produtoSelecionado:"",produtoDetalhes:null,documentos:[],produtos:[],loading:!1,currentTenantId:null}},computed:{produtoAprovado(){return this.produtoDetalhes&&"aprovado"===this.produtoDetalhes.status}},created(){this.obterTenantId().then((()=>{this.carregarProdutos()}))},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(t)if(t.user_metadata?.tenant_id)this.currentTenantId=t.user_metadata.tenant_id;else{const{data:a,error:e}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();!e&&a?.tenant_id&&(this.currentTenantId=a.tenant_id)}}catch(a){console.error("Erro ao obter dados do usuário:",a)}},async carregarProdutos(){try{if(this.loading=!0,!this.currentTenantId)return void console.error("Tenant ID não disponível");const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).order("nome");if(t)throw t;this.produtos=a||[]}catch(a){console.error("Erro ao carregar produtos:",a),this.$swal({icon:"error",title:"Erro",text:"Não foi possível carregar a lista de produtos."})}finally{this.loading=!1}},async carregarDetalhes(){if(!this.produtoSelecionado)return this.produtoDetalhes=null,void(this.documentos=[]);try{this.loading=!0;const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("id",this.produtoSelecionado).single();if(t)throw t;this.produtoDetalhes=a;const{data:e,error:o}=await g.ND.from("documentos").select("*").eq("produto_id",this.produtoSelecionado);if(o)throw o;this.documentos=e||[]}catch(a){console.error("Erro ao carregar detalhes do produto:",a),this.$swal({icon:"error",title:"Erro",text:"Não foi possível carregar os detalhes do produto."})}finally{this.loading=!1}},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";case"diligencia":return"status-diligencia";default:return""}},formatarStatus(a){switch(a){case"pendente":return"Em avaliação";case"diligencia":return"Diligência";default:return a.charAt(0).toUpperCase()+a.slice(1)}},gerarDCB(){this.produtoDetalhes&&this.produtoAprovado?this.$swal({icon:"info",title:"Funcionalidade em Desenvolvimento",text:"A geração de PDF da Declaração de Conformidade estará disponível em breve. Esta funcionalidade requer a instalação de bibliotecas adicionais no projeto."}):this.$swal({icon:"error",title:"Não disponível",text:"Apenas produtos aprovados possuem Declaração de Conformidade disponível."})}}},Ba=Fa;var Ua=(0,r.A)(Ba,za,qa,!1,null,"9c76b404",null);const La=Ua.exports,ja={name:"DCB",components:{FormularioDCB:La},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},mounted(){this.carregarConfiguracoes(),document.addEventListener("click",this.fecharDropdownFora)},beforeUnmount(){document.removeEventListener("click",this.fecharDropdownFora)},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},fecharDropdownFora(a){this.$el.querySelector(".profile-dropdown").contains(a.target)||(this.dropdownOpen=!1)},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}}}},Va=ja;var Ja=(0,r.A)(Va,$a,Oa,!1,null,"bb85b182",null);const Ga=Ja.exports;var Ka=function(){var a=this,t=a._self._c;return t("div",{staticClass:"ccl-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.showDropdown},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.usuarioNome))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.usuarioEmail))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.showDropdown}},[a._v("▼")])]),a.showDropdown?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.usuarioNome))]),t("small",[a._v(a._s(a.usuarioEmail))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoes}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracoesEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.showDropdown?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("DashboardCCL")],1)])},Ha=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])}],Za=function(){var a=this,t=a._self._c;return t("div",{staticClass:"dashboard"},[t("h2",[a._v("Painel de Comissão de Contratação ou Licitação")]),t("div",{staticClass:"tabs"},[t("div",{staticClass:"tab",class:{active:"dashboard"===a.activeTab},on:{click:function(t){a.activeTab="dashboard"}}},[a._v(" Dashboard ")]),t("div",{staticClass:"tab",class:{active:"atas"===a.activeTab},on:{click:function(t){a.activeTab="atas"}}},[a._v(" Atas de Julgamento ")]),t("div",{staticClass:"tab",class:{active:"homologacoes"===a.activeTab},on:{click:function(t){a.activeTab="homologacoes"}}},[a._v(" Homologações ")])]),"dashboard"===a.activeTab?t("div",[t("div",{staticClass:"stats-container"},[t("div",{staticClass:"stat-card status-pendente-card"},[t("h3",[a._v("Processos em Julgamento")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.pendentes))])]),t("div",{staticClass:"stat-card status-aprovado-card"},[t("h3",[a._v("Homologações")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.aprovados))])]),t("div",{staticClass:"stat-card status-diligencia-card"},[t("h3",[a._v("Processos com Diligências")]),t("div",{staticClass:"stat-value"},[a._v(a._s(a.diligencias))])])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Processos Pendentes de Julgamento")]),a.produtosPendentes.length>0?t("table",[a._m(0),t("tbody",a._l(a.produtosPendentes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.marca))]),t("td",[a._v(a._s(a.getCategoriaName(e.categoria_id)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(e.status)},[a._v(" "+a._s(a.formatarStatus(e.status))+" ")])]),t("td",[a._v(a._s(a.formatDate(e.criado_em)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.publicarDecisao(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("Não há processos pendentes de julgamento.")])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Atas de Julgamento Recentes")]),a.atasRecentes.length>0?t("table",[a._m(1),t("tbody",a._l(a.atasRecentes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.numero))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[t("span",{staticClass:"status-badge",class:a.getStatusClass(e.decisao)},[a._v(" "+a._s(a.formatarStatus(e.decisao))+" ")])]),t("td",[a._v(a._s(a.formatDate(e.data_publicacao)))]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.visualizarAta(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("Não há atas de julgamento recentes.")])]),t("div",{staticClass:"dashboard-section"},[t("h3",[a._v("Recursos Apresentados")]),a.recursos.length>0?t("table",[a._m(2),t("tbody",a._l(a.recursos,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.recorrente))]),t("td",[a._v(a._s(e.produto_nome))]),t("td",[a._v(a._s(a.formatDate(e.data_recurso)))]),t("td",[a._v(a._s(a.formatDate(e.prazo_final)))]),t("td",[t("span",{staticClass:"status-badge",class:a.getRecursoStatusClass(e.status)},[a._v(" "+a._s(e.status)+" ")])]),t("td",[t("button",{staticClass:"btn-small",on:{click:function(t){return a.julgarRecurso(e.id)}}},[a._v("Visualizar")])])])})),0)]):t("p",[a._v("Não há recursos apresentados.")])])]):a._e(),"atas"===a.activeTab?t("div",{staticClass:"atas-julgamento"},[a._m(3)]):a._e(),"homologacoes"===a.activeTab?t("div",{staticClass:"homologacoes"},[a._m(4)]):a._e()])},Qa=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Marca")]),t("th",[a._v("Categoria")]),t("th",[a._v("Status")]),t("th",[a._v("Data")]),t("th",[a._v("Documentação")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Número da Ata")]),t("th",[a._v("Produto")]),t("th",[a._v("Decisão")]),t("th",[a._v("Data de Publicação")]),t("th",[a._v("Documentação")])])])},function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Recorrente")]),t("th",[a._v("Produto")]),t("th",[a._v("Data do Recurso")]),t("th",[a._v("Prazo Final")]),t("th",[a._v("Status")]),t("th",[a._v("Documentação")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Atas de Julgamento")]),t("p",[a._v("Este módulo permitirá o gerenciamento completo das atas de julgamento emitidas pela Comissão de Contratação ou Licitação.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Cadastro e edição de atas de julgamento")]),t("li",[a._v("Publicação automática no Diário Oficial")]),t("li",[a._v("Comunicação com fornecedores interessados")]),t("li",[a._v("Histórico de alterações e versões")]),t("li",[a._v("Geração de relatórios consolidados")]),t("li",[a._v("Integração com sistema de processo eletrônico")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"info-card"},[t("h3",[a._v("Homologações")]),t("p",[a._v("Este módulo permitirá o acesso a todos os arquivos em PDF de atos de homologação assinados digitalmente pela autoridade competente do órgão ou entidade.")]),t("p",[a._v("Funcionalidades que serão implementadas:")]),t("ul",[t("li",[a._v("Acesso aos documentos de homologação de padronizações de marcas e modelos")]),t("li",[a._v("Acesso aos documentos de despadronizações")]),t("li",[a._v("Registro de decisões da autoridade competente")]),t("li",[a._v("Notificação automática de homologações e indeferimentos")])]),t("div",{staticClass:"em-desenvolvimento"},[t("span",[a._v("Em desenvolvimento")])])])}];const Ya={name:"DashboardCCL",data(){return{activeTab:"dashboard",produtosPendentes:[],atasRecentes:[],pendentes:0,aprovados:0,diligencias:0,categorias:[],currentTenantId:null,loading:!1,recursos:[]}},created(){this.obterTenantId().then((()=>{this.carregarDados(),this.carregarCategorias()}))},methods:{async obterTenantId(){try{const{data:a}=await g.ND.auth.getSession(),t=a?.session?.user;if(!t)return void console.error("Usuário não está autenticado");if(t.user_metadata?.tenant_id)return void(this.currentTenantId=t.user_metadata.tenant_id);const{data:e,error:o}=await g.ND.from("usuarios").select("tenant_id").eq("email",t.email).single();if(o)return void console.error("Erro ao buscar tenant_id:",o);e?.tenant_id?this.currentTenantId=e.tenant_id:console.error("Tenant ID não encontrado para o usuário")}catch(a){console.error("Erro ao obter tenant_id:",a)}},async carregarCategorias(){try{const{data:a,error:t}=await g.ND.from("categorias").select("*");if(t)throw t;this.categorias=a||[]}catch(a){console.error("Erro ao carregar categorias:",a)}},getCategoriaName(a){const t=this.categorias.find((t=>t.id===a));return t?t.nome:"Categoria não encontrada"},async carregarDados(){try{if(this.loading=!0,!this.currentTenantId)return void console.error("Tenant ID não disponível");const{data:a,error:t}=await g.ND.from("produtos").select("*").eq("tenant_id",this.currentTenantId).in("status",["aprovado","reprovado"]).order("criado_em",{ascending:!1}).limit(10);if(t)throw t;this.produtosPendentes=a||[],this.atasRecentes=[{id:"1",numero:"ATA-001/2023",produto_nome:"Monitor de Sinais Vitais",decisao:"aprovado",data_publicacao:"2023-05-15"},{id:"2",numero:"ATA-002/2023",produto_nome:"Desfibrilador",decisao:"diligencia",data_publicacao:"2023-05-20"},{id:"3",numero:"ATA-003/2023",produto_nome:"Autoclave Hospitalar",decisao:"aprovado",data_publicacao:"2023-06-01"}],this.recursos=[{id:"1",recorrente:"Hospital Médico LTDA",produto_nome:"Desfibrilador",data_recurso:"2023-05-22",status:"EM ANÁLISE",prazo_final:"2023-06-06"},{id:"2",recorrente:"Equipamentos Hospitalares S.A.",produto_nome:"Bomba de Infusão",data_recurso:"2023-06-05",status:"DEFERIDO",prazo_final:"2023-06-20"},{id:"3",recorrente:"Medical Suprimentos Médicos",produto_nome:"Ventilador Pulmonar",data_recurso:"2023-06-10",status:"INDEFERIDO",prazo_final:"2023-06-25"}];const e=await Promise.all([this.contarPorStatus("pendente"),this.contarPorStatus("aprovado"),this.contarPorStatus("diligencia")]);this.pendentes=e[0],this.aprovados=e[1],this.diligencias=e[2];const o=this.atasRecentes.filter((a=>"diligencia"===a.decisao)).length;o>0&&(this.diligencias=o);const s=this.atasRecentes.filter((a=>"aprovado"===a.decisao)).length;s>0&&0===this.aprovados&&(this.aprovados=s)}catch(a){console.error("Erro ao carregar dados:",a)}finally{this.loading=!1}},async contarPorStatus(a){if(!this.currentTenantId)return 0;const{count:t,error:e}=await g.ND.from("produtos").select("id",{count:"exact"}).eq("status",a).eq("tenant_id",this.currentTenantId);return e?(console.error(`Erro ao contar produtos ${a}:`,e),0):t||0},formatDate(a){if(!a)return"";if(a.includes("T")){const t=new Date(a);return t.toLocaleDateString("pt-BR")}const t=a.split("-");return 3===t.length?`${t[2]}/${t[1]}/${t[0]}`:a},formatarStatus(a){switch(a){case"pendente":return"Em avaliação";case"aprovado":return"Homologado";case"diligencia":return"Em diligência";default:return a}},getStatusClass(a){switch(a){case"aprovado":return"status-aprovado";case"pendente":return"status-pendente";case"reprovado":return"status-reprovado";case"diligencia":return"status-diligencia";default:return""}},publicarDecisao(a){this.$swal({title:"Ação Simulada",text:"Em uma implementação completa, abriria um formulário para registrar a decisão da comissão e publicar no Diário Oficial.",icon:"info"})},visualizarAta(a){this.$swal({title:"Ação Simulada",text:"Em uma implementação completa, exibiria o documento da ata de julgamento e permitiria fazer download.",icon:"info"})},getRecursoStatusClass(a){switch(a){case"EM ANÁLISE":return"status-pendente";case"DEFERIDO":return"status-aprovado";case"INDEFERIDO":return"status-reprovado";default:return""}},julgarRecurso(a){this.$swal({title:"Ação Simulada",text:"Em uma implementação completa, abriria um formulário para julgar o recurso e permitiria acesso ao documento PDF assinado digitalmente.",icon:"info"})}}},Wa=Ya;var Xa=(0,r.A)(Wa,Za,Qa,!1,null,"b8796608",null);const at=Xa.exports,tt={name:"CCL",components:{DashboardCCL:at},data(){return{dropdownOpen:!1,modalEmailAberto:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",configEmail:{nomeOrganizacao:"",emailRemetente:"",nomeRemetente:"",assinatura:""},showDropdown:!1,usuarioNome:"comprarBemTeste",usuarioEmail:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},async created(){await this.carregarDadosUsuario(),this.carregarConfiguracoes()},mounted(){},beforeUnmount(){},methods:{async carregarDadosUsuario(){try{const{data:{user:a}}=await g.ND.auth.getUser();a&&(this.usuarioEmail=a.email,this.usuarioNome=a.user_metadata?.nome||a.email.split("@")[0])}catch(a){console.error("Erro ao carregar dados do usuário:",a)}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}},toggleDropdown(){this.showDropdown=!this.showDropdown},abrirConfiguracoesEmail(){this.closeDropdown(),this.mostrarConfigEmail()},async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}this.closeDropdown()},abrirConfiguracoes(){this.closeDropdown(),this.mostrarConfigEmail()},async mostrarConfigEmail(){const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},closeDropdown(){this.showDropdown=!1}}},et=tt;var ot=(0,r.A)(et,Ka,Ha,!1,null,"c16dfade",null);const st=ot.exports;var it=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classificacao-view"},[t("header",{staticClass:"app-header"},[a._m(0),t("nav",{staticClass:"main-nav"},[t("router-link",{attrs:{to:"/dashboard"}},[a._v("Painel CPM")]),t("router-link",{attrs:{to:"/ccl"}},[a._v("Painel CCL")]),t("router-link",{attrs:{to:"/cadastro"}},[a._v("Cadastrar Produto")]),t("router-link",{staticClass:"nav-item",attrs:{to:"/catalogo"}},[t("span",[a._v("Catálogo")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Marcas")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/classificacao"}},[t("span",[a._v("Classificação")]),t("span",{staticClass:"nav-subtitle"},[a._v("de Bens")])]),t("router-link",{attrs:{to:"/dcb"}},[a._v("DCB")]),t("router-link",{attrs:{to:"/feedback"}},[a._v("RDM")])],1),t("div",{staticClass:"user-menu"},[t("div",{ref:"profileDropdown",staticClass:"profile-dropdown"},[t("button",{staticClass:"profile-button",class:{active:a.dropdownOpen},on:{click:a.toggleDropdown}},[a._m(1),t("div",{staticClass:"profile-info"},[t("span",{staticClass:"profile-name"},[a._v(a._s(a.nomeUsuario))]),t("span",{staticClass:"profile-email"},[a._v(a._s(a.emailUsuario))])]),t("span",{staticClass:"dropdown-arrow",class:{rotated:a.dropdownOpen}},[a._v("▼")])]),a.dropdownOpen?t("div",{staticClass:"dropdown-menu"},[t("div",{staticClass:"dropdown-header"},[t("div",{staticClass:"user-avatar-large"},[a._v("👤")]),t("div",{staticClass:"user-details"},[t("strong",[a._v(a._s(a.nomeUsuario))]),t("small",[a._v(a._s(a.emailUsuario))])])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("⚙️")]),t("span",[a._v("Configurações")])]),t("button",{staticClass:"dropdown-item",on:{click:a.abrirConfiguracaoEmail}},[t("span",{staticClass:"item-icon"},[a._v("📧")]),t("span",[a._v("Configurar Email")])]),t("hr",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item logout-item",on:{click:a.logout}},[t("span",{staticClass:"item-icon"},[a._v("🚪")]),t("span",[a._v("Sair")])])]):a._e()]),a.dropdownOpen?t("div",{staticClass:"dropdown-overlay",on:{click:a.closeDropdown}}):a._e()])]),t("main",{staticClass:"main-content"},[t("Classificacao")],1),a.modalEmailAberto?t("div",{staticClass:"modal-overlay",on:{click:a.fecharModalEmail}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[a._m(2),t("button",{staticClass:"btn-close",on:{click:a.fecharModalEmail}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeOrganizacao"}},[a._v("Nome da Organização")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeOrganizacao,expression:"configEmail.nomeOrganizacao"}],attrs:{id:"nomeOrganizacao",type:"text",placeholder:"Ex: Prefeitura Municipal de..."},domProps:{value:a.configEmail.nomeOrganizacao},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeOrganizacao",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"emailRemetente"}},[a._v("Email Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.emailRemetente,expression:"configEmail.emailRemetente"}],attrs:{id:"emailRemetente",type:"email",placeholder:"Ex: licitacoes@prefeitura.gov.br"},domProps:{value:a.configEmail.emailRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"emailRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nomeRemetente"}},[a._v("Nome do Remetente")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.nomeRemetente,expression:"configEmail.nomeRemetente"}],attrs:{id:"nomeRemetente",type:"text",placeholder:"Ex: CPM - Comissão de Padronização de Materiais"},domProps:{value:a.configEmail.nomeRemetente},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"nomeRemetente",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"assinatura"}},[a._v("Assinatura do Email")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.configEmail.assinatura,expression:"configEmail.assinatura"}],attrs:{id:"assinatura",rows:"4",placeholder:"Ex: Atenciosamente,&#10;Comissão de Padronização de Materiais&#10;Prefeitura Municipal&#10;Telefone: (xx) xxxx-xxxx"},domProps:{value:a.configEmail.assinatura},on:{input:function(t){t.target.composing||a.$set(a.configEmail,"assinatura",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:a.fecharModalEmail}},[a._v("Cancelar")]),t("button",{staticClass:"btn btn-primary",on:{click:a.salvarConfiguracaoEmail}},[t("i",{staticClass:"fas fa-save"}),a._v(" Salvar ")])])])]):a._e()])},rt=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"logo"},[t("div",{staticClass:"logo-content"},[t("h1",[a._v("Comprar Bem")]),t("span",{staticClass:"subtitle"},[a._v("Compras Públicas Inteligentes")])])])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"profile-avatar"},[t("span",{staticClass:"profile-icon"},[a._v("👤")])])},function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-envelope"}),a._v(" Configurar Email da Organização")])}],nt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classificacao-container"},[t("h2",[a._v("Classificação de Produtos")]),t("div",{staticClass:"tabs"},[t("button",{class:["tab-button",{active:"grupos"===a.activeTab}],on:{click:function(t){a.activeTab="grupos"}}},[a._v(" Grupos ")]),t("button",{class:["tab-button",{active:"classes"===a.activeTab}],on:{click:function(t){a.activeTab="classes"}}},[a._v(" Classes ")])]),t("div",{staticClass:"tab-content"},["grupos"===a.activeTab?t("GruposList"):a._e(),"classes"===a.activeTab?t("ClassesList"):a._e()],1)])},lt=[],ct=function(){var a=this,t=a._self._c;return t("div",{staticClass:"grupos-list"},[t("div",{staticClass:"header"},[t("h3",[a._v("Gerenciamento de Grupos")]),t("button",{staticClass:"btn-add",on:{click:function(t){a.mostrarFormulario=!0}}},[a._v(" Adicionar Grupo ")])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando grupos...")])]):0===a.grupos.length?t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhum grupo cadastrado.")])]):t("div",{staticClass:"grupos-table"},[t("table",[a._m(0),t("tbody",a._l(a.grupos,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(e.descricao||"-"))]),t("td",[a._v(a._s(a.formatarData(e.created_at)))]),t("td",{staticClass:"actions"},[t("button",{staticClass:"btn-edit",on:{click:function(t){return a.editarGrupo(e)}}},[a._v("Editar")]),t("button",{staticClass:"btn-delete",on:{click:function(t){return a.confirmarExclusao(e)}}},[a._v("Excluir")])])])})),0)])]),a.mostrarFormulario?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.modoEdicao?"Editar":"Adicionar")+" Grupo")]),t("button",{staticClass:"btn-close",on:{click:a.fecharFormulario}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarGrupo.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome do Grupo*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.grupoAtual.nome,expression:"grupoAtual.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.grupoAtual.nome},on:{input:function(t){t.target.composing||a.$set(a.grupoAtual,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descrição")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.grupoAtual.descricao,expression:"grupoAtual.descricao"}],attrs:{id:"descricao",rows:"3"},domProps:{value:a.grupoAtual.descricao},on:{input:function(t){t.target.composing||a.$set(a.grupoAtual,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharFormulario}},[a._v("Cancelar")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.salvando}},[a._v(" "+a._s(a.salvando?"Salvando...":"Salvar")+" ")])])])])])]):a._e()])},dt=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Descrição")]),t("th",[a._v("Data de Criação")]),t("th",[a._v("Ações")])])])}];const ut={name:"GruposList",setup(){const a=(0,o.KR)([]),t=(0,o.KR)(!0),e=(0,o.KR)(!1),s=(0,o.KR)(!1),i=(0,o.KR)(!1),r=(0,o.Kh)({id:null,nome:"",descricao:""});(0,o.sV)((async()=>{await n()}));const n=async()=>{try{t.value=!0;const{data:e,error:o}=await g.ND.from("grupos").select("*").order("nome");if(o)throw o;a.value=e||[]}catch(e){console.error("Erro ao carregar grupos:",e),alert("Erro ao carregar grupos. Por favor, tente novamente.")}finally{t.value=!1}},l=a=>{if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")},c=a=>{i.value=!0,r.id=a.id,r.nome=a.nome,r.descricao=a.descricao||"",s.value=!0},d=()=>{s.value=!1,i.value=!1,r.id=null,r.nome="",r.descricao=""},u=async()=>{try{if(e.value=!0,i.value){const{error:a}=await g.ND.from("grupos").update({nome:r.nome,descricao:r.descricao}).eq("id",r.id);if(a)throw a;alert("Grupo atualizado com sucesso!")}else{const{error:a}=await g.ND.from("grupos").insert({nome:r.nome,descricao:r.descricao});if(a)throw a;alert("Grupo adicionado com sucesso!")}await n(),d()}catch(a){console.error("Erro ao salvar grupo:",a),alert(`Erro ao ${i.value?"atualizar":"adicionar"} grupo: ${a.message}`)}finally{e.value=!1}},m=a=>{confirm(`Deseja realmente excluir o grupo "${a.nome}"?`)&&p(a.id)},p=async a=>{try{t.value=!0;const{data:e,error:o}=await g.ND.from("classes").select("id").eq("grupo_id",a);if(o)throw o;if(e&&e.length>0)return void alert(`Não é possível excluir este grupo porque existem ${e.length} classes associadas a ele.`);const{data:s,error:i}=await g.ND.from("produtos").select("id").eq("grupo_id",a);if(i)throw i;if(s&&s.length>0)return void alert(`Não é possível excluir este grupo porque existem ${s.length} produtos associados a ele.`);const{error:r}=await g.ND.from("grupos").delete().eq("id",a);if(r)throw r;alert("Grupo excluído com sucesso!"),await n()}catch(e){console.error("Erro ao excluir grupo:",e),alert(`Erro ao excluir grupo: ${e.message}`)}finally{t.value=!1}};return{grupos:a,loading:t,salvando:e,mostrarFormulario:s,modoEdicao:i,grupoAtual:r,carregarGrupos:n,formatarData:l,editarGrupo:c,fecharFormulario:d,salvarGrupo:u,confirmarExclusao:m}}},mt=ut;var pt=(0,r.A)(mt,ct,dt,!1,null,"3509bc35",null);const vt=pt.exports;var gt=function(){var a=this,t=a._self._c;return t("div",{staticClass:"classes-list"},[t("div",{staticClass:"header"},[t("h3",[a._v("Gerenciamento de Classes")]),t("button",{staticClass:"btn-add",on:{click:function(t){a.mostrarFormulario=!0}}},[a._v(" Adicionar Classe ")])]),a.loading?t("div",{staticClass:"loading"},[t("p",[a._v("Carregando classes...")])]):0===a.classes.length?t("div",{staticClass:"empty-state"},[t("p",[a._v("Nenhuma classe cadastrada.")])]):t("div",{staticClass:"classes-table"},[t("table",[a._m(0),t("tbody",a._l(a.classes,(function(e){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nome))]),t("td",[a._v(a._s(a.getNomeGrupo(e.grupo_id)))]),t("td",[a._v(a._s(e.descricao||"-"))]),t("td",[a._v(a._s(a.formatarData(e.created_at)))]),t("td",{staticClass:"actions"},[t("button",{staticClass:"btn-edit",on:{click:function(t){return a.editarClasse(e)}}},[a._v("Editar")]),t("button",{staticClass:"btn-delete",on:{click:function(t){return a.confirmarExclusao(e)}}},[a._v("Excluir")])])])})),0)])]),a.mostrarFormulario?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v(a._s(a.modoEdicao?"Editar":"Adicionar")+" Classe")]),t("button",{staticClass:"btn-close",on:{click:a.fecharFormulario}},[a._v("×")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(t){return t.preventDefault(),a.salvarClasse.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"grupo"}},[a._v("Grupo*")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.grupo_id,expression:"classeAtual.grupo_id"}],attrs:{id:"grupo",required:""},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.classeAtual,"grupo_id",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:""}},[a._v("Selecione...")]),a._l(a.grupos,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.nome)+" ")])}))],2),0===a.grupos.length?t("div",{staticClass:"error-text"},[t("p",[a._v("É necessário cadastrar pelo menos um grupo antes de adicionar classes.")])]):a._e()]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nome"}},[a._v("Nome da Classe*")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.nome,expression:"classeAtual.nome"}],attrs:{id:"nome",type:"text",required:""},domProps:{value:a.classeAtual.nome},on:{input:function(t){t.target.composing||a.$set(a.classeAtual,"nome",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descricao"}},[a._v("Descrição")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.classeAtual.descricao,expression:"classeAtual.descricao"}],attrs:{id:"descricao",rows:"3"},domProps:{value:a.classeAtual.descricao},on:{input:function(t){t.target.composing||a.$set(a.classeAtual,"descricao",t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-secondary",attrs:{type:"button"},on:{click:a.fecharFormulario}},[a._v("Cancelar")]),t("button",{staticClass:"btn-primary",attrs:{type:"submit",disabled:a.salvando||0===a.grupos.length}},[a._v(" "+a._s(a.salvando?"Salvando...":"Salvar")+" ")])])])])])]):a._e()])},ft=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Nome")]),t("th",[a._v("Grupo")]),t("th",[a._v("Descrição")]),t("th",[a._v("Data de Criação")]),t("th",[a._v("Ações")])])])}];const ht={name:"ClassesList",setup(){const a=(0,o.KR)([]),t=(0,o.KR)([]),e=(0,o.KR)(!0),s=(0,o.KR)(!1),i=(0,o.KR)(!1),r=(0,o.KR)(!1),n=(0,o.Kh)({id:null,grupo_id:"",nome:"",descricao:""});(0,o.sV)((async()=>{await Promise.all([l(),c()])}));const l=async()=>{try{const{data:a,error:e}=await g.ND.from("grupos").select("*").order("nome");if(e)throw e;t.value=a||[]}catch(a){console.error("Erro ao carregar grupos:",a),alert("Erro ao carregar grupos. Por favor, tente novamente.")}},c=async()=>{try{e.value=!0;const{data:t,error:o}=await g.ND.from("classes").select("*").order("nome");if(o)throw o;a.value=t||[]}catch(t){console.error("Erro ao carregar classes:",t),alert("Erro ao carregar classes. Por favor, tente novamente.")}finally{e.value=!1}},d=a=>{const e=t.value.find((t=>t.id===a));return e?e.nome:"Grupo não encontrado"},u=a=>{if(!a)return"-";const t=new Date(a);return t.toLocaleDateString("pt-BR")},m=a=>{r.value=!0,n.id=a.id,n.grupo_id=a.grupo_id,n.nome=a.nome,n.descricao=a.descricao||"",i.value=!0},p=()=>{i.value=!1,r.value=!1,n.id=null,n.grupo_id="",n.nome="",n.descricao=""},v=async()=>{try{if(s.value=!0,r.value){const{error:a}=await g.ND.from("classes").update({grupo_id:n.grupo_id,nome:n.nome,descricao:n.descricao}).eq("id",n.id);if(a)throw a;alert("Classe atualizada com sucesso!")}else{const{error:a}=await g.ND.from("classes").insert({grupo_id:n.grupo_id,nome:n.nome,descricao:n.descricao});if(a)throw a;alert("Classe adicionada com sucesso!")}await c(),p()}catch(a){console.error("Erro ao salvar classe:",a),alert(`Erro ao ${r.value?"atualizar":"adicionar"} classe: ${a.message}`)}finally{s.value=!1}},f=a=>{confirm(`Deseja realmente excluir a classe "${a.nome}"?`)&&h(a.id)},h=async a=>{try{e.value=!0;const{data:t,error:o}=await g.ND.from("produtos").select("id").eq("classe_id",a);if(o)throw o;if(t&&t.length>0)return void alert(`Não é possível excluir esta classe porque existem ${t.length} produtos associados a ela.`);const{error:s}=await g.ND.from("classes").delete().eq("id",a);if(s)throw s;alert("Classe excluída com sucesso!"),await c()}catch(t){console.error("Erro ao excluir classe:",t),alert(`Erro ao excluir classe: ${t.message}`)}finally{e.value=!1}};return{classes:a,grupos:t,loading:e,salvando:s,mostrarFormulario:i,modoEdicao:r,classeAtual:n,carregarClasses:c,carregarGrupos:l,getNomeGrupo:d,formatarData:u,editarClasse:m,fecharFormulario:p,salvarClasse:v,confirmarExclusao:f}}},_t=ht;var Ct=(0,r.A)(_t,gt,ft,!1,null,"7574422a",null);const bt=Ct.exports,wt={name:"Classificacao",components:{GruposList:vt,ClassesList:bt},setup(){const a=(0,o.KR)("grupos");return{activeTab:a}}},Dt=wt;var Et=(0,r.A)(Dt,nt,lt,!1,null,"35477b05",null);const yt=Et.exports,Pt={name:"ClassificacaoView",components:{Classificacao:yt},data(){return{dropdownOpen:!1,nomeUsuario:"comprarBemTeste",emailUsuario:"comprarbemteste@gmail.com",emailRemetente:"cpm@suaorganizacao.com.br",nomeRemetente:"CPM - Comissão de Padronização de Materiais"}},mounted(){this.carregarConfiguracoes(),document.addEventListener("click",this.fecharDropdownFora)},beforeUnmount(){document.removeEventListener("click",this.fecharDropdownFora)},methods:{async logout(){try{await g.ND.auth.signOut(),this.$router.push("/")}catch(a){console.error("Erro ao fazer logout:",a)}},toggleDropdown(){this.dropdownOpen=!this.dropdownOpen},fecharDropdownFora(a){this.$el.querySelector(".profile-dropdown").contains(a.target)||(this.dropdownOpen=!1)},async abrirConfiguracaoEmail(){this.dropdownOpen=!1;const{value:a}=await this.$swal({title:"📧 Configurar Email do Sistema",html:`\n          <div style="text-align: left; padding: 10px;">\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Email Remetente (CPM):</label>\n              <input id="emailRemetente" class="swal2-input" value="${this.emailRemetente}" type="email" placeholder="cpm@suaorganizacao.com.br">\n              <small style="color: #666; font-size: 11px;">Email que aparece como remetente das diligências</small>\n            </div>\n            <div style="margin-bottom: 15px;">\n              <label style="display: block; font-weight: bold; margin-bottom: 5px;">Nome do Remetente:</label>\n              <input id="nomeRemetente" class="swal2-input" value="${this.nomeRemetente}" type="text" placeholder="CPM - Comissão de Padronização de Materiais">\n            </div>\n          </div>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"💾 Salvar",cancelButtonText:"❌ Cancelar",preConfirm:()=>{const a=document.getElementById("emailRemetente").value,t=document.getElementById("nomeRemetente").value;return a&&t?{emailRemetente:a,nomeRemetente:t}:(this.$swal.showValidationMessage("Por favor, preencha todos os campos"),!1)}});if(a){this.emailRemetente=a.emailRemetente,this.nomeRemetente=a.nomeRemetente;const t={emailRemetente:a.emailRemetente,nomeRemetente:a.nomeRemetente};localStorage.setItem("configsSistema",JSON.stringify(t)),this.$swal({title:"✅ Sucesso!",text:"Configurações de email salvas com sucesso!",icon:"success"})}},carregarConfiguracoes(){try{const a=localStorage.getItem("configsSistema");if(a){const t=JSON.parse(a);this.emailRemetente=t.emailRemetente||this.emailRemetente,this.nomeRemetente=t.nomeRemetente||this.nomeRemetente}}catch(a){console.error("Erro ao carregar configurações:",a)}},closeDropdown(){this.dropdownOpen=!1}}},xt=Pt;var Rt=(0,r.A)(xt,it,rt,!1,null,"7461ecae",null);const Nt=Rt.exports;o.Ay.use(d.Ay);const At=[{path:"/",name:"Home",component:y,meta:{requiresAuth:!1}},{path:"/dashboard",name:"Dashboard",component:O,meta:{requiresAuth:!0}},{path:"/ccl",name:"CCL",component:st,meta:{requiresAuth:!0}},{path:"/cadastro",name:"Cadastro",component:H,meta:{requiresAuth:!0}},{path:"/analise/:id",name:"Analise",component:da,meta:{requiresAuth:!0}},{path:"/catalogo",name:"Catalogo",component:Da,meta:{requiresAuth:!0}},{path:"/feedback",name:"Feedback",component:Ma,meta:{requiresAuth:!0}},{path:"/dcb",name:"DCB",component:Ga,meta:{requiresAuth:!0}},{path:"/classificacao",name:"Classificacao",component:Nt,meta:{requiresAuth:!0}},{path:"/produtos/:id",name:"DetalheProduto",component:()=>e.e(961).then(e.bind(e,342)),props:!0,meta:{requiresAuth:!0}}],St=new d.Ay({mode:"history",base:"/ComprarBem/",routes:At});St.beforeEach((async(a,t,e)=>{const{data:o}=await g.ND.auth.getSession(),s=o?.session?.user,i=a.matched.some((a=>a.meta.requiresAuth));i&&!s?e("/"):e()}));const It=St;var kt=e(353);o.Ay.use(kt.Ay);const Tt=new kt.Ay.Store({state:{user:null,tenant:null,isLoading:!1},mutations:{SET_USER(a,t){a.user=t},SET_TENANT(a,t){a.tenant=t},SET_LOADING(a,t){a.isLoading=t}},actions:{async fetchUser({commit:a}){const{data:t}=await g.ND.auth.getSession(),e=t?.session?.user;if(a("SET_USER",e),e){const{data:t,error:o}=await g.ND.from("tenants").select("*").eq("id",e.user_metadata?.tenant_id).single();!o&&t&&a("SET_TENANT",t)}},setLoading({commit:a},t){a("SET_LOADING",t)}},getters:{isAuthenticated:a=>!!a.user,currentUser:a=>a.user,currentTenant:a=>a.tenant,isLoading:a=>a.isLoading}});var Mt=e(640),$t=e(201),Ot=e.n($t);o.Ay.config.productionTip=!1,o.Ay.use(Mt.A),o.Ay.use(Ot()),new o.Ay({router:It,store:Tt,render:a=>a(c)}).$mount("#app")}},t={};function e(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return a[o].call(i.exports,i,i.exports,e),i.exports}e.m=a,(()=>{var a=[];e.O=(t,o,s,i)=>{if(!o){var r=1/0;for(d=0;d<a.length;d++){for(var[o,s,i]=a[d],n=!0,l=0;l<o.length;l++)(!1&i||r>=i)&&Object.keys(e.O).every((a=>e.O[a](o[l])))?o.splice(l--,1):(n=!1,i<r&&(r=i));if(n){a.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=a.length;d>0&&a[d-1][2]>i;d--)a[d]=a[d-1];a[d]=[o,s,i]}})(),(()=>{e.n=a=>{var t=a&&a.__esModule?()=>a["default"]:()=>a;return e.d(t,{a:t}),t}})(),(()=>{var a,t=Object.getPrototypeOf?a=>Object.getPrototypeOf(a):a=>a.__proto__;e.t=function(o,s){if(1&s&&(o=this(o)),8&s)return o;if("object"===typeof o&&o){if(4&s&&o.__esModule)return o;if(16&s&&"function"===typeof o.then)return o}var i=Object.create(null);e.r(i);var r={};a=a||[null,t({}),t([]),t(t)];for(var n=2&s&&o;"object"==typeof n&&!~a.indexOf(n);n=t(n))Object.getOwnPropertyNames(n).forEach((a=>r[a]=()=>o[a]));return r["default"]=()=>o,e.d(i,r),i}})(),(()=>{e.d=(a,t)=>{for(var o in t)e.o(t,o)&&!e.o(a,o)&&Object.defineProperty(a,o,{enumerable:!0,get:t[o]})}})(),(()=>{e.f={},e.e=a=>Promise.all(Object.keys(e.f).reduce(((t,o)=>(e.f[o](a,t),t)),[]))})(),(()=>{e.u=a=>"js/"+a+"."+{591:"fd9cb239",961:"8d790549"}[a]+".js"})(),(()=>{e.miniCssF=a=>"css/"+a+".401b363e.css"})(),(()=>{e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"===typeof window)return window}}()})(),(()=>{e.o=(a,t)=>Object.prototype.hasOwnProperty.call(a,t)})(),(()=>{var a={},t="comprar-bem:";e.l=(o,s,i,r)=>{if(a[o])a[o].push(s);else{var n,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==o||u.getAttribute("data-webpack")==t+i){n=u;break}}n||(l=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,e.nc&&n.setAttribute("nonce",e.nc),n.setAttribute("data-webpack",t+i),n.src=o),a[o]=[s];var m=(t,e)=>{n.onerror=n.onload=null,clearTimeout(p);var s=a[o];if(delete a[o],n.parentNode&&n.parentNode.removeChild(n),s&&s.forEach((a=>a(e))),t)return t(e)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=m.bind(null,n.onerror),n.onload=m.bind(null,n.onload),l&&document.head.appendChild(n)}}})(),(()=>{e.r=a=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})}})(),(()=>{e.p="/ComprarBem/"})(),(()=>{if("undefined"!==typeof document){var a=(a,t,o,s,i)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",e.nc&&(r.nonce=e.nc);var n=e=>{if(r.onerror=r.onload=null,"load"===e.type)s();else{var o=e&&e.type,n=e&&e.target&&e.target.href||t,l=new Error("Loading CSS chunk "+a+" failed.\n("+o+": "+n+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=o,l.request=n,r.parentNode&&r.parentNode.removeChild(r),i(l)}};return r.onerror=r.onload=n,r.href=t,o?o.parentNode.insertBefore(r,o.nextSibling):document.head.appendChild(r),r},t=(a,t)=>{for(var e=document.getElementsByTagName("link"),o=0;o<e.length;o++){var s=e[o],i=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(i===a||i===t))return s}var r=document.getElementsByTagName("style");for(o=0;o<r.length;o++){s=r[o],i=s.getAttribute("data-href");if(i===a||i===t)return s}},o=o=>new Promise(((s,i)=>{var r=e.miniCssF(o),n=e.p+r;if(t(r,n))return s();a(o,n,null,s,i)})),s={524:0};e.f.miniCss=(a,t)=>{var e={961:1};s[a]?t.push(s[a]):0!==s[a]&&e[a]&&t.push(s[a]=o(a).then((()=>{s[a]=0}),(t=>{throw delete s[a],t})))}}})(),(()=>{var a={524:0};e.f.j=(t,o)=>{var s=e.o(a,t)?a[t]:void 0;if(0!==s)if(s)o.push(s[2]);else{var i=new Promise(((e,o)=>s=a[t]=[e,o]));o.push(s[2]=i);var r=e.p+e.u(t),n=new Error,l=o=>{if(e.o(a,t)&&(s=a[t],0!==s&&(a[t]=void 0),s)){var i=o&&("load"===o.type?"missing":o.type),r=o&&o.target&&o.target.src;n.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",n.name="ChunkLoadError",n.type=i,n.request=r,s[1](n)}};e.l(r,l,"chunk-"+t,t)}},e.O.j=t=>0===a[t];var t=(t,o)=>{var s,i,[r,n,l]=o,c=0;if(r.some((t=>0!==a[t]))){for(s in n)e.o(n,s)&&(e.m[s]=n[s]);if(l)var d=l(e)}for(t&&t(o);c<r.length;c++)i=r[c],e.o(a,i)&&a[i]&&a[i][0](),a[i]=0;return e.O(d)},o=self["webpackChunkcomprar_bem"]=self["webpackChunkcomprar_bem"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=e.O(void 0,[504],(()=>e(773)));o=e.O(o)})();
//# sourceMappingURL=app.36455019.js.map